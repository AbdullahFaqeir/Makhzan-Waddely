import{r as l,a3 as f,j as e,ao as h,a4 as A,T as i,B as m,ap as c,aq as u,k as d,aa as v,aE as P,l as S,bs as b,aJ as w,D,bt as C,bu as N,a2 as T,N as F,P as I}from"./main-BdzhGpqn.js";import{A as p,a as x,b as E}from"./account-settings-sidenav-DvoxIF6E.js";import{u as L,S as U,C as z,T as k,a as O}from"./two-factor-panel-BkNHUmTY.js";import{A as V}from"./access-token-panel-3ZzdIRh_.js";import{I as B}from"./image-selector-D4wNsD_9.js";import{F as g}from"./file-upload-provider-Cq9bpz4o.js";import{A as _}from"./AlternateEmail-DUXU6bra.js";import{u as R,L as $}from"./localization-panel-BK4u-k31.js";import{C as q}from"./confirmation-dialog-DtIJ4lxn.js";import"./use-all-social-logins-disabled-Cl0og6gM.js";import"./PhonelinkLock-B6EAD-Hr.js";import"./Lock-DVBKuRe-.js";import"./Login-DhVXLpJA.js";import"./list-DRfBegha.js";import"./Tablet-5AqDBePu.js";import"./envato-Bf0_i_G0.js";import"./google-CssrBl3X.js";import"./use-social-login-BZkWBzp4.js";import"./dialog-footer-DL2JkwrZ.js";import"./skeleton-CTimao-U.js";import"./external-link-BX7ebgFF.js";import"./formatted-date-hsbUwQxj.js";import"./use-date-formatter-BlrPWK68.js";import"./use-clipboard-JHhdQEsB.js";import"./index-DT7-cvGh.js";import"./secure-files-DjSbgaf8.js";import"./use-active-upload-DEBAs0lx.js";import"./open-upload-window-DBvxFCUj.js";import"./uploaded-file-BYIHeonQ.js";import"./shallow-DE7pCYeO.js";import"./AddAPhoto-DuYWQYIn.js";import"./progress-bar-base-LbuncwuG.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./combobox-BSHBFZKL.js";import"./select-l28gQBMg.js";import"./countries-BJ4WnA-N.js";function H({user:s}){const t=l.useId(),a=f({defaultValues:{name:s.name||"",image:s.image}});j(s.id);const r=R(s.id,a);return e.jsx(p,{id:x.AccountDetails,title:e.jsx(i,{message:"Update name and profile image"}),actions:e.jsx(m,{type:"submit",variant:"flat",color:"primary",form:t,disabled:r.isPending||!a.formState.isValid||!a.formState.isDirty,children:e.jsx(i,{message:"Save"})}),children:e.jsxs(h,{form:a,className:"flex flex-col items-center gap-40 md:flex-row md:gap-60",onSubmit:n=>{r.mutate(n,{onSuccess:()=>{a.reset({...a.getValues(),...n})}})},id:t,children:[e.jsx(g,{children:e.jsx(J,{user:s})}),e.jsxs("div",{className:"w-full flex-auto",children:[e.jsxs("div",{className:"mb-16 flex items-center gap-4 text-muted",children:[e.jsx(_,{size:"sm"}),s.email]}),e.jsx(A,{name:"name",label:e.jsx(i,{message:"Name"})})]})]})})}function J({user:s}){const[t,a]=l.useState(s.image),r=j(s.id);return e.jsx(g,{children:e.jsx(B,{value:t,uploadType:v.avatars,variant:"avatar",stretchPreview:!0,previewSize:"w-90 h-90",placeholderIcon:e.jsx(P,{label:s.name,size:"w-full h-full text-2xl",circle:!0}),showRemoveButton:!0,onChange:(n,o)=>{a(o==null?void 0:o.url),r.mutate({image:(o==null?void 0:o.url)??null,image_entry_id:(o==null?void 0:o.id)??null})}})})}function j(s){return c({mutationFn:t=>d.put(`users/${s}`,t).then(a=>a.data),onError:t=>u(t)})}function M(){const{user:s}=S(),t=b();return c({mutationFn:()=>Y(s.id),onSuccess:()=>{w("Account deleted"),t.mutate()},onError:a=>u(a)})}function Y(s){return d.delete(`users/${s}`,{params:{deleteCurrentUser:!0}}).then(t=>t.data)}function Z(){const s=M(),{withConfirmedPassword:t,isLoading:a}=L(),[r,n]=l.useState(!1);return e.jsxs(p,{id:x.DeleteAccount,title:e.jsx(i,{message:"Danger zone"}),children:[e.jsx(D,{type:"modal",isOpen:r,onOpenChange:n,onClose:o=>{o&&s.mutate()},children:e.jsx(q,{isDanger:!0,title:e.jsx(i,{message:"Delete account?"}),body:e.jsx(i,{message:"Your account will be deleted immediately and permanently. Once deleted, accounts can not be restored."}),confirm:e.jsx(i,{message:"Delete"})})}),e.jsx(m,{variant:"flat",color:"danger",disabled:a||s.isPending,onClick:()=>{t(()=>{n(!0)})},children:e.jsx(i,{message:"Delete account"})})]})}function Ee({panels:s,sidenavItems:t}){const{data:a,isLoading:r}=C("me",{with:["roles","social_profiles","tokens"]});return e.jsx(N,{children:e.jsxs("div",{className:"min-h-screen bg",children:[e.jsx(T,{children:e.jsx(i,{message:"Account Settings"})}),e.jsx(F,{menuPosition:"account-settings-page",color:"bg",className:"sticky top-0 z-10"}),e.jsx("div",{children:e.jsxs("div",{className:"container mx-auto px-24 py-24",children:[e.jsx("h1",{className:"text-3xl",children:e.jsx(i,{message:"Account settings"})}),e.jsx("div",{className:"mb-40 text-base text-muted",children:e.jsx(i,{message:"View and update your account details, profile and more."})}),r||!a?e.jsx(I,{className:"my-80","aria-label":"Loading user..",isIndeterminate:!0}):e.jsxs("div",{className:"flex items-start gap-24",children:[e.jsx(E,{items:t}),e.jsxs("main",{className:"flex-auto",children:[s?s(a.user):null,e.jsx(H,{user:a.user}),e.jsx(U,{user:a.user}),e.jsx(z,{}),e.jsx(k,{user:a.user}),e.jsx(O,{}),e.jsx($,{user:a.user}),e.jsx(V,{user:a.user}),e.jsx(Z,{})]})]})]})})]})})}export{Ee as AccountSettingsPage};
