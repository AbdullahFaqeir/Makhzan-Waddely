{"version":3,"file":"user-role-section-CaKKYyuQ.js","sources":["../../../common/foundation/resources/client/admin/users/requests/user-update-user.ts","../../../common/foundation/resources/client/admin/users/update-user-page/update-user-form.tsx","../../../common/foundation/resources/client/admin/users/update-user-page/user-role-section.tsx"],"sourcesContent":["import {UpdateUserPageUser} from '@common/admin/users/update-user-page/update-user-page-user';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {useNavigate} from '@common/ui/navigation/use-navigate';\nimport {useMutation} from '@tanstack/react-query';\nimport {message} from '@ui/i18n/message';\nimport {toast} from '@ui/toast/toast';\nimport {User} from '@ui/types/user';\nimport {UseFormReturn} from 'react-hook-form';\n\ninterface Response extends BackendResponse {\n  user: User;\n}\n\nexport interface UpdateUserPayload\n  extends Omit<Partial<UpdateUserPageUser>, 'email_verified_at'> {\n  email_verified_at?: boolean;\n}\n\nexport function useUpdateUser(\n  userId: number,\n  form?: UseFormReturn<UpdateUserPayload>,\n) {\n  const navigate = useNavigate();\n  return useMutation({\n    mutationFn: (payload: UpdateUserPayload) => updateUser(userId, payload),\n    onSuccess: () => {\n      toast(message('User updated'));\n      queryClient.invalidateQueries({queryKey: ['users']});\n      navigate('../..', {relative: 'path'});\n    },\n    onError: r => (form ? onFormQueryError(r, form) : showHttpErrorToast(r)),\n  });\n}\n\nfunction updateUser(\n  userId: number,\n  payload: UpdateUserPayload,\n): Promise<Response> {\n  if (payload.roles) {\n    payload.roles = payload.roles.map(r => r.id) as any;\n  }\n  return apiClient.put(`users/${userId}`, payload).then(r => r.data);\n}\n","import {DirtyFormSaveDrawer} from '@common/admin/crupdate-resource-layout';\nimport {\n  UpdateUserPayload,\n  useUpdateUser,\n} from '@common/admin/users/requests/user-update-user';\nimport {UpdateUserPageUser} from '@common/admin/users/update-user-page/update-user-page-user';\nimport {Form} from '@ui/forms/form';\nimport {ReactNode} from 'react';\nimport {UseFormReturn} from 'react-hook-form';\nimport {useOutletContext} from 'react-router';\n\ninterface Props {\n  form: UseFormReturn<Partial<UpdateUserPayload>>;\n  children: ReactNode;\n}\nexport function UpdateUserForm({form, children}: Props) {\n  const user = useOutletContext() as UpdateUserPageUser;\n  const updateUser = useUpdateUser(user.id, form);\n  return (\n    <Form\n      onSubmit={values => {\n        updateUser.mutate(values);\n      }}\n      onBeforeSubmit={() => form.clearErrors()}\n      form={form}\n    >\n      {children}\n      <DirtyFormSaveDrawer isLoading={updateUser.isPending} />\n    </Form>\n  );\n}\n","import {CrupdateResourceSection} from '@common/admin/crupdate-resource-layout';\nimport {useAuth} from '@common/auth/use-auth';\nimport {useNormalizedModels} from '@common/ui/normalized-model/use-normalized-models';\nimport {Avatar} from '@ui/avatar/avatar';\nimport {FormChipField} from '@ui/forms/input-field/chip-field/form-chip-field';\nimport {Item} from '@ui/forms/listbox/item';\nimport {Trans} from '@ui/i18n/trans';\nimport {useState} from 'react';\n\ninterface Props {\n  endpoint?: string;\n}\nexport function UserRoleSection({endpoint}: Props) {\n  const [query, setQuery] = useState('');\n  const {data} = useNormalizedModels(endpoint ?? 'normalized-models/role', {\n    query,\n  });\n  const {hasPermission} = useAuth();\n  return (\n    <CrupdateResourceSection label={<Trans message=\"Roles\" />}>\n      <FormChipField\n        className=\"mb-30\"\n        name=\"roles\"\n        suggestions={data?.results}\n        inputValue={query}\n        onInputValueChange={setQuery}\n        alwaysShowAvatar\n        readOnly={!hasPermission('users.update')}\n        description={\n          <Trans message=\"User will inherit all permissions from the roles they are assigned.\" />\n        }\n      >\n        {suggestion => (\n          <Item\n            key={suggestion.id}\n            value={suggestion.id}\n            startIcon={<Avatar label={suggestion.name} />}\n          >\n            {suggestion.name}\n          </Item>\n        )}\n      </FormChipField>\n    </CrupdateResourceSection>\n  );\n}\n"],"names":["useUpdateUser","userId","form","navigate","useNavigate","useMutation","payload","updateUser","toast","message","queryClient","onFormQueryError","r","showHttpErrorToast","apiClient","UpdateUserForm","children","user","useOutletContext","jsxs","Form","values","jsx","DirtyFormSaveDrawer","UserRoleSection","endpoint","query","setQuery","useState","data","useNormalizedModels","hasPermission","useAuth","CrupdateResourceSection","Trans","FormChipField","suggestion","Item","Avatar"],"mappings":"sUAqBO,SAASA,EACdC,EACAC,EACA,CACA,MAAMC,EAAWC,EAAA,EACjB,OAAOC,EAAY,CACjB,WAAaC,GAA+BC,EAAWN,EAAQK,CAAO,EACtE,UAAW,IAAM,CACfE,EAAMC,EAAQ,cAAc,CAAC,EAC7BC,EAAY,kBAAkB,CAAC,SAAU,CAAC,OAAO,EAAE,EACnDP,EAAS,QAAS,CAAC,SAAU,MAAA,CAAO,CACtC,EACA,WAAeD,EAAOS,EAAiBC,EAAGV,CAAI,EAAIW,EAAmBD,CAAC,CAAA,CACvE,CACH,CAEA,SAASL,EACPN,EACAK,EACmB,CACnB,OAAIA,EAAQ,QACVA,EAAQ,MAAQA,EAAQ,MAAM,IAAIM,GAAKA,EAAE,EAAE,GAEtCE,EAAU,IAAI,SAASb,CAAM,GAAIK,CAAO,EAAE,KAAKM,GAAKA,EAAE,IAAI,CACnE,CC9BO,SAASG,EAAe,CAAC,KAAAb,EAAM,SAAAc,GAAkB,CACtD,MAAMC,EAAOC,EAAA,EACPX,EAAaP,EAAciB,EAAK,GAAIf,CAAI,EAC9C,OACEiB,EAAAA,KAACC,EAAA,CACC,SAAUC,GAAU,CAClBd,EAAW,OAAOc,CAAM,CAC1B,EACA,eAAgB,IAAMnB,EAAK,YAAA,EAC3B,KAAAA,EAEC,SAAA,CAAAc,EACDM,EAAAA,IAACC,EAAA,CAAoB,UAAWhB,EAAW,SAAA,CAAW,CAAA,CAAA,CAAA,CAG5D,CClBO,SAASiB,EAAgB,CAAC,SAAAC,GAAkB,CACjD,KAAM,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAAS,EAAE,EAC/B,CAAC,KAAAC,CAAA,EAAQC,EAAoBL,GAAY,yBAA0B,CACvE,MAAAC,CAAA,CACD,EACK,CAAC,cAAAK,CAAA,EAAiBC,EAAA,EACxB,aACGC,EAAA,CAAwB,YAAQC,EAAA,CAAM,QAAQ,QAAQ,EACrD,SAAAZ,EAAAA,IAACa,EAAA,CACC,UAAU,QACV,KAAK,QACL,YAAaN,GAAA,YAAAA,EAAM,QACnB,WAAYH,EACZ,mBAAoBC,EACpB,iBAAgB,GAChB,SAAU,CAACI,EAAc,cAAc,EACvC,YACET,EAAAA,IAACY,EAAA,CAAM,QAAQ,qEAAA,CAAsE,EAGtF,SAAAE,GACCd,EAAAA,IAACe,EAAA,CAEC,MAAOD,EAAW,GAClB,UAAWd,EAAAA,IAACgB,EAAA,CAAO,MAAOF,EAAW,KAAM,EAE1C,SAAAA,EAAW,IAAA,EAJPA,EAAW,EAAA,CAKlB,CAAA,EAGN,CAEJ"}