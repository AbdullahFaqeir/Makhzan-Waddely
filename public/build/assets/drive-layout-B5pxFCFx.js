import{r as m,j as e,aw as Ae,J as F,am as oe,c as D,e as le,ax as C,k as P,ap as T,aq as $,a1 as ks,w as B,a8 as z,M as Q,R as U,ay as Le,P as ie,S as be,az as Ss,T as c,l as R,aA as kt,D as ce,B as E,aB as V,h as H,aC as Re,a0 as Ds,aD as je,aE as Qe,aF as te,aG as He,aH as Ye,A as Y,y as _,z as Es,x as k,aI as ye,aJ as L,aK as St,ai as Ce,af as ze,aL as Dt,a6 as W,aM as Ge,aN as Fe,aO as Ns,aP as Xe,ar as we,g as Ie,a3 as ke,Q as Z,ao as Se,aQ as Et,a4 as De,aR as Nt,ak as We,al as _e,U as Pt,aS as Ft,E as Ct,aT as Mt,aU as Tt,au as Ke,aV as Ps,L as Ze,aW as q,aX as Ee,aY as Fs,aZ as Cs,a_ as At,a$ as Lt,at as fe,b0 as Rt,ad as xs,b1 as zt,b2 as Wt,C as _t,b3 as $t,b4 as Ot,b5 as Kt,a2 as qt,b6 as Bt}from"./main-BdzhGpqn.js";import{D as Ut,a as Vt}from"./dashboard-layout-DZ4Y7yas.js";import{D as J}from"./dashboard-layout-context-DDiFtkN0.js";import{u as S,a as Je,d as g,m as Ms,S as X,g as es,R as M,b as Qt,c as Ts,e as Ht,f as Yt,E as ss,h as ts,T as ve,B as Gt,i as Xt,j as Zt,k as Jt,l as en,n as As,o as fs,p as ns,q as sn,r as tn,s as nn,t as rn,v as an,w as on,D as ln,x as cn,y as dn,z as un,A as mn}from"./dashboard-content-header-By3paBPj.js";import{D as hs}from"./dashboard-sidenav-DvKGfXRN.js";import{F as pn,a as xn,b as fn}from"./file-preview-dialog-C3JXygxI.js";import{u as se,F as hn}from"./file-upload-provider-Cq9bpz4o.js";import{P as gs,F as Me,U as gn,G as Ls,H as jn,B as vn}from"./Backup-bUbYJoCF.js";import{L as Rs,a as Be}from"./list-DRfBegha.js";import{a as bn,C as zs}from"./form-chip-field-Bj0OQHU9.js";import{A as rs}from"./Add-iOynMxF0.js";import{F as js}from"./formatted-date-hsbUwQxj.js";import{G as yn}from"./Groups-CBqd8bRk.js";import{p as Ue}from"./pretty-bytes-bO14ePu9.js";import{M as Ws}from"./MoreVert-BJhX_Lfk.js";import{d as vs,a as _s,u as $s,b as $e,c as wn,e as bs}from"./use-droppable-BTd4cZc2.js";import{C as In}from"./checkbox-B6q4SJqi.js";import{i as kn,a as Sn,T as Dn,b as En}from"./table-BV_6nbvK.js";import{u as Os}from"./use-pointer-events-Dsln3OKq.js";import{B as Ks,a as Te}from"./breadcrumb-DXXuqeGE.js";import{F as Ne,a as Pe,e as qs}from"./select-filter-panel-BD_PypVS.js";import{F as Nn}from"./file-entry-index-filters-B6qMH1XZ.js";import{c as Pn,u as Fn,F as Cn}from"./timestamp-filters-Bn_q9MOg.js";import{A as Mn}from"./ad-host-BsbSWmNF.js";import{F as Tn}from"./date-picker-BiDllGjz.js";import{F as qe,S as as}from"./switch-DFT-JawA.js";import{A as Bs}from"./ArrowBack-V0Wwapyg.js";import{D as de}from"./dialog-footer-DL2JkwrZ.js";import{C as An,a as Us,D as Ln,P as Rn,S as zn}from"./Sort-DwtelFLc.js";import{u as Vs}from"./use-clipboard-JHhdQEsB.js";import{u as Wn}from"./use-normalized-models-yOhv1j4Y.js";import{C as ue}from"./confirmation-dialog-DtIJ4lxn.js";import{C as _n}from"./combobox-BSHBFZKL.js";import{C as $n}from"./ChevronRight-C9FQjnQQ.js";import{u as Qs}from"./shallow-DE7pCYeO.js";import{u as On}from"./index-DiWaU00_.js";import{F as Kn}from"./FileUpload-CPJ1F6GL.js";import{o as ys}from"./open-upload-window-DBvxFCUj.js";import{I as qn}from"./Info-BDC5laOJ.js";import{S as Bn}from"./section-helper-D3pP9ZUR.js";import{L as Un}from"./external-link-BX7ebgFF.js";import{D as Hs}from"./Delete-Bd6wbCuT.js";import{E as Vn}from"./Edit-AfuLMjS-.js";import{A as Qn}from"./ArrowRight-DCiCmNhU.js";import{S as Hn}from"./Storage-DeJGZK1-.js";import{P as Yn}from"./progress-bar-base-LbuncwuG.js";import"./use-previous-BIOPjABW.js";import"./FileDownload-CzvSUcXm.js";import"./Link-JJQq45pr.js";import"./download-file-from-url-BVaKcxRP.js";import"./index-DT7-cvGh.js";import"./uploaded-file-BYIHeonQ.js";import"./ChevronLeft-CFnMYWTj.js";import"./KeyboardArrowRight-DFizyHtY.js";import"./input-CDTJ1VfY.js";import"./use-date-formatter-BlrPWK68.js";import"./useGlobalListeners-C14jVC5X.js";import"./CheckBoxOutlineBlank-DvnJQjlB.js";import"./skeleton-CTimao-U.js";import"./ArrowDownward-DXr7353z.js";import"./useEffectEvent-D8HiMrwe.js";import"./MoreHoriz-uyJcPOJk.js";import"./ArrowRightAlt-DSM1kJ5L.js";import"./DateRange-DT2RCJ3g.js";import"./use-base-date-picker-state-DYteqbZD.js";import"./use-date-range-picker-state-CEbm743A.js";import"./use-current-date-time-CnLDai64.js";import"./select-l28gQBMg.js";import"./user-D6GCMJ6c.js";import"./formatted-number-pJC-IR-x.js";import"./getScrollParent--OCc5gFh.js";function Ys({entryType:s,entryName:t}){const{setRightSidenavStatus:n}=m.useContext(J);return e.jsxs("div",{className:"mb-38 flex gap-16",children:[e.jsx(Ae,{className:"h-24 w-24",type:s}),e.jsx("div",{className:"mr-auto min-w-0 flex-auto break-words text-base font-medium leading-6 text-main",children:t}),e.jsx(F,{size:"sm",iconSize:"md",className:"-mt-6 ml-auto flex-shrink-0",onClick:()=>{n("closed")},children:e.jsx(oe,{})})]})}function is({children:s,margin:t="mb-20"}){return e.jsx("div",{className:D("text-base font-medium text-main",t),children:s})}function Gn(s){return le({queryKey:Gs(s),queryFn:()=>Xn(s),initialData:s.initialData?{tags:s.initialData}:void 0})}function Gs(s){const{taggableType:t,taggableId:n,type:r,notType:a}=s,i=["tags","taggable",t,`${n}`];return r!=null&&i.push(r),a!=null&&i.push(a),i}function Xs({taggableType:s,taggableIds:t}){return Promise.allSettled(t.map(n=>C.invalidateQueries({queryKey:Gs({taggableType:s,taggableId:n})})))}async function Xn({taggableType:s,taggableId:t,notType:n,type:r}){return P.get(`taggable/${s}/${t}/list-tags`,{params:{notType:n,type:r}}).then(a=>a.data)}function Zs(){return T({mutationFn:s=>Zn(s),onSuccess:(s,t)=>{Xs(t)},onError:s=>$(s)})}function Zn(s){return P.post("taggable/detach-tag",s).then(t=>t.data)}function Jn(){return T({mutationFn:s=>er(s),onSuccess:async(s,t)=>{Xs(t)},onError:s=>$(s)})}function er(s){return P.post("taggable/attach-tag",s).then(t=>t.data)}function sr(s){return le({queryKey:["tags",s],queryFn:({signal:t})=>tr(s,t),placeholderData:ks})}async function tr(s,t){return s.query&&await new Promise(n=>setTimeout(n,300)),P.get("tags",{params:{paginate:"simple",...s},signal:s.query?t:void 0}).then(n=>n.data)}function nr({attachedTags:s,tagType:t,notTagType:n,taggableType:r,taggableIds:a,userId:i,isLoading:o,onChange:l,onSelected:d}){const{trans:u}=B(),[x,p]=m.useState(""),{close:j}=z(),{data:f,isPlaceholderData:b,isLoading:h}=sr({type:t,notType:n,query:x,userId:i}),y=Zs(),w=Jn(),{tags:v,attachedTagIds:A}=m.useMemo(()=>{const N=(f==null?void 0:f.pagination.data)||[],O=s||[],K=O.map(I=>I.id),ee=N.filter(I=>!K.includes(I.id));return ee.unshift(...O),{tags:ee,attachedTagIds:K}},[s,f]);return e.jsx(Q,{children:e.jsxs(U,{padding:"p-8",children:[e.jsx("form",{children:e.jsx(Le,{placeholder:u({message:"Type tag name..."}),inputBorder:"border-b",inputRadius:"rounded-none",inputRing:"ring-0",inputShadow:"shadow-none",startAdornment:e.jsx(be,{}),value:x,onChange:N=>p(N.target.value),endAdornment:b&&e.jsx(ie,{isIndeterminate:!0,size:"w-24 h-24"})})}),e.jsxs(Rs,{className:"compact-scrollbar h-320 overflow-y-auto stable-scrollbar",children:[v.map(N=>{const O=A.includes(N.id),K=w.isPending||y.isPending||o;return e.jsx(Be,{isDisabled:K,onSelected:()=>{if(d){d(N.name),j();return}!a||!r||(O?y.mutate({tagId:N.id,taggableIds:a,taggableType:r},{onSuccess:()=>l==null?void 0:l(N.id)}):w.mutate({taggableType:r,taggableIds:a,tagName:N.name,userId:i,tagType:t},{onSuccess:()=>l==null?void 0:l(N.id)}))},className:D(O&&(K?"text-primary-light":"text-primary")),startIcon:e.jsx(gs,{size:"xs"}),endSection:O?e.jsx(Ss,{size:"sm",className:"block text-primary"}):e.jsx("div",{className:"h-20 w-20"}),children:N.name},N.id)}),!b&&!(f!=null&&f.pagination.data.length)&&x&&e.jsx(Be,{startIcon:e.jsx(gs,{size:"xs"}),onSelected:()=>{if(d){d(x),j();return}!a||!r||w.mutate({taggableType:r,taggableIds:a,tagName:x,userId:i,tagType:t},{onSuccess:N=>{p(""),l==null||l(N.tag.id)}})},children:e.jsx(c,{message:'Create tag ":name"',values:{name:x}})}),f&&!v.length&&!x&&e.jsx("li",{className:"text-center text-muted",children:e.jsx(c,{message:"No tags found"})}),h&&e.jsx("li",{className:"flex justify-center",children:e.jsx(ie,{isIndeterminate:!0,size:"w-24 h24"})})]})]})})}function rr({entry:s}){var i;const{user:t}=R(),n=Zs(),{data:r,isFetching:a}=Gn({taggableType:"fileEntry",taggableId:s.id,initialData:(i=s.tags)==null?void 0:i.filter(o=>o.type!=="label"),type:"custom"});return e.jsxs("div",{className:"mt-20 border-t pt-20",children:[e.jsx(is,{margin:"mb-10",children:e.jsx(c,{message:"Tags"})}),e.jsx("div",{className:"flex items-center gap-8",children:e.jsx(bn,{size:"sm",radius:"rounded-button",startButton:e.jsxs(ce,{type:"modal",children:[e.jsx(E,{variant:"outline",startIcon:e.jsx(rs,{}),size:"2xs",className:"min-h-26",children:e.jsx(c,{message:"Add tag"})}),e.jsx(nr,{attachedTags:r==null?void 0:r.tags,isLoading:a,tagType:"custom",taggableType:"fileEntry",taggableIds:[s.id],userId:t==null?void 0:t.id})]}),children:r==null?void 0:r.tags.map(o=>e.jsx(kt,{disabled:n.isPending||a,onRemove:()=>{n.mutate({tagId:o.id,taggableIds:[s.id],taggableType:"fileEntry"})},children:o.display_name||o.name},o.id))})})]})}function Js(){const{user:s}=R(),{workspaceId:t}=V(),n={userId:s.id,workspaceId:t};return le({...H.userFolders.index(n),enabled:!!s})}const ar=s=>{var a;const n=s.pages[0].folder,r=g().activePage;return n&&r&&r.uniqueId===n.hash&&(!r.folder||!Ds(n.permissions,(a=r.folder)==null?void 0:a.permissions))&&g().setActivePage(Ms(n)),s};function os(){var d;const s=S(u=>u.activePage),t=S(u=>u.sortDescriptor),[n]=Re(),{workspaceId:r}=V(),a={section:s==null?void 0:s.name,...s==null?void 0:s.queryParams,...Object.fromEntries(n),folderId:s!=null&&s.isFolderPage?s.uniqueId:null,workspaceId:r,...t},i=s===X&&!a.query&&!a.filters,o=Je({...H.driveEntries.index(a),enabled:s!=null&&!i});m.useEffect(()=>{var u;(u=o.data)!=null&&u.pages[0].folder&&ar(o.data)},[o.data]);const l=m.useMemo(()=>{var u;return((u=o.data)==null?void 0:u.pages.flatMap(x=>x.data))||[]},[(d=o.data)==null?void 0:d.pages]);return{...o,items:l,isEmpty:!l.length}}function Oe(){const s=S(n=>n.selectedEntries),{items:t}=os();return Array.from(s).map(n=>t.find(r=>r.id===n)).filter(n=>!!n)}function ls(){const s=Array.from(g().selectedEntries),t=C.getQueriesData({queryKey:H.driveEntries.invalidateKey}),n=[];for(const r of t){const a=r[1]?r[1].pages.flatMap(i=>i.data):[];for(const i of a)s.includes(i.id)&&!n.find(o=>o.id===i.id)&&n.push(i)}return n}function ir({entry:s}){return e.jsxs("div",{children:[e.jsx(Ys,{entryType:s.type,entryName:s.name}),s.type==="image"&&e.jsx(pn,{className:"mb-20 overflow-hidden rounded-panel border border-divider-lighter",file:s}),e.jsxs("div",{children:[e.jsx(is,{children:e.jsx(c,{message:"Who has access"})}),e.jsxs("div",{className:"flex items-center gap-14",children:[s.workspace_id?e.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-full border",children:e.jsx(yn,{className:"icon-md"})}):null,s.users.map(t=>e.jsx(je,{label:t.name,children:e.jsx(Qe,{src:t.image,label:t.name,size:"md"})},t.id))]}),s.permissions["files.update"]&&e.jsx(E,{className:"mt-20 block",variant:"outline",size:"xs",color:"primary",onClick:()=>{g().setActiveActionDialog("share",[s])},children:e.jsx(c,{message:"Manage Access"})})]}),e.jsx(or,{entry:s}),e.jsx(rr,{entry:s})]})}function or({entry:s}){const t=lr(),n=te(),r=s.users.find(i=>i.owns_entry),a=m.useMemo(()=>Ue(s.file_size),[s.file_size]);return e.jsxs("div",{className:"mt-20 border-t pt-20",children:[e.jsx(is,{children:e.jsx(c,{message:"Properties"})}),e.jsx(re,{label:e.jsx(c,{message:"Type"}),value:e.jsx("span",{className:"capitalize",children:e.jsx(c,{message:s.type})})}),e.jsx(re,{label:e.jsx(c,{message:"Size"}),value:s.file_size?a:"-"}),e.jsx(re,{label:e.jsx(c,{message:"Location"}),value:e.jsx(E,{variant:"link",startIcon:e.jsx(Me,{}),onClick:()=>{n(t?es(t.hash):M.path)},children:t?t.name:e.jsx(c,{message:"Root"})})}),r&&e.jsx(re,{label:e.jsx(c,{message:"Owner"}),value:r.name}),e.jsx(re,{label:e.jsx(c,{message:"Modified"}),value:e.jsx(js,{date:s.updated_at})}),e.jsx(re,{label:e.jsx(c,{message:"Created"}),value:e.jsx(js,{date:s.updated_at})})]})}function re({label:s,value:t}){return e.jsxs("div",{className:"mb-14 flex items-center",children:[e.jsx("div",{className:"w-1/3 text-xs text-muted",children:s}),e.jsx("div",{className:"w-2/3 text-sm text-main",children:t})]})}function lr(){const s=Oe()[0],{data:t}=Js();if(!(!s||!(t!=null&&t.folders)))return t.folders.find(n=>n.id===s.parent_id)}const cr=""+new URL("detailed-examination-DRXViCsL.svg",import.meta.url).href;function dr({className:s}){const t=Oe()[0];return e.jsx("div",{className:D(s,"dashboard-rounded-panel h-full overflow-y-auto border-divider-lighter p-18 text-sm text-muted lg:ml-8"),children:t?e.jsx(ir,{entry:t}):e.jsx(ur,{})})}function ur(){return e.jsxs(m.Fragment,{children:[e.jsx(Ys,{entryType:"folder",entryName:e.jsx(c,{message:"All files"})}),e.jsx(He,{image:e.jsx(Ye,{src:cr}),description:e.jsx(c,{message:"Select file or folder to see details"})})]})}function et({className:s}){const t=Oe();return t.length?e.jsx("div",{className:s,children:e.jsx(mr,{entries:t})}):null}function mr({entries:s}){const t=Qt(s),n=Ts(s),r=Ht(s),a=Yt(s),i=[t,n,r,a].filter(o=>!!o);return e.jsxs("div",{className:"entry-action-list",children:[i.map(o=>e.jsx(je,{label:e.jsx(c,{...o.label}),children:e.jsx(F,{size:"sm",onClick:()=>{o.execute()},children:m.createElement(o.icon)})},o.key)),e.jsx(ss,{entries:s,children:e.jsx(je,{label:e.jsx(c,{message:"More actions"}),children:e.jsx(F,{children:e.jsx(Ws,{})})})})]})}function cs(s){return`${s.id}-tree`}function pr(s){return`${s}`.endsWith("-tree")}function xr(s){const t=m.useRef(s),n=m.useId();m.useEffect(()=>(vs.set(n,t.current),()=>{vs.delete(n)}),[n])}function fr(){const s=m.useRef(null),[t,n]=m.useState(),[r,a]=m.useState({});xr({type:"fileEntry",onDragStart:(o,l)=>{const d=l;d&&(a({entries:d.getData(),e:o,draggingTreeItem:pr(d.id)}),n({start:o}))},onDragMove:o=>{a(l=>({...l,e:o})),n(l=>({...l,end:o}))},onDragEnd:(o,l,d)=>{a({status:d})}});let i=null;return r.entries&&r.e&&(i=e.jsx("div",{ref:s,style:r.e?{transform:`translate(${r.e.x}px, ${r.e.y}px)`,width:`${r.e.rect.width}px`}:void 0,className:"pointer-events-none fixed left-0 top-0 isolate",children:r.entries.map((o,l)=>e.jsx(hr,{index:l,entry:o,points:t,state:r},o.id))})),e.jsx(Y,{custom:r.status,children:i})}const hr=m.memo(({entry:s,points:t,index:n,state:r})=>{var x,p,j,f;const a=S(b=>b.viewMode),i=r.draggingTreeItem?cs(s):s.id,o=_s.get(i);if(!(o!=null&&o.rect)||!(t!=null&&t.start))return null;const l=o.rect,d=((x=r.entries)==null?void 0:x.length)||0,u=b=>{var h,y,w;return b==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:l.left-(((h=t.end)==null?void 0:h.x)||0),y:l.top-(((y=t.end)==null?void 0:y.y)||0),width:`${(w=r.e)==null?void 0:w.rect.width}px`}};return e.jsxs(_.div,{transition:{delay:.01*n,bounce:0,duration:.2},initial:{x:l.left-t.start.x,y:l.top-t.start.y,width:`${(p=r.e)==null?void 0:p.rect.width}px`},animate:{x:0,y:0,width:a==="list"?288:void 0},exit:u,style:{width:a==="grid"?`${(j=r.e)==null?void 0:j.rect.width}px`:void 0,height:`${(f=r.e)==null?void 0:f.rect.height}px`},className:D("absolute max-h-48 whitespace-nowrap rounded-button border border-primary-light bg-elevated",n<2&&"shadow",n===0&&"left-0 top-0 z-10",n>0&&"left-6 top-6"),children:[d>1&&n===0&&e.jsx(gr,{count:d}),e.jsxs("div",{className:"flex h-full items-center justify-center gap-10 overflow-hidden bg-primary-light/20 px-16 text-sm",children:[e.jsx(Ae,{type:s.type}),e.jsx("div",{className:"flex-auto overflow-hidden text-ellipsis",children:s.name})]})]},s.id)}),gr=m.memo(({count:s})=>e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -right-6 -top-6 z-10 z-30 flex h-20 w-20 items-center justify-center rounded-full bg-danger text-sm font-bold text-white shadow-lg",children:s},"entryCount"));function jr({isVisible:s}){const t=e.jsx(_.div,{...Es,transition:{duration:.3},className:"pointer-events-none absolute inset-0 min-h-full w-full border-2 border-dashed border-primary bg-primary-light/30",children:e.jsx(_.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"fixed bottom-0 left-0 right-0 mx-auto max-w-max rounded bg-primary p-10 text-on-primary",children:e.jsx(c,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return e.jsx(Y,{children:s?t:null})}function st(){return T({mutationFn:s=>(L.loading(k("Moving [one 1 item|other :count items]...",{values:{count:s.entryIds.length}}),{disableExitAnimation:!0}),vr(s)),onSuccess:(s,t)=>{C.invalidateQueries({queryKey:ye}),L(k('Moved [one 1 item|other :count items] to ":destination"',{values:{count:t.entryIds.length,destination:(s.destination||M.folder).name}}),{disableEnterAnimation:!0})},onError:s=>$(s,k("Could not move items"),null,{disableEnterAnimation:!0})})}function vr(s){return s.destinationId=s.destinationId?s.destinationId:null,P.post("file-entries/move",s).then(t=>t.data)}function ds(s,t){return t.type!=="folder"||!t.permissions["files.update"]&&!s.every(n=>n.permissions["files.update"])?!1:s.every(n=>!n||t.id===n.parent_id||!n.parent_id&&t.id===0?!1:!br(t,n))}function br(s,t){const n=(s.path||"").split("/");return(t.path||"").split("/").every((a,i)=>n[i]===a)}function tt(s){const t=st(),{uploadFiles:n}=ts();return{onDrop:async a=>{if(s.type==="folder"){if(a.type==="nativeFile")n(await a.getData(),{parentId:s.id});else if(a.type==="fileEntry"){const i=a.getData();i!=null&&i.length&&ds(i,s)&&(t.mutate({destinationId:s.id,entryIds:i.map(o=>o.id)}),g().deselectEntries("all"))}}}}}function Ve(s,t){if(s.type==="fileEntry"){const n=s.getData();return ds(n,t)}return!0}const he=new Map;function yr(s){const{id:t,ref:n}=s,r=m.useRef(s);r.current=s,m.useLayoutEffect(()=>{if(n.current)return he.set(t,{...he.get(t),id:t,ref:n,onSelected:()=>{var a,i;(i=(a=r.current).onSelected)==null||i.call(a)},onDeselected:()=>{var a,i;return(i=(a=r.current).onDeselected)==null?void 0:i.call(a)}}),()=>{_s.delete(t)}},[t,r,n])}function wr(){return St("((pointer: coarse))")}function nt(s){const t=wr(),n=m.useRef(null),{onDrop:r}=tt(s),[a,i]=m.useState(!1),o=S(p=>p.entriesBeingDragged.includes(s.id)),l=S(p=>p.activePage),{draggableProps:d}=$s({disabled:!!t||l===ve,id:s.id,type:"fileEntry",ref:n,hidePreview:!0,onDragStart:(p,j)=>{g().selectedEntries.has(s.id)||g().selectEntries([s.id]),g().setEntriesBeingDragged(j.getData().map(f=>f.id))},onDragEnd:()=>{g().setEntriesBeingDragged([])},getData:()=>ls()}),{droppableProps:u}=$e({id:s.id,disabled:t||s.type!=="folder",ref:n,types:["fileEntry","nativeFile"],acceptsDrop:p=>Ve(p,s),onDragEnter:()=>i(!0),onDragLeave:()=>i(!1),onDrop:r});yr({id:s.id,ref:n,onSelected:()=>{g().selectEntries([s.id],!0)},onDeselected:()=>{g().deselectEntries([s.id])}});const x=D(o&&"opacity-20",a&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:d,droppableProps:u,isDragOver:a,isDragging:o,itemClassName:x,ref:n}}function rt(){const s=te();return{performViewItemAction:m.useCallback(n=>{if(n&&n.type==="folder")g().activePage===ve?g().setActiveActionDialog("trashFolderBlock",[n]):s(es(n.hash));else{const r=ls();g().setActiveActionDialog("preview",r.length?r:[n])}},[s])}}function Ir({entry:s}){const t=S(f=>f.selectedEntries.has(s.id)),{performViewItemAction:n}=rt(),{isMobileMode:r}=m.useContext(J),{draggableProps:a,droppableProps:i,itemClassName:o,ref:l}=nt(s),d=()=>{t?g().deselectEntries([s.id]):g().selectEntries([s.id],!0)},u=(f,b)=>{r?g().selectedEntries.size?d():n(s):kn(f)?d():g().selectEntries([s.id])},{domProps:x}=Os({onLongPress:r?()=>d():void 0,onPress:u}),p=f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),f.stopPropagation(),n(s))},j=f=>{f.preventDefault(),f.stopPropagation(),r||(g().selectedEntries.has(s.id)||g().selectEntries([s.id]),g().setContextMenuData({x:f.clientX,y:f.clientY}))};return e.jsx(Gt,{...ze(a,i,x,{onKeyDown:Ce(p)}),ref:l,entry:s,isSelected:t,isMobileMode:!!r,tabIndex:-1,onDoubleClick:f=>{f.preventDefault(),f.stopPropagation(),r||n(s)},footerAdornment:r&&e.jsx(kr,{entry:s,isSelected:t}),onContextMenu:Ce(j),className:o})}function kr({entry:s,isSelected:t}){return S(r=>r.selectedEntries.size)?e.jsx(In,{className:"mr-8 block",checked:t}):e.jsx(ss,{entries:[s],children:e.jsx(F,{className:"text-muted",onPointerDown:r=>{r.stopPropagation()},children:e.jsx(Ws,{})})})}function Sr({entries:s}){return e.jsx("div",{className:"file-grid-container",children:e.jsx("div",{className:"file-grid",children:s.map(t=>e.jsx(Ir,{entry:t},t.id))})})}function Dr({item:s,children:t,className:n,...r}){const{isCollapsedMode:a}=m.useContext(Sn),{draggableProps:i,droppableProps:o,itemClassName:l,ref:d}=nt(s);return e.jsx("div",{className:D(n,l),ref:d,...ze(i,o,r,{onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),a||(g().selectedEntries.has(s.id)||g().selectEntries([s.id]),g().setContextMenuData({x:u.clientX,y:u.clientY}))}}),children:t})}function Er({entries:s}){const{performViewItemAction:t}=rt(),n=S(i=>i.selectedEntries),r=S(i=>i.sortDescriptor),a=m.useMemo(()=>[...n],[n]);return e.jsx(Dn,{columns:Xt,data:s,sortDescriptor:r,onSortChange:i=>{g().setSortDescriptor(i)},onAction:t,selectedRows:a,selectionStyle:"highlight",renderRowAs:Dr,onSelectionChange:i=>{g().selectEntries(i)}})}function Nr(){var a;const s=Oe(),t=S(i=>i.activePage),n=S(i=>i.contextMenuData),r=n!=null&&n.entry?[n.entry]:s;return((a=n==null?void 0:n.entry)==null?void 0:a.id)===0?e.jsx(ws,{position:n,page:M}):n&&r.length?e.jsx(Pr,{entries:r,position:n}):n&&t?e.jsx(ws,{position:n,page:t}):null}function Pr({entries:s,position:t}){const n=Jt(s);return e.jsx(at,{position:t,actions:n})}function ws({page:s,position:t}){const n=Zt(s);return e.jsx(at,{position:t,actions:n})}function at({position:s,actions:t}){return e.jsx(Dt,{floatingMinWidth:"min-w-224",position:s,onOpenChange:n=>{n||g().setContextMenuData(null)},children:t.map(n=>e.jsx(W,{value:n.key,onSelected:n.execute,startIcon:m.createElement(n.icon),children:e.jsx(c,{...n.label})},n.key))})}function it({isDisabled:s}){const t=S(n=>n.sortDescriptor);return e.jsx(en,{isDisabled:s,descriptor:t,onChange:n=>{g().setSortDescriptor(n)}})}function ot({className:s}){const{isMobileMode:t}=m.useContext(J),n=te(),r=S(x=>x.activePage),a=r==null?void 0:r.folder,i=As({hash:a==null?void 0:a.hash,isEnabled:(a==null?void 0:a.hash)!==M.folder.hash}),o=Ge(),l=Fr(),d=!r||!o||r.isFolderPage&&!a||i.fetchStatus!=="idle";let u;if(d)u=null;else{const x=l?[l]:[];i.data&&i.data.path.forEach(p=>{x.push({page:Ms(p),label:p.name})}),u=e.jsx(Ks,{className:s,size:t?"md":"lg",currentIsClickable:!0,children:x.map((p,j)=>j===x.length-1?e.jsx(Te,{children:({isMenuItem:b})=>b||!p.page.folder&&p.page!==ve?e.jsx(Fe,{value:p.label}):e.jsx(ss,{page:p.page,showIfNoActions:!0,children:e.jsxs(Ns,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[e.jsx(Fe,{value:p.label}),e.jsx(Xe,{className:"text-muted icon-md"})]})})},p.page.uniqueId):e.jsx(Te,{onSelected:()=>{n(p.page.path)},children:e.jsx(Fe,{value:p.label})},p.page.uniqueId))})}return u}function Fr(){var r,a;const s=S(i=>i.activePage),t=Ge(),{user:n}=R();if(!s)return null;if(t&&!t.default&&s!=null&&s.isFolderPage&&((s==null?void 0:s.name)===M.name||((r=s.folder)==null?void 0:r.workspace_id)===t.id))return{label:t.name,page:M};if(s!=null&&s.isFolderPage){const i=(a=s.folder)==null?void 0:a.users.find(o=>o.owns_entry);return(i==null?void 0:i.id)!==(n==null?void 0:n.id)?{label:fs.label,page:fs}:{label:M.label,page:M}}return{label:s.label,page:s}}const lt=[Nn,{key:"owner_id",label:k("Owner"),description:k("User file was uploaded by"),defaultOperator:Pe.eq,control:{type:Ne.Select,defaultValue:"02",options:[{key:"01",label:k("anyone"),value:{value:null,operator:"!="}},{key:"02",label:k("me"),value:"{authId}"},{key:"03",label:k("not me"),value:{value:"{authId}",operator:"!="}}]}},Pn({description:k("Date file was uploaded")}),Fn({description:k("Date file was last changed")}),{key:"deleted_at",label:k("In trash"),description:k("Only show files that are in the trash"),defaultOperator:Pe.ne,control:{type:Ne.BooleanToggle,defaultValue:null}},{key:"shareableLink",label:k("Has shareable link"),description:k("Only show files that have a shareable link"),defaultOperator:Pe.has,control:{type:Ne.BooleanToggle,defaultValue:"*"}},{control:{type:Ne.BooleanToggle,defaultValue:!0},key:"sharedByMe",label:k("Shared by me"),description:k("Only show files that are shared with someone"),defaultOperator:Pe.eq}],Cr=lt.map(s=>s.key);function Mr(){const s=S(l=>l.activePage),{isMobileMode:t}=m.useContext(J),{trans:n}=B(),r=te(),[a]=Re(),[i,o]=m.useState(a.get("query")||"");return s!==X?null:e.jsxs("div",{className:"mb-30 mt-10 px-10 md:px-26",children:[t&&e.jsx("form",{className:"contents",onSubmit:l=>{var d;l.preventDefault(),((d=document.activeElement)==null?void 0:d.tagName)==="INPUT"&&document.activeElement.blur(),r({pathname:X.path,search:`?query=${i}`},{replace:!0})},children:e.jsx(Le,{autoFocus:!0,className:"mb-20",startAdornment:e.jsx(F,{type:"submit",children:e.jsx(be,{})}),placeholder:n(k("Type to search")),value:i,onChange:l=>o(l.target.value)})}),e.jsx(Cn,{filters:lt,pinnedFilters:Cr})]})}function ct({query:{isInitialLoading:s,fetchNextPage:t,isFetchingNextPage:n,hasNextPage:r},children:a,loaderMarginTop:i="mt-24",style:o,className:l,variant:d="infiniteScroll",loadMoreExtraContent:u,size:x="sm"}){const p=m.useRef(null),j=n||s,[f,b]=m.useState(0),h=d==="loadMore"&&f<3?"loadMore":"infiniteScroll",y=m.useRef(!1);m.useEffect(()=>{const v=p.current;if(!v||h==="loadMore")return;const A=new IntersectionObserver(([N])=>{if(N.isIntersecting){if(!y.current)return;r&&!j&&(y.current=!1,t())}else y.current=!0});return A.observe(v),()=>{A.unobserve(v)}},[t,r,j,h]);let w;return a?w=n?a:null:h==="loadMore"?w=!s&&r&&e.jsxs("div",{className:D("flex items-center gap-8",i),children:[u,e.jsx(E,{size:x==="md"?"sm":"xs",className:D(x==="sm"?"min-h-24 min-w-96":"min-h-36 min-w-112"),variant:"outline",color:"primary",onClick:()=>{t(),b(f+1)},disabled:j,children:f>=2&&!n?e.jsx(c,{message:"Load all"}):e.jsx(c,{message:"Show more"})})]}):w=e.jsx(Y,{children:n&&e.jsx(_.div,{className:D("flex w-full justify-center",i),...Es,children:e.jsx(ie,{size:x,isIndeterminate:!0,"aria-label":"loading"})})}),e.jsxs("div",{style:o,className:D("w-full",l,r&&"min-h-36"),role:"presentation",children:[e.jsx("div",{ref:p,"aria-hidden":!0}),w]})}function Tr(s,t){return!s||!t?!1:s.left<=t.left+t.width&&s.left+s.width>=t.left&&s.top<=t.top+t.height&&s.top+s.height>=t.top}function Ar(s,t){const n={...s};n.left=Math.max(0,n.left);const r=n.left-s.left;r>0&&(n.width-=r),n.top=Math.max(0,n.top);const a=n.top-s.top;return a>0&&(n.height-=a),n.width=Math.min(n.width,t.width-n.left),n.height=Math.min(n.height,t.height-n.top),n}function Lr({onPointerDown:s,...t}={}){const n=m.useRef(null),r=t.containerRef||n,a=m.useRef(null);let i=m.useRef({}).current;const o=()=>{var w,v,A,N,O,K,ee;if(i.rafId&&cancelAnimationFrame(i.rafId),!i.startPoint||!i.endPoint||!i.boundaryRect)return;const d=i.startPoint,u=i.endPoint,x=d.scrollTop||0,p=((w=r.current)==null?void 0:w.scrollTop)||0,j={left:Math.min(d.x,u.x),top:Math.min(d.y,u.y),width:Math.abs(d.x-u.x),height:Math.abs(d.y-u.y)};j.left-=i.boundaryRect.left,j.top-=i.boundaryRect.top,j.top+=x;const f=p-x,b=Math.abs(f);f<0&&(j.top-=b),j.height+=b;const h=i.boundaryRect?Ar(j,i.boundaryRect):{...j};a.current&&(i.rafId=requestAnimationFrame(()=>{a.current&&(a.current.style.display="block",a.current.style.transform=`translate(${h.left}px, ${h.top}px)`,a.current.style.width=`${h.width}px`,a.current.style.height=`${h.height}px`),i.rafId=void 0}));const y={...h,left:h.left+i.boundaryRect.left,top:h.top+i.boundaryRect.top-p};for(const[,I]of he){const me=Tr(I.rect,y);me&&!((v=i.selectedIds)!=null&&v.has(I.id))?((A=i.selectedIds)==null||A.add(I.id),(N=I.onSelected)==null||N.call(I)):!me&&((O=i.selectedIds)!=null&&O.has(I.id))&&((K=i.selectedIds)==null||K.delete(I.id),(ee=I.onDeselected)==null||ee.call(I))}};return{containerProps:{...Os({minimumMovement:4,onPointerDown:s,onMoveStart:d=>{if(wn)return!1;bs(he),i={selectedIds:new Set};const u=r.current;if(i.startPoint={x:d.clientX,y:d.clientY,scrollTop:(u==null?void 0:u.scrollTop)||0},i.scrollListener=x=>{var p;i.startPoint&&(bs(he),(p=i.boundaryRect)!=null&&p.height&&(i.boundaryRect.height=x.target.scrollHeight),o())},u){const x=u.getBoundingClientRect();u.addEventListener("scroll",i.scrollListener),i.boundaryRect={top:x.top,left:x.left,height:u.scrollHeight,heightWithoutScroll:x.height,width:u.scrollWidth}}},onMove:d=>{if(i.endPoint={x:d.clientX,y:d.clientY},i.boundaryRect&&r.current){const u=d.clientY+20>i.boundaryRect.heightWithoutScroll+i.boundaryRect.top,x=d.clientY-20<i.boundaryRect.top;u?r.current.scrollBy({top:10}):x&&r.current.scrollBy({top:-10})}o()},onMoveEnd:()=>{i.rafId&&cancelAnimationFrame(i.rafId),r.current&&i.scrollListener&&r.current.removeEventListener("scroll",i.scrollListener),a.current&&(a.current.style.display="none",a.current.style.transform="",a.current.style.width="",a.current.style.height=""),i={}}}).domProps,ref:r},boxProps:{ref:a}}}function Rr({className:s}){const[t]=Re(),n=!!t.get("query")||!!t.get("filters"),r=m.useRef(null),a=os(),{uploadFiles:i}=ts(),o=ns(),l=S(v=>v.activePage),[d,u]=m.useState(!1),x=S(v=>v.viewMode),{isMobileMode:p}=m.useContext(J),{containerProps:j,boxProps:f}=Lr({containerRef:r,onPointerDown:v=>{v.target.closest(".entry-action-list")||g().deselectEntries("all")}}),{droppableProps:b}=$e({id:"driveRoot",ref:r,types:["nativeFile"],disabled:!(l!=null&&l.canUpload),onDragEnter:()=>{u(!0)},onDragLeave:()=>{u(!1)},onDrop:async v=>{v.type==="nativeFile"&&i(await v.getData())}});if(!l)return null;let h;if(a.isEmpty&&(!a.isLoading||a.fetchStatus==="idle")){const v=l.noContentMessage(n);h=e.jsx(He,{className:"mt-40",image:e.jsx(Ye,{src:v.image}),title:e.jsx(c,{...v.title}),description:e.jsx(c,{...v.description})})}else a.isLoading||(h=x==="list"?e.jsx(Er,{entries:a.items}):e.jsx(Sr,{entries:a.items}));const y=v=>{v.preventDefault(),v.stopPropagation(),g().deselectEntries("all"),g().setContextMenuData({x:v.clientX,y:v.clientY})},w=v=>{v.key==="a"&&En(v)&&(v.preventDefault(),v.stopPropagation(),g().selectEntries(a.items.map(A=>A.id))),v.key==="Delete"&&(v.preventDefault(),v.stopPropagation(),g().selectedEntries.size&&!o.isPending&&(l===ve?g().setActiveActionDialog("confirmAndDeleteForever",ls()):(o.mutate({entryIds:[...g().selectedEntries],deleteForever:l===ve}),g().selectEntries([]))))};return e.jsx("div",{className:D("compact-scrollbar relative flex-auto overflow-y-auto outline-none stable-scrollbar",s),tabIndex:-1,...ze(j,b,{onKeyDown:Ce(w)}),onContextMenu:y,children:e.jsxs("div",{className:"relative flex min-h-full flex-col pt-10",children:[p?e.jsx(ot,{className:"mb-10 px-14"}):e.jsx(zr,{}),e.jsx(Mr,{}),e.jsxs("div",{className:"relative flex-auto px-18 pb-18 md:px-24",children:[e.jsx(Mn,{slot:"drive",className:"mb-24"}),h,e.jsx(ct,{query:a})]}),e.jsx("div",{...f,className:"pointer-events-none absolute left-0 top-0 z-10 hidden border border-primary-light bg-primary-light/20 shadow-md"}),e.jsx(Nr,{}),e.jsx(jr,{isVisible:d})]})})}function zr(){const s=S(t=>t.activePage);return e.jsxs("div",{className:"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18",children:[e.jsx(it,{isDisabled:s==null?void 0:s.disableSort}),e.jsx(et,{className:"text-muted"})]})}function dt(s){return le({...H.shareableLinks.getEntryShareableLink(s),enabled:!!s})}function Wr({entryId:s,...t}){return P.put(`file-entries/${s}/shareable-link`,t).then(n=>n.data)}function _r(s){return T({mutationFn:t=>Wr(t),onSuccess:(t,{entryId:n})=>{C.setQueryData(H.shareableLinks.getEntryShareableLink(n).queryKey,t)},onError:t=>we(t,s)})}function $r({className:s,setActivePanel:t,entry:n}){const{drive:r}=Ie(),a=(r==null?void 0:r.direct_links)??!1,{formId:i}=z(),{data:o}=dt(n.id),l=o==null?void 0:o.link,d=ke({defaultValues:{allowDownload:l==null?void 0:l.allow_download,allowEdit:l==null?void 0:l.allow_edit,allowDirect:l==null?void 0:l.allow_direct,expiresAt:l==null?void 0:l.expires_at,entryId:n.id}}),u=_r(d);return e.jsxs(m.Fragment,{children:[e.jsx(Z,{onDismiss:()=>{t("main")},children:e.jsx(c,{message:"Shareable Link Settings"})}),e.jsx(U,{children:e.jsx(_.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:e.jsxs(Se,{id:i,className:s,form:d,onSubmit:x=>{u.mutate(x,{onSuccess:()=>{t("main"),L(k("Link settings saved"))}})},children:[e.jsx(Kr,{showField:!!(l!=null&&l.expires_at)}),e.jsx(qr,{showField:!!(l!=null&&l.password)}),e.jsxs(ge,{children:[e.jsx(c,{message:"Allow download"}),e.jsx(qe,{name:"allowDownload",children:e.jsx(c,{message:"Users with link can download this item"})})]}),e.jsxs(ge,{showBorder:a,children:[e.jsx(c,{message:"Allow import"}),e.jsx(qe,{name:"allowEdit",children:e.jsx(c,{message:"Users with link can import this item into their own drive"})})]}),a&&e.jsxs(ge,{showBorder:!1,children:[e.jsx(c,{message:"Allow direct access"}),e.jsx(qe,{name:"allowDirect",children:e.jsx(c,{message:"Allow accessing contents of the file directly using this link"})})]})]})},"link-settings-content")}),e.jsxs(de,{children:[e.jsx(E,{type:"button",startIcon:e.jsx(Bs,{}),onClick:()=>{t("main")},children:e.jsx(c,{message:"Back"})}),e.jsx(E,{type:"submit",form:i,variant:"flat",color:"primary",disabled:u.isPending,children:e.jsx(c,{message:"Save"})})]})]})}const Or=Et(Nt());function Kr({showField:s}){const{trans:t}=B(),[n,r]=m.useState(s);return e.jsxs(ge,{children:[e.jsx(c,{message:"Link expiration"}),e.jsxs("div",{children:[e.jsx(as,{checked:n,onChange:a=>{r(a.target.checked)},children:e.jsx(c,{message:"Link is valid until"})}),n&&e.jsx(Tn,{min:Or,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":t({message:"Link expiration date and time"})})]})]})}function qr({showField:s}){const{trans:t}=B(),[n,r]=m.useState(s);return e.jsxs(ge,{children:[e.jsx(c,{message:"Password protect"}),e.jsxs("div",{children:[e.jsx(as,{checked:n,onChange:a=>{r(a.target.checked)},children:e.jsx(c,{message:"Users will need to enter password in order to view this link"})}),n&&e.jsx(De,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":t({message:"Link password"}),description:e.jsx(c,{message:"Password will not be requested when viewing the link as file owner."}),placeholder:t({message:"Enter new password..."})})]})]})}function ge({children:s,showBorder:t=!0}){const[n,r]=s;return e.jsxs("div",{className:D(t&&"mb-20 border-b pb-20"),children:[e.jsx("div",{className:"mb-8 text-sm font-medium",children:n}),r]})}function Br({entryId:s}){return P.delete(`file-entries/${s}/shareable-link`).then(t=>t.data)}function Ur(){return T({mutationFn:({entryId:s})=>Br({entryId:s}),onSuccess:(s,{entryId:t})=>{C.setQueryData(H.shareableLinks.getEntryShareableLink(t).queryKey,{...s,link:null})},onError:s=>$(s,k("Could not delete link"))})}function Vr(s=36){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<s;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function Qr({setActivePanel:s,entry:t}){var l,d;const n=dt(t.id),r=!!((l=n.data)!=null&&l.link),a=sn(),i=Ur(),o=n.isLoading||a.isPending||i.isPending;return e.jsxs("div",{children:[e.jsx("div",{className:"mb-14 font-semibold",children:e.jsx(c,{message:"Public access"})}),e.jsxs("div",{className:"flex items-center justify-between gap-14 px-2 pb-4",children:[e.jsx(as,{checked:r,disabled:o,onChange:()=>{r?i.mutate({entryId:t.id}):a.mutate({entryId:t.id,enableDirectLinks:!0})},children:r?e.jsx(c,{message:"Shareable link is created"}):e.jsx(c,{message:"Create shareable link"})}),r&&e.jsx(E,{variant:"link",color:"primary",onClick:()=>{s("linkSettings")},children:e.jsx(c,{message:"Link settings"})})]}),e.jsx(Hr,{link:(d=n.data)==null?void 0:d.link})]})}function Hr({link:s}){const{drive:t}=Ie(),{trans:n}=B(),r=tn(),a=(s==null?void 0:s.hash)||(r==null?void 0:r.hash)||Vr(),i=nn(a),[o,l]=Vs(i,{successDuration:1e3});return e.jsxs("div",{children:[e.jsx(Le,{disabled:!s,className:"mt-10",readOnly:!0,value:i,"aria-label":n({message:"Shareable link"}),onFocus:d=>{d.target.select()},endAdornment:e.jsx(E,{className:"mr-6",size:"xs",variant:"flat",color:"primary",onClick:l,startIcon:e.jsx(An,{}),children:o?e.jsx(c,{message:"Copied!"}):e.jsx(c,{message:"Copy"})})}),s&&r&&(t!=null&&t.direct_links)&&r.type!=="folder"?e.jsx(Yr,{link:s,entry:r}):null]})}function Yr({link:s,entry:t}){const[n,r]=Vs(rn(s,t),{successDuration:1e3});return e.jsx(E,{variant:"outline",className:"mt-10",size:"xs",onClick:()=>r(),children:n?e.jsx(c,{message:"Copied direct link!"}):e.jsx(c,{message:"Copy direct link"})})}const Gr=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function ut(s){return!s||s.length>320?!1:Gr.test(s)}const Xr={edit:!0,view:!0,download:!0},ae=[{key:"view",value:{view:!0},label:k("Can view")},{key:"download",value:{view:!0,download:!0},label:k("Can Download")},{key:"edit",value:Xr,label:k("Can edit")}];function mt({value:s,onChange:t,isDisabled:n}){return e.jsxs(We,{selectedValue:s.key,selectionMode:"single",onSelectionChange:r=>{r!==s.key&&t(ae.find(a=>a.key===r))},children:[e.jsx(E,{variant:"flat",color:"chip",size:"xs",endIcon:e.jsx(Xe,{}),disabled:n,children:e.jsx(c,{...s.label})}),e.jsx(_e,{children:ae.map(r=>e.jsx(W,{value:r.key,children:e.jsx(c,{...r.label})},r.key))})]})}function Zr(s){const{download:t,edit:n}=s.entry_permissions;return n?ae.find(r=>r.key==="edit"):t?ae.find(r=>r.key==="download"):ae.find(r=>r.key==="view")}function Jr(){return T({mutationFn:s=>ea(s),onSuccess:()=>{C.invalidateQueries({queryKey:ye}),L(k("Updated user permissions"))},onError:s=>$(s,k("Could not update permissions"))})}function ea({entryId:s,...t}){return P.put(`file-entries/${s}/change-permissions`,t).then(n=>n.data)}function sa({className:s,entry:t}){if(!t)return null;const n=t.users;return e.jsxs("div",{className:D(s,"overflow-hidden"),children:[e.jsx("div",{className:"mb-14 text-sm font-semibold",children:e.jsx(c,{message:"People with access"})}),e.jsx(Y,{initial:!1,children:n.map(r=>e.jsx(ta,{user:r,entry:t},r.id))})]})}function ta({user:s,entry:t}){return e.jsxs(_.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-center gap-14 text-sm",children:[e.jsx(Pt,{user:s,circle:!0,size:"w-44 h-44"}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-muted",children:s.email})]}),e.jsx("div",{className:"ml-auto",children:s.owns_entry?e.jsx("span",{className:"text-muted",children:e.jsx(c,{message:"Owner"})}):e.jsx(na,{user:s,entry:t})})]},s.id)}function na({user:s,entry:t}){const n=Jr(),r=an(),[a,i]=m.useState(()=>Zr(s));return e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsx(mt,{isDisabled:n.isPending,onChange:o=>{n.mutate({userId:s.id,permissions:o.value,entryId:t.id}),i(o)},value:a}),e.jsx(F,{disabled:r.isPending,onClick:()=>{r.mutate({userId:s.id,entryIds:[t.id]},{onSuccess:()=>{L(k("Member removed"))},onError:o=>$(o,k("Could not remove member"))})},children:e.jsx(oe,{})})]})}function ra({entryId:s,...t}){return P.post(`file-entries/${s}/share`,t).then(n=>n.data)}function aa(){return T({mutationFn:s=>ra(s),onSuccess:()=>{C.invalidateQueries({queryKey:ye})},onError:s=>{var t,n;if(Ft.isAxiosError(s)&&s.response){const r=s.response.data;(t=r.errors)!=null&&t.emails?L.danger((n=r.errors)==null?void 0:n.emails[0]):$(s)}}})}function ia({className:s,entry:t}){var y;const{trans:n}=B(),{share:r}=Ie(),a=aa(),[i,o]=m.useState([]),[l,d]=m.useState(!1),[u,x]=m.useState(ae[0]),p=i.every(w=>!w.invalid),[j,f]=m.useState(""),b=Wn("normalized-models/user",{perPage:7,query:j},{enabled:r==null?void 0:r.suggest_emails}),h=w=>w.description||w.name;return e.jsxs("div",{className:s,children:[e.jsx(zs,{value:i,onChange:o,isAsync:!0,isLoading:b.fetchStatus==="fetching",inputValue:j,onInputValueChange:f,suggestions:(y=b.data)==null?void 0:y.results,displayWith:h,validateWith:w=>{const v=!ut(w.description);return{...w,invalid:v,errorMessage:v?n({message:"Not a valid email"}):void 0}},placeholder:n({message:"Enter email addresses"}),label:e.jsx(c,{message:"Invite people"}),labelClassName:"font-semibold",children:w=>e.jsx(W,{value:w.id,startIcon:e.jsx(Qe,{circle:!0,src:w.image,alt:""}),description:w.description,children:w.name})}),e.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[e.jsx(mt,{onChange:x,value:u}),i.length?e.jsx(E,{variant:"flat",color:"primary",size:"sm",disabled:l||!p,onClick:()=>{d(!0),a.mutate({emails:i.map(w=>h(w)),permissions:u.value,entryId:t.id},{onSuccess:()=>{o([])},onSettled:()=>{d(!1)}})},children:e.jsx(c,{message:"Share"})}):null]}),e.jsx(sa,{className:"mt-30",entry:t})]})}function oa({entry:s}){const{data:{fileEntry:t}}=le({...H.driveEntries.get(s.id),initialData:{fileEntry:s}}),[n,r]=m.useState("main");return e.jsx(Q,{size:"lg",children:e.jsx(Y,{initial:!1,mode:"wait",children:n==="linkSettings"?e.jsx($r,{setActivePanel:r,entry:t},"one"):e.jsx(la,{setActivePanel:r,entry:t},"two")})})}function la({setActivePanel:s,entry:t}){return e.jsxs(m.Fragment,{children:[e.jsx(Z,{children:e.jsx(c,{message:"Share ‘:name’",values:{name:t.name}})}),e.jsx(U,{className:"relative",children:e.jsxs(_.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[e.jsx(ia,{className:"mb-30 border-b pb-30",entry:t}),e.jsx(Qr,{setActivePanel:s,entry:t})]},"share-content")})]})}function ca({entries:s}){const t=on(),{close:n}=z();return e.jsx(ue,{title:e.jsx(c,{message:"This folder is in your trash"}),body:e.jsx(c,{message:"To view this folder, restore it from the trash."}),confirm:e.jsx(c,{message:"Restore"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:s.map(r=>r.id)},{onSuccess:()=>{n(),g().selectEntries([])}})}})}function da({entries:s}){const t=ns(),{close:n}=z(),r=s.length===1?e.jsx(c,{message:"‘:name‘ will be deleted forever and you won't be able to restore it.",values:{name:s[0].name}}):e.jsx(c,{message:":count items will be deleted forever and you won't be able to restore them.",values:{count:s.length}});return e.jsx(ue,{isDanger:!0,title:e.jsx(c,{message:"Delete forever?"}),body:r,confirm:e.jsx(c,{message:"Delete forever"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:s.map(a=>a.id),deleteForever:!0},{onSuccess:()=>{n(),g().selectEntries([])}})}})}function ua({selectedEntry:s}){const t=os().items.filter(i=>i.type!=="folder"),n=t.findIndex(i=>i.id===(s==null?void 0:s.id)),[r,a]=m.useState(n);return e.jsx(xn,{allowDownload:s.permissions["files.download"],headerActionsLeft:e.jsx(ma,{activeIndex:r,entries:t}),activeIndex:r,onActiveIndexChange:a,entries:t})}function ma({activeIndex:s,entries:t}){const n=t[s],r=Ts([n]);return!n||!r?null:e.jsxs(m.Fragment,{children:[e.jsx(F,{className:"md:hidden",onClick:()=>{r.execute()},children:m.createElement(r.icon)}),e.jsx(E,{className:"max-md:hidden",variant:"text",startIcon:m.createElement(r.icon),onClick:()=>{r.execute()},children:e.jsx(c,{...r.label})})]})}function pa({name:s,parentId:t}){return P.post("folders",{name:s,parentId:t===0?null:t}).then(n=>n.data)}function xa(s){return T({mutationFn:({name:t,parentId:n})=>pa({name:t,parentId:n}),onSuccess:()=>C.invalidateQueries({queryKey:ye}),onError:t=>we(t,s)})}function pt({parentId:s}){const{close:t,formId:n}=z(),{trans:r}=B(),a=ke({defaultValues:{name:r({message:"Untitled Folder"})}}),i=xa(a),o=l=>{i.mutate({...l,parentId:s},{onSuccess:d=>{t(d.folder),L(k("Folder created"))}})};return e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(c,{message:"New Folder"})}),e.jsx(U,{children:e.jsx(Se,{onSubmit:o,form:a,id:n,children:e.jsx(De,{placeholder:r({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),e.jsxs(de,{children:[e.jsx(E,{variant:"flat",onClick:()=>t(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(E,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending,children:e.jsx(c,{message:"Create"})})]})]})}function fa({query:s}){const{workspaceId:t}=V(),n=m.useMemo(()=>({section:"search",workspaceId:t,query:s,filters:qs([{key:"type",value:"folder"}])}),[t,s]);return Je({...H.driveEntries.index(n),enabled:!!s,placeholderData:ks})}function ha({onFolderSelected:s}){var d;const{trans:t}=B(),n=t({message:"Search folders"}),[r,a]=m.useState(""),{isFetching:i,data:o}=fa({query:r}),l=(d=o==null?void 0:o.pages[0])==null?void 0:d.data;return e.jsx(_n,{size:"sm",maxItems:10,placeholder:n,"aria-label":n,className:"pt-20",endAdornmentIcon:e.jsx(be,{}),isAsync:!0,isLoading:i,inputValue:r,onInputValueChange:a,blurReferenceOnItemSelection:!0,clearInputOnItemSelection:!0,selectionMode:"none",openMenuOnFocus:!1,children:l==null?void 0:l.map(u=>e.jsx(W,{value:u.id,textLabel:u.name,onSelected:()=>{s(u)},children:u.name},u.id))})}function ga({selectedFolder:s,onFolderSelected:t}){const{data:n}=As({hash:s.hash,isEnabled:(s==null?void 0:s.hash)!==M.folder.hash});let r=null;return n!=null&&n.path&&(n.path.length===1?r=M.folder:r=n.path[n.path.length-2]),e.jsxs("div",{className:"flex items-center gap-6 border-b pb-10",children:[e.jsx(F,{className:"flex-shrink-0",variant:"outline",size:"xs",disabled:!r,onClick:()=>{r&&t(r)},children:e.jsx(Bs,{})}),e.jsxs(Ks,{size:"sm",className:"flex-auto",children:[e.jsxs(Te,{onSelected:()=>{t(M.folder)},className:"flex items-center gap-8",children:[e.jsx(Me,{className:"icon-sm"}),e.jsx(c,{message:M.folder.name})]}),n==null?void 0:n.path.map(a=>e.jsxs(Te,{onSelected:()=>{t(a)},className:"flex items-center gap-8",children:[!a.id&&e.jsx(Me,{className:"icon-sm"}),a.name]},a.id||"root"))]})]})}const ja=""+new URL("my-files-DKUWq_rg.svg",import.meta.url).href;function va({selectedFolder:s,movingSharedFiles:t}){const{workspaceId:n}=V(),r=m.useMemo(()=>{const a=qs([{key:"type",value:"folder"}]);return{section:"folder",folderId:s.hash=="0"&&t?"sharedWithMe":s.hash,workspaceId:n,filters:a}},[n,s.hash,t]);return Je(H.driveEntries.index(r))}function ba({onFolderSelected:s,selectedFolder:t,movingSharedFiles:n}){var i,o,l;const r=va({selectedFolder:t,movingSharedFiles:n});let a;return r.isLoading?a=e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(ie,{isIndeterminate:!0,size:"md"})}):((o=(i=r.data)==null?void 0:i.pages[0])==null?void 0:o.data.length)===0?a=e.jsx(He,{size:"xs",className:"pb-20 pt-64",image:e.jsx(Ye,{src:ja}),title:e.jsx(c,{message:'There are no subfolders in ":folder"',values:{folder:t.name}})}):a=e.jsxs(m.Fragment,{children:[e.jsx(Rs,{children:(l=r.data)==null?void 0:l.pages.flatMap(d=>d.data).map(d=>e.jsx(Be,{className:"min-h-48 border-b",onSelected:()=>{s(d)},startIcon:e.jsx(Ae,{type:"folder"}),endIcon:e.jsx($n,{size:"md"}),children:d.name},d.id))}),e.jsx(ct,{query:r})]}),e.jsx("div",{className:"h-288 overflow-y-auto",children:a})}function ya({entries:s}){const{user:t}=R(),n=S(o=>o.activePage),[r,a]=m.useState((n==null?void 0:n.folder)||M.folder),i=s.some(o=>{var l;return!((l=o.users.find(d=>d.id===t.id))!=null&&l.owns_entry)});return e.jsxs(Q,{size:"lg",children:[e.jsx(Z,{children:e.jsx(c,{message:"Move [one ‘:name‘|other :count items]",values:{count:s.length,name:s[0].name}})}),e.jsxs(U,{children:[e.jsx("div",{className:"text-sm",children:e.jsx(c,{message:"Select a destination folder."})}),e.jsx(ha,{onFolderSelected:a}),e.jsxs("div",{className:"mb-20 mt-40",children:[e.jsx(ga,{selectedFolder:r,onFolderSelected:a}),e.jsx(ba,{movingSharedFiles:i,selectedFolder:r,onFolderSelected:a})]})]}),e.jsx(wa,{selectedFolder:r,setSelectedFolder:a,entries:s})]})}function wa({selectedFolder:s,setSelectedFolder:t,entries:n}){const{close:r}=z(),a=st();return e.jsxs(de,{className:"border-t",startAction:e.jsxs(ce,{type:"modal",onClose:i=>{i&&t(i)},children:[e.jsx(E,{startIcon:e.jsx(Us,{}),variant:"text",children:e.jsx(c,{message:"New Folder"})}),e.jsx(pt,{parentId:s.id})]}),children:[e.jsx(E,{className:"max-md:hidden",variant:"flat",onClick:()=>r(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(E,{type:"submit",variant:"flat",color:"primary",disabled:!ds(n,s)||a.isPending,onClick:()=>{a.mutate({destinationId:s.id,entryIds:n.map(i=>i.id)},{onSuccess:r})},children:e.jsx(c,{message:"Move here"})})]})}function Ia(s){return T({mutationFn:t=>ka(t),onSuccess:(t,n)=>{C.invalidateQueries({queryKey:ye}),L(k(":oldName renamed to :newName",{values:{oldName:n.initialName,newName:t.fileEntry.name}}))},onError:t=>we(t,s)})}function ka({entryId:s,...t}){return P.put(`file-entries/${s}`,t).then(n=>n.data)}function Sa({entries:s}){var l;const{close:t,formId:n}=z(),r=(l=s[0])==null?void 0:l.name,a=ke({defaultValues:{name:r}}),i=Ia(a),o=d=>{i.mutate({entryId:s[0].id,name:d.name,initialName:r},{onSuccess:t})};return e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(c,{message:"Rename"})}),e.jsx(U,{children:e.jsx(Se,{onSubmit:o,form:a,id:n,children:e.jsx(De,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),e.jsxs(de,{children:[e.jsx(E,{variant:"flat",onClick:()=>t(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(E,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending||!a.formState.isDirty,children:e.jsx(c,{message:"Save"})})]})]})}function Da(){const s=S(n=>n.activeActionDialog),t=Ea(s);return e.jsx(ce,{type:"modal",isOpen:!!t,onClose:()=>{g().setActiveActionDialog(null)},children:t})}function Ea(s){var t;switch(s==null?void 0:s.name){case"rename":return e.jsx(Sa,{entries:s.entries});case"newFolder":return e.jsx(pt,{parentId:(t=s.entries[0])==null?void 0:t.id});case"preview":return e.jsx(ua,{selectedEntry:s.entries[0]});case"share":return e.jsx(oa,{entry:s.entries[0]});case"moveTo":return e.jsx(ya,{entries:s.entries});case"confirmAndDeleteForever":return e.jsx(da,{entries:s.entries});case"trashFolderBlock":return e.jsx(ca,{entries:s.entries});default:return null}}function Na(){const{trans:s}=B(),t=te(),n=S(o=>o.activePage),[r]=Re(),[a,i]=m.useState(r.get("query")||"");return e.jsx("form",{className:"ml-10 flex-auto",onSubmit:o=>{o.preventDefault(),t({pathname:X.path,search:`?query=${a}`},{replace:!0})},children:e.jsx(Le,{size:"lg",background:"bg-elevated",inputRadius:"rounded-full",inputBorder:"border border-divider-lighter",inputShadow:"shadow-sm",inputClassName:"max-h-46 placeholder:text-main/50",value:a,onChange:o=>i(o.target.value),onFocus:()=>{n!==X&&t(X.path)},startAdornment:e.jsx(F,{type:"submit",children:e.jsx(be,{})}),className:"max-w-720 flex-auto",placeholder:s({message:"Search files and folders"}),"aria-label":s({message:"Search files and folders"})})})}const Pa=m.memo(({file:s,className:t,style:n})=>e.jsxs("div",{className:D("flex items-center gap-14",t),style:n,children:[e.jsx("div",{className:"shrink-0 rounded border p-8",children:e.jsx(Ae,{className:"h-22 w-22",mime:s.mime})}),e.jsxs("div",{className:"min-w-0 flex-auto pr-10",children:[e.jsx("div",{className:"mb-2 flex min-w-0 items-center gap-10",children:e.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:s.name})}),e.jsx(Fa,{file:s})]}),e.jsx("div",{className:"mr-10",children:e.jsx(Ca,{file:s})})]}),Ds);function Fa({file:s}){const t=se(Qs(o=>o.fileUploads.get(s.id))),n=(t==null?void 0:t.bytesUploaded)||0,r=m.useMemo(()=>Ue(s.size),[s]),a=m.useMemo(()=>Ue(n),[n]);let i;return(t==null?void 0:t.status)==="completed"?i=e.jsx(c,{message:"Upload complete"}):(t==null?void 0:t.status)==="aborted"?i=e.jsx(c,{message:"Upload cancelled"}):(t==null?void 0:t.status)==="failed"?i=e.jsx(c,{message:"Upload failed"}):(t==null?void 0:t.status)==="pending"?i=e.jsx(m.Fragment,{children:r}):i=e.jsx(c,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:a,totalBytes:r}}),e.jsx("div",{className:"text-xs text-muted",children:i})}function Ca({file:s}){const t=se(Qs(p=>p.fileUploads.get(s.id))),n=se(p=>p.abortUpload),r=(t==null?void 0:t.percentage)||0,a=t==null?void 0:t.status,i=t==null?void 0:t.errorMessage,[o,l]=m.useState(!1),d=e.jsx(F,{size:"xs",iconSize:"sm",onClick:()=>{n(s.id)},children:e.jsx(oe,{})}),u=e.jsx(ie,{"aria-label":"Upload progress",size:"w-24 h-24",value:r,isIndeterminate:r===100,trackWidth:3});let x;if(a==="failed"){const p=i||k("This file could not be uploaded");x=e.jsx(pe,{children:e.jsx(je,{variant:"danger",label:e.jsx(Fe,{value:p}),children:e.jsx(Ct,{className:"text-danger",size:"md"})})})}else a==="aborted"?x=e.jsx(pe,{children:e.jsx(Mt,{className:"text-warning",size:"md"})}):a==="completed"?x=e.jsx(pe,{children:e.jsx(Tt,{size:"md",className:"text-positive"})}):a==="pending"?x=e.jsx(pe,{children:d}):x=e.jsx(pe,{onPointerEnter:p=>{p.pointerType==="mouse"&&l(!0)},onPointerLeave:p=>{p.pointerType==="mouse"&&l(!1)},children:o?d:u});return e.jsx(Y,{children:x})}function pe({children:s,...t}){return e.jsx(_.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:s})}function Ma(){const s=S(t=>t.uploadQueueIsOpen);return e.jsx(Y,{children:s&&e.jsxs(_.div,{className:"fixed bottom-16 right-16 z-modal w-375 overflow-hidden rounded-panel border bg text-sm shadow-xl",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[e.jsx(Ta,{}),e.jsx(Aa,{})]},"upload-queue")})}function Ta(){const s=se(a=>a.activeUploadsCount),t=se(a=>a.completedUploadsCount),n=se(a=>a.clearInactive);let r;return s?r=e.jsx(c,{message:"Uploading :count files",values:{count:s}}):t?r=e.jsx(c,{message:"Uploaded :count files",values:{count:t}}):r=e.jsx(c,{message:"No active uploads"}),e.jsxs("div",{className:"flex min-h-[45px] items-center justify-between gap-10 border-b bg-alt px-10 py-4",children:[r,s===0?e.jsx(F,{size:"sm",onClick:()=>{g().setUploadQueueIsOpen(!1),setTimeout(()=>{n()},200)},children:e.jsx(oe,{})}):void 0]})}function Aa(){const s=se(a=>a.fileUploads),t=[...s.values()],n=m.useRef(null),r=On({count:s.size,getScrollElement:()=>n.current,estimateSize:()=>60,overscan:4});return e.jsx("div",{className:"max-h-320 overflow-y-auto",ref:n,children:e.jsx("div",{className:"relative w-full",style:{height:`${r.getTotalSize()}px`},children:r.getVirtualItems().map(a=>{const i=t[a.index];return e.jsx(Pa,{file:i.file,className:"absolute left-0 top-0 w-full p-10",style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`}},i.file.id)})})})}function xt({isCompact:s,className:t}){const n=S(i=>i.activePage),{uploadFiles:r}=ts(),a=s?e.jsx(F,{size:"md",disabled:!(n!=null&&n.canUpload),children:e.jsx(rs,{})}):e.jsx(E,{className:"w-full",color:"primary",variant:"flat",size:"sm",startIcon:e.jsx(Kn,{}),disabled:!(n!=null&&n.canUpload),children:e.jsx(c,{message:"Upload"})});return e.jsx("div",{className:t,children:e.jsxs(We,{onItemSelected:async i=>{var o;if(i==="uploadFiles")r(await ys({multiple:!0}));else if(i==="uploadFolder")r(await ys({directory:!0}));else if(i==="newFolder"){const l=(o=g().activePage)==null?void 0:o.folder;g().setActiveActionDialog("newFolder",l?[l]:[])}},children:[a,e.jsxs(_e,{children:[e.jsx(W,{value:"uploadFiles",startIcon:e.jsx(gn,{}),children:e.jsx(c,{message:"Upload files"})}),e.jsx(W,{value:"uploadFolder",startIcon:e.jsx(Ln,{}),children:e.jsx(c,{message:"Upload folder"})}),e.jsx(W,{value:"newFolder",startIcon:e.jsx(Us,{}),children:e.jsx(c,{message:"Create folder"})})]})]})})}function La({children:s,color:t,variant:n,radius:r="rounded-button",size:a,className:i,value:o,onChange:l,multiple:d,disabled:u}){const x=f=>o===void 0?!1:d?o.includes(f):f===o,p=f=>{const b=[...o],h=o.indexOf(f);return h>-1?b.splice(h,1):b.push(f),b},j=Ke.Children.map(s,(f,b)=>{if(Ke.isValidElement(f)){const h=f.props,y=x(h.value),w=y?"primary":t;return Ke.cloneElement(f,{color:y?"primary":t,variant:n,size:a,radius:null,disabled:h.disabled||u,...h,onClick:v=>{h.onClick&&h.onClick(v),l&&(d?l==null||l(p(h.value)):l==null||l(h.value))},className:D(h.className,y?"z-20":"z-10",Ra(b,s,r,w))})}});return e.jsx("div",{className:D(r,"isolate inline-flex",i),children:j})}function Ra(s,t,n,r){return s===0?D(n,"rounded-tr-none rounded-br-none",!r&&"border-r-transparent disabled:border-r-transparent"):s===t.length-1?D(n,"rounded-tl-none rounded-bl-none -ml-1"):D("rounded-none -ml-1",!r&&"border-r-transparent disabled:border-r-transparent")}const za=m.forwardRef((s,t)=>e.jsxs(Ps,{...s,ref:t,children:[e.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"})]})),Wa=m.forwardRef((s,t)=>e.jsxs(Ps,{...s,ref:t,children:[e.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"}),e.jsx("path",{d:"M14 4h7"}),e.jsx("path",{d:"M14 9h7"}),e.jsx("path",{d:"M14 15h7"}),e.jsx("path",{d:"M14 20h7"})]}));function _a(){const{isMobileMode:s}=m.useContext(J),t=S(n=>n.activePage);return e.jsxs(ln,{className:"flex h-60 flex-shrink-0 items-center gap-20 border-b border-divider-lighter px-8 py-4 md:px-26",children:[s?e.jsx(it,{isDisabled:t==null?void 0:t.disableSort}):e.jsx(ot,{}),e.jsxs("div",{className:"ml-auto flex flex-shrink-0 items-center gap-6",children:[e.jsx($a,{}),e.jsx(Oa,{})]})]})}function $a(){const s=S(t=>t.viewMode);return e.jsxs(La,{size:"xs",variant:"outline",radius:"rounded-full",value:s,onChange:t=>{g().setViewMode(t)},children:[e.jsx(F,{value:"list",className:"min-w-54",children:e.jsx(Wa,{})}),e.jsx(F,{value:"grid",className:"min-w-54",children:e.jsx(za,{})})]})}function Oa(){const{rightSidenavStatus:s,setRightSidenavStatus:t}=m.useContext(J),n=s?e.jsx(c,{message:"Hide details"}):e.jsx(c,{message:"Show details"});return e.jsx(je,{label:n,children:e.jsx(F,{radius:"rounded-full",size:"sm",color:s==="open"?"primary":null,onClick:()=>{t(s==="open"?"closed":"open")},children:e.jsx(qn,{})})})}function Ka({resourceName:s,className:t,size:n="md",color:r="bgAlt",reason:a="overQuota",...i}){const o=i.message??e.jsx(qa,{resourceName:s,reason:a});return e.jsx(Bn,{color:r,size:n,className:t,description:o})}function qa({resourceName:s,reason:t}){const{billing:n}=Ie();if(t==="noWorkspacePermission")return e.jsx(c,{message:"You can't create new :name in this workspace.",values:{name:s}});const r={name:s,a:a=>e.jsx(Ze,{className:Un,to:"/pricing",children:a})};return t==="overQuota"&&n.enable?e.jsx(c,{message:"Your plan is at its maximum number of :name allowed. <a>Upgrade to add more.</a>",values:r}):t==="noPermission"&&n.enable?e.jsx(c,{message:"To unlock ability to create :name. <a>Upgrade your plan.</a>",values:r}):e.jsx(c,{message:"You don't have permissions to create :name.",values:{name:s}})}function ft({onConfirm:s,isLoading:t}){return e.jsx(ue,{isDanger:!0,title:e.jsx(c,{message:"Leave workspace"}),isLoading:t,onConfirm:s,body:e.jsxs("div",{children:[e.jsx(c,{message:"Are you sure you want to leave this workspace?"}),e.jsx("div",{className:"mt-8 font-semibold",children:e.jsx(c,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:e.jsx(c,{message:"Leave"})})}function Ba(s){return T({mutationFn:t=>Ua(t),onSuccess:()=>{L(k("Created workspace")),C.invalidateQueries({queryKey:q.fetchUserWorkspaces})},onError:t=>we(t,s)})}function Ua(s){return P.post("workspace",s).then(t=>t.data)}function Va(){const s=ke(),{formId:t,close:n}=z(),r=Ba(s);return e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(c,{message:"Create workspace"})}),e.jsx(U,{children:e.jsx(Se,{form:s,id:t,onSubmit:()=>{r.mutate(s.getValues(),{onSuccess:a=>{n(a.workspace.id)}})},children:e.jsx(De,{name:"name",autoFocus:!0,label:e.jsx(c,{message:"Workspace name"}),minLength:3,required:!0})})}),e.jsxs(de,{children:[e.jsx(E,{variant:"text",onClick:n,children:e.jsx(c,{message:"Cancel"})}),e.jsx(E,{variant:"flat",color:"primary",type:"submit",form:t,disabled:r.isPending,children:e.jsx(c,{message:"Create"})})]})]})}function Qa({id:s,...t}){return P.put(`workspace/${s}`,t).then(n=>n.data)}function Ha(s){const{close:t}=z();return T({mutationFn:n=>Qa(n),onSuccess:n=>{t(),L(k("Updated workspace")),C.invalidateQueries({queryKey:q.fetchUserWorkspaces}),C.invalidateQueries({queryKey:q.workspaceWithMembers(n.workspace.id)})},onError:n=>we(n,s)})}function Ya({workspace:s}){const t=ke({defaultValues:{id:s.id,name:s.name}}),{formId:n,close:r}=z(),a=Ha(t);return e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsx(c,{message:"Rename workspace"})}),e.jsx(U,{children:e.jsx(Se,{form:t,id:n,onSubmit:()=>{a.mutate(t.getValues())},children:e.jsx(De,{name:"name",autoFocus:!0,label:e.jsx(c,{message:"Name"}),minLength:3,required:!0})})}),e.jsxs(de,{children:[e.jsx(E,{variant:"text",onClick:r,children:e.jsx(c,{message:"Cancel"})}),e.jsx(E,{variant:"flat",color:"primary",type:"submit",form:n,disabled:a.isPending,children:e.jsx(c,{message:"Rename"})})]})]})}function Ga({id:s}){return P.delete(`workspace/${s}`).then(t=>t.data)}function Xa(){const{workspaceId:s,setWorkspaceId:t}=V();return T({mutationFn:n=>Ga(n),onSuccess:(n,r)=>{L(k("Deleted workspace")),C.invalidateQueries({queryKey:q.fetchUserWorkspaces}),C.invalidateQueries({queryKey:q.workspaceWithMembers(r.id)}),s===r.id&&t(Ee.id)},onError:n=>$(n)})}function Za({workspaceId:s,memberId:t,memberType:n}){const r=n==="invite"?`workspace/invite/${t}`:`workspace/${s}/member/${t}`;return P.delete(r).then(a=>a.data)}function ht(){const{workspaceId:s,setWorkspaceId:t}=V(),{user:n}=R();return T({mutationFn:r=>Za(r),onSuccess:(r,a)=>{C.invalidateQueries({queryKey:q.fetchUserWorkspaces}),C.invalidateQueries({queryKey:q.workspaceWithMembers(a.workspaceId)}),a.memberId===(n==null?void 0:n.id)&&s===a.workspaceId&&t(Ee.id)},onError:r=>$(r)})}function Ja({workspaceId:s,member:t,...n}){const r=t.model_type,a=t.model_type==="invite"?t.id:t.member_id;return P.post(`workspace/${s}/${r}/${a}/change-role`,n).then(i=>i.data)}function ei(){return T({mutationFn:s=>Ja(s),onSuccess:(s,t)=>{L(k("Role changed")),C.invalidateQueries({queryKey:q.workspaceWithMembers(t.workspaceId)})},onError:s=>$(s)})}function si({workspaceId:s,...t}){return P.post(`workspace/${s}/invite`,t).then(n=>n.data)}function ti(){return T({mutationFn:s=>si(s),onSuccess:(s,t)=>{C.invalidateQueries({queryKey:q.workspaceWithMembers(t.workspaceId)})},onError:s=>$(s)})}function ni({workspaceId:s,inviteId:t,...n}){return P.post(`workspace/${s}/${t}/resend`,n).then(r=>r.data)}function ri(){return T({mutationFn:s=>ni(s),onSuccess:()=>{L("Invite sent")},onError:s=>$(s)})}function ai(s){return P.get(`workspace/${s}`).then(t=>t.data)}function ii(s){return le({queryKey:q.workspaceWithMembers(s),queryFn:()=>ai(s)})}function oi({workspace:s}){const{data:t,isLoading:n}=ii(s.id);return e.jsxs(Q,{size:"lg",children:[e.jsx(Z,{children:e.jsx(c,{message:"Manage workspace members"})}),e.jsx(U,{children:n?e.jsx("div",{className:"flex min-h-[238px] items-center justify-center",children:e.jsx(ie,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):e.jsx(li,{workspace:t.workspace})})]})}function li({workspace:s}){const{user:t}=R(),n=us(s),r=[...s.members||[],...s.invites||[]],a=!n.update&&!n.delete;return e.jsxs("div",{children:[n.invite&&e.jsx(ui,{workspace:s}),e.jsxs("div",{className:"mb-14 flex items-center gap-10 text-base",children:[e.jsx(Ls,{className:"icon-sm"}),e.jsx(c,{message:"Members of `:workspace`",values:{workspace:s.name}})]}),e.jsxs(Y,{initial:!1,children:[r.map(i=>a&&i.id!==(t==null?void 0:t.id)?null:e.jsx(ci,{workspace:s,member:i},`${i.model_type}.${i.id}`)),a&&e.jsx("div",{className:"text-muted",children:e.jsx(c,{message:"And [one one other member|:count other members]",values:{count:r.length}})})]})]})}function ci({workspace:s,member:t}){return e.jsxs(_.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-start gap-14 text-sm",children:[e.jsx(Qe,{className:"flex-shrink-0",size:"lg",circle:!0,label:t.name,src:t.image,fallback:"initials"}),e.jsxs("div",{className:"min-w-0 flex-auto items-center justify-between gap-14 md:flex",children:[e.jsxs("div",{className:"mb-10 overflow-hidden md:mb-0 md:mr-10",children:[e.jsxs("div",{className:"flex items-center justify-start gap-6",children:[e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),e.jsx(xi,{workspace:s,member:t})]}),e.jsx("div",{className:"text-muted",children:t.email})]}),e.jsx(di,{workspace:s,member:t})]})]},`${t.model_type}.${t.id}`)}function us(s){var i;const{user:t}=R(),n={update:!1,invite:!1,delete:!1},r=["update","invite","delete"],a=(i=s.members)==null?void 0:i.find(o=>o.id===(t==null?void 0:t.id));return a&&r.forEach(o=>{var l;n[o]=a.is_owner||!!((l=a.permissions)!=null&&l.find(d=>d.name===`workspace_members.${o}`))}),n}function di({workspace:s,member:t}){const[n,r]=m.useState(t.role_id),a=ei(),{user:i}=R(),o=us(s),l=t.model_type==="member"&&t.is_owner,d=t.model_type==="member"&&(i==null?void 0:i.id)===t.id,u=!o.update||l||d?e.jsx("div",{className:"ml-auto text-muted first:capitalize",children:e.jsx(c,{message:t.role_name})}):e.jsx(gt,{className:"ml-auto flex-shrink-0",size:"xs",value:n,isDisabled:a.isPending,onChange:x=>{r(x),a.mutate({roleId:x,workspaceId:s.id,member:t})}});return e.jsxs(e.Fragment,{children:[u,!l&&(d||o.delete)&&e.jsx(mi,{type:d?"leave":"remove",member:t,workspace:s})]})}function ui({workspace:s}){const{trans:t}=B(),[n,r]=m.useState([]),a=n.every(x=>!x.invalid),i=x=>x.description||x.name,[o,l]=m.useState(),d=ti(),{data:u}=Fs(["workspaceRoles"]);return m.useEffect(()=>{var x;!o&&((x=u==null?void 0:u.workspaceRoles)!=null&&x.length)&&l(u.workspaceRoles[0].id)},[u,o]),e.jsxs("div",{className:"mb-30",children:[e.jsx(zs,{value:n,onChange:r,displayWith:i,validateWith:x=>{const p=!ut(x.description);return{...x,invalid:p,errorMessage:p?t({message:"Not a valid email"}):void 0}},placeholder:t({message:"Enter email addresses"}),label:e.jsx(c,{message:"Invite people"})}),e.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[e.jsx(gt,{onChange:l,value:o}),n.length&&o?e.jsx(E,{variant:"flat",color:"primary",size:"sm",disabled:d.isPending||!a,onClick:()=>{d.mutate({emails:n.map(x=>i(x)),roleId:o,workspaceId:s.id},{onSuccess:()=>{r([])}})},children:e.jsx(c,{message:"Invite"})}):null]})]})}function mi({member:s,workspace:t,type:n}){const r=ht(),{close:a}=z();return e.jsxs(ce,{type:"modal",onClose:i=>{i&&(r.mutate({workspaceId:t.id,memberId:s.id,memberType:s.model_type}),n==="leave"&&(a(),L(k("Left workspace"))))},children:[e.jsx(F,{size:"md",className:"flex-shrink-0 text-muted",disabled:r.isPending,children:n==="leave"?e.jsx(Cs,{}):e.jsx(oe,{})}),n==="leave"?e.jsx(ft,{}):e.jsx(pi,{member:s})]})}function pi({member:s}){return e.jsx(ue,{isDanger:!0,title:e.jsx(c,{message:"Remove member"}),body:e.jsxs("div",{children:[e.jsx(c,{message:"Are you sure you want to remove `:name`?",values:{name:s.name}}),e.jsx("div",{className:"mt-8 font-semibold",children:e.jsx(c,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:s.name}})})]}),confirm:e.jsx(c,{message:"Remove"})})}function gt({value:s,onChange:t,size:n="xs",className:r,isDisabled:a}){var l;const{data:i}=Fs(["workspaceRoles"]),o=(l=i==null?void 0:i.workspaceRoles)==null?void 0:l.find(d=>d.id===s);return!s||!o||!(i!=null&&i.workspaceRoles)?null:e.jsxs(We,{selectionMode:"single",selectedValue:s,onSelectionChange:d=>{t(d)},children:[e.jsx(E,{className:r,size:n,variant:"flat",color:"chip",disabled:a,endIcon:e.jsx(Xe,{}),children:e.jsx(c,{message:o.name})}),e.jsx(_e,{children:i.workspaceRoles.map(d=>e.jsx(W,{value:d.id,description:d.description,children:e.jsx(c,{message:d.name})},d.id))})]})}function xi({member:s,workspace:t}){const{user:n}=R(),r=us(t);return(n==null?void 0:n.id)===s.id?e.jsxs("div",{className:"font-medium",children:["(",e.jsx(c,{message:"You"}),")"]}):s.model_type==="invite"?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{children:"·"}),e.jsx("div",{className:"font-medium",children:e.jsx(c,{message:"Invited"})}),r.invite?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"·"}),e.jsx(fi,{member:s,workspace:t})]}):null]}):null}function fi({member:s,workspace:t}){const n=ri();return e.jsxs(ce,{type:"modal",onClose:r=>{r&&n.mutate({workspaceId:t.id,inviteId:s.id})},children:[e.jsx(E,{variant:"link",size:"sm",color:"primary",disabled:n.isPending,children:e.jsx(c,{message:"Resend invite"})}),e.jsx(ue,{title:e.jsx(c,{message:"Resend invite"}),body:e.jsx(c,{message:"Are you sure you want to send this invite again?"}),confirm:e.jsx(c,{message:"Send"})})]})}function hi({onChange:s,className:t,trigger:n,placement:r="top"}){const{data:a,isFetched:i,isFetching:o}=At(),{setWorkspaceId:l}=V(),d=Ge(),[u,x]=m.useState(!1),{hasPermission:p}=R();return m.useEffect(()=>{i&&!o&&!d&&l(Ee.id)},[d,a,l,i,o]),!n&&(!d||!p("workspaces.create")&&(a==null?void 0:a.length)===1)?null:e.jsx(m.Fragment,{children:e.jsxs(ce,{type:"popover",placement:r,isOpen:u,onClose:()=>{x(!1)},children:[n?m.cloneElement(n,{onClick:()=>x(!u)}):e.jsx(ji,{onClick:()=>x(!u),workspace:d,className:t}),e.jsx(Q,{size:"min-w-320",children:e.jsxs(U,{padding:"p-10",children:[e.jsx("div",{className:"mb-16 border-b pb-10",children:a==null?void 0:a.map(j=>e.jsx(vi,{workspace:j,setSelectorIsOpen:x,onChange:s},j.id))}),e.jsx("div",{className:"mb-4 px-4 text-center",children:e.jsx(gi,{onClick:()=>x(!1),onCreated:j=>s==null?void 0:s(j),workspaceCount:a?a.length-1:0})})]})})]})})}function gi({onClick:s,onCreated:t,workspaceCount:n}){const{setWorkspaceId:r}=V(),{checkOverQuotaOrNoPermission:a}=R(),{overQuotaOrNoPermission:i}=a("workspaces.create","count",n);return e.jsxs(m.Fragment,{children:[e.jsx(E,{disabled:i,onClick:async o=>{o.preventDefault(),o.stopPropagation(),s();const l=await fe(Va);l&&(r(l),t==null||t(l))},variant:"outline",startIcon:e.jsx(rs,{}),color:"primary",className:"h-40 w-full",children:e.jsx(c,{message:"Create new workspace"})}),i&&e.jsx(Ka,{size:"sm",className:"mt-12 max-w-288",resourceName:e.jsx(c,{message:"worksapces"})})]})}const ji=m.forwardRef(({workspace:s,className:t,onClick:n,...r},a)=>e.jsxs(Ns,{ref:a,onClick:n,className:D("flex items-center gap-10 rounded ring-inset hover:bg-hover focus-visible:ring-2",t),...r,children:[e.jsxs("span",{className:"mr-auto block flex-auto overflow-hidden text-left",children:[e.jsx("span",{className:"block overflow-hidden overflow-ellipsis text-sm font-medium text-main",children:s.default?e.jsx(c,{message:s.name}):s.name}),e.jsx("span",{className:"block text-xs text-muted",children:s.default?e.jsx(c,{message:"Personal workspace"}):e.jsx(c,{message:":count members",values:{count:s.members_count}})})]}),e.jsx(Lt,{className:"shrink-0 icon-md"})]}));function vi({workspace:s,onChange:t,setSelectorIsOpen:n}){const{workspaceId:r,setWorkspaceId:a}=V(),i=r===s.id;return e.jsxs("div",{onClick:()=>{a(s.id),t==null||t(s.id),n(!1)},className:D("mb-4 flex cursor-pointer items-center gap-12 rounded-lg p-10 text-left",i&&"bg-primary/5",!i&&"hover:bg-hover"),children:[e.jsx(Ss,{size:"sm",className:D("flex-shrink-0 text-primary",!i&&"invisible")}),e.jsxs("div",{className:"flex-auto",children:[e.jsx("div",{className:D("text-sm",i&&"font-semibold"),children:s.name}),e.jsx("div",{className:"text-sm text-muted",children:s.default?e.jsx(c,{message:"Personal workspace"}):e.jsx(c,{message:":count members",values:{count:s.members_count}})})]}),s.id!==0&&e.jsx(wi,{setSelectorIsOpen:n,workspace:s,onChange:t})]})}function bi({workspace:s,onChange:t}){const n=ht(),{user:r}=R(),{close:a}=z();return e.jsx(ft,{isLoading:n.isPending,onConfirm:()=>{n.mutate({workspaceId:s.id,memberId:r.id,memberType:"member"},{onSuccess:()=>{a(),t==null||t(Ee.id)}})}})}function yi({workspace:s,onChange:t}){const n=Xa(),{close:r}=z();return e.jsx(ue,{isDanger:!0,title:e.jsx(c,{message:"Delete workspace"}),body:e.jsx(c,{message:"Are you sure you want to delete “:name“?",values:{name:s.name}}),confirm:e.jsx(c,{message:"Delete"}),isLoading:n.isPending,onConfirm:()=>{n.mutate({id:s.id},{onSuccess:()=>{r(),t==null||t(Ee.id)}})}})}function wi({setSelectorIsOpen:s,workspace:t,onChange:n}){const{user:r}=R();return e.jsxs(We,{onItemSelected:()=>s(!1),children:[e.jsx(E,{onClick:a=>{a.preventDefault(),a.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:e.jsx(Rt,{}),children:e.jsx(c,{message:"Manage"})}),e.jsxs(_e,{children:[e.jsx(W,{onClick:a=>{a.stopPropagation(),fe(oi,{workspace:t})},value:"workspaceMembers",startIcon:e.jsx(Rn,{}),children:e.jsx(c,{message:"Members"})}),t.owner_id===(r==null?void 0:r.id)&&e.jsx(W,{onClick:a=>{a.stopPropagation(),fe(Ya,{workspace:t})},value:"updateWorkspace",startIcon:e.jsx(Vn,{}),children:e.jsx(c,{message:"Rename"})}),t.owner_id!==(r==null?void 0:r.id)&&e.jsx(W,{onClick:a=>{a.stopPropagation(),fe(bi,{workspace:t,onChange:n})},value:"leaveWorkspace",startIcon:e.jsx(Cs,{}),children:e.jsx(c,{message:"Leave"})}),t.owner_id===(r==null?void 0:r.id)&&e.jsx(W,{onClick:a=>{a.stopPropagation(),fe(yi,{workspace:t,onChange:n})},value:"deleteWorkspace",startIcon:e.jsx(Hs,{}),children:e.jsx(c,{message:"Delete"})})]})]})}const jt={"/drive/recent":jn,"/drive/starred":zn,"/drive/shares":Ls,"/drive/trash":Hs};var xe={},Is;function Ii(){return Is||(Is=1,(function(s){var t=xe&&xe.__assign||function(){return(t=Object.assign||function(o){for(var l,d=1,u=arguments.length;d<u;d++)for(var x in l=arguments[d])Object.prototype.hasOwnProperty.call(l,x)&&(o[x]=l[x]);return o}).apply(this,arguments)},n=(Object.defineProperty(s,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(s.countNodes=s.arrayToTree=void 0)},nestedIds:!0,assign:!1});function r(o,l){l===void 0&&(l={});for(var d,u=t(t({},n),l),x=[],p={},j=u.throwIfOrphans?new Set:null,f=0,b=o;f<b.length;f++){var h=b[f],y=u.nestedIds?i(h,u.id):h[u.id],w=u.nestedIds?i(h,u.parentId):h[u.parentId];if(u.rootParentIds[y])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(y,'", `rootParentIds`: ').concat(Object.keys(u.rootParentIds).map(function(v){return'"'.concat(v,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(p,y)||(p[y]=((d={})[u.childrenField]=[],d)),j&&j.delete(y),u.dataField?p[y][u.dataField]=h:u.assign?p[y]=Object.assign(h,((d={})[u.childrenField]=p[y][u.childrenField],d)):p[y]=t(t({},h),((h={})[u.childrenField]=p[y][u.childrenField],h)),h=p[y],w==null||u.rootParentIds[w]?x.push(h):(Object.prototype.hasOwnProperty.call(p,w)||(p[w]=((y={})[u.childrenField]=[],y),j&&j.add(w)),p[w][u.childrenField].push(h))}if(j!=null&&j.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(j),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(u.throwIfOrphans&&a(x,u.childrenField)<Object.keys(p).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return x}function a(o,l){return o.reduce(function(d,u){return d+1+(u[l]&&a(u[l],l))},0)}function i(o,l){return l.split(".").reduce(function(d,u){return d&&d[u]},o)}s.arrayToTree=r,s.countNodes=a})(xe)),xe}var ki=Ii();function Si({folder:s,ref:t}){const[n,r]=m.useState(!1),{onDrop:a}=tt(s);return{...$e({id:cs(s),ref:t,types:["fileEntry","nativeFile"],acceptsDrop:o=>Ve(o,s),onDragEnter:o=>{Ve(o,s)&&r(!0)},onDragLeave:()=>{r(!1)},onDropActivate:()=>{g().sidebarExpandedKeys.includes(s.id)||g().setSidebarExpandedKeys([...g().sidebarExpandedKeys,s.id])},onDrop:a}),isDragOver:n}}const ms=m.createContext(null);function vt({nodes:s,itemRenderer:t,parentNode:n,level:r}){return s.map((a,i)=>m.cloneElement(t(a),{level:r==null?0:r+1,index:i,node:a,parentNode:n,key:a.id,itemRenderer:t}))}function Di({children:s,nodes:t,...n}){const[r,a]=xs(n.expandedKeys,n.defaultSelectedKeys,n.onExpandedKeysChange),[i,o]=xs(n.selectedKeys,n.defaultSelectedKeys,n.onSelectedKeysChange),[l,d]=m.useState(),u={expandedKeys:r,setExpandedKeys:a,selectedKeys:i,setSelectedKeys:o,focusedNode:l,setFocusedNode:d};return e.jsx(ms.Provider,{value:u,children:e.jsx(zt,{children:e.jsx(Ei,{nodes:t,itemRenderer:s})})})}function Ei(s){return e.jsx("ul",{className:"overflow-hidden text-sm",role:"tree",children:vt(s)})}const bt=m.forwardRef(({icon:s,label:t,level:n=0,node:r,className:a,...i},o)=>{const{expandedKeys:l,setExpandedKeys:d,selectedKeys:u,setSelectedKeys:x}=m.useContext(ms),p=l.includes(r.id),j=u.includes(r.id),f=b=>{b.stopPropagation();const h=l.indexOf(r.id),y=[...l];h>-1?y.splice(h,1):y.push(r.id),d(y)};return e.jsxs("div",{...i,ref:o,onClick:b=>{b.stopPropagation(),x([r.id])},className:D("header tree-label flex cursor-pointer flex-nowrap items-center gap-4 overflow-hidden text-ellipsis whitespace-nowrap rounded-button py-6",a,j&&"bg-primary/selected font-bold text-primary",!j&&"hover:bg-hover"),children:[n>0&&e.jsx("div",{className:"flex",children:Array.from({length:n}).map((b,h)=>e.jsx("div",{className:"h-24 w-24"},h))}),e.jsx("div",{onClick:f,children:e.jsx(Qn,{className:D("cursor-default transition-transform icon-sm",p&&"rotate-90")})}),s,e.jsx("div",{className:"overflow-hidden text-ellipsis pr-6",children:t})]})});bt.displayName="TreeLabel";function Ni({label:s,icon:t,node:n,level:r,index:a,itemRenderer:i,labelRef:o,labelClassName:l,className:d,parentNode:u,...x}){const p=Wt(),{expandedKeys:j,selectedKeys:f,focusedNode:b,setFocusedNode:h,setExpandedKeys:y,setSelectedKeys:w}=m.useContext(ms);if(m.useEffect(()=>()=>{b===(n==null?void 0:n.id)&&h(void 0)},[b,n==null?void 0:n.id,h]),!n||!i)return null;const v=n.children.length,A=v&&j.includes(n.id),N=f.includes(n.id),O=r===0&&a===0,K=b==null?O:b===n.id,ee=I=>{var me,ps;if(b!=null)switch(I.key){case"Enter":case" ":I.stopPropagation(),I.preventDefault(),w([b]);break;case"ArrowRight":if(I.stopPropagation(),I.preventDefault(),!v)return;A?p==null||p.focusNext():y([...j,b]);break;case"ArrowLeft":if(I.stopPropagation(),I.preventDefault(),A){const G=j.indexOf(b),ne=[...j];ne.splice(G,1),y(ne)}else if(u){const G=(ps=(me=document.activeElement)==null?void 0:me.parentElement)==null?void 0:ps.closest("[tabindex]");G&&G.focus()}break;case"ArrowDown":I.stopPropagation(),I.preventDefault(),p==null||p.focusNext();break;case"ArrowUp":I.stopPropagation(),I.preventDefault(),p==null||p.focusPrevious();break;case"Home":I.stopPropagation(),I.preventDefault(),p==null||p.focusFirst();break;case"End":I.stopPropagation(),I.preventDefault(),p==null||p.focusLast();break;case"*":if(I.stopPropagation(),I.preventDefault(),u!=null&&u.children){const G=[...j];u.children.forEach(ne=>{ne.children.length&&!j.includes(ne.id)&&G.push(ne.id)}),G.length!==j.length&&y(G)}break}};return e.jsxs("li",{role:"treeitem","aria-expanded":A?"true":"false","aria-selected":N,tabIndex:K?0:-1,onKeyDown:Ce(ee),onFocus:I=>{I.stopPropagation(),h(n.id)},onBlur:I=>{I.stopPropagation(),I.currentTarget.contains(I.relatedTarget)||h(void 0)},className:D("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",d),children:[e.jsx(bt,{ref:o,className:l,node:n,level:r,label:s,icon:t,...x}),e.jsx(Y,{initial:!1,children:A?e.jsx(_.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:vt({nodes:n.children,parentNode:n,itemRenderer:i,level:r})},`${n.id}-group`):null})]})}function Pi(){const s=te(),{data:t}=Js(),n=S(o=>o.sidebarExpandedKeys),r=S(o=>o.activePage);let a=[];r!=null&&r.isFolderPage&&(a=r.folder?[r.folder.id]:[]);const i=m.useMemo(()=>{const o=ki.arrayToTree((t==null?void 0:t.folders)||[],{parentId:"parent_id",dataField:null});return[{...M.folder,children:o}]},[t==null?void 0:t.folders]);return e.jsx(Di,{nodes:i,expandedKeys:n,onExpandedKeysChange:o=>{g().setSidebarExpandedKeys(o)},selectedKeys:a,onSelectedKeysChange:([o])=>{const l=yt(o,i);s(l?es(l):M.path)},children:()=>e.jsx(Fi,{})})}function Fi(s){const{node:t}=s,n=m.useRef(null),r=t.id===0,a=S(d=>d.entriesBeingDragged.includes(t.id)),{draggableProps:i}=$s({type:"fileEntry",id:cs(t),ref:n,disabled:r,hidePreview:!0,onDragStart:(d,u)=>{const x=u;g().setEntriesBeingDragged(x.getData().map(p=>p.id)),g().selectEntries([])},onDragEnd:()=>{g().setEntriesBeingDragged([])},getData:()=>[t]}),{droppableProps:o,isDragOver:l}=Si({folder:t,ref:n});return e.jsx(Ni,{...ze(i,o,s),onContextMenu:d=>{d.preventDefault(),d.stopPropagation(),g().deselectEntries("all"),g().setContextMenuData({x:d.clientX,y:d.clientY,entry:t})},labelRef:n,className:r?"focus-visible:ring-2":void 0,labelClassName:D(l&&"bg-primary/selected ring ring-2 ring-inset ring-primary",a&&"opacity-30",r&&"h-40"),icon:r?e.jsx(vn,{size:"md",className:"mr-6"}):e.jsx(Me,{size:"sm",className:"mr-4"}),label:t.name})}const yt=(s,t)=>{for(const n of t){if(n.id===s)return n.hash;if(n.children){const r=yt(s,n.children);if(r)return r}}};var wt=(s=>(s.DriveSidebar="drive-sidebar",s))(wt||{});function Ci(){return e.jsxs("div",{className:"mt-26 px-12 text-muted",children:[e.jsx(Pi,{}),e.jsx(_t,{defaultIcons:jt,menu:wt.DriveSidebar,orientation:"vertical",gap:"gap-0",children:s=>s.action==="/drive/trash"?e.jsx(Mi,{item:s},s.id):e.jsx(It,{item:s},s.id)})]})}const It=m.forwardRef(({item:s,className:t,...n},r)=>e.jsx($t,{defaultIcons:jt,className:({isActive:a})=>D(t,"my-4 h-40 w-full rounded-button px-24",a?"cursor-default bg-primary/selected font-bold text-primary":"hover:bg-hover"),item:s,ref:r,...n}));function Mi({item:s}){const t=ns(),[n,r]=m.useState(!1),a=m.useRef(null),{droppableProps:i}=$e({id:"trash",types:["fileEntry"],ref:a,onDragEnter:()=>{r(!0)},onDragLeave:()=>{r(!1)},onDrop:o=>{const l=o.getData().map(d=>d.id);t.mutate({entryIds:l,deleteForever:!1})}});return e.jsx(It,{className:D(n&&"bg-primary/selected"),ref:a,...i,item:s})}function Ti(s){return e.jsx(Yn,{...s,role:"meter progressbar"})}function Ai(){const{isLoading:s,data:t}=cn(),n=e.jsx("span",{className:D("whitespace-nowrap",s&&"invisible"),children:e.jsx(c,{message:":used of :available used",values:{used:t==null?void 0:t.usedFormatted,available:t==null?void 0:t.availableFormatted}})});return e.jsxs("div",{className:"mt-24 flex items-start gap-16 border-t pl-24 pt-24",children:[e.jsx(Hn,{className:"-mt-4 icon-md"}),e.jsx(Ti,{className:"max-w-144 flex-auto",size:"xs",value:t==null?void 0:t.percentage,label:n,showValueLabel:!1,labelPosition:"bottom"})]})}function Li({className:s}){const{isSubscribed:t}=R(),{billing:n}=Ie();return e.jsxs("div",{className:D(s,"flex flex-col gap-20 border-divider-lighter bg text-sm font-medium text-muted lg:mr-8 lg:bg-transparent"),children:[e.jsxs("div",{className:"compact-scrollbar flex-auto overflow-y-auto",children:[e.jsx(xt,{className:"px-12 pt-28 text-center"}),e.jsx(Ci,{}),e.jsx(Ai,{}),n.enable?e.jsx("div",{className:"mt-14 pl-60",children:e.jsx(E,{elementType:Ze,to:t?"/billing/change-plan":"/pricing",variant:"outline",color:"primary",size:"xs",children:e.jsx(c,{message:"Upgrade"})})}):null]}),e.jsx(Ri,{})]})}function Ri(){const s=te();return e.jsx(hi,{onChange:()=>{s(M.path)},className:"mt-auto w-full flex-shrink-0 border-t px-24 py-18"})}const zi={modifyUploadedFile:s=>{const t=Bt();return s.fingerprint=`${s.fingerprint}-w-${t}`,s}};function rl(){const{pathname:s}=Ot(),{hash:t}=Kt(),{workspaceId:n}=V(),r=S(i=>i.activePage);m.useEffect(()=>{g().setActivePage(dn.find(i=>i.path===s)||un(t))},[s,t]);const a=m.useMemo(()=>({workspaceId:n}),[n]);return m.useEffect(()=>()=>{g().reset()},[]),e.jsxs(m.Fragment,{children:[(r==null?void 0:r.label)&&e.jsx(qt,{children:e.jsx(c,{message:typeof r.label=="string"?r.label:r.label.message})}),e.jsxs(hn,{options:zi,children:[e.jsx(fn.Provider,{value:a,children:e.jsxs(Ut,{className:"lg:bg-alt lg:p-8 lg:dark:bg",name:"drive",onDragOver:i=>{i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="none"},onDrop:i=>{i.preventDefault()},children:[e.jsx(Wi,{}),e.jsx(hs,{position:"left",size:"md",children:e.jsx(Li,{})}),e.jsx(Vt,{isScrollable:!1,children:e.jsxs("div",{className:"dashboard-rounded-panel flex h-full flex-col border-divider-lighter",children:[e.jsx(_a,{}),e.jsx(Rr,{})]})}),e.jsx(Ma,{}),e.jsx(Da,{}),e.jsx(hs,{position:"right",size:"lg",children:e.jsx(dr,{})})]})}),e.jsx(fr,{})]})]})}function Wi(){const{isMobileMode:s}=m.useContext(J),t=S(i=>i.activePage),n=s?null:e.jsx(Na,{}),r=e.jsx(F,{elementType:Ze,to:X.path,children:e.jsx(be,{})}),a=e.jsxs(m.Fragment,{children:[t!==X&&r,e.jsx(xt,{isCompact:!0})]});return e.jsxs(m.Fragment,{children:[e.jsx(mn,{rightChildren:s&&a,menuPosition:"drive-navbar",color:"transparent",darkModeColor:"transparent",logoColor:"matchMode",border:"border-b lg:border-none",textColor:"text-main",size:null,className:"mb-8",children:n}),s&&e.jsx(_i,{})]})}function _i(){const s=S(t=>t.selectedEntries.size);return s?e.jsxs("div",{className:"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl",children:[e.jsx(F,{onClick:()=>{g().selectEntries([])},children:e.jsx(oe,{})}),e.jsx(c,{message:":count selected",values:{count:s}}),e.jsx(et,{className:"ml-auto"})]}):null}export{rl as Component};
