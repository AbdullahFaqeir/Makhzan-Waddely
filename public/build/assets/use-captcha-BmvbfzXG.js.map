{"version":3,"file":"use-captcha-BmvbfzXG.js","sources":["../../../common/foundation/resources/client/captcha/captcha-container.tsx","../../../common/foundation/resources/client/captcha/use-captcha.ts"],"sourcesContent":["import {getInputFieldClassNames} from '@ui/forms/input-field/get-input-field-class-names';\nimport {Trans} from '@ui/i18n/trans';\n\ninterface CaptchaContainerProps {\n  className?: string;\n}\nexport function CaptchaContainer({className}: CaptchaContainerProps) {\n  const {label} = getInputFieldClassNames();\n  return (\n    <div className={className}>\n      <div className={label}>\n        <Trans message=\"Let us know you're human\" />\n      </div>\n      <div id=\"captcha-container\" className=\"h-[65px] w-[300px]\" />\n    </div>\n  );\n}\n","import {useSettingsPreviewMode} from '@common/admin/settings/preview/use-settings-preview-mode';\nimport {CaptchaAction} from '@common/core/settings/base-backend-settings';\nimport {getBootstrapData} from '@ui/bootstrap-data/bootstrap-data-store';\nimport {useSettings} from '@ui/settings/use-settings';\nimport lazyLoader from '@ui/utils/loaders/lazy-loader';\nimport {useCallback, useEffect, useRef, useState} from 'react';\n\nexport function useCaptcha(action: CaptchaAction, disabled = false) {\n  const {isInsideSettingsPreview} = useSettingsPreviewMode();\n  const alreadyRendered = useRef(false);\n  const settings = useSettings();\n  const provider =\n    settings.captcha?.provider === 'turnstile' ? 'turnstile' : 'recaptcha';\n  const siteKey =\n    provider === 'recaptcha'\n      ? settings.captcha?.g_site_key\n      : settings.captcha?.t_site_key;\n  const captchaEnabled = !!(\n    !isInsideSettingsPreview &&\n    siteKey &&\n    settings.captcha?.enable?.[action] &&\n    !disabled\n  );\n\n  const [captchaToken, setCaptchaToken] = useState<string | null>(null);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (captchaEnabled && !cancelled && !alreadyRendered.current) {\n      if (cancelled || alreadyRendered.current) return;\n\n      const renderCaptcha = () => {\n        if (provider === 'recaptcha') {\n          window.grecaptcha.render('captcha-container', {\n            sitekey: siteKey,\n            action,\n            callback: function (token: string) {\n              setCaptchaToken(token);\n            },\n          });\n        } else {\n          turnstile.render('#captcha-container', {\n            sitekey: siteKey,\n            action,\n            callback: function (token: string) {\n              setCaptchaToken(token);\n            },\n          });\n        }\n      };\n\n      if (window.turnstile || window.grecaptcha) {\n        setTimeout(() => renderCaptcha());\n      } else {\n        window.captchaOnloadCallback = function () {\n          renderCaptcha();\n        };\n      }\n\n      loadCaptchaScript();\n\n      alreadyRendered.current = true;\n    }\n\n    return () => {\n      cancelled = true;\n      if (window.turnstile) {\n        window.turnstile?.remove('#captcha-container');\n      }\n    };\n  }, [captchaEnabled, siteKey]);\n\n  const resetCaptcha = useCallback(() => {\n    if (!siteKey || !captchaEnabled) return;\n    if (provider === 'turnstile') {\n      window.turnstile?.reset('#captcha-container');\n    } else {\n      window.grecaptcha?.reset();\n    }\n  }, [siteKey, captchaEnabled, provider]);\n\n  return {captchaToken, captchaEnabled, resetCaptcha};\n}\n\nfunction loadCaptchaScript() {\n  if (getBootstrapData().settings.captcha?.provider === 'turnstile') {\n    return lazyLoader.loadAsset(\n      `https://challenges.cloudflare.com/turnstile/v0/api.js?onload=captchaOnloadCallback&render=explicit`,\n      {id: 'turnstile-js'},\n    );\n  }\n  return lazyLoader.loadAsset(\n    `https://www.google.com/recaptcha/api.js?onload=captchaOnloadCallback&render=explicit`,\n    {id: 'recaptcha-js'},\n  );\n}\n"],"names":["CaptchaContainer","className","label","getInputFieldClassNames","jsxs","jsx","Trans","useCaptcha","action","disabled","isInsideSettingsPreview","useSettingsPreviewMode","alreadyRendered","useRef","settings","useSettings","provider","_a","siteKey","_b","_c","captchaEnabled","_e","_d","captchaToken","setCaptchaToken","useState","useEffect","cancelled","renderCaptcha","token","loadCaptchaScript","resetCaptcha","useCallback","getBootstrapData","lazyLoader"],"mappings":"yFAMO,SAASA,EAAiB,CAAC,UAAAC,GAAmC,CACnE,KAAM,CAAC,MAAAC,CAAA,EAASC,EAAA,EAChB,OACEC,OAAC,OAAI,UAAAH,EACH,SAAA,CAAAI,EAAAA,IAAC,OAAI,UAAWH,EACd,eAACI,EAAA,CAAM,QAAQ,2BAA2B,CAAA,CAC5C,EACAD,EAAAA,IAAC,MAAA,CAAI,GAAG,oBAAoB,UAAU,oBAAA,CAAqB,CAAA,EAC7D,CAEJ,CCTO,SAASE,EAAWC,EAAuBC,EAAW,GAAO,eAClE,KAAM,CAAC,wBAAAC,CAAA,EAA2BC,EAAA,EAC5BC,EAAkBC,EAAAA,OAAO,EAAK,EAC9BC,EAAWC,EAAA,EACXC,IACJC,EAAAH,EAAS,UAAT,YAAAG,EAAkB,YAAa,YAAc,YAAc,YACvDC,EACJF,IAAa,aACTG,EAAAL,EAAS,UAAT,YAAAK,EAAkB,YAClBC,EAAAN,EAAS,UAAT,YAAAM,EAAkB,WAClBC,EAAiB,CAAC,EACtB,CAACX,GACDQ,KACAI,GAAAC,EAAAT,EAAS,UAAT,YAAAS,EAAkB,SAAlB,MAAAD,EAA2Bd,KAC3B,CAACC,GAGG,CAACe,EAAcC,CAAe,EAAIC,EAAAA,SAAwB,IAAI,EAEpEC,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAY,GAChB,GAAIP,GAAkB,CAACO,GAAa,CAAChB,EAAgB,QAAS,CAC5D,GAAIgB,GAAahB,EAAgB,QAAS,OAE1C,MAAMiB,EAAgB,IAAM,CACtBb,IAAa,YACf,OAAO,WAAW,OAAO,oBAAqB,CAC5C,QAASE,EACT,OAAAV,EACA,SAAU,SAAUsB,EAAe,CACjCL,EAAgBK,CAAK,CACvB,CAAA,CACD,EAED,UAAU,OAAO,qBAAsB,CACrC,QAASZ,EACT,OAAAV,EACA,SAAU,SAAUsB,EAAe,CACjCL,EAAgBK,CAAK,CACvB,CAAA,CACD,CAEL,EAEI,OAAO,WAAa,OAAO,WAC7B,WAAW,IAAMD,GAAe,EAEhC,OAAO,sBAAwB,UAAY,CACzCA,EAAA,CACF,EAGFE,EAAA,EAEAnB,EAAgB,QAAU,EAC5B,CAEA,MAAO,IAAM,OACXgB,EAAY,GACR,OAAO,aACTX,EAAA,OAAO,YAAP,MAAAA,EAAkB,OAAO,sBAE7B,CACF,EAAG,CAACI,EAAgBH,CAAO,CAAC,EAE5B,MAAMc,EAAeC,EAAAA,YAAY,IAAM,SACjC,CAACf,GAAW,CAACG,IACbL,IAAa,aACfC,EAAA,OAAO,YAAP,MAAAA,EAAkB,MAAM,uBAExBE,EAAA,OAAO,aAAP,MAAAA,EAAmB,QAEvB,EAAG,CAACD,EAASG,EAAgBL,CAAQ,CAAC,EAEtC,MAAO,CAAC,aAAAQ,EAAc,eAAAH,EAAgB,aAAAW,CAAA,CACxC,CAEA,SAASD,GAAoB,OAC3B,QAAId,EAAAiB,EAAA,EAAmB,SAAS,UAA5B,YAAAjB,EAAqC,YAAa,YAC7CkB,EAAW,UAChB,qGACA,CAAC,GAAI,cAAA,CAAc,EAGhBA,EAAW,UAChB,uFACA,CAAC,GAAI,cAAA,CAAc,CAEvB"}