import{g as $,r as l,cb as S,X as A,w as p,j as t,c as v,au as R,as as _,B as E,T as g,P as L,k as D,aI as z,ac as B,J as j,K as M,A as K,y as O,z as H,ak as V,M as J,a7 as Q}from"./main-TIUJvpaR.js";import{C as W}from"./ChevronLeft-BuvOaHR7.js";import{C as X}from"./ChevronRight-BaJkMP9s.js";import{F}from"./FileDownload-pojohXY8.js";import{K as q}from"./KeyboardArrowRight-C0U0wgwT.js";import{d as N}from"./download-file-from-url-BVaKcxRP.js";const G=l.createContext(null);function x(e,s){const{base_url:a}=$(),n=l.useContext(G);return l.useMemo(()=>{if(!e)return{};const i={previewUrl:Y(e,(s==null?void 0:s.preferThumbnail)||!1),downloadUrl:`${a}/api/v1/file-entries/download/${(s==null?void 0:s.downloadHashes)||e.hash}`};return n&&(i.previewUrl&&(i.previewUrl=k(i.previewUrl,{...n,thumbnail:s!=null&&s.preferThumbnail?"true":""},a)),i.downloadUrl=k(i.downloadUrl,n,a)),i},[a,e,s==null?void 0:s.downloadHashes,s==null?void 0:s.preferThumbnail,n])}function Y(e,s){if(e.url){if(S(e.url))if(s&&e.thumbnail){const a=e.extension==="png"?"png":"jpg";return e.url.replace(new RegExp(e.file_name+"$"),`thumbnail.${a}`)}else return e.url;return`${A().settings.base_url}/${e.url}`}}function k(e,s,a){const n=new URL(e,a);return Object.entries(s).forEach(([r,i])=>{n.searchParams.append(r,i)}),n.toString()}const Z=2*1024*1024;function ee({file:e,className:s,iconClassName:a,showImage:n=!0}){const{trans:r}=p(),{previewUrl:i}=x(e,{preferThumbnail:!0});if(e.file_size&&e.file_size>Z&&!e.thumbnail&&(n=!1),n&&e.type==="image"&&i){const c=r({message:":fileName thumbnail",values:{fileName:e.name}});return t.jsx("img",{className:v(s,"object-cover"),src:i,alt:c,draggable:!1})}return t.jsx(R,{className:a,type:e.type})}const I=_.createContext(null);function m({message:e,className:s,allowDownload:a}){const{entries:n,activeIndex:r}=l.useContext(I),i=n[r],c=e||t.jsx(g,{message:"No file preview available"}),{downloadUrl:o}=x(i);return t.jsxs("div",{className:v(s,"w-[calc(100%-40px)] max-w-400 rounded-panel bg-elevated p-40 text-center shadow"),children:[t.jsx("div",{className:"text-lg",children:c}),a&&t.jsx("div",{className:"mt-20 block text-center",children:t.jsx(E,{variant:"flat",color:"primary",onClick:()=>{o&&N(o)},children:t.jsx(g,{message:"Download"})})})]})}function se(e){const{entry:s,className:a}=e,{previewUrl:n}=x(s),r=l.useRef(null),[i,c]=l.useState(!1);return l.useEffect(()=>{var o;c(!((o=r.current)!=null&&o.canPlayType(s.mime)))},[s]),i||!n?t.jsx(m,{...e}):t.jsx("audio",{className:a,ref:r,controls:!0,controlsList:"nodownload noremoteplayback",autoPlay:!0,children:t.jsx("source",{src:n,type:s.mime,onError:()=>{c(!0)}})})}function te(e){const{entry:s,className:a}=e,{trans:n}=p(),{previewUrl:r}=x(s);return r?t.jsx("img",{className:v(a,"shadow"),src:r,alt:n({message:"Preview for :name",values:{name:s.name}})}):t.jsx(m,{...e})}function ae(e){const{entry:s,className:a}=e,{trans:n}=p(),{previewUrl:r}=x(s);return r?t.jsx("iframe",{title:n({message:"Preview for :name",values:{name:s.name}}),className:v(a,"h-full w-full"),src:`${r}#toolbar=0`}):t.jsx(m,{...e})}const ne=5242880;function re(e){const{entry:s,className:a}=e,{trans:n}=p(),[r,i]=l.useState(!1),[c,o]=l.useState(!0),[u,d]=l.useState(!1),[f,h]=l.useState(null),{previewUrl:w}=x(s);return l.useEffect(()=>{s&&(w?s.file_size>=ne?(i(!0),o(!1)):ie(w).then(b=>{h(b.data)}).catch(()=>{d(!0)}).finally(()=>{o(!1)}):d(!0))},[s,w]),c?t.jsx(L,{isIndeterminate:!0,"aria-label":n({message:"Loading file contents"})}):r?t.jsx(m,{...e,message:t.jsx(g,{message:"This file is too large to preview."})}):u?t.jsx(m,{...e,message:t.jsx(g,{message:"There was an issue previewing this file"})}):t.jsx("pre",{className:v("h-full w-full overflow-y-auto whitespace-pre-wrap break-words rounded-panel bg-elevated p-20 text-sm",a),children:t.jsx("div",{className:"container mx-auto",children:`${f}`})})}function ie(e){return D.get(e,{responseType:"text",withCredentials:!1,headers:{Accept:"text/plain"}})}function le(e){const{entry:s,className:a}=e,{previewUrl:n}=x(s),r=l.useRef(null),[i,c]=l.useState(!1);return l.useEffect(()=>{var o;c(!((o=r.current)!=null&&o.canPlayType(s.mime)))},[s]),i||!n?t.jsx(m,{...e}):t.jsx("video",{className:a,ref:r,controls:!0,controlsList:"nodownload noremoteplayback",playsInline:!0,autoPlay:!0,children:t.jsx("source",{src:n,type:s.mime,onError:()=>{c(!0)}})})}function P(e){const{entry:s,className:a}=e,{trans:n}=p(),r=l.useRef(null),[i,c]=l.useState(!1),o=l.useRef(null),[u,d]=l.useState(!1),{previewUrl:f}=x(s);return l.useEffect(()=>{f?s.file_size&&s.file_size>25e6?c(!0):r.current&&(r.current.onload=()=>{clearTimeout(o.current),d(!1)},ce(f,s).then(h=>{r.current&&(r.current.src=h)}),o.current=setTimeout(()=>{c(!0)},5e3)):c(!0)},[s,f]),i?t.jsx(m,{...e}):t.jsxs("div",{className:v(a,"h-full w-full"),children:[u&&t.jsx(L,{}),t.jsx("iframe",{ref:r,title:n({message:"Preview for :name",values:{name:s.name}}),className:v("h-full w-full",u&&"hidden")})]})}async function ce(e,s){const a=new URL(e);if(!a.searchParams.has("shareable_link")){const{data:n}=await D.post(`file-entries/${s.id}/add-preview-token`);a.searchParams.append("preview_token",n.preview_token)}return oe(a)}function oe(e){return`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(e.toString())}`}const T={text:re,video:le,audio:se,image:te,pdf:ae,spreadsheet:P,powerPoint:P,word:P,"text/rtf":m};function ue(e){const s=e==null?void 0:e.mime,a=e==null?void 0:e.type;return T[s]||T[a]||m}function de({entries:e,onClose:s,showHeader:a=!0,className:n,headerActionsLeft:r,allowDownload:i=!0,...c}){const o=z("(max-width: 1024px)"),[u,d]=B(c.activeIndex,c.defaultActiveIndex||0,c.onActiveIndexChange),f=e[u],h=l.useMemo(()=>({entries:e,activeIndex:u}),[e,u]),w=ue(f);if(!f)return s==null||s(),null;const b=e.length-1>u,y=()=>{d(u+1)},C=u>0,U=()=>{d(u-1)};return t.jsxs(I.Provider,{value:h,children:[a&&t.jsx(fe,{actionsLeft:r,isMobile:o,onClose:s,onNext:b?y:void 0,onPrevious:C?U:void 0,allowDownload:i}),t.jsxs("div",{className:v("relative flex-auto overflow-hidden",n),children:[o&&t.jsx(j,{size:"lg",className:"absolute left-0 top-1/2 z-10 -translate-y-1/2 transform text-muted",disabled:!C,onClick:U,children:t.jsx(M,{})}),t.jsx(K,{initial:!1,children:t.jsx(O.div,{className:"absolute inset-0 flex items-center justify-center",...H,children:t.jsx(w,{className:"max-h-[calc(100%-30px)]",entry:f,allowDownload:i})},f.id)}),o&&t.jsx(j,{size:"lg",className:"absolute right-0 top-1/2 z-10 -translate-y-1/2 transform text-muted",disabled:!b,onClick:y,children:t.jsx(q,{})})]})]})}function fe({onNext:e,onPrevious:s,onClose:a,isMobile:n,actionsLeft:r,allowDownload:i}){const{entries:c,activeIndex:o}=l.useContext(I),u=c[o],{downloadUrl:d}=x(u),w=n?t.jsx(j,{onClick:()=>{d&&N(d)},children:t.jsx(F,{})}):t.jsx(E,{startIcon:t.jsx(F,{}),variant:"text",onClick:()=>{d&&N(d)},children:t.jsx(g,{message:"Download"})});return t.jsxs("div",{className:"flex min-h-50 flex-shrink-0 items-center justify-between gap-20 border-b bg-elevated px-10 text-sm text-muted",children:[t.jsxs("div",{className:"flex w-1/3 items-center justify-start gap-4",children:[r,i?w:void 0]}),t.jsxs("div",{className:"flex w-1/3 flex-nowrap items-center justify-center gap-10 text-main",children:[t.jsx(ee,{file:u,iconClassName:"w-16 h-16",showImage:!1}),t.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:u.name})]}),t.jsxs("div",{className:"flex w-1/3 items-center justify-end gap-10 whitespace-nowrap",children:[!n&&t.jsxs(l.Fragment,{children:[t.jsx(j,{disabled:!s,onClick:s,children:t.jsx(W,{})}),t.jsx("div",{children:o+1}),t.jsx("div",{children:"/"}),t.jsx("div",{children:c.length}),t.jsx(j,{disabled:!e,onClick:e,children:t.jsx(X,{})}),t.jsx("div",{className:"mx-20 h-24 w-1 bg-divider"})]}),t.jsx(j,{radius:"rounded-none",onClick:a,children:t.jsx(V,{})})]})]})}function pe(e){return t.jsx(J,{size:"fullscreenTakeover",background:"bg-alt",className:"flex flex-col",children:t.jsx(me,{...e})})}function me(e){const{close:s}=Q();return t.jsx(de,{onClose:s,...e})}export{ee as F,pe as a,G as b,de as c,x as u};
