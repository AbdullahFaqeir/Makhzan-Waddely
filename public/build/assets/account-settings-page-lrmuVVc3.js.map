{"version":3,"file":"account-settings-page-lrmuVVc3.js","sources":["../../../common/foundation/resources/client/auth/ui/account-settings/basic-info-panel/basic-info-panel.tsx","../../../common/foundation/resources/client/auth/ui/account-settings/danger-zone-panel/delete-account.ts","../../../common/foundation/resources/client/auth/ui/account-settings/danger-zone-panel/danger-zone-panel.tsx","../../../common/foundation/resources/client/auth/ui/account-settings/account-settings-page.tsx"],"sourcesContent":["import {UploadType} from '@app/site-config';\nimport {AccountSettingsId} from '@common/auth/ui/account-settings/account-settings-sidenav';\nimport {apiClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {ImageSelector} from '@common/uploads/components/image-selector';\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\nimport {useMutation} from '@tanstack/react-query';\nimport {Avatar} from '@ui/avatar/avatar';\nimport {Button} from '@ui/buttons/button';\nimport {Form} from '@ui/forms/form';\nimport {FormTextField} from '@ui/forms/input-field/text-field/text-field';\nimport {Trans} from '@ui/i18n/trans';\nimport {AlternateEmailIcon} from '@ui/icons/material/AlternateEmail';\nimport {User} from '@ui/types/user';\nimport {useId, useState} from 'react';\nimport {useForm} from 'react-hook-form';\nimport {AccountSettingsPanel} from '../account-settings-panel';\nimport {useUpdateAccountDetails} from './update-account-details';\n\ninterface Props {\n  user: User;\n}\nexport function BasicInfoPanel({user}: Props) {\n  const formId = useId();\n  const form = useForm<Partial<Omit<User, 'subscriptions'>>>({\n    defaultValues: {\n      name: user.name || '',\n      image: user.image,\n    },\n  });\n  const updateAvatar = useUpdateAvatar(user.id);\n  const updateDetails = useUpdateAccountDetails(user.id, form);\n\n  return (\n    <AccountSettingsPanel\n      id={AccountSettingsId.AccountDetails}\n      title={<Trans message=\"Update name and profile image\" />}\n      actions={\n        <Button\n          type=\"submit\"\n          variant=\"flat\"\n          color=\"primary\"\n          form={formId}\n          disabled={\n            updateDetails.isPending ||\n            !form.formState.isValid ||\n            !form.formState.isDirty\n          }\n        >\n          <Trans message=\"Save\" />\n        </Button>\n      }\n    >\n      <Form\n        form={form}\n        className=\"flex flex-col items-center gap-40 md:flex-row md:gap-60\"\n        onSubmit={newDetails => {\n          updateDetails.mutate(newDetails, {\n            onSuccess: () => {\n              form.reset({\n                ...form.getValues(),\n                ...newDetails,\n              });\n            },\n          });\n        }}\n        id={formId}\n      >\n        <FileUploadProvider>\n          <AvatarSelector user={user} />\n        </FileUploadProvider>\n        <div className=\"w-full flex-auto\">\n          <div className=\"mb-16 flex items-center gap-4 text-muted\">\n            <AlternateEmailIcon size=\"sm\" />\n            {user.email}\n          </div>\n          <FormTextField name=\"name\" label={<Trans message=\"Name\" />} />\n        </div>\n      </Form>\n    </AccountSettingsPanel>\n  );\n}\n\ninterface AvatarManagerProps {\n  user: {\n    id: User['id'];\n    image?: User['image'];\n    name: User['name'];\n  };\n}\nfunction AvatarSelector({user}: AvatarManagerProps) {\n  const [value, setValue] = useState(user.image);\n  const updateAvatar = useUpdateAvatar(user.id);\n  return (\n    <FileUploadProvider>\n      <ImageSelector\n        value={value}\n        uploadType={UploadType.avatars}\n        variant=\"avatar\"\n        stretchPreview\n        previewSize=\"w-90 h-90\"\n        placeholderIcon={\n          <Avatar label={user.name} size=\"w-full h-full text-2xl\" circle />\n        }\n        showRemoveButton\n        onChange={(_, entry) => {\n          setValue(entry?.url);\n          updateAvatar.mutate({\n            image: entry?.url ?? null,\n            image_entry_id: entry?.id ?? null,\n          });\n        }}\n      />\n    </FileUploadProvider>\n  );\n}\n\nfunction useUpdateAvatar(userId: number) {\n  return useMutation({\n    mutationFn: (payload: {\n      image?: string | null;\n      image_entry_id?: number | null;\n    }) => apiClient.put(`users/${userId}`, payload).then(r => r.data),\n    onError: r => showHttpErrorToast(r),\n  });\n}\n","import {useMutation} from '@tanstack/react-query';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {useLogout} from '@common/auth/requests/logout';\nimport {toast} from '@ui/toast/toast';\nimport {useAuth} from '@common/auth/use-auth';\nimport {apiClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\n\ninterface Response extends BackendResponse {}\n\nexport function useDeleteAccount() {\n  const {user} = useAuth();\n  const logout = useLogout();\n  return useMutation({\n    mutationFn: () => deleteAccount(user!.id),\n    onSuccess: () => {\n      toast('Account deleted');\n      logout.mutate();\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n}\n\nfunction deleteAccount(userId: number): Promise<Response> {\n  return apiClient\n    .delete(`users/${userId}`, {params: {deleteCurrentUser: true}})\n    .then(r => r.data);\n}\n","import {AccountSettingsId} from '@common/auth/ui/account-settings/account-settings-sidenav';\nimport {usePasswordConfirmedAction} from '@common/auth/ui/confirm-password/use-password-confirmed-action';\nimport {Button} from '@ui/buttons/button';\nimport {Trans} from '@ui/i18n/trans';\nimport {ConfirmationDialog} from '@ui/overlays/dialog/confirmation-dialog';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {useState} from 'react';\nimport {AccountSettingsPanel} from '../account-settings-panel';\nimport {useDeleteAccount} from './delete-account';\n\nexport function DangerZonePanel() {\n  const deleteAccount = useDeleteAccount();\n  const {withConfirmedPassword, isLoading: confirmingPassword} =\n    usePasswordConfirmedAction();\n\n  const [confirmDialogOpen, setConfirmDialogOpen] = useState(false);\n\n  return (\n    <AccountSettingsPanel\n      id={AccountSettingsId.DeleteAccount}\n      title={<Trans message=\"Danger zone\" />}\n    >\n      <DialogTrigger\n        type=\"modal\"\n        isOpen={confirmDialogOpen}\n        onOpenChange={setConfirmDialogOpen}\n        onClose={isConfirmed => {\n          if (isConfirmed) {\n            deleteAccount.mutate();\n          }\n        }}\n      >\n        <ConfirmationDialog\n          isDanger\n          title={<Trans message=\"Delete account?\" />}\n          body={\n            <Trans message=\"Your account will be deleted immediately and permanently. Once deleted, accounts can not be restored.\" />\n          }\n          confirm={<Trans message=\"Delete\" />}\n        />\n      </DialogTrigger>\n      <Button\n        variant=\"flat\"\n        color=\"danger\"\n        disabled={confirmingPassword || deleteAccount.isPending}\n        onClick={() => {\n          withConfirmedPassword(() => {\n            setConfirmDialogOpen(true);\n          });\n        }}\n      >\n        <Trans message=\"Delete account\" />\n      </Button>\n    </AccountSettingsPanel>\n  );\n}\n","import {AuthRoute} from '@common/auth/guards/auth-route';\nimport {AccountSettingsSidenav} from '@common/auth/ui/account-settings/account-settings-sidenav';\nimport {SessionsPanel} from '@common/auth/ui/account-settings/sessions-panel/sessions-panel';\nimport {TwoFactorPanel} from '@common/auth/ui/account-settings/two-factor-panel';\nimport {StaticPageTitle} from '@common/seo/static-page-title';\nimport {Navbar} from '@common/ui/navigation/navbar/navbar';\nimport {Trans} from '@ui/i18n/trans';\nimport {ProgressCircle} from '@ui/progress/progress-circle';\nimport {User} from '@ui/types/user';\nimport {ReactNode} from 'react';\nimport {useUser} from '../use-user';\nimport {AccessTokenPanel} from './access-token-panel/access-token-panel';\nimport {BasicInfoPanel} from './basic-info-panel/basic-info-panel';\nimport {ChangePasswordPanel} from './change-password-panel/change-password-panel';\nimport {DangerZonePanel} from './danger-zone-panel/danger-zone-panel';\nimport {LocalizationPanel} from './localization-panel';\nimport {SocialLoginPanel} from './social-login-panel';\n\ninterface Props {\n  panels?: (user: User) => ReactNode;\n  sidenavItems?: ReactNode;\n}\nexport function AccountSettingsPage({panels, sidenavItems}: Props) {\n  const {data, isLoading} = useUser('me', {\n    with: ['roles', 'social_profiles', 'tokens'],\n  });\n  return (\n    <AuthRoute>\n      <div className=\"min-h-screen bg\">\n        <StaticPageTitle>\n          <Trans message=\"Account Settings\" />\n        </StaticPageTitle>\n        <Navbar\n          menuPosition=\"account-settings-page\"\n          color=\"bg\"\n          className=\"sticky top-0 z-10\"\n        />\n        <div>\n          <div className=\"container mx-auto px-24 py-24\">\n            <h1 className=\"text-3xl\">\n              <Trans message=\"Account settings\" />\n            </h1>\n            <div className=\"mb-40 text-base text-muted\">\n              <Trans message=\"View and update your account details, profile and more.\" />\n            </div>\n            {isLoading || !data ? (\n              <ProgressCircle\n                className=\"my-80\"\n                aria-label=\"Loading user..\"\n                isIndeterminate\n              />\n            ) : (\n              <div className=\"flex items-start gap-24\">\n                <AccountSettingsSidenav items={sidenavItems} />\n                <main className=\"flex-auto\">\n                  {panels ? panels(data.user) : null}\n                  <BasicInfoPanel user={data.user} />\n                  <SocialLoginPanel user={data.user} />\n                  <ChangePasswordPanel />\n                  <TwoFactorPanel user={data.user} />\n                  <SessionsPanel />\n                  <LocalizationPanel user={data.user} />\n                  <AccessTokenPanel user={data.user} />\n                  <DangerZonePanel />\n                </main>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </AuthRoute>\n  );\n}\n"],"names":["BasicInfoPanel","user","formId","useId","form","useForm","useUpdateAvatar","updateDetails","useUpdateAccountDetails","jsx","AccountSettingsPanel","AccountSettingsId","Trans","Button","jsxs","Form","newDetails","FileUploadProvider","AvatarSelector","AlternateEmailIcon","FormTextField","value","setValue","useState","updateAvatar","ImageSelector","UploadType","Avatar","_","entry","userId","useMutation","payload","apiClient","r","showHttpErrorToast","useDeleteAccount","useAuth","logout","useLogout","deleteAccount","toast","err","DangerZonePanel","withConfirmedPassword","confirmingPassword","usePasswordConfirmedAction","confirmDialogOpen","setConfirmDialogOpen","DialogTrigger","isConfirmed","ConfirmationDialog","AccountSettingsPage","panels","sidenavItems","data","isLoading","useUser","AuthRoute","StaticPageTitle","Navbar","ProgressCircle","AccountSettingsSidenav","SocialLoginPanel","ChangePasswordPanel","TwoFactorPanel","SessionsPanel","LocalizationPanel","AccessTokenPanel"],"mappings":"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"}