{"version":3,"file":"base-captcha-settings-BA6D3IuD.js","sources":["../../../common/foundation/resources/client/admin/settings/pages/base-captcha-settings.tsx"],"sourcesContent":["import {AdminDocsUrls} from '@app/admin/admin-config';\nimport {AdminSettings} from '@common/admin/settings/admin-settings';\nimport {SettingsErrorGroup} from '@common/admin/settings/layout/settings-error-group';\nimport {AdminSettingsLayout} from '@common/admin/settings/layout/settings-layout';\nimport {DocsLink} from '@common/admin/settings/layout/settings-links';\nimport {SettingsPanel} from '@common/admin/settings/layout/settings-panel';\nimport {useAdminSettings} from '@common/admin/settings/requests/use-admin-settings';\nimport {CaptchaAction} from '@common/core/settings/base-backend-settings';\nimport {FormTextField} from '@ui/forms/input-field/text-field/text-field';\nimport {Item} from '@ui/forms/listbox/item';\nimport {FormSelect} from '@ui/forms/select/select';\nimport {FormSwitch} from '@ui/forms/toggle/switch';\nimport {Trans} from '@ui/i18n/trans';\nimport {Fragment, ReactNode} from 'react';\nimport {useForm, useFormContext, useWatch} from 'react-hook-form';\n\ninterface Props {\n  children?: ReactNode;\n  actions?: CaptchaAction[];\n}\nexport function Component({children, actions}: Props) {\n  const {data} = useAdminSettings();\n\n  const defaultValues: {client: Partial<AdminSettings['client']>} = {\n    client: {\n      captcha: {\n        provider: data.client.captcha?.provider ?? 'turnstile',\n        enable: {\n          contact: data.client.captcha?.enable?.contact ?? false,\n          register: data.client.captcha?.enable?.register ?? false,\n        },\n        g_site_key: data.client.captcha?.g_site_key ?? '',\n        g_secret_key: data.client.captcha?.g_secret_key ?? '',\n        t_site_key: data.client.captcha?.t_site_key ?? '',\n        t_secret_key: data.client.captcha?.t_secret_key ?? '',\n      },\n    },\n  };\n\n  actions?.forEach(action => {\n    defaultValues.client.captcha!.enable![action] =\n      data.client.captcha?.enable?.[action] ?? false;\n  });\n\n  const form = useForm<AdminSettings>({\n    defaultValues,\n  });\n\n  return (\n    <AdminSettingsLayout title={<Trans message=\"Captcha\" />} form={form}>\n      <EnableCaptchaPanel>{children}</EnableCaptchaPanel>\n      <CaptchaCredentialsPanel />\n    </AdminSettingsLayout>\n  );\n}\n\ninterface EnableCaptchaPanelProps {\n  children?: ReactNode;\n}\nfunction EnableCaptchaPanel({children}: EnableCaptchaPanelProps) {\n  return (\n    <SettingsPanel\n      className=\"mb-24\"\n      title={<Trans message=\"Enable captcha\" />}\n      description={\n        <Trans message=\"Select which pages should be protected by captcha.\" />\n      }\n      link={\n        AdminDocsUrls.settings.captcha ? (\n          <DocsLink link={AdminDocsUrls.settings.captcha}>\n            <Trans message=\"What is captcha?\" />\n          </DocsLink>\n        ) : null\n      }\n    >\n      {children}\n      <FormSwitch\n        className=\"mb-20\"\n        name=\"client.captcha.enable.contact\"\n        description={\n          <Trans\n            message={'Enable captcha integration for \"contact us\" page.'}\n          />\n        }\n      >\n        <Trans message=\"Contact page\" />\n      </FormSwitch>\n      <FormSwitch\n        name=\"client.captcha.enable.register\"\n        description={\n          <Trans message=\"Enable captcha integration for registration page.\" />\n        }\n      >\n        <Trans message=\"Registration page\" />\n      </FormSwitch>\n    </SettingsPanel>\n  );\n}\n\nfunction CaptchaCredentialsPanel() {\n  return (\n    <SettingsPanel\n      title={<Trans message=\"Provider & credentials\" />}\n      description={\n        <Trans message=\"Select captcha provider and enter your API credentials.\" />\n      }\n    >\n      <SettingsErrorGroup\n        separatorTop={false}\n        separatorBottom={false}\n        name=\"captcha_group\"\n      >\n        {isInvalid => {\n          return (\n            <Fragment>\n              <FormSelect\n                size=\"sm\"\n                name=\"client.captcha.provider\"\n                label={<Trans message=\"Captcha provider\" />}\n                className=\"mb-20\"\n              >\n                <Item value=\"recaptcha\">\n                  <Trans message=\"Google reCAPTCHA\" />\n                </Item>\n                <Item value=\"turnstile\">\n                  <Trans message=\"Cloudflare Turnstile\" />\n                </Item>\n              </FormSelect>\n              <CaptchaKeysFields isInvalid={isInvalid} />\n            </Fragment>\n          );\n        }}\n      </SettingsErrorGroup>\n    </SettingsPanel>\n  );\n}\n\ninterface CaptchaKeysFieldsProps {\n  isInvalid: boolean;\n}\nfunction CaptchaKeysFields({isInvalid}: CaptchaKeysFieldsProps) {\n  const {clearErrors} = useFormContext();\n  const provider = useWatch<AdminSettings>({name: 'client.captcha.provider'});\n\n  if (provider === 'turnstile') {\n    return (\n      <Fragment key={provider}>\n        <FormTextField\n          size=\"sm\"\n          className=\"mb-20\"\n          onChange={() => {\n            clearErrors();\n          }}\n          invalid={isInvalid}\n          name=\"client.captcha.t_site_key\"\n          label={<Trans message=\"Turnstile site key\" />}\n        />\n        <FormTextField\n          size=\"sm\"\n          onChange={() => {\n            clearErrors();\n          }}\n          invalid={isInvalid}\n          name=\"client.captcha.t_secret_key\"\n          label={<Trans message=\"Turnstile secret key\" />}\n        />\n      </Fragment>\n    );\n  }\n\n  return (\n    <Fragment key={provider}>\n      <FormTextField\n        size=\"sm\"\n        className=\"mb-20\"\n        onChange={() => {\n          clearErrors();\n        }}\n        invalid={isInvalid}\n        name=\"client.captcha.g_site_key\"\n        label={<Trans message=\"Google reCAPTCHA site key\" />}\n      />\n      <FormTextField\n        size=\"sm\"\n        onChange={() => {\n          clearErrors();\n        }}\n        invalid={isInvalid}\n        name=\"client.captcha.g_secret_key\"\n        label={<Trans message=\"Google reCAPTCHA secret key\" />}\n      />\n    </Fragment>\n  );\n}\n"],"names":["Component","children","actions","data","useAdminSettings","defaultValues","_a","_c","_b","_e","_d","_f","_g","_h","_i","action","form","useForm","jsxs","AdminSettingsLayout","jsx","Trans","EnableCaptchaPanel","CaptchaCredentialsPanel","SettingsPanel","AdminDocsUrls","DocsLink","FormSwitch","SettingsErrorGroup","isInvalid","Fragment","FormSelect","Item","CaptchaKeysFields","clearErrors","useFormContext","provider","useWatch","FormTextField"],"mappings":"i8BAoBO,SAASA,GAAU,CAAC,SAAAC,EAAU,QAAAC,GAAiB,uBACpD,KAAM,CAAC,KAAAC,CAAA,EAAQC,EAAA,EAETC,EAA4D,CAChE,OAAQ,CACN,QAAS,CACP,WAAUC,EAAAH,EAAK,OAAO,UAAZ,YAAAG,EAAqB,WAAY,YAC3C,OAAQ,CACN,UAASC,GAAAC,EAAAL,EAAK,OAAO,UAAZ,YAAAK,EAAqB,SAArB,YAAAD,EAA6B,UAAW,GACjD,WAAUE,GAAAC,EAAAP,EAAK,OAAO,UAAZ,YAAAO,EAAqB,SAArB,YAAAD,EAA6B,WAAY,EAAA,EAErD,aAAYE,EAAAR,EAAK,OAAO,UAAZ,YAAAQ,EAAqB,aAAc,GAC/C,eAAcC,EAAAT,EAAK,OAAO,UAAZ,YAAAS,EAAqB,eAAgB,GACnD,aAAYC,EAAAV,EAAK,OAAO,UAAZ,YAAAU,EAAqB,aAAc,GAC/C,eAAcC,EAAAX,EAAK,OAAO,UAAZ,YAAAW,EAAqB,eAAgB,EAAA,CACrD,CACF,EAGFZ,GAAA,MAAAA,EAAS,QAAQa,GAAU,SACzBV,EAAc,OAAO,QAAS,OAAQU,CAAM,IAC1CP,GAAAF,EAAAH,EAAK,OAAO,UAAZ,YAAAG,EAAqB,SAArB,YAAAE,EAA8BO,KAAW,EAC7C,GAEA,MAAMC,EAAOC,EAAuB,CAClC,cAAAZ,CAAA,CACD,EAED,OACEa,OAACC,GAAoB,MAAOC,EAAAA,IAACC,GAAM,QAAQ,SAAA,CAAU,EAAI,KAAAL,EACvD,SAAA,CAAAI,MAACE,GAAoB,SAAArB,EAAS,QAC7BsB,EAAA,CAAA,CAAwB,CAAA,EAC3B,CAEJ,CAKA,SAASD,EAAmB,CAAC,SAAArB,GAAoC,CAC/D,OACEiB,EAAAA,KAACM,EAAA,CACC,UAAU,QACV,MAAOJ,EAAAA,IAACC,EAAA,CAAM,QAAQ,gBAAA,CAAiB,EACvC,YACED,EAAAA,IAACC,EAAA,CAAM,QAAQ,oDAAA,CAAqD,EAEtE,KACEI,EAAc,SAAS,cACpBC,EAAA,CAAS,KAAMD,EAAc,SAAS,QACrC,SAAAL,EAAAA,IAACC,EAAA,CAAM,QAAQ,kBAAA,CAAmB,EACpC,EACE,KAGL,SAAA,CAAApB,EACDmB,EAAAA,IAACO,EAAA,CACC,UAAU,QACV,KAAK,gCACL,YACEP,EAAAA,IAACC,EAAA,CACC,QAAS,mDAAA,CAAA,EAIb,SAAAD,EAAAA,IAACC,EAAA,CAAM,QAAQ,cAAA,CAAe,CAAA,CAAA,EAEhCD,EAAAA,IAACO,EAAA,CACC,KAAK,iCACL,YACEP,EAAAA,IAACC,EAAA,CAAM,QAAQ,mDAAA,CAAoD,EAGrE,SAAAD,EAAAA,IAACC,EAAA,CAAM,QAAQ,mBAAA,CAAoB,CAAA,CAAA,CACrC,CAAA,CAAA,CAGN,CAEA,SAASE,GAA0B,CACjC,OACEH,EAAAA,IAACI,EAAA,CACC,MAAOJ,EAAAA,IAACC,EAAA,CAAM,QAAQ,wBAAA,CAAyB,EAC/C,YACED,EAAAA,IAACC,EAAA,CAAM,QAAQ,yDAAA,CAA0D,EAG3E,SAAAD,EAAAA,IAACQ,EAAA,CACC,aAAc,GACd,gBAAiB,GACjB,KAAK,gBAEJ,SAAAC,UAEIC,WAAA,CACC,SAAA,CAAAZ,EAAAA,KAACa,EAAA,CACC,KAAK,KACL,KAAK,0BACL,MAAOX,EAAAA,IAACC,EAAA,CAAM,QAAQ,kBAAA,CAAmB,EACzC,UAAU,QAEV,SAAA,CAAAD,EAAAA,IAACY,GAAK,MAAM,YACV,eAACX,EAAA,CAAM,QAAQ,mBAAmB,CAAA,CACpC,EACAD,EAAAA,IAACY,GAAK,MAAM,YACV,eAACX,EAAA,CAAM,QAAQ,uBAAuB,CAAA,CACxC,CAAA,CAAA,CAAA,EAEFD,MAACa,GAAkB,UAAAJ,CAAA,CAAsB,CAAA,EAC3C,CAEJ,CAAA,CACF,CAAA,CAGN,CAKA,SAASI,EAAkB,CAAC,UAAAJ,GAAoC,CAC9D,KAAM,CAAC,YAAAK,CAAA,EAAeC,EAAA,EAChBC,EAAWC,EAAwB,CAAC,KAAM,0BAA0B,EAE1E,OAAID,IAAa,mBAEZN,WAAA,CACC,SAAA,CAAAV,EAAAA,IAACkB,EAAA,CACC,KAAK,KACL,UAAU,QACV,SAAU,IAAM,CACdJ,EAAA,CACF,EACA,QAASL,EACT,KAAK,4BACL,MAAOT,EAAAA,IAACC,EAAA,CAAM,QAAQ,oBAAA,CAAqB,CAAA,CAAA,EAE7CD,EAAAA,IAACkB,EAAA,CACC,KAAK,KACL,SAAU,IAAM,CACdJ,EAAA,CACF,EACA,QAASL,EACT,KAAK,8BACL,MAAOT,EAAAA,IAACC,EAAA,CAAM,QAAQ,sBAAA,CAAuB,CAAA,CAAA,CAC/C,CAAA,EAnBae,CAoBf,SAKDN,WAAA,CACC,SAAA,CAAAV,EAAAA,IAACkB,EAAA,CACC,KAAK,KACL,UAAU,QACV,SAAU,IAAM,CACdJ,EAAA,CACF,EACA,QAASL,EACT,KAAK,4BACL,MAAOT,EAAAA,IAACC,EAAA,CAAM,QAAQ,2BAAA,CAA4B,CAAA,CAAA,EAEpDD,EAAAA,IAACkB,EAAA,CACC,KAAK,KACL,SAAU,IAAM,CACdJ,EAAA,CACF,EACA,QAASL,EACT,KAAK,8BACL,MAAOT,EAAAA,IAACC,EAAA,CAAM,QAAQ,6BAAA,CAA8B,CAAA,CAAA,CACtD,CAAA,EAnBae,CAoBf,CAEJ"}