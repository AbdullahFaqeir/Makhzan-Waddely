{"version":3,"file":"localization-panel-CGrJg3F5.js","sources":["../../../common/foundation/resources/client/auth/ui/account-settings/basic-info-panel/update-account-details.ts","../../../common/foundation/resources/client/auth/ui/account-settings/timezone-select.tsx","../../../common/foundation/resources/client/ui/library/utils/intl/timezones.ts","../../../common/foundation/resources/client/auth/ui/account-settings/localization-panel.tsx"],"sourcesContent":["import {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {apiClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {useMutation} from '@tanstack/react-query';\nimport {message} from '@ui/i18n/message';\nimport {toast} from '@ui/toast/toast';\nimport {User} from '@ui/types/user';\nimport {UseFormReturn} from 'react-hook-form';\n\ninterface Payload {\n  name?: string;\n  image?: string | null;\n  image_entry_id?: number | null;\n}\n\nexport function useUpdateAccountDetails(\n  userId: number,\n  form?: UseFormReturn<Partial<User> & {image_entry_id?: string | null}>,\n) {\n  return useMutation({\n    mutationFn: (payload: Payload) =>\n      apiClient.put(`users/${userId}`, payload).then(r => r.data),\n    onSuccess: () => {\n      toast(message('Updated account details'));\n    },\n    onError: r => (form ? onFormQueryError(r, form) : showHttpErrorToast(r)),\n  });\n}\n","import {Option} from '@ui/forms/combobox/combobox';\nimport {InputSize} from '@ui/forms/input-field/input-size';\nimport {FormSelect, OptionGroup, SelectProps} from '@ui/forms/select/select';\nimport {message} from '@ui/i18n/message';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {ReactNode} from 'react';\n\ninterface Props extends Omit<SelectProps<any>, 'selectionMode' | 'children'> {\n  name: string;\n  timezones: Record<string, string[]>;\n  size?: InputSize;\n  label?: ReactNode;\n}\nexport function TimezoneSelect({\n  name,\n  size,\n  timezones,\n  label,\n  ...selectProps\n}: Props) {\n  const {trans} = useTrans();\n  return (\n    <FormSelect\n      selectionMode=\"single\"\n      name={name}\n      size={size}\n      label={label}\n      showSearchField\n      searchPlaceholder={trans(message('Search timezones'))}\n      {...selectProps}\n    >\n      {Object.entries(timezones).map(([sectionName, sectionItems]) => (\n        <OptionGroup label={sectionName} key={sectionName}>\n          {sectionItems.map(timezone => (\n            <Option key={timezone} value={timezone}>\n              {timezone}\n            </Option>\n          ))}\n        </OptionGroup>\n      ))}\n    </FormSelect>\n  );\n}\n","import memoize from 'nano-memoize';\n\nexport const getTimeZoneList = memoize(() =>\n  Intl.supportedValuesOf('timeZone'),\n);\n\nexport const getTimeZoneGroups = memoize(() => {\n  const timezones = getTimeZoneList();\n  const groups: Record<string, string[]> = {};\n  for (const timezone of timezones) {\n    const [region, city] = timezone.split('/');\n    if (!groups[region]) {\n      groups[region] = [];\n    }\n    groups[region].push(timezone);\n  }\n  return groups;\n});\n","import {AccountSettingsPanel} from '@common/auth/ui/account-settings/account-settings-panel';\nimport {AccountSettingsId} from '@common/auth/ui/account-settings/account-settings-sidenav';\nimport {useUpdateAccountDetails} from '@common/auth/ui/account-settings/basic-info-panel/update-account-details';\nimport {TimezoneSelect} from '@common/auth/ui/account-settings/timezone-select';\nimport {useChangeLocale} from '@common/locale-switcher/change-locale';\nimport {useBootstrapDataStore} from '@ui/bootstrap-data/bootstrap-data-store';\nimport {Button} from '@ui/buttons/button';\nimport {Form} from '@ui/forms/form';\nimport {Item} from '@ui/forms/listbox/item';\nimport {FormSelect} from '@ui/forms/select/select';\nimport {message} from '@ui/i18n/message';\nimport {Trans} from '@ui/i18n/trans';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {User} from '@ui/types/user';\nimport {getCountryList} from '@ui/utils/intl/countries';\nimport {getTimeZoneGroups} from '@ui/utils/intl/timezones';\nimport {useId} from 'react';\nimport {useForm} from 'react-hook-form';\n\ninterface PartialUser {\n  id: number;\n  language?: User['language'];\n  country?: User['country'];\n  timezone?: User['timezone'];\n}\n\ninterface Props {\n  user: PartialUser;\n}\nexport function LocalizationPanel({user}: Props) {\n  const locales = useBootstrapDataStore(s => s.data.i18n.locales);\n  const formId = useId();\n  const {trans} = useTrans();\n  const form = useForm<Partial<User>>({\n    defaultValues: {\n      language: user.language || '',\n      country: user.country || '',\n      timezone: user.timezone || 'UTC',\n    },\n  });\n  const updateDetails = useUpdateAccountDetails(user.id, form);\n  const changeLocale = useChangeLocale();\n\n  const countries = getCountryList();\n  const timezones = getTimeZoneGroups();\n\n  return (\n    <AccountSettingsPanel\n      id={AccountSettingsId.LocationAndLanguage}\n      title={<Trans message=\"Date, time and language\" />}\n      actions={\n        <Button\n          type=\"submit\"\n          variant=\"flat\"\n          color=\"primary\"\n          form={formId}\n          disabled={updateDetails.isPending || !form.formState.isValid}\n        >\n          <Trans message=\"Save\" />\n        </Button>\n      }\n    >\n      <Form\n        form={form}\n        onSubmit={newDetails => {\n          updateDetails.mutate(newDetails);\n          changeLocale.mutate({locale: newDetails.language});\n        }}\n        id={formId}\n      >\n        <FormSelect\n          className=\"mb-24\"\n          selectionMode=\"single\"\n          name=\"language\"\n          label={<Trans message=\"Language\" />}\n        >\n          {locales.map(localization => (\n            <Item key={localization.language} value={localization.language}>\n              {localization.name}\n            </Item>\n          ))}\n        </FormSelect>\n        <FormSelect\n          className=\"mb-24\"\n          selectionMode=\"single\"\n          name=\"country\"\n          label={<Trans message=\"Country\" />}\n          showSearchField\n          searchPlaceholder={trans(message('Search countries'))}\n        >\n          {countries.map(country => (\n            <Item key={country.code} value={country.code}>\n              {country.name}\n            </Item>\n          ))}\n        </FormSelect>\n        <TimezoneSelect\n          label={<Trans message=\"Timezone\" />}\n          name=\"timezone\"\n          timezones={timezones}\n        />\n      </Form>\n    </AccountSettingsPanel>\n  );\n}\n"],"names":["useUpdateAccountDetails","userId","form","useMutation","payload","apiClient","r","toast","message","onFormQueryError","showHttpErrorToast","TimezoneSelect","name","size","timezones","label","selectProps","trans","useTrans","jsx","FormSelect","sectionName","sectionItems","OptionGroup","timezone","Option","getTimeZoneList","memoize","getTimeZoneGroups","groups","region","city","LocalizationPanel","user","locales","useBootstrapDataStore","formId","useId","useForm","updateDetails","changeLocale","useChangeLocale","countries","getCountryList","AccountSettingsPanel","AccountSettingsId","Trans","Button","jsxs","Form","newDetails","localization","Item","country"],"mappings":"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"}