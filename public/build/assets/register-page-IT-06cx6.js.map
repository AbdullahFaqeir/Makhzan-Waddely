{"version":3,"file":"register-page-IT-06cx6.js","sources":["../../../common/foundation/resources/client/auth/requests/use-register.ts","../../../common/foundation/resources/client/auth/ui/register-page.tsx"],"sourcesContent":["import {useMutation} from '@tanstack/react-query';\nimport {setBootstrapData} from '@ui/bootstrap-data/bootstrap-data-store';\nimport {UseFormReturn} from 'react-hook-form';\nimport {useParams} from 'react-router';\nimport {onFormQueryError} from '../../errors/on-form-query-error';\nimport {BackendResponse} from '../../http/backend-response/backend-response';\nimport {apiClient} from '../../http/query-client';\nimport {useNavigate} from '../../ui/navigation/use-navigate';\nimport {useAuth} from '../use-auth';\n\ninterface Response extends BackendResponse {\n  bootstrapData?: string;\n  message?: string;\n  status: 'success' | 'needs_email_verification';\n}\n\nexport interface RegisterPayload {\n  email: string;\n  password: string;\n  password_confirmation: string;\n  invite_id?: string;\n  invite_type?: string;\n  captcha_token: string | null;\n}\n\nexport function useRegister(form: UseFormReturn<RegisterPayload>) {\n  const navigate = useNavigate();\n  const {getRedirectUri} = useAuth();\n  const {inviteId} = useParams();\n\n  return useMutation({\n    mutationFn: (payload: RegisterPayload) => {\n      return register({\n        invite_id: inviteId,\n        ...payload,\n      });\n    },\n    onSuccess: response => {\n      setBootstrapData(response.bootstrapData!);\n      if (response.status === 'needs_email_verification') {\n        navigate('/');\n      } else {\n        navigate(getRedirectUri(), {replace: true});\n      }\n    },\n    onError: r => onFormQueryError(r, form),\n  });\n}\n\nfunction register(payload: RegisterPayload): Promise<Response> {\n  return apiClient\n    .post('auth/register', payload)\n    .then(response => response.data);\n}\n","import {GuestRoute} from '@common/auth/guards/guest-route';\nimport {CaptchaContainer} from '@common/captcha/captcha-container';\nimport {Button} from '@ui/buttons/button';\nimport {LinkStyle} from '@ui/buttons/external-link';\nimport {Form} from '@ui/forms/form';\nimport {FormTextField} from '@ui/forms/input-field/text-field/text-field';\nimport {FormCheckbox} from '@ui/forms/toggle/checkbox';\nimport {message} from '@ui/i18n/message';\nimport {Trans} from '@ui/i18n/trans';\nimport {useSettings} from '@ui/settings/use-settings';\nimport {toast} from '@ui/toast/toast';\nimport {ReactNode} from 'react';\nimport {useForm} from 'react-hook-form';\nimport {Link, Navigate, useLocation, useSearchParams} from 'react-router';\nimport {useCaptcha} from '../../captcha/use-captcha';\nimport {CustomMenuItem} from '../../menus/custom-menu';\nimport {StaticPageTitle} from '../../seo/static-page-title';\nimport {RegisterPayload, useRegister} from '../requests/use-register';\nimport {AuthLayout} from './auth-layout/auth-layout';\nimport {SocialAuthSection} from './social-auth-section';\n\ninterface Props {\n  inviteType?: string;\n  fields?: ReactNode;\n}\nexport function RegisterPage({inviteType, fields}: Props) {\n  const {branding, registration, social} = useSettings();\n  const {captchaToken, captchaEnabled, resetCaptcha} = useCaptcha('register');\n\n  const {pathname} = useLocation();\n  const [searchParams] = useSearchParams();\n\n  const isRegisteringUsingInvite =\n    pathname.includes('workspace') || !!inviteType;\n  const isBillingRegister = searchParams.get('redirectFrom') === 'pricing';\n  const searchParamsEmail = searchParams.get('email') || undefined;\n\n  const form = useForm<RegisterPayload>({\n    defaultValues: {email: searchParamsEmail},\n  });\n  const register = useRegister(form);\n\n  if (registration?.disable && !isRegisteringUsingInvite) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  let heading = <Trans message=\"Create a new account\" />;\n  if (isRegisteringUsingInvite) {\n    heading = (\n      <Trans\n        values={{siteName: branding?.site_name}}\n        message=\"To join your team on :siteName, create an account\"\n      />\n    );\n  } else if (isBillingRegister) {\n    heading = <Trans message=\"First, let's create your account\" />;\n  }\n\n  const footerMessage = (\n    <Trans\n      values={{\n        a: parts => (\n          <Link className={LinkStyle} to=\"/login\">\n            {parts}\n          </Link>\n        ),\n      }}\n      message=\"Already have an account? <a>Sign in.</a>\"\n    />\n  );\n\n  return (\n    <GuestRoute>\n      <AuthLayout heading={heading} message={footerMessage}>\n        <StaticPageTitle>\n          <Trans message=\"Register\" />\n        </StaticPageTitle>\n        <Form\n          form={form}\n          onSubmit={async payload => {\n            if (captchaEnabled && !captchaToken) {\n              toast.danger(message('Please solve the captcha challenge.'));\n              return;\n            }\n            register.mutate(\n              {\n                ...payload,\n                captcha_token: captchaToken,\n                invite_type: inviteType,\n              },\n              {onError: () => resetCaptcha()},\n            );\n          }}\n        >\n          <FormTextField\n            className=\"mb-32\"\n            name=\"email\"\n            type=\"email\"\n            disabled={!!searchParamsEmail}\n            label={<Trans message=\"Email\" />}\n            required\n          />\n          <FormTextField\n            className=\"mb-32\"\n            name=\"password\"\n            type=\"password\"\n            label={<Trans message=\"Password\" />}\n            required\n          />\n          <FormTextField\n            className=\"mb-32\"\n            name=\"password_confirmation\"\n            type=\"password\"\n            label={<Trans message=\"Confirm password\" />}\n            required\n          />\n          {fields}\n          {captchaEnabled && <CaptchaContainer className=\"mb-32\" />}\n          <PolicyCheckboxes />\n          <Button\n            className=\"block w-full\"\n            type=\"submit\"\n            variant=\"flat\"\n            color=\"primary\"\n            size=\"md\"\n            disabled={register.isPending}\n          >\n            <Trans message=\"Create account\" />\n          </Button>\n          <SocialAuthSection\n            isUsingInvite={isRegisteringUsingInvite}\n            dividerMessage={\n              social?.compact_buttons ? (\n                <Trans message=\"Or sign up with\" />\n              ) : (\n                <Trans message=\"OR\" />\n              )\n            }\n          />\n        </Form>\n      </AuthLayout>\n    </GuestRoute>\n  );\n}\n\nfunction PolicyCheckboxes() {\n  const {registration} = useSettings();\n\n  if (!registration?.policies) return null;\n\n  return (\n    <div className=\"mb-32\">\n      {registration.policies.map(policy => (\n        <FormCheckbox\n          key={policy.id}\n          name={policy.id}\n          className=\"mb-4 block\"\n          required\n        >\n          <Trans\n            message=\"I accept the :name\"\n            values={{\n              name: (\n                <CustomMenuItem\n                  unstyled\n                  className={() => LinkStyle}\n                  item={policy}\n                />\n              ),\n            }}\n          />\n        </FormCheckbox>\n      ))}\n    </div>\n  );\n}\n"],"names":["useRegister","form","navigate","useNavigate","getRedirectUri","useAuth","inviteId","useParams","useMutation","payload","register","response","setBootstrapData","onFormQueryError","apiClient","RegisterPage","inviteType","fields","branding","registration","social","useSettings","captchaToken","captchaEnabled","resetCaptcha","useCaptcha","pathname","useLocation","searchParams","useSearchParams","isRegisteringUsingInvite","isBillingRegister","searchParamsEmail","useForm","jsx","Navigate","heading","Trans","footerMessage","Link","LinkStyle","parts","GuestRoute","jsxs","AuthLayout","StaticPageTitle","Form","toast","message","FormTextField","CaptchaContainer","PolicyCheckboxes","Button","SocialAuthSection","policy","FormCheckbox","CustomMenuItem"],"mappings":"mqBAyBO,SAASA,EAAYC,EAAsC,CAChE,MAAMC,EAAWC,EAAA,EACX,CAAC,eAAAC,CAAA,EAAkBC,EAAA,EACnB,CAAC,SAAAC,CAAA,EAAYC,EAAA,EAEnB,OAAOC,EAAY,CACjB,WAAaC,GACJC,EAAS,CACd,UAAWJ,EACX,GAAGG,CAAA,CACJ,EAEH,UAAWE,GAAY,CACrBC,EAAiBD,EAAS,aAAc,EACpCA,EAAS,SAAW,2BACtBT,EAAS,GAAG,EAEZA,EAASE,EAAA,EAAkB,CAAC,QAAS,GAAK,CAE9C,EACA,QAAS,GAAKS,EAAiB,EAAGZ,CAAI,CAAA,CACvC,CACH,CAEA,SAASS,EAASD,EAA6C,CAC7D,OAAOK,EACJ,KAAK,gBAAiBL,CAAO,EAC7B,KAAKE,GAAYA,EAAS,IAAI,CACnC,CC5BO,SAASI,GAAa,CAAC,WAAAC,EAAY,OAAAC,GAAgB,CACxD,KAAM,CAAC,SAAAC,EAAU,aAAAC,EAAc,OAAAC,CAAA,EAAUC,EAAA,EACnC,CAAC,aAAAC,EAAc,eAAAC,EAAgB,aAAAC,CAAA,EAAgBC,EAAW,UAAU,EAEpE,CAAC,SAAAC,CAAA,EAAYC,EAAA,EACb,CAACC,CAAY,EAAIC,EAAA,EAEjBC,EACJJ,EAAS,SAAS,WAAW,GAAK,CAAC,CAACV,EAChCe,EAAoBH,EAAa,IAAI,cAAc,IAAM,UACzDI,EAAoBJ,EAAa,IAAI,OAAO,GAAK,OAEjD3B,EAAOgC,EAAyB,CACpC,cAAe,CAAC,MAAOD,CAAA,CAAiB,CACzC,EACKtB,EAAWV,EAAYC,CAAI,EAEjC,GAAIkB,GAAA,MAAAA,EAAc,SAAW,CAACW,EAC5B,OAAOI,EAAAA,IAACC,EAAA,CAAS,GAAG,SAAS,QAAO,GAAC,EAGvC,IAAIC,EAAUF,EAAAA,IAACG,EAAA,CAAM,QAAQ,sBAAA,CAAuB,EAChDP,EACFM,EACEF,EAAAA,IAACG,EAAA,CACC,OAAQ,CAAC,SAAUnB,GAAA,YAAAA,EAAU,SAAA,EAC7B,QAAQ,mDAAA,CAAA,EAGHa,IACTK,EAAUF,EAAAA,IAACG,EAAA,CAAM,QAAQ,kCAAA,CAAmC,GAG9D,MAAMC,EACJJ,EAAAA,IAACG,EAAA,CACC,OAAQ,CACN,KACEH,EAAAA,IAACK,EAAA,CAAK,UAAWC,EAAW,GAAG,SAC5B,SAAAC,CAAA,CACH,CAAA,EAGJ,QAAQ,0CAAA,CAAA,EAIZ,aACGC,EAAA,CACC,SAAAC,EAAAA,KAACC,EAAA,CAAW,QAAAR,EAAkB,QAASE,EACrC,SAAA,CAAAJ,MAACW,EAAA,CACC,SAAAX,EAAAA,IAACG,EAAA,CAAM,QAAQ,WAAW,EAC5B,EACAM,EAAAA,KAACG,EAAA,CACC,KAAA7C,EACA,SAAU,MAAMQ,GAAW,CACzB,GAAIc,GAAkB,CAACD,EAAc,CACnCyB,EAAM,OAAOC,EAAQ,qCAAqC,CAAC,EAC3D,MACF,CACAtC,EAAS,OACP,CACE,GAAGD,EACH,cAAea,EACf,YAAaN,CAAA,EAEf,CAAC,QAAS,IAAMQ,EAAA,CAAa,CAAC,CAElC,EAEA,SAAA,CAAAU,EAAAA,IAACe,EAAA,CACC,UAAU,QACV,KAAK,QACL,KAAK,QACL,SAAU,CAAC,CAACjB,EACZ,MAAOE,EAAAA,IAACG,EAAA,CAAM,QAAQ,OAAA,CAAQ,EAC9B,SAAQ,EAAA,CAAA,EAEVH,EAAAA,IAACe,EAAA,CACC,UAAU,QACV,KAAK,WACL,KAAK,WACL,MAAOf,EAAAA,IAACG,EAAA,CAAM,QAAQ,UAAA,CAAW,EACjC,SAAQ,EAAA,CAAA,EAEVH,EAAAA,IAACe,EAAA,CACC,UAAU,QACV,KAAK,wBACL,KAAK,WACL,MAAOf,EAAAA,IAACG,EAAA,CAAM,QAAQ,kBAAA,CAAmB,EACzC,SAAQ,EAAA,CAAA,EAETpB,EACAM,GAAkBW,EAAAA,IAACgB,EAAA,CAAiB,UAAU,OAAA,CAAQ,QACtDC,EAAA,EAAiB,EAClBjB,EAAAA,IAACkB,EAAA,CACC,UAAU,eACV,KAAK,SACL,QAAQ,OACR,MAAM,UACN,KAAK,KACL,SAAU1C,EAAS,UAEnB,SAAAwB,EAAAA,IAACG,EAAA,CAAM,QAAQ,gBAAA,CAAiB,CAAA,CAAA,EAElCH,EAAAA,IAACmB,EAAA,CACC,cAAevB,EACf,eACEV,GAAA,MAAAA,EAAQ,gBACNc,EAAAA,IAACG,EAAA,CAAM,QAAQ,iBAAA,CAAkB,EAEjCH,EAAAA,IAACG,EAAA,CAAM,QAAQ,IAAA,CAAK,CAAA,CAAA,CAG1B,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CACF,CAEJ,CAEA,SAASc,GAAmB,CAC1B,KAAM,CAAC,aAAAhC,CAAA,EAAgBE,EAAA,EAEvB,OAAKF,GAAA,MAAAA,EAAc,eAGhB,MAAA,CAAI,UAAU,QACZ,SAAAA,EAAa,SAAS,IAAImC,GACzBpB,EAAAA,IAACqB,EAAA,CAEC,KAAMD,EAAO,GACb,UAAU,aACV,SAAQ,GAER,SAAApB,EAAAA,IAACG,EAAA,CACC,QAAQ,qBACR,OAAQ,CACN,KACEH,EAAAA,IAACsB,EAAA,CACC,SAAQ,GACR,UAAW,IAAMhB,EACjB,KAAMc,CAAA,CAAA,CACR,CAEJ,CAAA,CACF,EAhBKA,EAAO,EAAA,CAkBf,EACH,EAzBkC,IA2BtC"}