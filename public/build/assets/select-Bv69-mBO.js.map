{"version":3,"file":"select-Bv69-mBO.js","sources":["../../../common/foundation/resources/client/ui/library/forms/combobox/combobox-end-adornment.tsx","../../../common/foundation/resources/client/ui/library/forms/select/select.tsx"],"sourcesContent":["import {useListboxContext} from '@ui/forms/listbox/listbox-context';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {KeyboardArrowDownIcon} from '@ui/icons/material/KeyboardArrowDown';\nimport {SvgIconProps} from '@ui/icons/svg-icon';\nimport {ProgressCircle} from '@ui/progress/progress-circle';\nimport {ReactElement, useEffect, useRef, useState} from 'react';\n\ninterface Props {\n  isLoading?: boolean;\n  icon?: ReactElement<SvgIconProps>;\n  size?: string;\n}\nexport function ComboboxEndAdornment({isLoading, icon, size}: Props) {\n  const timeout = useRef<any>(null);\n  const {trans} = useTrans();\n  const [showLoading, setShowLoading] = useState(false);\n\n  const {\n    state: {isOpen, inputValue},\n  } = useListboxContext();\n\n  const lastInputValue = useRef(inputValue);\n  useEffect(() => {\n    if (isLoading && !showLoading) {\n      if (timeout.current === null) {\n        timeout.current = setTimeout(() => {\n          setShowLoading(true);\n        }, 500);\n      }\n\n      // If user is typing, clear the timer and restart since it is a new request\n      if (inputValue !== lastInputValue.current) {\n        clearTimeout(timeout.current);\n        timeout.current = setTimeout(() => {\n          setShowLoading(true);\n        }, 500);\n      }\n    } else if (!isLoading) {\n      // If loading is no longer happening, clear any timers and hide the loading circle\n      setShowLoading(false);\n      clearTimeout(timeout.current);\n      timeout.current = null;\n    }\n\n    lastInputValue.current = inputValue;\n  }, [isLoading, showLoading, inputValue]);\n\n  // loading circle should only be displayed if menu is open, if menuTrigger is \"manual\", or first time load (to stop circle from showing up when user selects an option)\n  const showLoadingIndicator = showLoading && (isOpen || isLoading);\n\n  if (showLoadingIndicator) {\n    return (\n      <ProgressCircle\n        aria-label={trans({message: 'Loading'})}\n        size=\"w-24 h-24\"\n        isIndeterminate\n      />\n    );\n  }\n\n  return icon || <KeyboardArrowDownIcon size={size} />;\n}\n","import {mergeProps} from '@react-aria/utils';\nimport {ComboboxEndAdornment} from '@ui/forms/combobox/combobox-end-adornment';\nimport {TextField} from '@ui/forms/input-field/text-field/text-field';\nimport {useDefaultValidationRules} from '@ui/forms/use-default-validation-rules';\nimport {Trans} from '@ui/i18n/trans';\nimport {SearchIcon} from '@ui/icons/material/Search';\nimport {useIsMobileDevice} from '@ui/utils/hooks/is-mobile-device';\nimport clsx from 'clsx';\nimport React, {Fragment, ReactNode, Ref, RefObject} from 'react';\nimport {useController} from 'react-hook-form';\nimport {BaseFieldPropsWithDom} from '../input-field/base-field-props';\nimport {Field} from '../input-field/field';\nimport {getInputFieldClassNames} from '../input-field/get-input-field-class-names';\nimport {useField} from '../input-field/use-field';\nimport {Item} from '../listbox/item';\nimport {Listbox} from '../listbox/listbox';\nimport {Section} from '../listbox/section';\nimport {ListBoxChildren, ListboxProps, PrimitiveValue} from '../listbox/types';\nimport {useListbox} from '../listbox/use-listbox';\nimport {useListboxKeyboardNavigation} from '../listbox/use-listbox-keyboard-navigation';\nimport {useTypeSelect} from '../listbox/use-type-select';\n\nexport type SelectProps<T extends object> = Omit<\n  BaseFieldPropsWithDom<HTMLButtonElement>,\n  'value'\n> &\n  ListboxProps &\n  ListBoxChildren<T> & {\n    hideCaret?: boolean;\n    minWidth?: string;\n    searchPlaceholder?: string;\n    showSearchField?: boolean;\n    valueClassName?: string;\n    ref?: Ref<HTMLButtonElement>;\n    appearance?: 'select' | 'dropdown';\n    selectedValue?: PrimitiveValue | null;\n    onSelectionChange?: (value: PrimitiveValue) => void;\n    defaultSelectedValue?: PrimitiveValue;\n  };\nexport function Select<T extends object>(props: SelectProps<T>) {\n  const isMobile = useIsMobileDevice();\n  const {\n    hideCaret,\n    placeholder = <Trans message=\"Select an option...\" />,\n    selectedValue,\n    onItemSelected,\n    onOpenChange,\n    onInputValueChange,\n    onSelectionChange,\n    selectionMode = 'single',\n    minWidth = 'min-w-128',\n    children,\n    searchPlaceholder,\n    showEmptyMessage,\n    showSearchField,\n    defaultInputValue,\n    defaultSelectedValue,\n    inputValue: userInputValue,\n    isLoading,\n    isAsync,\n    valueClassName,\n    floatingWidth = isMobile ? 'auto' : 'matchTrigger',\n    ref,\n    showCheckmark,\n    inputRadius,\n    appearance,\n    ...inputFieldProps\n  } = props;\n\n  const listbox = useListbox(\n    {\n      ...props,\n      selectionMode: selectionMode as any,\n      showCheckmark,\n      clearInputOnItemSelection: true,\n      showEmptyMessage: showEmptyMessage || showSearchField,\n      floatingWidth,\n      role: 'listbox',\n      virtualFocus: showSearchField,\n    },\n    ref,\n  );\n  const {\n    state: {\n      selectedValues,\n      isOpen,\n      setIsOpen,\n      activeIndex,\n      setSelectedIndex,\n      inputValue,\n      setInputValue,\n    },\n    collections,\n    focusItem,\n    listboxId,\n    reference,\n    refs,\n    listContent,\n    onInputChange,\n  } = listbox;\n\n  const {fieldProps, inputProps} = useField({\n    ...inputFieldProps,\n    focusRef: refs.reference as RefObject<HTMLButtonElement>,\n  });\n\n  let selectedContent: ReactNode = (\n    <span className=\"text-main/50\">{placeholder}</span>\n  );\n\n  if (selectionMode === 'multiple') {\n    const selectedOptions = selectedValues\n      .map(value => collections.collection.get(value)?.element.props.children)\n      .filter(Boolean);\n    if (selectedOptions.length > 0) {\n      selectedContent = (\n        <span className=\"flex items-center overflow-hidden overflow-ellipsis whitespace-nowrap\">\n          {selectedOptions.map((child, index) => (\n            <Fragment key={index}>\n              <div className=\"block\">{child}</div>\n              {index < selectedOptions.length - 1 ? (\n                <span className=\"mr-4 block\">,</span>\n              ) : null}\n            </Fragment>\n          ))}\n        </span>\n      );\n    }\n  } else if (selectionMode === 'single') {\n    const selectedOption = collections.collection.get(selectedValues[0]);\n    if (selectedOption) {\n      selectedContent = (\n        <span className=\"flex items-center gap-10\">\n          {selectedOption.element.props.startIcon}\n          <span\n            className={clsx(\n              'overflow-hidden overflow-ellipsis whitespace-nowrap',\n              valueClassName,\n            )}\n          >\n            {selectedOption.element.props.children}\n          </span>\n        </span>\n      );\n    }\n  }\n\n  const fieldClassNames = getInputFieldClassNames({\n    ...props,\n    inputRadius:\n      inputRadius ||\n      (appearance === 'dropdown' ? 'rounded-button' : 'rounded-input'),\n    endAdornment: true,\n  });\n\n  const {\n    handleTriggerKeyDown,\n    handleListboxKeyboardNavigation,\n    handleListboxSearchFieldKeydown,\n  } = useListboxKeyboardNavigation(listbox);\n\n  const {findMatchingItem} = useTypeSelect();\n\n  // focus matching item when user types, if dropdown is open\n  const handleListboxTypeSelect = (e: React.KeyboardEvent) => {\n    if (!isOpen) return;\n    const i = findMatchingItem(e, listContent, activeIndex);\n    if (i != null) {\n      focusItem('increment', i);\n    }\n  };\n\n  // select matching item when user types, if dropdown is closed\n  const handleTriggerTypeSelect = (e: React.KeyboardEvent) => {\n    if (isOpen) return undefined;\n    const i = findMatchingItem(e, listContent, activeIndex);\n    if (i != null) {\n      setSelectedIndex(i);\n    }\n  };\n\n  return (\n    <Listbox\n      listbox={listbox}\n      onKeyDownCapture={!showSearchField ? handleListboxTypeSelect : undefined}\n      onKeyDown={handleListboxKeyboardNavigation}\n      onClose={showSearchField ? () => setInputValue('') : undefined}\n      isLoading={isLoading}\n      searchField={\n        showSearchField && (\n          <TextField\n            size={props.size === 'xs' || props.size === 'sm' ? 'xs' : 'sm'}\n            placeholder={searchPlaceholder}\n            startAdornment={<SearchIcon />}\n            className=\"flex-shrink-0 px-8 pb-8 pt-4\"\n            autoFocus\n            aria-expanded={isOpen ? 'true' : 'false'}\n            aria-haspopup=\"listbox\"\n            aria-controls={isOpen ? listboxId : undefined}\n            aria-autocomplete=\"list\"\n            autoComplete=\"off\"\n            autoCorrect=\"off\"\n            spellCheck=\"false\"\n            value={inputValue}\n            onChange={onInputChange}\n            onKeyDown={e => {\n              handleListboxSearchFieldKeydown(e);\n            }}\n          />\n        )\n      }\n    >\n      <Field\n        fieldClassNames={fieldClassNames}\n        {...fieldProps}\n        endAdornment={\n          !hideCaret && (\n            <ComboboxEndAdornment isLoading={isLoading} size={props.size} />\n          )\n        }\n      >\n        <button\n          {...inputProps}\n          type=\"button\"\n          aria-expanded={isOpen ? 'true' : 'false'}\n          aria-haspopup=\"listbox\"\n          aria-controls={isOpen ? listboxId : undefined}\n          ref={reference}\n          onKeyDown={handleTriggerKeyDown}\n          onKeyDownCapture={\n            !showSearchField ? handleTriggerTypeSelect : undefined\n          }\n          disabled={inputFieldProps.disabled}\n          onClick={() => {\n            setIsOpen(!isOpen);\n          }}\n          className={clsx(\n            fieldClassNames.input,\n            !fieldProps.unstyled && minWidth,\n          )}\n        >\n          {selectedContent}\n        </button>\n        <div\n          aria-hidden\n          className=\"pointer-events-none absolute bottom-0 left-0 w-full opacity-0\"\n        >\n          <label>\n            <input\n              tabIndex={-1}\n              required={props.required}\n              name={props.name}\n              value={selectedValues[0]}\n              onChange={() => {}}\n              onFocus={() => {\n                if (\n                  refs.reference.current &&\n                  'focus' in refs.reference.current\n                ) {\n                  refs.reference.current.focus();\n                }\n              }}\n            />\n          </label>\n        </div>\n      </Field>\n    </Listbox>\n  );\n}\n\nexport type FormSelectProps<T extends object> = SelectProps<T> & {\n  name: string;\n};\nexport function FormSelect<T extends object>({\n  children,\n  ...props\n}: FormSelectProps<T>) {\n  const rules = useDefaultValidationRules(props);\n  const {\n    field: {onChange, onBlur, value = null, ref},\n    fieldState: {invalid, error},\n  } = useController({\n    name: props.name,\n    rules,\n  });\n\n  const formProps: Partial<SelectProps<T>> = {\n    onSelectionChange: onChange,\n    onBlur,\n    selectedValue: value,\n    invalid,\n    errorMessage: error?.message,\n    name: props.name,\n  };\n\n  // make sure error message is not overridden by undefined or null\n  const errorMessage = props.errorMessage || error?.message;\n  return (\n    <Select ref={ref} {...mergeProps(formProps, props, {errorMessage})}>\n      {children}\n    </Select>\n  );\n}\n\nexport {Item as Option, Section as OptionGroup};\n"],"names":["ComboboxEndAdornment","isLoading","icon","size","timeout","useRef","trans","useTrans","showLoading","setShowLoading","useState","isOpen","inputValue","useListboxContext","lastInputValue","useEffect","jsx","ProgressCircle","KeyboardArrowDownIcon","Select","props","isMobile","useIsMobileDevice","hideCaret","placeholder","Trans","selectedValue","onItemSelected","onOpenChange","onInputValueChange","onSelectionChange","selectionMode","minWidth","children","searchPlaceholder","showEmptyMessage","showSearchField","defaultInputValue","defaultSelectedValue","userInputValue","isAsync","valueClassName","floatingWidth","ref","showCheckmark","inputRadius","appearance","inputFieldProps","listbox","useListbox","selectedValues","setIsOpen","activeIndex","setSelectedIndex","setInputValue","collections","focusItem","listboxId","reference","refs","listContent","onInputChange","fieldProps","inputProps","useField","selectedContent","selectedOptions","value","_a","child","index","jsxs","Fragment","selectedOption","clsx","fieldClassNames","getInputFieldClassNames","handleTriggerKeyDown","handleListboxKeyboardNavigation","handleListboxSearchFieldKeydown","useListboxKeyboardNavigation","findMatchingItem","useTypeSelect","handleListboxTypeSelect","e","i","handleTriggerTypeSelect","Listbox","TextField","SearchIcon","Field","FormSelect","rules","useDefaultValidationRules","onChange","onBlur","invalid","error","useController","formProps","errorMessage","mergeProps"],"mappings":"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"}