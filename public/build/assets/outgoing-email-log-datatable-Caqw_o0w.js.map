{"version":3,"file":"outgoing-email-log-datatable-Caqw_o0w.js","sources":["../../../common/foundation/resources/client/admin/logging/outgoing-email/opened.svg","../../../common/foundation/resources/client/admin/logging/outgoing-email/use-outgoing-email-log-item-with-mime.ts","../../../common/foundation/resources/client/admin/logging/outgoing-email/outgoing-email-log-entry-dialog.tsx","../../../common/foundation/resources/client/admin/logging/outgoing-email/outgoing-email-log-datatable-columns.tsx","../../../common/foundation/resources/client/admin/logging/outgoing-email/outgoing-email-log-datatable.tsx"],"sourcesContent":["export default \"__VITE_ASSET__CJsGO7hp__\"","import {useQuery} from '@tanstack/react-query';\nimport {apiClient} from '@common/http/query-client';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {OutgoingEmailLogItem} from '@common/admin/logging/outgoing-email/outgoing-email-log-item';\n\ninterface Response extends BackendResponse {\n  logItem: OutgoingEmailLogItem;\n}\n\nexport function useOutgoingEmailLogItemWithMime(id: number) {\n  return useQuery({\n    queryKey: ['logs/outgoing-email', id],\n    queryFn: () => fetchLogItem(id),\n  });\n}\n\nfunction fetchLogItem(id: number) {\n  return apiClient.get<Response>(`logs/outgoing-email/${id}`).then(r => r.data);\n}\n","import {Dialog} from '@ui/overlays/dialog/dialog';\nimport {DialogHeader} from '@ui/overlays/dialog/dialog-header';\nimport {Trans} from '@ui/i18n/trans';\nimport {DialogBody} from '@ui/overlays/dialog/dialog-body';\nimport {Button} from '@ui/buttons/button';\nimport {useOutgoingEmailLogItemWithMime} from '@common/admin/logging/outgoing-email/use-outgoing-email-log-item-with-mime';\nimport {ProgressCircle} from '@ui/progress/progress-circle';\nimport {downloadFileFromUrl} from '@ui/utils/files/download-file-from-url';\nimport {useSettings} from '@ui/settings/use-settings';\n\ninterface Props {\n  logItemId: number;\n}\nexport function OutgoingEmailLogEntryDialog({logItemId}: Props) {\n  const {data} = useOutgoingEmailLogItemWithMime(logItemId);\n  const {base_url} = useSettings();\n  return (\n    <Dialog size=\"fullscreen\">\n      <DialogHeader\n        showDivider\n        padding=\"px-24 py-10\"\n        actions={\n          <Button\n            variant=\"outline\"\n            size=\"xs\"\n            disabled={!data}\n            type=\"button\"\n            onClick={\n              data\n                ? () =>\n                    downloadFileFromUrl(\n                      `${base_url}/api/v1/logs/outgoing-email/${logItemId}/download`,\n                    )\n                : undefined\n            }\n          >\n            <Trans message=\"Download\" />\n          </Button>\n        }\n      >\n        <Trans message=\"Email preview\" />\n      </DialogHeader>\n      <DialogBody>\n        {data ? (\n          <iframe\n            srcDoc={data.logItem.parsed_message!.body.html}\n            className=\"h-max w-full border-none\"\n            onLoad={e => {\n              const iframe = e.target as HTMLIFrameElement;\n              iframe.style.height =\n                iframe.contentWindow!.document.body.scrollHeight + 'px';\n            }}\n          />\n        ) : (\n          <div className=\"flex min-h-200 items-center justify-center\">\n            <ProgressCircle isIndeterminate />\n          </div>\n        )}\n      </DialogBody>\n    </Dialog>\n  );\n}\n","import {OutgoingEmailLogEntryDialog} from '@common/admin/logging/outgoing-email/outgoing-email-log-entry-dialog';\nimport {OutgoingEmailLogItem} from '@common/admin/logging/outgoing-email/outgoing-email-log-item';\nimport {useRerunScheduledCommand} from '@common/admin/logging/schedule/use-rerurun-scheduled-command';\nimport {ColumnConfig} from '@common/datatable/column-config';\nimport {NameWithAvatar} from '@common/datatable/column-templates/name-with-avatar';\nimport {IconButton} from '@ui/buttons/icon-button';\nimport {Chip, ChipProps} from '@ui/forms/input-field/chip-field/chip';\nimport {FormattedRelativeTime} from '@ui/i18n/formatted-relative-time';\nimport {Trans} from '@ui/i18n/trans';\nimport {VisibilityIcon} from '@ui/icons/material/Visibility';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {Tooltip} from '@ui/tooltip/tooltip';\nimport {ReactNode} from 'react';\n\nexport const OutgoingEmailLogDatatableColumns: ColumnConfig<OutgoingEmailLogItem>[] =\n  [\n    {\n      key: 'message_id',\n      allowsSorting: true,\n      visibleInMode: 'all',\n      width: 'flex-3 min-w-200',\n      header: () => <Trans message=\"Subject\" />,\n      body: item => (\n        <NameWithAvatar label={item.subject} description={item.message_id} />\n      ),\n    },\n    {\n      key: 'status',\n      allowsSorting: true,\n      header: () => <Trans message=\"Status\" />,\n      body: item => {\n        switch (item.status) {\n          case 'sent':\n            return (\n              <StatusChip color=\"positive\">\n                <Trans message=\"Sent\" />\n              </StatusChip>\n            );\n          case 'not-sent':\n            return (\n              <StatusChip color={undefined}>\n                <Trans message=\"Not sent\" />\n              </StatusChip>\n            );\n          case 'error':\n            return (\n              <StatusChip color=\"danger\">\n                <Trans message=\"Error\" />\n              </StatusChip>\n            );\n        }\n      },\n    },\n    {\n      key: 'from',\n      allowsSorting: true,\n      header: () => <Trans message=\"From\" />,\n      body: item => item.from,\n    },\n    {\n      key: 'to',\n      allowsSorting: true,\n      header: () => <Trans message=\"To\" />,\n      body: item => item.to,\n    },\n    {\n      key: 'created_at',\n      allowsSorting: true,\n      header: () => <Trans message=\"Date\" />,\n      body: item => <FormattedRelativeTime date={item.created_at} />,\n    },\n    {\n      key: 'actions',\n      header: () => <Trans message=\"Actions\" />,\n      hideHeader: true,\n      align: 'end',\n      width: 'w-42 flex-shrink-0',\n      visibleInMode: 'all',\n      body: item => <PreviewEmailButton item={item} />,\n    },\n  ];\n\ninterface PreviewButtonProps {\n  item: OutgoingEmailLogItem;\n}\nfunction PreviewEmailButton({item}: PreviewButtonProps) {\n  const rerunCommand = useRerunScheduledCommand();\n  return (\n    <DialogTrigger type=\"modal\">\n      <Tooltip label={<Trans message=\"Preview\" />}>\n        <IconButton\n          size=\"md\"\n          className=\"text-muted\"\n          disabled={rerunCommand.isPending}\n          onClick={() => {\n            rerunCommand.mutate({id: item.id});\n          }}\n        >\n          <VisibilityIcon />\n        </IconButton>\n      </Tooltip>\n      <OutgoingEmailLogEntryDialog logItemId={item.id} />\n    </DialogTrigger>\n  );\n}\n\ninterface StatusChipProps {\n  color: ChipProps['color'];\n  children: ReactNode;\n}\nfunction StatusChip({color, children}: StatusChipProps) {\n  return (\n    <Chip color={color} size=\"xs\" className=\"w-max min-w-50 text-center\">\n      {children}\n    </Chip>\n  );\n}\n","import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport openedImage from '@common/admin/logging/outgoing-email/opened.svg';\nimport {OutgoingEmailLogDatatableColumns} from '@common/admin/logging/outgoing-email/outgoing-email-log-datatable-columns';\nimport {GlobalLoadingProgress} from '@common/core/global-loading-progress';\nimport {DataTableAddItemButton} from '@common/datatable/data-table-add-item-button';\nimport {DataTableHeader} from '@common/datatable/data-table-header';\nimport {DataTablePaginationFooter} from '@common/datatable/data-table-pagination-footer';\nimport {useDatatableSearchParams} from '@common/datatable/filters/utils/use-datatable-search-params';\nimport {validateDatatableSearch} from '@common/datatable/filters/utils/validate-datatable-search';\nimport {DataTableEmptyStateMessage} from '@common/datatable/page/data-table-emty-state-message';\nimport {\n  DatatablePageScrollContainer,\n  DatatablePageWithHeaderBody,\n  DatatablePageWithHeaderLayout,\n} from '@common/datatable/page/datatable-page-with-header-layout';\nimport {useDatatableQuery} from '@common/datatable/requests/use-datatable-query';\nimport {Table} from '@common/ui/tables/table';\nimport {Trans} from '@ui/i18n/trans';\nimport {DownloadIcon} from '@ui/icons/material/Download';\n\nexport function Component() {\n  const {\n    searchParams,\n    sortDescriptor,\n    mergeIntoSearchParams,\n    setSearchQuery,\n    isFiltering,\n  } = useDatatableSearchParams(validateDatatableSearch);\n\n  const query = useDatatableQuery({\n    ...commonAdminQueries.logs.email(searchParams),\n  });\n\n  const actions = (\n    <DataTableAddItemButton\n      elementType=\"a\"\n      href=\"api/v1/logs/outgoing-email/download\"\n      download\n      icon={<DownloadIcon />}\n    >\n      <Trans message=\"Download log\" />\n    </DataTableAddItemButton>\n  );\n\n  return (\n    <DatatablePageWithHeaderLayout>\n      <GlobalLoadingProgress query={query} />\n      <DatatablePageWithHeaderBody>\n        <DataTableHeader\n          searchValue={searchParams.query}\n          onSearchChange={setSearchQuery}\n          actions={actions}\n        />\n        <DatatablePageScrollContainer>\n          <Table\n            columns={OutgoingEmailLogDatatableColumns}\n            data={query.items}\n            sortDescriptor={sortDescriptor}\n            onSortChange={mergeIntoSearchParams}\n            enableSelection={false}\n          />\n          {query.isEmpty && (\n            <DataTableEmptyStateMessage\n              isFiltering={isFiltering}\n              image={openedImage}\n              title={\n                <Trans message=\"No outgoing emails have been logged yet\" />\n              }\n              filteringTitle={<Trans message=\"No matching emails\" />}\n            />\n          )}\n          <DataTablePaginationFooter\n            query={query}\n            onPageChange={page => mergeIntoSearchParams({page})}\n            onPerPageChange={perPage => mergeIntoSearchParams({perPage})}\n          />\n        </DatatablePageScrollContainer>\n      </DatatablePageWithHeaderBody>\n    </DatatablePageWithHeaderLayout>\n  );\n}\n"],"names":["openedImage","useOutgoingEmailLogItemWithMime","id","useQuery","fetchLogItem","apiClient","r","OutgoingEmailLogEntryDialog","logItemId","data","base_url","useSettings","jsxs","Dialog","jsx","DialogHeader","Button","downloadFileFromUrl","Trans","DialogBody","e","iframe","ProgressCircle","OutgoingEmailLogDatatableColumns","NameWithAvatar","item","StatusChip","FormattedRelativeTime","PreviewEmailButton","rerunCommand","useRerunScheduledCommand","DialogTrigger","Tooltip","IconButton","VisibilityIcon","color","children","Chip","Component","searchParams","sortDescriptor","mergeIntoSearchParams","setSearchQuery","isFiltering","useDatatableSearchParams","validateDatatableSearch","query","useDatatableQuery","commonAdminQueries","actions","DataTableAddItemButton","DownloadIcon","DatatablePageWithHeaderLayout","GlobalLoadingProgress","DatatablePageWithHeaderBody","DataTableHeader","DatatablePageScrollContainer","Table","DataTableEmptyStateMessage","DataTablePaginationFooter","page","perPage"],"mappings":"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"}