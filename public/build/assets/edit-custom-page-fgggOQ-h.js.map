{"version":3,"file":"edit-custom-page-fgggOQ-h.js","sources":["../../../common/foundation/resources/client/admin/custom-pages/requests/use-update-custom-page.ts","../../../common/foundation/resources/client/admin/custom-pages/edit-custom-page.tsx"],"sourcesContent":["import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {CreateCustomPagePayload} from '@common/admin/custom-pages/requests/use-create-custom-page';\nimport {DatatableDataQueryKey} from '@common/datatable/requests/paginated-resources';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {useMutation} from '@tanstack/react-query';\nimport {message} from '@ui/i18n/message';\nimport {toast} from '@ui/toast/toast';\nimport {useParams} from 'react-router';\nimport {CustomPage} from '../custom-page';\n\ninterface Response extends BackendResponse {\n  page: CustomPage;\n}\n\nexport function useUpdateCustomPage(endpoint?: string) {\n  const {pageId} = useParams();\n  const finalEndpoint = `${endpoint || 'custom-pages'}/${pageId}`;\n  return useMutation({\n    mutationFn: (payload: CreateCustomPagePayload) =>\n      updatePage(payload, finalEndpoint),\n    onError: err => showHttpErrorToast(err),\n    onSuccess: async () => {\n      await queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.customPages.invalidateKey,\n      });\n      await queryClient.invalidateQueries({\n        queryKey: DatatableDataQueryKey(finalEndpoint),\n      });\n      toast(message('Page updated'));\n    },\n  });\n}\n\nfunction updatePage(\n  payload: CreateCustomPagePayload,\n  endpoint: string,\n): Promise<Response> {\n  return apiClient.put(`${endpoint}`, payload).then(r => r.data);\n}\n","import {UploadType} from '@app/site-config';\nimport {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {CreateCustomPagePayload} from '@common/admin/custom-pages/requests/use-create-custom-page';\nimport {useUpdateCustomPage} from '@common/admin/custom-pages/requests/use-update-custom-page';\nimport ArticleEditorPage from '@common/article-editor/article-editor-page';\nimport {PageMetaTags} from '@common/http/page-meta-tags';\nimport {useNavigate} from '@common/ui/navigation/use-navigate';\nimport {useRequiredParams} from '@common/ui/navigation/use-required-params';\nimport {useSuspenseQuery} from '@tanstack/react-query';\nimport {Breadcrumb} from '@ui/breadcrumbs/breadcrumb';\nimport {BreadcrumbItem} from '@ui/breadcrumbs/breadcrumb-item';\nimport {Button} from '@ui/buttons/button';\nimport {Trans} from '@ui/i18n/trans';\nimport {FormProvider, useForm} from 'react-hook-form';\nimport {Fragment} from 'react/jsx-runtime';\n\nexport function Component() {\n  const {pageId} = useRequiredParams(['pageId']);\n  const query = useSuspenseQuery(commonAdminQueries.customPages.get(pageId));\n  const page = query.data.page;\n\n  const navigate = useNavigate();\n  const crupdatePage = useUpdateCustomPage();\n  const form = useForm<CreateCustomPagePayload>({\n    defaultValues: {\n      title: page.title,\n      slug: page.slug,\n      body: page.body,\n    },\n  });\n\n  const handleSave = () => {\n    crupdatePage.mutate(form.getValues(), {\n      onSuccess: () => navigate('../..', {relative: 'path'}),\n    });\n  };\n\n  const saveButton = (\n    <Button\n      variant=\"flat\"\n      color=\"primary\"\n      size=\"xs\"\n      onClick={() => handleSave()}\n      disabled={crupdatePage.isPending}\n    >\n      <Trans message=\"Save\" />\n    </Button>\n  );\n\n  const breadCrumb = (\n    <Breadcrumb size=\"xl\">\n      <BreadcrumbItem to=\"../..\" relative=\"path\">\n        <Trans message=\"Custom pages\" />\n      </BreadcrumbItem>\n      <BreadcrumbItem>\n        <Trans message=\"Edit\" />\n      </BreadcrumbItem>\n    </Breadcrumb>\n  );\n\n  return (\n    <Fragment>\n      <PageMetaTags query={query} />\n      <FormProvider {...form}>\n        <ArticleEditorPage\n          title={breadCrumb}\n          saveButton={saveButton}\n          imageUploadType={UploadType.articleImages}\n          initialContent={page.body}\n          onChange={value => {\n            form.setValue('body', value, {shouldDirty: true});\n          }}\n        />\n      </FormProvider>\n    </Fragment>\n  );\n}\n"],"names":["useUpdateCustomPage","endpoint","pageId","useParams","finalEndpoint","useMutation","payload","updatePage","err","showHttpErrorToast","queryClient","commonAdminQueries","DatatableDataQueryKey","toast","message","apiClient","r","Component","useRequiredParams","query","useSuspenseQuery","page","navigate","useNavigate","crupdatePage","form","useForm","handleSave","saveButton","jsx","Button","Trans","breadCrumb","jsxs","Breadcrumb","BreadcrumbItem","Fragment","PageMetaTags","FormProvider","ArticleEditorPage","UploadType","value"],"mappings":"u3CAgBO,SAASA,EAAoBC,EAAmB,CACrD,KAAM,CAAC,OAAAC,CAAA,EAAUC,EAAA,EACXC,EAAgB,gBAAiCF,CAAM,GAC7D,OAAOG,EAAY,CACjB,WAAaC,GACXC,EAAWD,EAASF,CAAa,EACnC,QAASI,GAAOC,EAAmBD,CAAG,EACtC,UAAW,SAAY,CACrB,MAAME,EAAY,kBAAkB,CAClC,SAAUC,EAAmB,YAAY,aAAA,CAC1C,EACD,MAAMD,EAAY,kBAAkB,CAClC,SAAUE,EAAsBR,CAAa,CAAA,CAC9C,EACDS,EAAMC,EAAQ,cAAc,CAAC,CAC/B,CAAA,CACD,CACH,CAEA,SAASP,EACPD,EACAL,EACmB,CACnB,OAAOc,EAAU,IAAI,GAAGd,CAAQ,GAAIK,CAAO,EAAE,KAAKU,GAAKA,EAAE,IAAI,CAC/D,CCxBO,SAASC,IAAY,CAC1B,KAAM,CAAC,OAAAf,CAAA,EAAUgB,EAAkB,CAAC,QAAQ,CAAC,EACvCC,EAAQC,EAAiBT,EAAmB,YAAY,IAAIT,CAAM,CAAC,EACnEmB,EAAOF,EAAM,KAAK,KAElBG,EAAWC,EAAA,EACXC,EAAexB,EAAA,EACfyB,EAAOC,EAAiC,CAC5C,cAAe,CACb,MAAOL,EAAK,MACZ,KAAMA,EAAK,KACX,KAAMA,EAAK,IAAA,CACb,CACD,EAEKM,EAAa,IAAM,CACvBH,EAAa,OAAOC,EAAK,YAAa,CACpC,UAAW,IAAMH,EAAS,QAAS,CAAC,SAAU,OAAO,CAAA,CACtD,CACH,EAEMM,EACJC,EAAAA,IAACC,EAAA,CACC,QAAQ,OACR,MAAM,UACN,KAAK,KACL,QAAS,IAAMH,EAAA,EACf,SAAUH,EAAa,UAEvB,SAAAK,EAAAA,IAACE,EAAA,CAAM,QAAQ,MAAA,CAAO,CAAA,CAAA,EAIpBC,EACJC,EAAAA,KAACC,EAAA,CAAW,KAAK,KACf,SAAA,CAAAL,EAAAA,IAACM,EAAA,CAAe,GAAG,QAAQ,SAAS,OAClC,SAAAN,EAAAA,IAACE,EAAA,CAAM,QAAQ,cAAA,CAAe,CAAA,CAChC,QACCI,EAAA,CACC,SAAAN,EAAAA,IAACE,EAAA,CAAM,QAAQ,OAAO,CAAA,CACxB,CAAA,EACF,EAGF,cACGK,WAAA,CACC,SAAA,CAAAP,MAACQ,GAAa,MAAAlB,EAAc,EAC5BU,EAAAA,IAACS,EAAA,CAAc,GAAGb,EAChB,SAAAI,EAAAA,IAACU,EAAA,CACC,MAAOP,EACP,WAAAJ,EACA,gBAAiBY,EAAW,cAC5B,eAAgBnB,EAAK,KACrB,SAAUoB,GAAS,CACjBhB,EAAK,SAAS,OAAQgB,EAAO,CAAC,YAAa,GAAK,CAClD,CAAA,CAAA,CACF,CACF,CAAA,EACF,CAEJ"}