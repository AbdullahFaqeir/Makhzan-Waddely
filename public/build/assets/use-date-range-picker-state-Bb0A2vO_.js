import{x as d,j as s,T as $,r as i,g as fe,bG as me,Z as be,bH as he,aI as xe,bI as ge,bJ as Q,bK as F,bL as M,bM as Z,bN as q,X as ye,a7 as De,B as G,M as ke,R as Re,A as $e,y as je,ac as Ve,bO as w,bP as T,bQ as p,bR as J,bS as pe}from"./main-owSUWNVS.js";import{L as ee,a as te}from"./list-B5Ky1WKX.js";import{S as Ce}from"./switch-DbAW1G8x.js";import{D as ve}from"./formatted-date-dVjFR1LG.js";import{u as Se}from"./use-date-formatter-BiXQj-wq.js";import{A as Pe}from"./ArrowRightAlt-PxVB8wV6.js";import{D as we}from"./dialog-footer-D_t7V-bM.js";import{C as Te,D as Ie,a as K,u as Le,t as C}from"./use-base-date-picker-state-Cn_aBnWX.js";import{g as ze,u as Fe}from"./use-current-date-time-lVcX-4fw.js";const Me=[{key:0,label:d("Preceding period"),getRangeValue:e=>{const t=e.start,c=(e.end.toDate().getTime()-t.toDate().getTime())/(1e3*60);return{preset:0,start:t.subtract({minutes:c}),end:t}}},{key:1,label:d("Same period last year"),getRangeValue:e=>({start:e.start.subtract({years:1}),end:e.end.subtract({years:1}),preset:1})},{key:2,label:d("Custom"),getRangeValue:e=>({start:e.start.subtract({weeks:1}),end:e.end.subtract({weeks:1}),preset:2})}];function Ne({originalRangeValue:e,onPresetSelected:t,selectedValue:a}){return s.jsx(ee,{children:Me.map(n=>s.jsx(te,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(a==null?void 0:a.preset)===n.key,onSelected:()=>{const c=n.getRangeValue(e);t(c)},children:s.jsx($,{...n.label})},n.key))})}const Ae=i.memo(({start:e,end:t,options:a,preset:n,timezone:c})=>{const{dates:u}=fe(),D=me(),h=c||(a==null?void 0:a.timeZone)||D,o=Se(a||ve[n||(u==null?void 0:u.format)||"short"]);if(!e||!t)return null;let k;try{k=o.formatRange(U(e,h),U(t,h))}catch{k=""}return s.jsx(i.Fragment,{children:k})},be);function U(e,t){return typeof e=="string"?he(e,t).toDate():"toDate"in e?e.toDate(t):e}function Ee(){return xe("(max-width: 1024px)")}function g(e){return e.set({hour:23,minute:59,second:59,millisecond:999})}function ae(e){return e.set({hour:0,minute:0,second:0,millisecond:0})}const l=ae(ze());var W,_;const I=((_=(W=ye())==null?void 0:W.i18n)==null?void 0:_.active)||"en",Oe=[{key:0,label:d("Today"),getRangeValue:()=>({preset:0,start:l,end:g(l)})},{key:1,label:d("Yesterday"),getRangeValue:()=>({preset:1,start:l.subtract({days:1}),end:g(l).subtract({days:1})})},{key:2,label:d("This week"),getRangeValue:()=>({preset:2,start:Q(l,I),end:ge(g(l),I)})},{key:3,label:d("Last week"),getRangeValue:()=>{const e=Q(l,I).subtract({days:7});return{preset:3,start:e,end:e.add({days:6})}}},{key:4,label:d("Last 7 days"),getRangeValue:()=>({preset:4,start:l.subtract({days:7}),end:g(l)})},{key:5,label:d("Last 30 days"),getRangeValue:()=>({preset:5,start:l.subtract({days:30}),end:g(l)})},{key:6,label:d("Last 3 months"),getRangeValue:()=>({preset:6,start:l.subtract({months:3}),end:g(l)})},{key:7,label:d("Last 12 months"),getRangeValue:()=>({preset:7,start:l.subtract({months:12}),end:g(l)})},{key:8,label:d("This month"),getRangeValue:()=>({preset:8,start:M(l),end:F(g(l))})},{key:9,label:d("This year"),getRangeValue:()=>({preset:9,start:q(l),end:Z(g(l))})},{key:10,label:d("Last year"),getRangeValue:()=>({preset:10,start:q(l).subtract({years:1}),end:Z(g(l)).subtract({years:1})})}];function Be({onPresetSelected:e,selectedValue:t}){return s.jsx(ee,{children:Oe.map(a=>s.jsx(te,{borderRadius:"rounded-none",capitalizeFirst:!0,isSelected:(t==null?void 0:t.preset)===a.key,onSelected:()=>{const n=a.getRangeValue();e(n)},children:s.jsx($,{...a.label})},a.key))})}function We({state:e,compareState:t,showInlineDatePickerField:a=!1,compareVisibleDefault:n=!1}){const c=Ee(),{close:u}=De(),D=i.useRef(e),h=e.isPlaceholder.start||e.isPlaceholder.end,[o,k]=i.useState(n),x=s.jsxs(we,{dividerTop:!0,startAction:!h&&!c?s.jsx("div",{className:"text-xs",children:s.jsx(Ae,{start:e.selectedValue.start.toDate(),end:e.selectedValue.end.toDate(),options:{dateStyle:"medium"}})}):void 0,children:[s.jsx(G,{variant:"text",size:"xs",onClick:()=>{e.setSelectedValue(D.current.selectedValue),e.setIsPlaceholder(D.current.isPlaceholder),u()},children:s.jsx($,{message:"Cancel"})}),s.jsx(G,{variant:"flat",color:"primary",size:"xs",onClick:()=>{const b=e.selectedValue;t&&o&&(b.compareStart=t.selectedValue.start,b.compareEnd=t.selectedValue.end),u(b)},children:s.jsx($,{message:"Select"})})]});return s.jsxs(ke,{size:"auto",children:[s.jsxs(Re,{className:"flex",padding:"p-0",children:[!c&&s.jsxs("div",{className:"min-w-192 py-14",children:[s.jsx(Be,{selectedValue:e.selectedValue,onPresetSelected:b=>{e.setSelectedValue(b),e.closeDialogOnSelection&&u(b)}}),!!t&&s.jsxs(i.Fragment,{children:[s.jsx(Ce,{className:"mx-20 mb-10 mt-14",checked:o,onChange:b=>k(b.target.checked),children:s.jsx($,{message:"Compare"})}),o&&s.jsx(Ne,{originalRangeValue:e.selectedValue,selectedValue:t.selectedValue,onPresetSelected:b=>{t.setSelectedValue(b)}})]})]}),s.jsx($e,{initial:!1,children:s.jsx(He,{state:e,compareState:t,showInlineDatePickerField:a,compareVisible:o})})]}),!e.closeDialogOnSelection&&x]})}function He({state:e,compareState:t,showInlineDatePickerField:a,compareVisible:n}){return s.jsxs(je.div,{initial:{width:0,overflow:"hidden"},animate:{width:"auto"},exit:{width:0,overflow:"hidden"},transition:{type:"tween",duration:.125},className:"border-l px-20 pb-20 pt-10",children:[a&&s.jsxs("div",{children:[s.jsx(X,{state:e}),!!t&&n&&s.jsx(X,{state:t,label:s.jsx($,{message:"Compare"})})]}),s.jsx("div",{className:"flex items-start gap-36",children:s.jsx(Te,{state:e,visibleMonths:2})})]})}function X({state:e,label:t}){const{selectedValue:a,setSelectedValue:n}=e;return s.jsxs(Ie,{className:"mb-20 mt-10",label:t,children:[s.jsx(K,{state:e,value:a.start,onChange:c=>{n({...a,start:c})}}),s.jsx(Pe,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(K,{state:e,value:a.end,onChange:c=>{n({...a,end:c})}})]})}function _e(e){var B,H;const t=Fe(),[a,n]=i.useState({start:(!e.value||!e.value.start)&&!((B=e.defaultValue)!=null&&B.start),end:(!e.value||!e.value.end)&&!((H=e.defaultValue)!=null&&H.end)}),c=e.onChange,[u,D]=Ve(e.value?z(e.value,t):void 0,e.value?void 0:z(e.defaultValue,t),r=>{n({start:!1,end:!1}),c==null||c(r)}),{min:h,max:o,granularity:k,timezone:x,calendarIsOpen:b,setCalendarIsOpen:R,closeDialogOnSelection:v}=Le(u.start,e),se=i.useCallback(()=>{n({start:!0,end:!0}),D(z(null,t)),c==null||c(null),R(!1)},[t,D,c,R]),[S,N]=i.useState(null),[j,A]=i.useState(!1),[y,P]=i.useState(u),[ne,E]=i.useState(()=>Y(u,o)),O=i.useCallback(r=>{let f=r.start,m=r.end;h&&(f=w(f,h));const de=o?T(o,m):m;f=T(f,de);const ue=h?w(h,f):f;return m=w(m,ue),o&&(m=T(m,o)),{start:C(f,x),end:C(m,x)}},[h,o,x]),V=i.useCallback(r=>{const f={...O(r),preset:r.preset};D(f),P(f),E(Y(f,o)),n({start:!1,end:!1})},[D,O,o]),re=i.useCallback(r=>!a.start&&p(r,y.start)||!a.end&&p(r,y.end),[y,a]),le=i.useCallback(r=>(j||!a.start&&!a.end)&&r.compare(y.start)>=0&&r.compare(y.end)<=0,[y,a,j]),ce=i.useCallback(r=>p(r,y.start),[y]),ie=i.useCallback(r=>p(r,y.end),[y]),oe=i.useCallback((r,f)=>({onPointerEnter:()=>{j&&f&&P(L({start:S,end:r,timezone:x}))},onClick:()=>{if(!j)A(!0),N(r),P(L({start:r,end:r,timezone:x}));else{const m=L({start:S,end:r,timezone:x});m.start=ae(m.start),m.end=g(m.end),A(!1),N(null),V==null||V(m),v&&(R==null||R(!1))}}}),[S,j,V,R,v,x]);return{selectedValue:u,setSelectedValue:V,calendarIsOpen:b,setCalendarIsOpen:R,dayIsActive:re,dayIsHighlighted:le,dayIsRangeStart:ce,dayIsRangeEnd:ie,getCellProps:oe,calendarDates:ne,setIsPlaceholder:n,isPlaceholder:a,clear:se,setCalendarDates:E,min:h,max:o,granularity:k,timezone:x,closeDialogOnSelection:v}}function Y(e,t){let a=J(M(e.start)),n=J(F(e.end));return pe(a,n)&&(n=F(n.add({months:1}))),t&&n.compare(t)>0&&(n=a,a=M(a.subtract({months:1}))),[a,n]}function L(e){const t=C(e.start,e.timezone),a=C(e.end,e.timezone);return t.compare(a)>0?{start:a,end:t}:{start:t,end:a}}function z(e,t){return e!=null&&e.start&&(e!=null&&e.end)?e:!(e!=null&&e.start)&&(e!=null&&e.end)?(e.start=e.end.subtract({months:1}),e):!(e!=null&&e.end)&&(e!=null&&e.start)?(e.end=e.start.add({months:1}),e):{start:t,end:t.add({months:1})}}export{Me as D,Ae as F,We as a,Oe as b,_e as u};
//# sourceMappingURL=use-date-range-picker-state-Bb0A2vO_.js.map
