import{c4 as p,r as u,c5 as C,c6 as F,c7 as I,j as a,c8 as A,an as M,ap as E,aH as k,x as B,av as P,k as R,c9 as T,D as W,T as l,c as V,G as N,am as q,B as L,b2 as O,aD as H,ai as Q,J as U,ca as z,aj as J,a5 as K,cb as Y}from"./main-owSUWNVS.js";import{D as G}from"./settings-links-CpaqNUpE.js";import{u as _}from"./use-admin-settings-page-nav-config-CWz7kMFd.js";import{D as $}from"./datatable-page-with-header-layout-68nRfBM1.js";import{F as X}from"./file-upload-provider-B2470Xt4.js";import{C as Z}from"./confirmation-dialog-DdZaouVf.js";function ee(t,n){const s=p(n);return te({filters:{...t,status:"pending"}},s).length}function b(t,n){return t.findAll(n.filters).map(s=>n.select?n.select(s):s.state)}function te(t={},n){const s=p(n).getMutationCache(),r=u.useRef(t),e=u.useRef(null);return e.current||(e.current=b(s,t)),u.useEffect(()=>{r.current=t}),u.useSyncExternalStore(u.useCallback(i=>s.subscribe(()=>{const o=C(e.current,b(s,r.current));e.current!==o&&(e.current=o,F.schedule(i))}),[s]),()=>e.current,()=>e.current)}const S="admin-settings-form",Se="f7fy8bxf0e18",se=t=>(n,s,r)=>{const e=r.subscribe;return r.subscribe=((o,c,d)=>{let g=o;if(c){const j=(d==null?void 0:d.equalityFn)||Object.is;let m=o(r.getState());g=w=>{const x=o(w);if(!j(m,x)){const D=m;c(m=x,D)}},d!=null&&d.fireImmediately&&c(m,m)}return e(g)}),t(n,s,r)},ne=se,re=({defaultRoute:t,availableRoutes:n})=>A()(ne((s,r)=>({isFullScreen:!1,setIsFullScreen:e=>{s({isFullScreen:e})},previewRoute:t??null,availableRoutes:n??{},setPreviewRoute:e=>{s({previewRoute:e??null})},iframeWindow:null,isDirty:!1,setIsDirty:e=>{s(()=>({isDirty:e}))},setIframeWindow:e=>{s({iframeWindow:e}),e&&e.addEventListener("message",i=>{i.data.source==="be-settings-preview"&&i.data.type==="appLoaded"&&y()})},preview:{setValues:(e,i)=>{i.merge=i.merge??!0;const o=r().iframeWindow;f(o,{type:"setValues",values:e,options:i})},setThemeFont:e=>{const i=r().iframeWindow;f(i,{type:"setThemeFont",value:e})},setThemeValue:(e,i)=>{const o=r().iframeWindow;f(o,{type:"setThemeValue",name:e,value:i})},setActiveTheme:e=>{const i=r().iframeWindow;f(i,{type:"setActiveTheme",themeId:e})},setCustomCode:(e,i)=>{const o=r().iframeWindow;f(o,{type:"setCustomCode",mode:e,value:i})},setHighlight:e=>{var c;let i=null;const o=(c=r().iframeWindow)==null?void 0:c.document;o&&e&&(i=o.querySelector(e)),i&&requestAnimationFrame(()=>{i&&i.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})})}}}))),h=u.createContext(null);function ie({children:t,defaultRoute:n,availableRoutes:s}){const[r]=u.useState(()=>re({defaultRoute:n,availableRoutes:s}));return a.jsx(h.Provider,{value:r,children:t})}function v(t){const n=u.useContext(h);return I(n,t)}let y=()=>{};new Promise(t=>y=t);function f(t,n){t&&t.postMessage({source:"be-settings-editor",...n},"*")}function ae(t){return M({mutationKey:["submitAdminSettings"],mutationFn:n=>oe(n),onSuccess:n=>(k(B("Settings updated")),P.setQueryData(["fetchAdminSettings"],n)),onError:n=>E(n,t)})}function oe({files:t,...n}){const s=new FormData;Object.entries(t||{}).forEach(([r,e])=>{s.set(r,e)});for(const r in n)s.set(r,JSON.stringify(n[r]));return R.post("settings",s,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>r.data)}function ue({shouldBlock:t,allowNavigation:n}){const s=u.useRef(t);s.current=t;const{state:r,reset:e,proceed:i}=T(o=>(typeof s.current=="boolean"?s.current:s.current())&&(!n||!n(o)));return u.useEffect(()=>{const o=c=>{(typeof s.current=="boolean"?s.current:s.current())&&(c.preventDefault(),c.returnValue=!0)};return window.addEventListener("beforeunload",o),()=>window.removeEventListener("beforeunload",o)},[]),a.jsx(W,{type:"modal",isOpen:r==="blocked",onClose:o=>{r==="blocked"&&(o?i():e())},children:a.jsx(Z,{isDanger:!0,title:a.jsx(l,{message:"You have unsaved changes"}),body:a.jsx(l,{message:"Your changes will be lost if you continue. Are you sure you want to discard them?"}),close:a.jsx(l,{message:"Stay here"}),confirm:a.jsx(l,{message:"Discard changes"})})})}function he({title:t,form:n,children:s,padding:r="p-12 md:p-24",tabs:e,docsLink:i}){return a.jsx(ie,{children:a.jsxs("div",{className:"dashboard-grid-content dashboard-rounded-panel relative flex flex-auto flex-col",children:[a.jsx(ce,{title:t,tabs:e,docsLink:i}),a.jsx("div",{className:"flex-auto overflow-y-auto",children:a.jsx("div",{className:V("mx-auto @container/settings-form lg:max-w-[1440px]",r),children:a.jsx(le,{form:n,children:s})})})]})})}function ce({title:t,className:n,tabs:s,allowNavigation:r,docsLink:e}){const i=v(g=>g.isDirty),o=N(),c=ee({mutationKey:["submitAdminSettings"]})>0,d=a.jsx(L,{type:"submit",form:S,variant:"flat",color:"primary",size:"xs",disabled:c||!i,className:"min-w-84",children:o?a.jsx(l,{message:"Save"}):a.jsx(l,{message:"Save changes"})});return a.jsxs(u.Fragment,{children:[a.jsx($,{className:n,title:t,showSidebarToggleButton:!!o,border:s?"border-none":void 0,rightContent:a.jsxs(u.Fragment,{children:[o&&a.jsx(de,{}),e?a.jsx(G,{link:e,variant:"button",size:"xs",buttonVariant:o?"icon":"text",children:a.jsx(l,{message:"Learn more"})}):null,d]})}),s,a.jsx(ue,{shouldBlock:i,allowNavigation:r})]})}function le({form:t,children:n}){const s=v(e=>e.setIsDirty),r=ae(t);return u.useEffect(()=>(s(t.formState.isDirty),()=>s(!1)),[t.formState.isDirty,s]),a.jsx(X,{children:a.jsx(q,{id:S,form:t,disableNativeValidation:!0,onBeforeSubmit:()=>{const e=t.formState.errors,i=Object.keys(e).filter(o=>o.endsWith("_group"));t.clearErrors(i)},onSubmit:e=>{r.mutate(e,{onSuccess:()=>{t.reset(e),s(!1)}})},children:n})})}function de(){const{pathname:t}=O(),n=H(),s=t.split("/").pop(),r=_();return a.jsxs(Q,{selectionMode:"single",selectedValue:s,onSelectionChange:e=>{e=Y(e)?e:`/admin/settings/${e}`,n(e,{state:{prevPath:t}})},children:[a.jsx(U,{children:a.jsx(z,{})}),a.jsx(J,{children:r.map(e=>a.jsx(K,{value:e.to,children:a.jsx(l,{...e.label})},e.to))})]})}export{he as A,ue as B,ie as S,ce as a,le as b,Se as s,v as u};
//# sourceMappingURL=settings-layout-BqSPGR9K.js.map
