{"version":3,"file":"edit-plan-page-CkRVMGzZ.js","sources":["../../../common/foundation/resources/client/admin/plans/requests/use-update-product.ts","../../../common/foundation/resources/client/admin/plans/crupdate-plan-page/edit-plan-page.tsx"],"sourcesContent":["import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {Product} from '@common/billing/product';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {useNavigate} from '@common/ui/navigation/use-navigate';\nimport {useMutation} from '@tanstack/react-query';\nimport {message} from '@ui/i18n/message';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {toast} from '@ui/toast/toast';\nimport {UseFormReturn} from 'react-hook-form';\nimport {CreateProductPayload} from './use-create-product';\n\ninterface Response extends BackendResponse {\n  product: Product;\n}\n\nexport interface UpdateProductPayload extends CreateProductPayload {\n  id: number;\n}\n\nexport function useUpdateProduct(form: UseFormReturn<UpdateProductPayload>) {\n  const {trans} = useTrans();\n  const navigate = useNavigate();\n  return useMutation({\n    mutationFn: (payload: UpdateProductPayload) => updateProduct(payload),\n    onSuccess: () => {\n      toast(trans(message('Plan updated')));\n      queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.products.invalidateKey,\n      });\n      navigate('/admin/plans');\n    },\n    onError: err => onFormQueryError(err, form),\n  });\n}\n\nfunction updateProduct({\n  id,\n  ...payload\n}: UpdateProductPayload): Promise<Response> {\n  const backendPayload = {\n    ...payload,\n    feature_list: payload.feature_list.map(feature => feature.value),\n  };\n  return apiClient\n    .put(`billing/products/${id}`, backendPayload)\n    .then(r => r.data);\n}\n","import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {useRequiredParams} from '@common/ui/navigation/use-required-params';\nimport {useSuspenseQuery} from '@tanstack/react-query';\nimport {Breadcrumb} from '@ui/breadcrumbs/breadcrumb';\nimport {BreadcrumbItem} from '@ui/breadcrumbs/breadcrumb-item';\nimport {Trans} from '@ui/i18n/trans';\nimport {useForm} from 'react-hook-form';\nimport {CrupdateResourceLayout} from '../../crupdate-resource-layout';\nimport {\n  UpdateProductPayload,\n  useUpdateProduct,\n} from '../requests/use-update-product';\nimport {CrupdatePlanForm} from './crupdate-plan-form';\n\nexport function Component() {\n  const {productId} = useRequiredParams(['productId']);\n  const query = useSuspenseQuery(commonAdminQueries.products.get(productId));\n\n  const form = useForm<UpdateProductPayload>({\n    defaultValues: {\n      ...query.data.product,\n      feature_list: query.data.product.feature_list.map(f => ({value: f})),\n    },\n  });\n  const updateProduct = useUpdateProduct(form);\n\n  return (\n    <CrupdateResourceLayout\n      form={form}\n      onSubmit={values => {\n        updateProduct.mutate(values);\n      }}\n      title={\n        <Breadcrumb size=\"xl\">\n          <BreadcrumbItem to=\"/admin/plans\">\n            <Trans message=\"Plans\" />\n          </BreadcrumbItem>\n          <BreadcrumbItem>{query.data.product.name}</BreadcrumbItem>\n        </Breadcrumb>\n      }\n      isLoading={updateProduct.isPending}\n    >\n      <CrupdatePlanForm />\n    </CrupdateResourceLayout>\n  );\n}\n"],"names":["useUpdateProduct","form","trans","useTrans","navigate","useNavigate","useMutation","payload","updateProduct","toast","message","queryClient","commonAdminQueries","err","onFormQueryError","id","backendPayload","feature","apiClient","r","Component","productId","useRequiredParams","query","useSuspenseQuery","useForm","f","jsx","CrupdateResourceLayout","values","jsxs","Breadcrumb","BreadcrumbItem","Trans","CrupdatePlanForm"],"mappings":"w4BAqBO,SAASA,EAAiBC,EAA2C,CAC1E,KAAM,CAAC,MAAAC,CAAA,EAASC,EAAA,EACVC,EAAWC,EAAA,EACjB,OAAOC,EAAY,CACjB,WAAaC,GAAkCC,EAAcD,CAAO,EACpE,UAAW,IAAM,CACfE,EAAMP,EAAMQ,EAAQ,cAAc,CAAC,CAAC,EACpCC,EAAY,kBAAkB,CAC5B,SAAUC,EAAmB,SAAS,aAAA,CACvC,EACDR,EAAS,cAAc,CACzB,EACA,QAASS,GAAOC,EAAiBD,EAAKZ,CAAI,CAAA,CAC3C,CACH,CAEA,SAASO,EAAc,CACrB,GAAAO,EACA,GAAGR,CACL,EAA4C,CAC1C,MAAMS,EAAiB,CACrB,GAAGT,EACH,aAAcA,EAAQ,aAAa,IAAIU,GAAWA,EAAQ,KAAK,CAAA,EAEjE,OAAOC,EACJ,IAAI,oBAAoBH,CAAE,GAAIC,CAAc,EAC5C,KAAKG,GAAKA,EAAE,IAAI,CACrB,CClCO,SAASC,GAAY,CAC1B,KAAM,CAAC,UAAAC,CAAA,EAAaC,EAAkB,CAAC,WAAW,CAAC,EAC7CC,EAAQC,EAAiBZ,EAAmB,SAAS,IAAIS,CAAS,CAAC,EAEnEpB,EAAOwB,EAA8B,CACzC,cAAe,CACb,GAAGF,EAAM,KAAK,QACd,aAAcA,EAAM,KAAK,QAAQ,aAAa,IAAIG,IAAM,CAAC,MAAOA,GAAG,CAAA,CACrE,CACD,EACKlB,EAAgBR,EAAiBC,CAAI,EAE3C,OACE0B,EAAAA,IAACC,EAAA,CACC,KAAA3B,EACA,SAAU4B,GAAU,CAClBrB,EAAc,OAAOqB,CAAM,CAC7B,EACA,MACEC,EAAAA,KAACC,EAAA,CAAW,KAAK,KACf,SAAA,CAAAJ,EAAAA,IAACK,GAAe,GAAG,eACjB,eAACC,EAAA,CAAM,QAAQ,QAAQ,CAAA,CACzB,EACAN,EAAAA,IAACK,EAAA,CAAgB,SAAAT,EAAM,KAAK,QAAQ,IAAA,CAAK,CAAA,EAC3C,EAEF,UAAWf,EAAc,UAEzB,eAAC0B,EAAA,CAAA,CAAiB,CAAA,CAAA,CAGxB"}