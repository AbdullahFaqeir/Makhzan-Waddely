{"version":3,"file":"uploaded-file-0zTC6Yq4.js","sources":["../../../common/foundation/resources/client/ui/library/utils/files/extension-from-filename.ts","../../../common/foundation/resources/client/ui/library/utils/files/get-file-mime.ts","../../../common/foundation/resources/client/ui/library/utils/files/uploaded-file.ts"],"sourcesContent":["export function extensionFromFilename(fullFileName: string): string {\n  const re = /(?:\\.([^.]+))?$/;\n  return re.exec(fullFileName)?.[1] || '';\n}\n","import {extensionFromFilename} from './extension-from-filename';\n\nexport function getFileMime(file: File): string {\n  const extensionsToMime: Record<string, string> = {\n    md: 'text/markdown',\n    markdown: 'text/markdown',\n    mp4: 'video/mp4',\n    mp3: 'audio/mp3',\n    svg: 'image/svg+xml',\n    jpg: 'image/jpeg',\n    png: 'image/png',\n    gif: 'image/gif',\n    yaml: 'text/yaml',\n    yml: 'text/yaml',\n    log: 'text/plain',\n  };\n\n  const fileExtension = file.name ? extensionFromFilename(file.name) : null;\n\n  // check if mime type is set in the file object\n  if (file.type) {\n    return file.type;\n  }\n\n  // see if we can map extension to a mime type\n  if (fileExtension && fileExtension in extensionsToMime) {\n    return extensionsToMime[fileExtension];\n  }\n\n  return 'application/octet-stream';\n}\n","import {getFileMime} from '@ui/utils/files/get-file-mime';\nimport {extensionFromFilename} from '@ui/utils/files/extension-from-filename';\nimport {nanoid} from 'nanoid';\nimport {FileEntry} from '@common/uploads/file-entry';\n\nexport class UploadedFile {\n  id: string;\n  fingerprint: string;\n  name: string;\n  relativePath = '';\n  size: number;\n  mime = '';\n  extension = '';\n  native: File;\n  lastModified: number;\n\n  private cachedData?: string;\n  get data(): Promise<string> {\n    return new Promise(resolve => {\n      if (this.cachedData) {\n        resolve(this.cachedData);\n      }\n      const reader = new FileReader();\n\n      reader.addEventListener('load', () => {\n        this.cachedData = reader.result as string;\n        resolve(this.cachedData);\n      });\n\n      if (this.extension === 'json') {\n        reader.readAsText(this.native);\n      } else {\n        reader.readAsDataURL(this.native);\n      }\n    });\n  }\n\n  constructor(file: File, relativePath?: string | null) {\n    this.id = nanoid();\n    this.name = file.name;\n    this.size = file.size;\n    this.mime = getFileMime(file);\n    this.lastModified = file.lastModified;\n    this.extension = extensionFromFilename(file.name) || 'bin';\n    this.native = file;\n    relativePath = relativePath || file.webkitRelativePath || '';\n\n    // remove leading slashes\n    relativePath = relativePath.replace(/^\\/+/g, '');\n\n    // only include relative path if file is actually in a folder and not just /file.txt\n    if (relativePath && relativePath.split('/').length > 1) {\n      this.relativePath = relativePath;\n    }\n\n    this.fingerprint = generateFingerprint({\n      name: this.name,\n      size: this.size,\n      mime: this.mime,\n      lastModified: this.lastModified,\n    });\n  }\n}\n\nexport class UploadedFileFromEntry {\n  id: string;\n  fingerprint: string;\n  name: string;\n  relativePath = '';\n  size: number;\n  mime = '';\n  extension = '';\n  native = null;\n  lastModified: string;\n\n  get data(): Promise<string> {\n    return new Promise((resolve, reject) => {\n      reject('UploadedFileFromEntry does not have file data');\n    });\n  }\n\n  constructor(entry: FileEntry) {\n    this.id = nanoid();\n    this.name = entry.name;\n    this.size = entry.file_size ?? 0;\n    this.mime = entry.mime;\n    this.lastModified = entry.updated_at || '';\n    this.extension = entry.extension || 'bin';\n    this.relativePath = entry.path;\n\n    this.fingerprint = generateFingerprint({\n      name: this.name,\n      size: this.size,\n      mime: this.mime,\n      lastModified: this.lastModified,\n    });\n  }\n}\n\ninterface FileMeta {\n  name?: string;\n  mime?: string | null;\n  size?: number | string;\n  lastModified?: number | string;\n  relativePath?: string;\n}\nfunction generateFingerprint({\n  name,\n  mime,\n  size,\n  relativePath,\n  lastModified,\n}: FileMeta) {\n  let id = 'be';\n  if (typeof name === 'string') {\n    id += `-${encodeFilename(name.toLowerCase())}`;\n  }\n\n  if (mime) {\n    id += `-${mime}`;\n  }\n\n  if (typeof relativePath === 'string') {\n    id += `-${encodeFilename(relativePath.toLowerCase())}`;\n  }\n\n  if (size !== undefined) {\n    id += `-${size}`;\n  }\n  if (lastModified !== undefined) {\n    id += `-${lastModified}`;\n  }\n\n  return id;\n}\n\nfunction encodeCharacter(character: string) {\n  return character.charCodeAt(0).toString(32);\n}\n\nfunction encodeFilename(name: string) {\n  let suffix = '';\n  return (\n    name.replace(/[^A-Z0-9]/gi, character => {\n      suffix += `-${encodeCharacter(character)}`;\n      return '/';\n    }) + suffix\n  );\n}\n"],"names":["extensionFromFilename","fullFileName","_a","getFileMime","file","extensionsToMime","fileExtension","UploadedFile","relativePath","__publicField","nanoid","generateFingerprint","resolve","reader","UploadedFileFromEntry","entry","reject","name","mime","size","lastModified","id","encodeFilename","encodeCharacter","character","suffix"],"mappings":"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"}