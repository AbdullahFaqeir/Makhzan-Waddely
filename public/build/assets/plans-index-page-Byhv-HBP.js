import{x as r,w as x,ap as g,aq as h,aJ as y,ax as j,ce as d,k as b,aF as F,j as e,T as s,cH as T,r as f,aD as D,J as c,L as P,D as w}from"./main-BdzhGpqn.js";import{u as C,a as k,G as A,D as E,b as I,c as H}from"./use-datatable-query-CL53W5gM.js";import{D as N}from"./datatable-filters-Cd3MyVOw.js";import{a as q,D as W,b as B,c as L}from"./datatable-page-with-header-layout-T5QYry_g.js";import{T as Q}from"./table-BV_6nbvK.js";import{F as p}from"./formatted-date-hsbUwQxj.js";import{D as K}from"./Delete-Bd6wbCuT.js";import{E as M}from"./Edit-AfuLMjS-.js";import{S as _}from"./Sync-CXG5L3Yj.js";import{C as z}from"./confirmation-dialog-DtIJ4lxn.js";import{F as $}from"./formatted-price-DRpdBayZ.js";import{N as G}from"./name-with-avatar-oLONXEoV.js";import{D as J}from"./data-table-add-item-button-DnF2ZiVm.js";import{s as O}from"./software-engineer-BiXKysY-.js";import{a as m,F as V}from"./select-filter-panel-BD_PypVS.js";import{c as R,u as U}from"./timestamp-filters-Bn_q9MOg.js";import"./FilterAlt-BkhHIgY7.js";import"./accordion-DxYXjiZR.js";import"./checkbox-B6q4SJqi.js";import"./CheckBoxOutlineBlank-DvnJQjlB.js";import"./select-l28gQBMg.js";import"./KeyboardArrowRight-DFizyHtY.js";import"./skeleton-CTimao-U.js";import"./dashboard-layout-context-DDiFtkN0.js";import"./use-toggle-dashboard-left-sidebar-Dzdho4R0.js";import"./ArrowDownward-DXr7353z.js";import"./useEffectEvent-D8HiMrwe.js";import"./use-pointer-events-Dsln3OKq.js";import"./useGlobalListeners-C14jVC5X.js";import"./use-date-formatter-BlrPWK68.js";import"./dialog-footer-DL2JkwrZ.js";import"./Add-iOynMxF0.js";import"./use-normalized-models-yOhv1j4Y.js";import"./form-chip-field-Bj0OQHU9.js";import"./input-CDTJ1VfY.js";import"./ArrowRightAlt-DSM1kJ5L.js";import"./DateRange-DT2RCJ3g.js";import"./use-base-date-picker-state-DYteqbZD.js";import"./use-date-range-picker-state-CEbm743A.js";import"./list-DRfBegha.js";import"./switch-DFT-JawA.js";import"./use-current-date-time-CnLDai64.js";import"./formatted-number-pJC-IR-x.js";const u=[{key:"subscriptions",label:r("Subscriptions"),description:r("Whether plan has any active subscriptions"),defaultOperator:m.eq,control:{type:V.Select,defaultValue:"01",options:[{key:"01",label:r("Has active subscriptions"),value:{value:"*",operator:m.has}},{key:"02",label:r("Does not have active subscriptions"),value:{value:"*",operator:m.doesntHave}}]}},R({description:r("Date plan was created")}),U({description:r("Date plan was last updated")})],X=a=>`billing/products/${a}`;function Y(){const{trans:a}=x();return g({mutationFn:t=>Z(t),onSuccess:()=>{y(a(r("Plan deleted"))),j.invalidateQueries({queryKey:d.products.invalidateKey})},onError:t=>h(t)})}function Z({productId:a}){return b.delete(X(a)).then(t=>t.data)}function ee(){const{trans:a}=x();return g({mutationFn:()=>ae(),onSuccess:()=>{y(a(r("Plans synced"))),j.invalidateQueries({queryKey:d.products.invalidateKey})},onError:t=>h(t,r("Could not sync plans"))})}function ae(){return b.post("billing/products/sync").then(a=>a.data)}const te=[{key:"name",allowsSorting:!0,visibleInMode:"all",header:()=>e.jsx(s,{message:"Name"}),body:a=>{const t=a.prices[0];return e.jsx(G,{label:a.name,description:a.free?e.jsx(s,{message:"Free"}):e.jsx($,{price:t})})}},{key:"created_at",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(s,{message:"Created"}),body:a=>e.jsx(p,{date:a.created_at})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(s,{message:"Last updated"}),body:a=>e.jsx(p,{date:a.updated_at})},{key:"actions",header:()=>e.jsx(s,{message:"Actions"}),visibleInMode:"all",hideHeader:!0,align:"end",maxWidth:"max-w-84",body:a=>e.jsxs(f.Fragment,{children:[e.jsx(c,{size:"md",className:"text-muted",elementType:P,to:`/admin/plans/${a.id}/edit`,children:e.jsx(M,{})}),e.jsx(se,{product:a})]})}];function Ve(){const a=F(),{searchParams:t,sortDescriptor:n,mergeIntoSearchParams:l,setSearchQuery:S,isFiltering:v}=C(T),i=k(d.products.index(t));return e.jsxs(q,{children:[e.jsx(A,{query:i}),e.jsx(W,{title:e.jsx(s,{message:"Subscription plans"}),showSidebarToggleButton:!0}),e.jsxs(B,{children:[e.jsx(E,{searchValue:t.query,onSearchChange:S,actions:e.jsx(re,{}),filters:u}),e.jsx(N,{filters:u}),e.jsxs(L,{children:[e.jsx(Q,{columns:te,data:i.items,sortDescriptor:n,onSortChange:l,enableSelection:!1,onAction:o=>{a(`/admin/plans/${o.id}/edit`)}}),i.isEmpty&&e.jsx(I,{className:"mt-50",isFiltering:v,image:O,title:e.jsx(s,{message:"No plans have been created yet"}),filteringTitle:e.jsx(s,{message:"No matching plans"})}),e.jsx(H,{query:i,onPageChange:o=>l({page:o}),onPerPageChange:o=>l({perPage:o})})]})]})]})}function se({product:a}){const t=Y();return e.jsxs(w,{type:"modal",onClose:n=>{n&&t.mutate({productId:a.id})},children:[e.jsx(D,{label:e.jsx(s,{message:"Delete plan"}),children:e.jsx(c,{size:"md",className:"text-muted",disabled:t.isPending,children:e.jsx(K,{})})}),e.jsx(z,{title:e.jsx(s,{message:"Delete plan"}),body:e.jsx(s,{message:"Are you sure you want to delete this plan?"}),confirm:e.jsx(s,{message:"Delete"})})]})}function re(){const a=ee();return e.jsxs(f.Fragment,{children:[e.jsx(D,{label:e.jsx(s,{message:"Sync plans with Stripe & PayPal"}),children:e.jsx(c,{color:"primary",variant:"outline",size:"sm",disabled:a.isPending,onClick:()=>{a.mutate()},children:e.jsx(_,{})})}),e.jsx(J,{elementType:P,to:"/admin/plans/new",children:e.jsx(s,{message:"Add new plan"})})]})}export{Ve as Component};
