{"version":3,"file":"date-picker-DHqKAJpp.js","sources":["../../../common/foundation/resources/client/ui/library/forms/input-field/date/date-picker/use-date-picker-state.ts","../../../common/foundation/resources/client/ui/library/forms/input-field/date/date-picker/date-picker.tsx"],"sourcesContent":["import {useControlledState} from '@react-stately/utils';\nimport {HTMLAttributes, useCallback, useState} from 'react';\nimport {\n  CalendarDate,\n  DateValue,\n  isSameDay,\n  toCalendarDate,\n  ZonedDateTime,\n} from '@internationalized/date';\nimport {useBaseDatePickerState} from '../use-base-date-picker-state';\nimport {useCurrentDateTime} from '@ui/i18n/use-current-date-time';\nimport {toSafeZoned} from '@ui/i18n/to-safe-zoned';\n\nexport type Granularity = 'day' | 'minute';\n\nexport type DatePickerState = BaseDatePickerState;\n\nexport interface BaseDatePickerState<T = ZonedDateTime, P = boolean> {\n  timezone: string;\n  granularity: Granularity;\n  selectedValue: T;\n  setSelectedValue: (value: T) => void;\n  calendarIsOpen: boolean;\n  setCalendarIsOpen: (isOpen: boolean) => void;\n  calendarDates: CalendarDate[];\n  setCalendarDates: (dates: CalendarDate[]) => void;\n  dayIsActive: (day: CalendarDate) => boolean;\n  dayIsHighlighted: (day: CalendarDate) => boolean;\n  dayIsRangeStart: (day: CalendarDate) => boolean;\n  dayIsRangeEnd: (day: CalendarDate) => boolean;\n  isPlaceholder: P;\n  setIsPlaceholder: (value: P) => void;\n  clear: () => void;\n  min?: ZonedDateTime;\n  max?: ZonedDateTime;\n  closeDialogOnSelection: boolean;\n  getCellProps: (\n    date: CalendarDate,\n    isSameMonth: boolean,\n  ) => HTMLAttributes<HTMLElement>;\n}\n\nexport interface DatePickerValueProps<V, CV = V> {\n  value?: V | null | '';\n  defaultValue?: V | null;\n  onChange?: (value: CV | null) => void;\n  min?: DateValue;\n  max?: DateValue;\n  granularity?: Granularity;\n  timezone?: string;\n  closeDialogOnSelection?: boolean;\n}\nexport function useDatePickerState(\n  props: DatePickerValueProps<ZonedDateTime>,\n): BaseDatePickerState {\n  const now = useCurrentDateTime();\n  const [isPlaceholder, setIsPlaceholder] = useState(\n    !props.value && !props.defaultValue,\n  );\n\n  // if user clears the date, we will want to still keep an\n  // instance internally, but return null via \"onChange\" callback\n  const setStateValue = props.onChange;\n  const [internalValue, setInternalValue] = useControlledState(\n    props.value || now,\n    props.defaultValue || now,\n    value => {\n      setIsPlaceholder(false);\n      setStateValue?.(value);\n    },\n  );\n\n  const {\n    min,\n    max,\n    granularity,\n    timezone,\n    calendarIsOpen,\n    setCalendarIsOpen,\n    closeDialogOnSelection,\n  } = useBaseDatePickerState(internalValue, props);\n\n  const clear = useCallback(() => {\n    setIsPlaceholder(true);\n    setInternalValue(now);\n    setStateValue?.(null);\n    setCalendarIsOpen(false);\n  }, [now, setInternalValue, setStateValue, setCalendarIsOpen]);\n\n  const [calendarDates, setCalendarDates] = useState<CalendarDate[]>(() => {\n    return [toCalendarDate(internalValue)];\n  });\n\n  const setSelectedValue = useCallback(\n    (newValue: DateValue) => {\n      if (min && newValue.compare(min) < 0) {\n        newValue = min;\n      } else if (max && newValue.compare(max) > 0) {\n        newValue = max;\n      }\n\n      // preserve time\n      const value = internalValue\n        ? internalValue.set(newValue)\n        : toSafeZoned(newValue, timezone);\n      setInternalValue(value);\n      setCalendarDates([toCalendarDate(value)]);\n      setIsPlaceholder(false);\n    },\n    [setInternalValue, min, max, internalValue, timezone],\n  );\n\n  const dayIsActive = useCallback(\n    (day: DateValue) => !isPlaceholder && isSameDay(internalValue, day),\n    [internalValue, isPlaceholder],\n  );\n\n  const getCellProps = useCallback(\n    (date: DateValue): HTMLAttributes<HTMLElement> => {\n      return {\n        onClick: () => {\n          setSelectedValue?.(date);\n          if (closeDialogOnSelection) {\n            setCalendarIsOpen?.(false);\n          }\n        },\n      };\n    },\n    [setSelectedValue, setCalendarIsOpen, closeDialogOnSelection],\n  );\n\n  return {\n    selectedValue: internalValue,\n    setSelectedValue: setInternalValue,\n    calendarIsOpen,\n    setCalendarIsOpen,\n    dayIsActive,\n    dayIsHighlighted: () => false,\n    dayIsRangeStart: () => false,\n    dayIsRangeEnd: () => false,\n    getCellProps,\n    calendarDates,\n    setCalendarDates,\n    isPlaceholder,\n    clear,\n    setIsPlaceholder,\n    min,\n    max,\n    granularity,\n    timezone,\n    closeDialogOnSelection,\n  };\n}\n","import {parseAbsolute, ZonedDateTime} from '@internationalized/date';\nimport {mergeProps} from '@react-aria/utils';\nimport {Button} from '@ui/buttons/button';\nimport {Trans} from '@ui/i18n/trans';\nimport {useCurrentDateTime} from '@ui/i18n/use-current-date-time';\nimport {useDateFormatter} from '@ui/i18n/use-date-formatter';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {useUserTimezone} from '@ui/i18n/use-user-timezone';\nimport {DateRangeIcon} from '@ui/icons/material/DateRange';\nimport {Dialog} from '@ui/overlays/dialog/dialog';\nimport {DialogBody} from '@ui/overlays/dialog/dialog-body';\nimport {DialogFooter} from '@ui/overlays/dialog/dialog-footer';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport clsx from 'clsx';\nimport {ComponentPropsWithoutRef, Fragment, MouseEvent, useRef} from 'react';\nimport {useController} from 'react-hook-form';\nimport {Calendar} from '../calendar/calendar';\nimport {\n  DatePickerField,\n  DatePickerFieldProps,\n} from '../date-range-picker/date-picker-field';\nimport {DateSegmentList} from '../segments/date-segment-list';\nimport {\n  DatePickerValueProps,\n  useDatePickerState,\n} from './use-date-picker-state';\n\nexport interface DatePickerProps\n  extends Omit<DatePickerFieldProps, 'children'>,\n    DatePickerValueProps<ZonedDateTime> {}\nexport function DatePicker({showCalendarFooter, ...props}: DatePickerProps) {\n  const state = useDatePickerState(props);\n  const inputRef = useRef<HTMLDivElement>(null);\n  const now = useCurrentDateTime();\n\n  const footer = showCalendarFooter && (\n    <DialogFooter\n      padding=\"px-14 pb-14\"\n      startAction={\n        <Button\n          disabled={state.isPlaceholder}\n          variant=\"text\"\n          color=\"primary\"\n          onClick={() => {\n            state.clear();\n          }}\n        >\n          <Trans message=\"Clear\" />\n        </Button>\n      }\n    >\n      <Button\n        variant=\"text\"\n        color=\"primary\"\n        onClick={() => {\n          state.setSelectedValue(now);\n          state.setCalendarIsOpen(false);\n        }}\n      >\n        <Trans message=\"Today\" />\n      </Button>\n    </DialogFooter>\n  );\n\n  const dialog = (\n    <DialogTrigger\n      offset={8}\n      placement=\"bottom-start\"\n      isOpen={state.calendarIsOpen}\n      onOpenChange={state.setCalendarIsOpen}\n      type=\"popover\"\n      triggerRef={inputRef}\n      returnFocusToTrigger={false}\n      moveFocusToDialog={false}\n    >\n      <Dialog size=\"auto\">\n        <DialogBody\n          className=\"flex items-start gap-40\"\n          padding={showCalendarFooter ? 'px-24 pt-20 pb-10' : null}\n        >\n          <Calendar state={state} visibleMonths={1} />\n        </DialogBody>\n        {footer}\n      </Dialog>\n    </DialogTrigger>\n  );\n\n  const openOnClick: ComponentPropsWithoutRef<'div'> = {\n    onClick: e => {\n      e.stopPropagation();\n      e.preventDefault();\n      if (!isHourSegment(e)) {\n        state.setCalendarIsOpen(true);\n      } else {\n        state.setCalendarIsOpen(false);\n      }\n    },\n  };\n\n  return (\n    <Fragment>\n      <DatePickerField\n        ref={inputRef}\n        wrapperProps={openOnClick}\n        endAdornment={\n          <DateRangeIcon className={clsx(props.disabled && 'text-disabled')} />\n        }\n        {...props}\n      >\n        <DateSegmentList\n          segmentProps={openOnClick}\n          state={state}\n          value={state.selectedValue}\n          onChange={state.setSelectedValue}\n          isPlaceholder={state.isPlaceholder}\n        />\n      </DatePickerField>\n      {dialog}\n    </Fragment>\n  );\n}\n\ninterface FormDatePickerProps extends DatePickerProps {\n  name: string;\n}\nexport function FormDatePicker(props: FormDatePickerProps) {\n  const {min, max} = props;\n  const userTimezone = useUserTimezone();\n  const timezone = props.timezone || userTimezone;\n  const {trans} = useTrans();\n  const {format} = useDateFormatter({timeZone: timezone});\n  const {\n    field: {onChange, onBlur, value = null, ref},\n    fieldState: {invalid, error},\n  } = useController({\n    name: props.name,\n    rules: {\n      validate: v => {\n        if (!v) return;\n        const date = parseAbsolute(v, timezone);\n        if (min && date.compare(min) < 0) {\n          return trans({\n            message: 'Enter a date after :date',\n            values: {date: format(v)},\n          });\n        }\n        if (max && date.compare(max) > 0) {\n          return trans({\n            message: 'Enter a date before :date',\n            values: {date: format(v)},\n          });\n        }\n      },\n    },\n  });\n\n  const parsedValue: null | ZonedDateTime = value\n    ? parseAbsolute(value, timezone)\n    : null;\n\n  const formProps: Partial<DatePickerProps> = {\n    onChange: e => {\n      onChange(e ? e.toAbsoluteString() : e);\n    },\n    onBlur,\n    value: parsedValue,\n    invalid,\n    errorMessage: error?.message,\n    inputRef: ref,\n  };\n\n  return <DatePicker {...mergeProps(formProps, props)} />;\n}\n\nfunction isHourSegment(e: MouseEvent<HTMLDivElement>): boolean {\n  return ['hour', 'minute', 'dayPeriod'].includes(\n    (e.currentTarget as HTMLElement).ariaLabel || '',\n  );\n}\n"],"names":["useDatePickerState","props","now","useCurrentDateTime","isPlaceholder","setIsPlaceholder","useState","setStateValue","internalValue","setInternalValue","useControlledState","value","min","max","granularity","timezone","calendarIsOpen","setCalendarIsOpen","closeDialogOnSelection","useBaseDatePickerState","clear","useCallback","calendarDates","setCalendarDates","toCalendarDate","setSelectedValue","newValue","toSafeZoned","dayIsActive","day","isSameDay","getCellProps","date","DatePicker","showCalendarFooter","state","inputRef","useRef","footer","jsx","DialogFooter","Button","Trans","dialog","DialogTrigger","jsxs","Dialog","DialogBody","Calendar","openOnClick","e","isHourSegment","Fragment","DatePickerField","DateRangeIcon","clsx","DateSegmentList","FormDatePicker","userTimezone","useUserTimezone","trans","useTrans","format","useDateFormatter","onChange","onBlur","ref","invalid","error","useController","v","parseAbsolute","parsedValue","formProps","mergeProps"],"mappings":"ybAoDO,SAASA,EACdC,EACqB,CACrB,MAAMC,EAAMC,EAAA,EACN,CAACC,EAAeC,CAAgB,EAAIC,EAAAA,SACxC,CAACL,EAAM,OAAS,CAACA,EAAM,YAAA,EAKnBM,EAAgBN,EAAM,SACtB,CAACO,EAAeC,CAAgB,EAAIC,EACxCT,EAAM,OAASC,EACfD,EAAM,cAAgBC,EACtBS,GAAS,CACPN,EAAiB,EAAK,EACtBE,GAAA,MAAAA,EAAgBI,EAClB,CAAA,EAGI,CACJ,IAAAC,EACA,IAAAC,EACA,YAAAC,EACA,SAAAC,EACA,eAAAC,EACA,kBAAAC,EACA,uBAAAC,CAAA,EACEC,EAAuBX,EAAeP,CAAK,EAEzCmB,EAAQC,EAAAA,YAAY,IAAM,CAC9BhB,EAAiB,EAAI,EACrBI,EAAiBP,CAAG,EACpBK,GAAA,MAAAA,EAAgB,MAChBU,EAAkB,EAAK,CACzB,EAAG,CAACf,EAAKO,EAAkBF,EAAeU,CAAiB,CAAC,EAEtD,CAACK,EAAeC,CAAgB,EAAIjB,EAAAA,SAAyB,IAC1D,CAACkB,EAAehB,CAAa,CAAC,CACtC,EAEKiB,EAAmBJ,EAAAA,YACtBK,GAAwB,CACnBd,GAAOc,EAAS,QAAQd,CAAG,EAAI,EACjCc,EAAWd,EACFC,GAAOa,EAAS,QAAQb,CAAG,EAAI,IACxCa,EAAWb,GAIb,MAAMF,EAAQH,EACVA,EAAc,IAAIkB,CAAQ,EAC1BC,EAAYD,EAAUX,CAAQ,EAClCN,EAAiBE,CAAK,EACtBY,EAAiB,CAACC,EAAeb,CAAK,CAAC,CAAC,EACxCN,EAAiB,EAAK,CACxB,EACA,CAACI,EAAkBG,EAAKC,EAAKL,EAAeO,CAAQ,CAAA,EAGhDa,EAAcP,EAAAA,YACjBQ,GAAmB,CAACzB,GAAiB0B,EAAUtB,EAAeqB,CAAG,EAClE,CAACrB,EAAeJ,CAAa,CAAA,EAGzB2B,EAAeV,EAAAA,YAClBW,IACQ,CACL,QAAS,IAAM,CACbP,GAAA,MAAAA,EAAmBO,GACfd,IACFD,GAAA,MAAAA,EAAoB,IAExB,CAAA,GAGJ,CAACQ,EAAkBR,EAAmBC,CAAsB,CAAA,EAG9D,MAAO,CACL,cAAeV,EACf,iBAAkBC,EAClB,eAAAO,EACA,kBAAAC,EACA,YAAAW,EACA,iBAAkB,IAAM,GACxB,gBAAiB,IAAM,GACvB,cAAe,IAAM,GACrB,aAAAG,EACA,cAAAT,EACA,iBAAAC,EACA,cAAAnB,EACA,MAAAgB,EACA,iBAAAf,EACA,IAAAO,EACA,IAAAC,EACA,YAAAC,EACA,SAAAC,EACA,uBAAAG,CAAA,CAEJ,CC1HO,SAASe,EAAW,CAAC,mBAAAC,EAAoB,GAAGjC,GAAyB,CAC1E,MAAMkC,EAAQnC,EAAmBC,CAAK,EAChCmC,EAAWC,EAAAA,OAAuB,IAAI,EACtCnC,EAAMC,EAAA,EAENmC,EAASJ,GACbK,EAAAA,IAACC,EAAA,CACC,QAAQ,cACR,YACED,EAAAA,IAACE,EAAA,CACC,SAAUN,EAAM,cAChB,QAAQ,OACR,MAAM,UACN,QAAS,IAAM,CACbA,EAAM,MAAA,CACR,EAEA,SAAAI,EAAAA,IAACG,EAAA,CAAM,QAAQ,OAAA,CAAQ,CAAA,CAAA,EAI3B,SAAAH,EAAAA,IAACE,EAAA,CACC,QAAQ,OACR,MAAM,UACN,QAAS,IAAM,CACbN,EAAM,iBAAiBjC,CAAG,EAC1BiC,EAAM,kBAAkB,EAAK,CAC/B,EAEA,SAAAI,EAAAA,IAACG,EAAA,CAAM,QAAQ,OAAA,CAAQ,CAAA,CAAA,CACzB,CAAA,EAIEC,EACJJ,EAAAA,IAACK,EAAA,CACC,OAAQ,EACR,UAAU,eACV,OAAQT,EAAM,eACd,aAAcA,EAAM,kBACpB,KAAK,UACL,WAAYC,EACZ,qBAAsB,GACtB,kBAAmB,GAEnB,SAAAS,EAAAA,KAACC,EAAA,CAAO,KAAK,OACX,SAAA,CAAAP,EAAAA,IAACQ,EAAA,CACC,UAAU,0BACV,QAASb,EAAqB,oBAAsB,KAEpD,SAAAK,EAAAA,IAACS,EAAA,CAAS,MAAAb,EAAc,cAAe,CAAA,CAAG,CAAA,CAAA,EAE3CG,CAAA,CAAA,CACH,CAAA,CAAA,EAIEW,EAA+C,CACnD,QAASC,GAAK,CACZA,EAAE,gBAAA,EACFA,EAAE,eAAA,EACGC,EAAcD,CAAC,EAGlBf,EAAM,kBAAkB,EAAK,EAF7BA,EAAM,kBAAkB,EAAI,CAIhC,CAAA,EAGF,cACGiB,WAAA,CACC,SAAA,CAAAb,EAAAA,IAACc,EAAA,CACC,IAAKjB,EACL,aAAca,EACd,mBACGK,EAAA,CAAc,UAAWC,EAAKtD,EAAM,UAAY,eAAe,EAAG,EAEpE,GAAGA,EAEJ,SAAAsC,EAAAA,IAACiB,EAAA,CACC,aAAcP,EACd,MAAAd,EACA,MAAOA,EAAM,cACb,SAAUA,EAAM,iBAChB,cAAeA,EAAM,aAAA,CAAA,CACvB,CAAA,EAEDQ,CAAA,EACH,CAEJ,CAKO,SAASc,GAAexD,EAA4B,CACzD,KAAM,CAAC,IAAAW,EAAK,IAAAC,CAAA,EAAOZ,EACbyD,EAAeC,EAAA,EACf5C,EAAWd,EAAM,UAAYyD,EAC7B,CAAC,MAAAE,CAAA,EAASC,EAAA,EACV,CAAC,OAAAC,CAAA,EAAUC,EAAiB,CAAC,SAAUhD,EAAS,EAChD,CACJ,MAAO,CAAC,SAAAiD,EAAU,OAAAC,EAAQ,MAAAtD,EAAQ,KAAM,IAAAuD,CAAA,EACxC,WAAY,CAAC,QAAAC,EAAS,MAAAC,CAAA,CAAK,EACzBC,EAAc,CAChB,KAAMpE,EAAM,KACZ,MAAO,CACL,SAAUqE,GAAK,CACb,GAAI,CAACA,EAAG,OACR,MAAMtC,EAAOuC,EAAcD,EAAGvD,CAAQ,EACtC,GAAIH,GAAOoB,EAAK,QAAQpB,CAAG,EAAI,EAC7B,OAAOgD,EAAM,CACX,QAAS,2BACT,OAAQ,CAAC,KAAME,EAAOQ,CAAC,CAAA,CAAC,CACzB,EAEH,GAAIzD,GAAOmB,EAAK,QAAQnB,CAAG,EAAI,EAC7B,OAAO+C,EAAM,CACX,QAAS,4BACT,OAAQ,CAAC,KAAME,EAAOQ,CAAC,CAAA,CAAC,CACzB,CAEL,CAAA,CACF,CACD,EAEKE,EAAoC7D,EACtC4D,EAAc5D,EAAOI,CAAQ,EAC7B,KAEE0D,EAAsC,CAC1C,SAAUvB,GAAK,CACbc,EAASd,GAAIA,EAAE,iBAAA,CAAsB,CACvC,EACA,OAAAe,EACA,MAAOO,EACP,QAAAL,EACA,aAAcC,GAAA,YAAAA,EAAO,QACrB,SAAUF,CAAA,EAGZ,aAAQjC,EAAA,CAAY,GAAGyC,EAAWD,EAAWxE,CAAK,EAAG,CACvD,CAEA,SAASkD,EAAcD,EAAwC,CAC7D,MAAO,CAAC,OAAQ,SAAU,WAAW,EAAE,SACpCA,EAAE,cAA8B,WAAa,EAAA,CAElD"}