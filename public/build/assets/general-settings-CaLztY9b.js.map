{"version":3,"file":"general-settings-CaLztY9b.js","sources":["../../../common/foundation/resources/client/admin/settings/requests/use-generate-sitemap.ts","../../../common/foundation/resources/client/admin/settings/pages/general-settings.tsx"],"sourcesContent":["import {useMutation} from '@tanstack/react-query';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {toast} from '@ui/toast/toast';\nimport {message} from '@ui/i18n/message';\nimport {apiClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\n\ninterface Response extends BackendResponse {}\n\nexport function useGenerateSitemap() {\n  return useMutation({\n    mutationFn: () => generate(),\n    onSuccess: () => {\n      toast(message('Sitemap generated'));\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n}\n\nfunction generate(): Promise<Response> {\n  return apiClient.post('sitemap/generate').then(r => r.data);\n}\n","import {AdminDocsUrls} from '@app/admin/admin-config';\nimport {UploadType} from '@app/site-config';\nimport {AdminSettings} from '@common/admin/settings/admin-settings';\nimport {AdminSettingsLayout} from '@common/admin/settings/layout/settings-layout';\nimport {DocsLink} from '@common/admin/settings/layout/settings-links';\nimport {SettingsPanel} from '@common/admin/settings/layout/settings-panel';\nimport {useAdminSettings} from '@common/admin/settings/requests/use-admin-settings';\nimport {useGenerateSitemap} from '@common/admin/settings/requests/use-generate-sitemap';\nimport {FormImageSelector} from '@common/uploads/components/image-selector';\nimport {Button} from '@ui/buttons/button';\nimport {ExternalLink} from '@ui/buttons/external-link';\nimport {\n  FormTextField,\n  TextField,\n} from '@ui/forms/input-field/text-field/text-field';\nimport {Trans} from '@ui/i18n/trans';\nimport {useSettings} from '@ui/settings/use-settings';\nimport deepmerge from 'deepmerge';\nimport {ReactNode, useMemo} from 'react';\nimport {useForm} from 'react-hook-form';\n\ninterface Props {\n  children?: ReactNode;\n  defaultValues?: {client?: Partial<AdminSettings['client']>};\n}\nexport function Component({children, defaultValues}: Props) {\n  const {data} = useAdminSettings();\n\n  const mergedDefaultValues = useMemo(() => {\n    return deepmerge(defaultValues ?? {}, {\n      ...defaultValues,\n      client: {\n        branding: {\n          favicon: data.client.branding.favicon,\n          logo_light: data.client.branding.logo_light,\n          logo_dark: data.client.branding.logo_dark,\n          logo_light_mobile: data.client.branding.logo_light_mobile,\n          logo_dark_mobile: data.client.branding.logo_dark_mobile,\n          site_description: data.client.branding.site_description,\n        },\n      },\n      server: {\n        app_name: data.server.app_name,\n      },\n    });\n  }, [defaultValues, data]);\n\n  const form = useForm<AdminSettings>({\n    defaultValues: mergedDefaultValues,\n  });\n\n  return (\n    <AdminSettingsLayout\n      form={form}\n      title={<Trans message=\"General\" />}\n      docsLink={AdminDocsUrls.settings.general}\n    >\n      <SiteUrlSection />\n      <SiteNameSection />\n      <FaviconSection />\n      <LightModeLogo />\n      <DarkModeLogo />\n      <MobileLogos />\n      {children}\n      <SitemapSection />\n    </AdminSettingsLayout>\n  );\n}\n\nfunction SiteUrlSection() {\n  const {data} = useAdminSettings();\n\n  if (!data) return null;\n\n  let append = null;\n  const server = data!.server;\n  const isInvalid = server.newAppUrl && server.newAppUrl !== server.app_url;\n  if (isInvalid) {\n    append = (\n      <div className=\"mt-20 text-xs text-danger\">\n        <Trans\n          values={{\n            baseUrl: server.app_url,\n            currentUrl: server.newAppUrl,\n            b: chunks => <b>{chunks}</b>,\n          }}\n          message=\"Base site url is set as <b>:baseUrl</b> in configuration, but current url is <b>:currentUrl</b>. It is recommended to set the primary url you want to use in configuration file and then redirect all other url versions to this primary version via cpanel or .htaccess file.\"\n        />\n      </div>\n    );\n  }\n\n  return (\n    <SettingsPanel\n      className=\"mb-24\"\n      title={<Trans message=\"Site URL\" />}\n      description={\n        <div>\n          <Trans message=\"The primary domain for your site.\" />\n        </div>\n      }\n      link={\n        <DocsLink link=\"https://support.vebto.com/hc/articles/35/primary-site-url\">\n          <Trans message=\"What is a primary site url?\" />\n        </DocsLink>\n      }\n    >\n      <TextField\n        readOnly\n        invalid={!!isInvalid}\n        value={server.app_url}\n        label={<Trans message=\"Primary site url\" />}\n      />\n      {append}\n    </SettingsPanel>\n  );\n}\n\nfunction SiteNameSection() {\n  return (\n    <SettingsPanel\n      className=\"mb-24\"\n      title={<Trans message=\"Site name\" />}\n      description={\n        <div>\n          <Trans message=\"Short name for the site that will appear in browser tabs, seo tags, PWA app and other places.\" />\n        </div>\n      }\n    >\n      <FormTextField\n        name=\"server.app_name\"\n        label={<Trans message=\"Site name\" />}\n      />\n    </SettingsPanel>\n  );\n}\n\nfunction FaviconSection() {\n  return (\n    <SettingsPanel\n      className=\"mb-24\"\n      title={<Trans message=\"Favicon\" />}\n      description={\n        <div>\n          <Trans message=\"This will generate different size favicons. Image should be at least 512x512 in size.\" />\n        </div>\n      }\n    >\n      <div className=\"w-max\">\n        <BrandingImageSelector type=\"favicon\" />\n      </div>\n    </SettingsPanel>\n  );\n}\n\nfunction LightModeLogo() {\n  return (\n    <SettingsPanel\n      className=\"mb-24\"\n      title={<Trans message=\"Light mode logo\" />}\n      description={\n        <div>\n          <Trans message=\"Logo used in light mode and when enough screen space is available. Default logo is 516x117px size.\" />\n        </div>\n      }\n    >\n      <BrandingImageSelector type=\"logo_dark\" />\n    </SettingsPanel>\n  );\n}\n\nfunction DarkModeLogo() {\n  return (\n    <SettingsPanel\n      className=\"mb-24\"\n      title={<Trans message=\"Dark mode logo\" />}\n      description={\n        <div>\n          <Trans message=\"Will show light mode logo, if left empty.\" />\n        </div>\n      }\n    >\n      <BrandingImageSelector type=\"logo_light\" />\n    </SettingsPanel>\n  );\n}\n\nfunction MobileLogos() {\n  return (\n    <SettingsPanel\n      className=\"mb-24\"\n      title={<Trans message=\"Compact logos\" />}\n      description={\n        <div>\n          <Trans message=\"Will show these logos if there's not enough space. For example on mobile or when screen is too small.\" />\n        </div>\n      }\n    >\n      <div className=\"flex items-center gap-24\">\n        <BrandingImageSelector type=\"logo_dark_mobile\" title=\"Light mode\" />\n        <BrandingImageSelector type=\"logo_light_mobile\" title=\"Dark mode\" />\n      </div>\n    </SettingsPanel>\n  );\n}\n\ninterface ImageSelectorProps {\n  type: keyof AdminSettings['client']['branding'];\n  title?: string;\n}\nfunction BrandingImageSelector({type, title}: ImageSelectorProps) {\n  const {data} = useAdminSettings();\n  return (\n    <FormImageSelector\n      className=\"max-w-max\"\n      showEditButtonOnHover\n      name={`client.branding.${type}`}\n      uploadType={UploadType.brandingImages}\n      defaultValue={data?.defaults?.client.branding[type]}\n      label={title}\n    />\n  );\n}\n\nfunction SitemapSection() {\n  const generateSitemap = useGenerateSitemap();\n  const {base_url} = useSettings();\n\n  const url = `${base_url}/storage/sitemaps/sitemap-index.xml`;\n  const link = <ExternalLink href={url}>{url}</ExternalLink>;\n\n  return (\n    <SettingsPanel\n      className=\"mb-24\"\n      title={<Trans message=\"Sitemap\" />}\n      description={\n        <div>\n          <Trans message=\"Generate a sitemap to help search engines discover and index your site content.\" />\n        </div>\n      }\n    >\n      <Button\n        variant=\"outline\"\n        size=\"xs\"\n        color=\"primary\"\n        disabled={generateSitemap.isPending}\n        onClick={() => {\n          generateSitemap.mutate();\n        }}\n      >\n        <Trans message=\"Generate sitemap\" />\n      </Button>\n      <div className=\"mt-14 text-xs text-muted\">\n        <Trans\n          message=\"Once generated, sitemap url will be: :url\"\n          values={{\n            url: link,\n          }}\n        />\n      </div>\n    </SettingsPanel>\n  );\n}\n"],"names":["useGenerateSitemap","useMutation","generate","toast","message","err","showHttpErrorToast","apiClient","r","Component","children","defaultValues","data","useAdminSettings","mergedDefaultValues","useMemo","deepmerge","form","useForm","jsxs","AdminSettingsLayout","jsx","Trans","AdminDocsUrls","SiteUrlSection","SiteNameSection","FaviconSection","LightModeLogo","DarkModeLogo","MobileLogos","SitemapSection","append","server","isInvalid","chunks","SettingsPanel","DocsLink","TextField","FormTextField","BrandingImageSelector","type","title","FormImageSelector","UploadType","_a","generateSitemap","base_url","useSettings","url","link","ExternalLink","Button"],"mappings":"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"}