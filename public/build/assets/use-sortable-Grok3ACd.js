import{ad as O,r as w,ae as y}from"./main-owSUWNVS.js";import{$ as D}from"./getScrollParent--OCc5gFh.js";import{a as b,u as L,b as $,e as R}from"./use-droppable-C1L4PX9b.js";const N={onDragStart:()=>{},onDragEnter:()=>{},onDragOver:({e,ref:l,item:t,sortSession:r,onDropPositionChange:n})=>{var u;const d=r.dropPosition;let i=null;const f=(u=b.get(t))==null?void 0:u.rect;if(f){const a=f.top+f.height/2;e.clientY<=a?i="before":e.clientY>=a&&(i="after")}if(i!==d){const a=r.sortables.indexOf(t);if(r.dropPosition=i,n==null||n(r.dropPosition),P(r),l.current)if(r.dropPosition==="after")m(l.current,"bottom",r);else if(a===0)m(l.current,"top",r);else{const E=r.sortables[a-1],v=b.get(E);v!=null&&v.ref.current&&m(v.ref.current,"bottom",r)}const o=r.sortables.indexOf(t);if(r.activeIndex===o){r.finalIndex=r.activeIndex;return}(a>r.activeIndex?"after":"before")==="after"?r.finalIndex=r.dropPosition==="before"?o-1:o:r.finalIndex=r.dropPosition==="after"?o+1:o}},onDragEnd:e=>{P(e)}};function P(e){e!=null&&e.linePreviewEl&&(e.linePreviewEl.style.borderBottomColor="",e.linePreviewEl.style.borderTopColor="",e.linePreviewEl=void 0)}function m(e,l,t){const r="rgb(var(--be-primary))";l==="top"?e.style.borderTopColor=r:e.style.borderBottomColor=r,t&&(t.linePreviewEl=e)}function s(e,l,t){const r=O(l,0,e.length-1),n=O(t,0,e.length-1);if(r===n)return e;const d=e[r],i=n<r?-1:1;for(let f=r;f!==n;f+=i)e[f]=e[f+i];return e[n]=d,e}const A={onDragStart:()=>{},onDragOver:()=>{},onDragEnter:(e,l,t)=>{var n;const r=(n=b.get(e.sortables[t]))==null?void 0:n.ref.current;r&&(Y(r,t,l),s(e.sortables,t,l),e.finalIndex=l)},onDragEnd:()=>{}};function Y(e,l,t){const r=e.parentElement;if(t<0)r.prepend(e);else{l>-1&&l<=t&&t++;const n=r.children.item(t);n?n.before(e):r.append(e)}}function z(e,l,t){const r=e.slice();return r.splice(t<0?r.length+t:t,0,r.splice(l,1)[0]),r}const B="transform 0.2s cubic-bezier(0.2, 0, 0, 1)",T={onDragStart:e=>{e.sortables.forEach((l,t)=>{const r=b.get(l);r!=null&&r.ref.current&&(r.ref.current.style.transition=B,(e==null?void 0:e.activeIndex)===t&&(r.ref.current.style.opacity="0.4"))})},onDragEnter:(e,l,t)=>{s(e.sortables,t,l);const r=e.sortables.map(n=>{var d;return(d=b.get(n))==null?void 0:d.rect});e.sortables.forEach((n,d)=>{if(!e)return;const i=z(r,l,e.activeIndex),f=r[d],u=i[d],a=b.get(n);if(a!=null&&a.ref.current&&u&&f){const o=u.left-f.left,x=u.top-f.top;a.ref.current.style.transform=`translate3d(${o}px, ${x}px, 0)`}}),e.finalIndex=l},onDragOver:()=>{},onDragEnd:e=>{e.sortables.forEach(l=>{const t=b.get(l);t!=null&&t.ref.current&&(t.ref.current.style.transform="",t.ref.current.style.transition="",t.ref.current.style.opacity="",t.ref.current.style.zIndex="")})}};let c=null;const I={line:N,liveSort:T,moveNode:A};function j({item:e,items:l,type:t,ref:r,onSortEnd:n,onSortStart:d,onDragEnd:i,preview:f,disabled:u,onDropPositionChange:a,strategy:o="liveSort"}){w.useEffect(()=>{!u&&(c==null?void 0:c.type)===t&&c.sortables.length!==l.length&&(c.sortables=[...l],c.activeIndex=l.indexOf(e))},[l,e]);const{draggableProps:x,dragHandleRef:E}=L({id:e,ref:r,type:t,preview:f,disabled:u,onDragStart:()=>{var p;c={type:t,sortables:[...l],activeSortable:e,activeIndex:l.indexOf(e),finalIndex:l.indexOf(e),dropPosition:null,ref:r,scrollParent:r.current?D(r.current):void 0,scrollListener:()=>{R(b)}},I[o].onDragStart(c),d==null||d(),(p=c.scrollParent)==null||p.addEventListener("scroll",c.scrollListener)},onDragEnd:p=>{var g;c&&(c.dropPosition=null,a==null||a(c.dropPosition),c.activeIndex!==c.finalIndex&&(n==null||n(c.activeIndex,c.finalIndex)),(g=c.scrollParent)==null||g.removeEventListener("scroll",c.scrollListener),I[o].onDragEnd(c),i==null||i(),c=null)},getData:()=>{}}),{droppableProps:v}=$({id:e,ref:r,types:[t],disabled:u,allowDragEventsFromItself:!0,onDragOver:(p,g)=>{c&&I[o].onDragOver({e:g,ref:r,item:e,sortSession:c,onDropPositionChange:a})},onDragEnter:()=>{if(!c)return;const p=c.sortables.indexOf(e),g=c.sortables.indexOf(c.activeSortable);I[o].onDragEnter(c,p,g)},onDragLeave:()=>{c&&(c.dropPosition=null,a==null||a(c.dropPosition))}});return{sortableProps:{...y(x,v)},dragHandleRef:E}}export{z as m,j as u};
//# sourceMappingURL=use-sortable-Grok3ACd.js.map
