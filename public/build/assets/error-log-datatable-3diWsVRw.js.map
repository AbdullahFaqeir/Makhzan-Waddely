{"version":3,"file":"error-log-datatable-3diWsVRw.js","sources":["../../../common/foundation/resources/client/admin/logging/error/bug-fixing.svg","../../../common/foundation/resources/client/admin/logging/error/error-log-datatable-columns.tsx","../../../common/foundation/resources/client/admin/logging/error/use-delete-error-log.ts","../../../common/foundation/resources/client/admin/logging/error/error-log-datatable.tsx"],"sourcesContent":["export default \"__VITE_ASSET__DP$pC8B8__\"","import {ColumnConfig} from '@common/datatable/column-config';\nimport {Trans} from '@ui/i18n/trans';\nimport React from 'react';\nimport {ErrorLogItem} from '@common/admin/logging/error/error-log-item';\nimport {InfoIcon} from '@ui/icons/material/Info';\nimport {ErrorIcon} from '@ui/icons/material/Error';\nimport clsx from 'clsx';\nimport {FormattedRelativeTime} from '@ui/i18n/formatted-relative-time';\n\nexport const ErrorLogDatatableColumns: ColumnConfig<ErrorLogItem>[] = [\n  {\n    key: 'message',\n    visibleInMode: 'all',\n    width: 'flex-3 min-w-200',\n    header: () => <Trans message=\"Message\" />,\n    body: item => item.message,\n  },\n  {\n    key: 'datetime',\n    header: () => <Trans message=\"Date\" />,\n    body: item => <FormattedRelativeTime date={item.datetime} />,\n  },\n  {\n    key: 'severity',\n    header: () => <Trans message=\"Severity\" />,\n    body: item => {\n      return (\n        <span\n          className={clsx(\n            'flex items-center gap-6 text-xs capitalize',\n            item.level === 'error' ? 'text-danger' : 'text-primary',\n          )}\n        >\n          {item.level === 'error' ? (\n            <ErrorIcon size=\"sm\" />\n          ) : (\n            <InfoIcon size=\"sm\" />\n          )}\n          {item.level}\n        </span>\n      );\n    },\n  },\n];\n","import {useMutation} from '@tanstack/react-query';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {toast} from '@ui/toast/toast';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {message} from '@ui/i18n/message';\nimport {DatatableDataQueryKey} from '@common/datatable/requests/paginated-resources';\n\ninterface Payload {\n  identifier: string;\n}\n\nexport function useDeleteErrorLog() {\n  const {trans} = useTrans();\n  return useMutation({\n    mutationFn: (payload: Payload) => deleteLogFile(payload),\n    onSuccess: async () => {\n      await queryClient.invalidateQueries({\n        queryKey: DatatableDataQueryKey('logs/error'),\n      });\n      toast(trans(message('Log file deleted')));\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n}\n\nfunction deleteLogFile({identifier}: Payload) {\n  return apiClient.delete(`logs/error/${identifier}`).then(r => r.data);\n}\n","import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport bugFixingImage from '@common/admin/logging/error/bug-fixing.svg';\nimport {ErrorLogDatatableColumns} from '@common/admin/logging/error/error-log-datatable-columns';\nimport {\n  ErrorLogItem,\n  ErrorLogsPageData,\n} from '@common/admin/logging/error/error-log-item';\nimport {useDeleteErrorLog} from '@common/admin/logging/error/use-delete-error-log';\nimport {validateErrorLogDatatableSearch} from '@common/admin/logging/error/validate-error-log-datatable-search';\nimport {GlobalLoadingProgress} from '@common/core/global-loading-progress';\nimport {DataTableAddItemButton} from '@common/datatable/data-table-add-item-button';\nimport {DataTableHeader} from '@common/datatable/data-table-header';\nimport {DataTablePaginationFooter} from '@common/datatable/data-table-pagination-footer';\nimport {useDatatableSearchParams} from '@common/datatable/filters/utils/use-datatable-search-params';\nimport {DataTableEmptyStateMessage} from '@common/datatable/page/data-table-emty-state-message';\nimport {\n  DatatablePageScrollContainer,\n  DatatablePageWithHeaderBody,\n  DatatablePageWithHeaderLayout,\n} from '@common/datatable/page/datatable-page-with-header-layout';\nimport {useDatatableQuery} from '@common/datatable/requests/use-datatable-query';\nimport {Table} from '@common/ui/tables/table';\nimport {Button} from '@ui/buttons/button';\nimport {Item} from '@ui/forms/listbox/item';\nimport {Select} from '@ui/forms/select/select';\nimport {FormattedBytes} from '@ui/i18n/formatted-bytes';\nimport {Trans} from '@ui/i18n/trans';\nimport {DownloadIcon} from '@ui/icons/material/Download';\nimport {ConfirmationDialog} from '@ui/overlays/dialog/confirmation-dialog';\nimport {closeDialog, openDialog} from '@ui/overlays/store/dialog-store';\nimport {Skeleton} from '@ui/skeleton/skeleton';\nimport {Fragment, useEffect, useRef, useState} from 'react';\n\ntype ErrorLogFile = ErrorLogsPageData['files'][number];\n\nexport function Component() {\n  const {\n    searchParams,\n    sortDescriptor,\n    mergeIntoSearchParams,\n    setSearchQuery,\n    isFiltering,\n  } = useDatatableSearchParams(validateErrorLogDatatableSearch);\n\n  const query = useDatatableQuery({\n    ...commonAdminQueries.logs.error(searchParams),\n  } as any);\n\n  return (\n    <DatatablePageWithHeaderLayout>\n      <GlobalLoadingProgress query={query} />\n      <DatatablePageWithHeaderBody>\n        <DataTableHeader\n          searchValue={searchParams.query}\n          onSearchChange={setSearchQuery}\n          actions={\n            <Actions\n              data={query.data as ErrorLogsPageData}\n              onParamsChange={mergeIntoSearchParams}\n            />\n          }\n        />\n        <DatatablePageScrollContainer>\n          <Table\n            columns={ErrorLogDatatableColumns}\n            data={query.items as ErrorLogItem[]}\n            sortDescriptor={sortDescriptor}\n            onSortChange={mergeIntoSearchParams}\n            enableSelection={false}\n          />\n          {query.isEmpty && (\n            <DataTableEmptyStateMessage\n              isFiltering={isFiltering}\n              image={bugFixingImage}\n              title={<Trans message=\"No errors have been logged yet\" />}\n              filteringTitle={<Trans message=\"No matching error log entries\" />}\n            />\n          )}\n          <DataTablePaginationFooter\n            query={query}\n            onPageChange={page => mergeIntoSearchParams({page})}\n            onPerPageChange={perPage => mergeIntoSearchParams({perPage})}\n          />\n        </DatatablePageScrollContainer>\n      </DatatablePageWithHeaderBody>\n    </DatatablePageWithHeaderLayout>\n  );\n}\n\ninterface ActionsProps {\n  data: ErrorLogsPageData;\n  onParamsChange: (params: Record<string, string>) => void;\n}\nfunction Actions({data, onParamsChange}: ActionsProps) {\n  const setOnce = useRef(false);\n  const [selectedFile, setSelectedFile] = useState<string | null>(null);\n\n  // set initial selected file once files are loaded\n  useEffect(() => {\n    if (data.files.length && !setOnce.current) {\n      setOnce.current = true;\n      const firstFile = data.files[0].identifier;\n      setSelectedFile(firstFile);\n      // prevent unnecessary http call\n      if (firstFile !== data.selectedFile) {\n        onParamsChange({file: firstFile});\n      }\n    }\n  }, [data, onParamsChange, setOnce]);\n\n  return (\n    <Fragment>\n      <FileSelector\n        files={data.files ?? null}\n        selectedFile={selectedFile}\n        onSelected={file => {\n          setSelectedFile(file.identifier);\n          onParamsChange({file: file.identifier});\n        }}\n      />\n      <Button\n        variant=\"outline\"\n        color=\"danger\"\n        disabled={!selectedFile}\n        onClick={() =>\n          openDialog(ConfirmDeleteDialog, {identifier: selectedFile})\n        }\n      >\n        <Trans message=\"Delete\" />\n      </Button>\n      {selectedFile && (\n        <DataTableAddItemButton\n          elementType=\"a\"\n          download={data.files.find(f => f.identifier === selectedFile)?.name}\n          href={`api/v1/logs/error/${selectedFile}/download`}\n          icon={<DownloadIcon />}\n        >\n          <Trans message=\"Download log\" />\n        </DataTableAddItemButton>\n      )}\n    </Fragment>\n  );\n}\n\ninterface FileSelectorProps {\n  files: ErrorLogFile[] | null;\n  selectedFile: string | null;\n  onSelected: (file: ErrorLogFile) => void;\n}\nfunction FileSelector({files, selectedFile, onSelected}: FileSelectorProps) {\n  // files have not loaded yet, show skeleton\n  if (!files) {\n    return <Skeleton variant=\"rect\" className=\"max-w-[210px]\" />;\n  }\n\n  // no error logs yet, hide select completely\n  if (!files.length) {\n    return null;\n  }\n\n  return (\n    <Select\n      appearance=\"dropdown\"\n      selectionMode=\"single\"\n      selectedValue={selectedFile}\n      size=\"sm\"\n      minWidth=\"min-w-[210px]\"\n    >\n      {files?.map(file => (\n        <Item\n          key={file.identifier}\n          value={file.identifier}\n          onSelected={() => onSelected(file)}\n        >\n          {file.name} (<FormattedBytes bytes={file.size} />)\n        </Item>\n      ))}\n    </Select>\n  );\n}\n\ninterface ConfirmDeleteDialogProps {\n  identifier: string;\n}\nfunction ConfirmDeleteDialog({identifier}: ConfirmDeleteDialogProps) {\n  const deleteLog = useDeleteErrorLog();\n  return (\n    <ConfirmationDialog\n      title={<Trans message=\"Delete log file\" />}\n      body={<Trans message=\"Are you sure you want to delete this log file?\" />}\n      confirm={<Trans message=\"Delete\" />}\n      onConfirm={() =>\n        deleteLog.mutate({identifier}, {onSuccess: () => closeDialog()})\n      }\n      isLoading={deleteLog.isPending}\n      isDanger\n    />\n  );\n}\n"],"names":["bugFixingImage","ErrorLogDatatableColumns","jsx","Trans","item","FormattedRelativeTime","jsxs","clsx","ErrorIcon","InfoIcon","useDeleteErrorLog","trans","useTrans","useMutation","payload","deleteLogFile","queryClient","DatatableDataQueryKey","toast","message","err","showHttpErrorToast","identifier","apiClient","Component","searchParams","sortDescriptor","mergeIntoSearchParams","setSearchQuery","isFiltering","useDatatableSearchParams","validateErrorLogDatatableSearch","query","useDatatableQuery","commonAdminQueries","DatatablePageWithHeaderLayout","GlobalLoadingProgress","DatatablePageWithHeaderBody","DataTableHeader","Actions","DatatablePageScrollContainer","Table","DataTableEmptyStateMessage","DataTablePaginationFooter","page","perPage","data","onParamsChange","setOnce","useRef","selectedFile","setSelectedFile","useState","useEffect","firstFile","Fragment","FileSelector","file","Button","openDialog","ConfirmDeleteDialog","DataTableAddItemButton","_a","f","DownloadIcon","files","onSelected","Select","Item","FormattedBytes","Skeleton","deleteLog","ConfirmationDialog","closeDialog"],"mappings":"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"}