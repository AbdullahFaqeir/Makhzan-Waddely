{"version":3,"file":"roles-index-page-CKXk_iOl.js","sources":["../../../common/foundation/resources/client/admin/roles/roles-index-page.tsx"],"sourcesContent":["import {AdminDocsUrls} from '@app/admin/admin-config';\nimport {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {validateRolesDatatableSearch} from '@common/admin/roles/requests/validate-roles-datatable-search';\nimport {DocsLink} from '@common/admin/settings/layout/settings-links';\nimport {Role} from '@common/auth/role';\nimport {GlobalLoadingProgress} from '@common/core/global-loading-progress';\nimport {SiteConfigContext} from '@common/core/settings/site-config-context';\nimport {ColumnConfig} from '@common/datatable/column-config';\nimport {DataTableExportCsvButton} from '@common/datatable/csv-export/data-table-export-csv-button';\nimport {DataTableAddItemButton} from '@common/datatable/data-table-add-item-button';\nimport {DataTableHeader} from '@common/datatable/data-table-header';\nimport {DataTablePaginationFooter} from '@common/datatable/data-table-pagination-footer';\nimport {useDatatableSearchParams} from '@common/datatable/filters/utils/use-datatable-search-params';\nimport {DataTableEmptyStateMessage} from '@common/datatable/page/data-table-emty-state-message';\nimport {\n  DatatablePageHeaderBar,\n  DatatablePageScrollContainer,\n  DatatablePageWithHeaderBody,\n  DatatablePageWithHeaderLayout,\n} from '@common/datatable/page/datatable-page-with-header-layout';\nimport {useDatatableQuery} from '@common/datatable/requests/use-datatable-query';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {useNavigate} from '@common/ui/navigation/use-navigate';\nimport {Table} from '@common/ui/tables/table';\nimport {useMutation} from '@tanstack/react-query';\nimport {IconButton} from '@ui/buttons/icon-button';\nimport {Item} from '@ui/forms/listbox/item';\nimport {FormattedDate} from '@ui/i18n/formatted-date';\nimport {Trans} from '@ui/i18n/trans';\nimport {DeleteIcon} from '@ui/icons/material/Delete';\nimport {EditIcon} from '@ui/icons/material/Edit';\nimport {MoreVertIcon} from '@ui/icons/material/MoreVert';\nimport {Menu, MenuTrigger} from '@ui/menu/menu-trigger';\nimport {ConfirmationDialog} from '@ui/overlays/dialog/confirmation-dialog';\nimport {useDialogContext} from '@ui/overlays/dialog/dialog-context';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {Tab} from '@ui/tabs/tab';\nimport {TabList} from '@ui/tabs/tab-list';\nimport {Tabs} from '@ui/tabs/tabs';\nimport {Fragment, useContext, useState} from 'react';\nimport {Link} from 'react-router';\nimport teamSvg from './team.svg';\n\nconst columnConfig: ColumnConfig<Role>[] = [\n  {\n    key: 'name',\n    allowsSorting: true,\n    visibleInMode: 'all',\n    header: () => <Trans message=\"Role\" />,\n    body: role => (\n      <div>\n        <div>\n          <Trans message={role.name} />\n        </div>\n        <div className=\"overflow-x-hidden overflow-ellipsis text-xs text-muted\">\n          {role.description ? <Trans message={role.description} /> : undefined}\n        </div>\n      </div>\n    ),\n  },\n  {\n    key: 'updated_at',\n    maxWidth: 'max-w-100',\n    allowsSorting: true,\n    header: () => <Trans message=\"Last updated\" />,\n    body: role => <FormattedDate date={role.updated_at} />,\n  },\n  {\n    key: 'actions',\n    header: () => <Trans message=\"Actions\" />,\n    hideHeader: true,\n    visibleInMode: 'all',\n    align: 'end',\n    width: 'w-84 flex-shrink-0',\n    body: role => <ActionsColumn role={role} />,\n  },\n];\n\nexport function Component() {\n  const navigate = useNavigate();\n  const {\n    searchParams,\n    sortDescriptor,\n    mergeIntoSearchParams,\n    setSearchQuery,\n    isFiltering,\n  } = useDatatableSearchParams(validateRolesDatatableSearch);\n\n  const query = useDatatableQuery(commonAdminQueries.roles.index(searchParams));\n\n  const actions = (\n    <Fragment>\n      <DataTableExportCsvButton endpoint=\"roles/csv/export\" />\n      <DataTableAddItemButton\n        elementType={Link}\n        to={`new?type=${searchParams.type ?? 'users'}`}\n      >\n        <Trans message=\"Add new role\" />\n      </DataTableAddItemButton>\n    </Fragment>\n  );\n\n  const siteConfig = useContext(SiteConfigContext);\n  const roleTypes = siteConfig.roles?.types;\n\n  const selectedTab = searchParams.type\n    ? roleTypes?.findIndex(type => type.type === searchParams.type)\n    : 0;\n\n  const roleTypeTabs = !!roleTypes?.length ? (\n    <Tabs\n      selectedTab={selectedTab}\n      onTabChange={newTab => {\n        mergeIntoSearchParams({\n          type: roleTypes[newTab].type,\n        });\n      }}\n    >\n      <TabList className=\"mx-24\">\n        {roleTypes.map(type => (\n          <Tab key={type.type} className=\"min-w-100\">\n            <Trans {...type.label} />\n          </Tab>\n        ))}\n      </TabList>\n    </Tabs>\n  ) : null;\n\n  return (\n    <DatatablePageWithHeaderLayout>\n      <GlobalLoadingProgress query={query} />\n      <DatatablePageHeaderBar\n        title={<Trans message=\"Roles\" />}\n        showSidebarToggleButton\n        border={roleTypeTabs ? 'border-none' : undefined}\n        rightContent={\n          <DocsLink\n            variant=\"button\"\n            link={AdminDocsUrls.pages.roles}\n            size=\"xs\"\n          />\n        }\n      />\n      {roleTypeTabs}\n      <DatatablePageWithHeaderBody>\n        <DataTableHeader\n          searchValue={searchParams.query}\n          onSearchChange={setSearchQuery}\n          actions={actions}\n        />\n        <DatatablePageScrollContainer>\n          <Table\n            columns={columnConfig}\n            data={query.items}\n            sortDescriptor={sortDescriptor}\n            onSortChange={mergeIntoSearchParams}\n            enableSelection={false}\n            onAction={role => navigate(`${role.id}/edit`)}\n            cellHeight=\"h-64\"\n          />\n          {query.isEmpty ? (\n            <DataTableEmptyStateMessage\n              image={teamSvg}\n              isFiltering={isFiltering}\n              title={<Trans message=\"No roles have been created yet\" />}\n              filteringTitle={<Trans message=\"No matching roles\" />}\n            />\n          ) : null}\n          <DataTablePaginationFooter\n            query={query}\n            onPageChange={page => mergeIntoSearchParams({page})}\n            onPerPageChange={perPage => mergeIntoSearchParams({perPage})}\n          />\n        </DatatablePageScrollContainer>\n      </DatatablePageWithHeaderBody>\n    </DatatablePageWithHeaderLayout>\n  );\n}\n\ninterface ActionsColumnProps {\n  role: Role;\n}\nfunction ActionsColumn({role}: ActionsColumnProps) {\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  return (\n    <Fragment>\n      <DialogTrigger\n        type=\"modal\"\n        isOpen={deleteDialogOpen}\n        onOpenChange={setDeleteDialogOpen}\n      >\n        <DeleteRoleDialog roleId={role.id} />\n      </DialogTrigger>\n      <MenuTrigger>\n        <IconButton size=\"md\" className=\"text-muted\">\n          <MoreVertIcon />\n        </IconButton>\n        <Menu>\n          <Item\n            value=\"edit\"\n            elementType={Link}\n            to={`${role.id}/edit`}\n            startIcon={<EditIcon />}\n          >\n            <Trans message=\"Edit\" />\n          </Item>\n          {!role.internal && (\n            <Item\n              value=\"delete\"\n              onSelected={() => setDeleteDialogOpen(true)}\n              startIcon={<DeleteIcon />}\n            >\n              <Trans message=\"Delete\" />\n            </Item>\n          )}\n        </Menu>\n      </MenuTrigger>\n    </Fragment>\n  );\n}\n\ninterface DeleteRoleDialogProps {\n  roleId: number;\n}\nfunction DeleteRoleDialog({roleId}: DeleteRoleDialogProps) {\n  const {close} = useDialogContext();\n  const deleteRoles = useMutation({\n    mutationFn: () => {\n      return apiClient.delete(`roles/${roleId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.roles.invalidateKey,\n      });\n      close();\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n\n  return (\n    <ConfirmationDialog\n      isDanger\n      title={<Trans message=\"Delete role\" />}\n      body={<Trans message=\"Are you sure you want to delete this role?\" />}\n      confirm={<Trans message=\"Delete\" />}\n      isLoading={deleteRoles.isPending}\n      onConfirm={() => {\n        deleteRoles.mutate();\n      }}\n    />\n  );\n}\n"],"names":["columnConfig","jsx","Trans","role","jsxs","FormattedDate","ActionsColumn","Component","navigate","useNavigate","searchParams","sortDescriptor","mergeIntoSearchParams","setSearchQuery","isFiltering","useDatatableSearchParams","validateRolesDatatableSearch","query","useDatatableQuery","commonAdminQueries","actions","Fragment","DataTableExportCsvButton","DataTableAddItemButton","Link","roleTypes","_a","useContext","SiteConfigContext","selectedTab","type","roleTypeTabs","Tabs","newTab","TabList","Tab","DatatablePageWithHeaderLayout","GlobalLoadingProgress","DatatablePageHeaderBar","DocsLink","AdminDocsUrls","DatatablePageWithHeaderBody","DataTableHeader","DatatablePageScrollContainer","Table","DataTableEmptyStateMessage","teamSvg","DataTablePaginationFooter","page","perPage","deleteDialogOpen","setDeleteDialogOpen","useState","DialogTrigger","DeleteRoleDialog","MenuTrigger","IconButton","MoreVertIcon","Menu","Item","EditIcon","DeleteIcon","roleId","close","useDialogContext","deleteRoles","useMutation","apiClient","queryClient","err","showHttpErrorToast","ConfirmationDialog"],"mappings":"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"}