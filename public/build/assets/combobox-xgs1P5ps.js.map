{"version":3,"file":"combobox-xgs1P5ps.js","sources":["../../../common/foundation/resources/client/ui/library/forms/combobox/combobox.tsx"],"sourcesContent":["import {IconButton} from '@ui/buttons/icon-button';\nimport {ComboboxEndAdornment} from '@ui/forms/combobox/combobox-end-adornment';\nimport {BaseFieldPropsWithDom} from '@ui/forms/input-field/base-field-props';\nimport {TextField} from '@ui/forms/input-field/text-field/text-field';\nimport {Item} from '@ui/forms/listbox/item';\nimport {Listbox} from '@ui/forms/listbox/listbox';\nimport {ListBoxChildren, ListboxProps} from '@ui/forms/listbox/types';\nimport {useListbox} from '@ui/forms/listbox/use-listbox';\nimport {useListboxKeyboardNavigation} from '@ui/forms/listbox/use-listbox-keyboard-navigation';\nimport {SvgIconProps} from '@ui/icons/svg-icon';\nimport {Popover} from '@ui/overlays/popover';\nimport {createEventHandler} from '@ui/utils/dom/create-event-handler';\nimport React, {ReactElement, Ref} from 'react';\n\nexport {Item as Option};\n\nexport type ComboboxProps<T extends object> = Omit<\n  BaseFieldPropsWithDom<HTMLInputElement>,\n  'endAdornment'\n> &\n  ListBoxChildren<T> &\n  ListboxProps & {\n    selectionMode?: 'single' | 'none';\n    isAsync?: boolean;\n    isLoading?: boolean;\n    isFetching?: boolean;\n    openMenuOnFocus?: boolean;\n    endAdornmentIcon?: ReactElement<SvgIconProps>;\n    useOptionLabelAsInputValue?: boolean;\n    hideEndAdornment?: boolean;\n    onEndAdornmentClick?: () => void;\n    prependListbox?: boolean;\n    listboxClassName?: string;\n    contentClassName?: string;\n    searchFieldClassName?: string;\n  };\n\nfunction ComboBox<T extends object>(\n  props: ComboboxProps<T> & {selectionMode: 'single'},\n  ref: Ref<HTMLInputElement>,\n) {\n  const {\n    children,\n    items,\n    isAsync,\n    isLoading,\n    isPending,\n    isFetching,\n    openMenuOnFocus = true,\n    endAdornmentIcon,\n    onItemSelected,\n    maxItems,\n    clearInputOnItemSelection,\n    inputValue: userInputValue,\n    selectedValue,\n    onSelectionChange,\n    allowCustomValue = false,\n    onInputValueChange,\n    defaultInputValue,\n    selectionMode = 'single',\n    useOptionLabelAsInputValue,\n    showEmptyMessage,\n    floatingMaxHeight,\n    hideEndAdornment = false,\n    blurReferenceOnItemSelection,\n    clearSelectionOnInputClear,\n    isOpen: propsIsOpen,\n    onOpenChange: propsOnOpenChange,\n    prependListbox,\n    listboxClassName,\n    contentClassName,\n    searchFieldClassName,\n    onEndAdornmentClick,\n    autoFocusFirstItem = true,\n    focusLoopingMode,\n    ...textFieldProps\n  } = props;\n\n  const listbox = useListbox(\n    {\n      ...props,\n      floatingMaxHeight,\n      blurReferenceOnItemSelection,\n      selectionMode,\n      role: 'listbox',\n      virtualFocus: true,\n      clearSelectionOnInputClear: true,\n    },\n    ref,\n  );\n\n  const {\n    reference,\n    listboxId,\n    onInputChange,\n    state: {\n      isOpen,\n      setIsOpen,\n      inputValue,\n      setInputValue,\n      selectValues,\n      selectedValues,\n      setActiveCollection,\n    },\n    collection,\n  } = listbox;\n\n  const textLabel = selectedValues[0]\n    ? collection.get(selectedValues[0])?.textLabel\n    : undefined;\n\n  const {handleListboxSearchFieldKeydown} =\n    useListboxKeyboardNavigation(listbox);\n\n  const handleFocusAndClick = createEventHandler(\n    (e: React.FocusEvent<HTMLInputElement>) => {\n      if (openMenuOnFocus && !isOpen) {\n        setIsOpen(true);\n      }\n      e.target.select();\n    },\n  );\n\n  return (\n    <Listbox\n      prepend={prependListbox}\n      className={listboxClassName}\n      contentClassName={contentClassName}\n      listbox={listbox}\n      mobileOverlay={Popover}\n      isLoading={isLoading}\n      isPending={isPending}\n      onPointerDown={e => {\n        // prevent focus from leaving input when scrolling listbox via mouse\n        e.preventDefault();\n      }}\n    >\n      <TextField\n        inputRef={reference}\n        className={searchFieldClassName}\n        {...textFieldProps}\n        endAdornment={\n          !hideEndAdornment ? (\n            <IconButton\n              size=\"md\"\n              tabIndex={-1}\n              disabled={textFieldProps.disabled}\n              className=\"pointer-events-auto\"\n              onPointerDown={e => {\n                e.preventDefault();\n                e.stopPropagation();\n                if (onEndAdornmentClick) {\n                  onEndAdornmentClick();\n                } else {\n                  setActiveCollection('all');\n                  setIsOpen(!isOpen);\n                }\n              }}\n            >\n              <ComboboxEndAdornment\n                isLoading={isLoading || isFetching}\n                icon={endAdornmentIcon}\n              />\n            </IconButton>\n          ) : null\n        }\n        aria-expanded={isOpen ? 'true' : 'false'}\n        aria-haspopup=\"listbox\"\n        aria-controls={isOpen ? listboxId : undefined}\n        aria-autocomplete=\"list\"\n        autoComplete=\"off\"\n        autoCorrect=\"off\"\n        spellCheck=\"false\"\n        onChange={onInputChange}\n        value={useOptionLabelAsInputValue && textLabel ? textLabel : inputValue}\n        onBlur={e => {\n          if (allowCustomValue) {\n            selectValues(e.target.value);\n          } else if (!clearInputOnItemSelection) {\n            const val = selectedValues[0];\n            setInputValue(selectValues.length && val != null ? `${val}` : '');\n          }\n        }}\n        onFocus={handleFocusAndClick}\n        onClick={handleFocusAndClick}\n        onKeyDown={e => handleListboxSearchFieldKeydown(e)}\n      />\n    </Listbox>\n  );\n}\n\nconst ComboBoxForwardRef = React.forwardRef(ComboBox) as <T extends object>(\n  props: ComboboxProps<T> & {ref?: Ref<HTMLInputElement>},\n) => ReactElement;\nexport {ComboBoxForwardRef as ComboBox};\n"],"names":["ComboBox","props","ref","children","items","isAsync","isLoading","isPending","isFetching","openMenuOnFocus","endAdornmentIcon","onItemSelected","maxItems","clearInputOnItemSelection","userInputValue","selectedValue","onSelectionChange","allowCustomValue","onInputValueChange","defaultInputValue","selectionMode","useOptionLabelAsInputValue","showEmptyMessage","floatingMaxHeight","hideEndAdornment","blurReferenceOnItemSelection","clearSelectionOnInputClear","propsIsOpen","propsOnOpenChange","prependListbox","listboxClassName","contentClassName","searchFieldClassName","onEndAdornmentClick","autoFocusFirstItem","focusLoopingMode","textFieldProps","listbox","useListbox","reference","listboxId","onInputChange","isOpen","setIsOpen","inputValue","setInputValue","selectValues","selectedValues","setActiveCollection","collection","textLabel","_a","handleListboxSearchFieldKeydown","useListboxKeyboardNavigation","handleFocusAndClick","createEventHandler","jsx","Listbox","Popover","TextField","IconButton","ComboboxEndAdornment","val","ComboBoxForwardRef","React"],"mappings":"+IAqCA,SAASA,EACPC,EACAC,EACA,OACA,KAAM,CACJ,SAAAC,EACA,MAAAC,EACA,QAAAC,EACA,UAAAC,EACA,UAAAC,EACA,WAAAC,EACA,gBAAAC,EAAkB,GAClB,iBAAAC,EACA,eAAAC,EACA,SAAAC,EACA,0BAAAC,EACA,WAAYC,GACZ,cAAAC,GACA,kBAAAC,GACA,iBAAAC,EAAmB,GACnB,mBAAAC,GACA,kBAAAC,GACA,cAAAC,EAAgB,SAChB,2BAAAC,EACA,iBAAAC,GACA,kBAAAC,EACA,iBAAAC,EAAmB,GACnB,6BAAAC,EACA,2BAAAC,GACA,OAAQC,GACR,aAAcC,GACd,eAAAC,EACA,iBAAAC,EACA,iBAAAC,EACA,qBAAAC,EACA,oBAAAC,EACA,mBAAAC,GAAqB,GACrB,iBAAAC,GACA,GAAGC,CAAA,EACDnC,EAEEoC,EAAUC,EACd,CACE,GAAGrC,EACH,kBAAAsB,EACA,6BAAAE,EACA,cAAAL,EACA,KAAM,UACN,aAAc,GACd,2BAA4B,EAAA,EAE9BlB,CAAA,EAGI,CACJ,UAAAqC,EACA,UAAAC,EACA,cAAAC,EACA,MAAO,CACL,OAAAC,EACA,UAAAC,EACA,WAAAC,EACA,cAAAC,EACA,aAAAC,EACA,eAAAC,EACA,oBAAAC,CAAA,EAEF,WAAAC,CAAA,EACEZ,EAEEa,EAAYH,EAAe,CAAC,GAC9BI,EAAAF,EAAW,IAAIF,EAAe,CAAC,CAAC,IAAhC,YAAAI,EAAmC,UACnC,OAEE,CAAC,gCAAAC,CAAA,EACLC,EAA6BhB,CAAO,EAEhCiB,EAAsBC,EACzB,GAA0C,CACrC9C,GAAmB,CAACiC,GACtBC,EAAU,EAAI,EAEhB,EAAE,OAAO,OAAA,CACX,CAAA,EAGF,OACEa,EAAAA,IAACC,EAAA,CACC,QAAS5B,EACT,UAAWC,EACX,iBAAAC,EACA,QAAAM,EACA,cAAeqB,EACf,UAAApD,EACA,UAAAC,EACA,cAAe,GAAK,CAElB,EAAE,eAAA,CACJ,EAEA,SAAAiD,EAAAA,IAACG,EAAA,CACC,SAAUpB,EACV,UAAWP,EACV,GAAGI,EACJ,aACGZ,EAsBG,KArBFgC,EAAAA,IAACI,EAAA,CACC,KAAK,KACL,SAAU,GACV,SAAUxB,EAAe,SACzB,UAAU,sBACV,cAAe,GAAK,CAClB,EAAE,eAAA,EACF,EAAE,gBAAA,EACEH,EACFA,EAAA,GAEAe,EAAoB,KAAK,EACzBL,EAAU,CAACD,CAAM,EAErB,EAEA,SAAAc,EAAAA,IAACK,EAAA,CACC,UAAWvD,GAAaE,EACxB,KAAME,CAAA,CAAA,CACR,CAAA,EAIN,gBAAegC,EAAS,OAAS,QACjC,gBAAc,UACd,gBAAeA,EAASF,EAAY,OACpC,oBAAkB,OAClB,aAAa,MACb,YAAY,MACZ,WAAW,QACX,SAAUC,EACV,MAAOpB,GAA8B6B,EAAYA,EAAYN,EAC7D,OAAQ,GAAK,CACX,GAAI3B,EACF6B,EAAa,EAAE,OAAO,KAAK,UAClB,CAACjC,EAA2B,CACrC,MAAMiD,EAAMf,EAAe,CAAC,EAC5BF,EAAcC,EAAa,QAAUgB,GAAO,KAAO,GAAGA,CAAG,GAAK,EAAE,CAClE,CACF,EACA,QAASR,EACT,QAASA,EACT,UAAW,GAAKF,EAAgC,CAAC,CAAA,CAAA,CACnD,CAAA,CAGN,CAEA,MAAMW,GAAqBC,EAAM,WAAWhE,CAAQ"}