{"version":3,"mappings":";wzBAcA,MAAMA,EAAYC,EAAM,KAAK,IAAAC,EAAA,IAAM,OAAO,0BAA+B,2CAAC,EAEpEC,EAAO,CACX,CACE,KAAM,OACN,MAAOC,EAAQ,0BAA0B,GAE3C,CACE,KAAM,MACN,MAAOA,EAAQ,YAAY,EAE/B,EAEO,SAASC,GAAY,CAC1B,KAAM,CAACC,EAAcC,CAAe,EAAIC,EAAA,EAClCC,EAAkBH,EAAa,IAAI,KAAK,GAAK,OACnD,IAAII,EAAmBP,EAAK,UAAUQ,GAAOA,EAAI,OAASF,CAAe,EACzEC,EAAmBA,IAAqB,GAAK,EAAIA,EAEjD,MAAME,EAAOH,IAAoB,OAAS,OAAS,MAE7CI,EACJC,MAACC,EAAA,CACC,YAAaL,EACb,eAAsBH,EAAgB,CAAC,IAAKJ,EAAKa,CAAK,EAAE,KAAK,EAE7D,eAACC,EAAA,CAAQ,UAAU,OAChB,SAAAd,EAAK,OACJW,MAACI,EAAA,CACC,SAAAJ,MAACK,EAAA,CAAO,GAAGR,EAAI,MAAO,GADdA,EAAI,IAEd,CACD,EACH,IAIJ,OAAOG,MAACM,EAAA,CAAwB,KAAAR,EAAY,QAAAC,CAAA,EAAlBD,CAAoC,CAChE,CAMA,SAASQ,EAAa,CAAC,KAAAR,EAAM,QAAAC,GAA6B,CACxD,KAAM,CAAC,KAAAQ,CAAA,EAAQC,EAAA,EACTC,EACJX,IAAS,MACL,CAAC,YAAa,CAAC,IAAKS,EAAK,YAAY,IAAG,EACxC,CAAC,YAAa,CAAC,KAAMA,EAAK,YAAY,KAAI,EAE1CG,EAAOC,EAAuB,CAClC,cAAAF,CAAA,CACD,EAED,OACET,MAACY,EAAA,CACC,KAAAF,EACA,MAAOV,MAACK,EAAA,CAAM,QAAQ,cAAc,EACpC,KAAMN,EACN,SAAUc,EAAc,SAAS,WAEjC,eAAC,OAAI,UAAU,sDACb,SAAAb,MAACc,EAAA,CAAW,KAAAhB,EAAY,EAC1B,GAGN,CAKA,SAASgB,EAAW,CAAC,KAAAhB,GAAwB,CAC3C,KAAM,CAAC,SAAAiB,EAAU,UAAAC,EAAW,SAAAC,EAAU,YAAAC,CAAA,EACpCC,EAAA,EAIIC,EAAeC,SAAO,EAAI,EAE1BC,EACJxB,IAAS,OACJ,mBACA,kBAEP,aACGyB,WAAA,CAAS,eAAWC,EAAA,CAAe,gBAAe,GAAC,EAClD,SAAAxB,MAACd,EAAA,CACC,KAAAY,EACA,OAAQ,IAAM,CACZ,WAAW,IAAOsB,EAAa,QAAU,GAAQ,EAAE,CACrD,EACA,SAAUK,GAAY,CACpB,GAAI,CAACL,EAAa,QAChB,OAAOL,EAASO,EAAUG,EAAU,CAAC,YAAa,GAAK,CAE3D,EACA,aAAcT,EAAUM,CAAQ,GAAK,GACrC,gBAAiBI,GAAW,CACtBA,EACFR,EAAYI,CAAQ,EAEpBL,EAASK,EAAU,CAAC,KAAM,SAAS,CAEvC,IAEJ,CAEJ","names":["AceEditor","React","__vitePreload","tabs","message","Component","searchParams","setSearchParams","useSearchParams","selectedTabName","selectedTabIndex","tab","mode","tabList","jsx","Tabs","index","TabList","Tab","Trans","EditorLayout","data","useAdminSettings","defaultValues","form","useForm","AdminSettingsLayout","AdminDocsUrls","CodeEditor","setValue","getValues","setError","clearErrors","useFormContext","ignoreChange","useRef","formPath","Suspense","ProgressCircle","newValue","isValid"],"ignoreList":[],"sources":["../../../common/foundation/resources/client/admin/settings/pages/custom-code-settings.tsx"],"sourcesContent":["import {AdminDocsUrls} from '@app/admin/admin-config';\nimport {AdminSettings} from '@common/admin/settings/admin-settings';\nimport {AdminSettingsLayout} from '@common/admin/settings/layout/settings-layout';\nimport {useAdminSettings} from '@common/admin/settings/requests/use-admin-settings';\nimport {message} from '@ui/i18n/message';\nimport {Trans} from '@ui/i18n/trans';\nimport {ProgressCircle} from '@ui/progress/progress-circle';\nimport {Tab} from '@ui/tabs/tab';\nimport {TabList} from '@ui/tabs/tab-list';\nimport {Tabs} from '@ui/tabs/tabs';\nimport React, {ReactElement, Suspense, useRef} from 'react';\nimport {useForm, useFormContext} from 'react-hook-form';\nimport {useSearchParams} from 'react-router';\n\nconst AceEditor = React.lazy(() => import('@common/ace-editor/ace-editor'));\n\nconst tabs = [\n  {\n    name: 'html',\n    label: message('Custom HTML & JavaScript'),\n  },\n  {\n    name: 'css',\n    label: message('Custom CSS'),\n  },\n];\n\nexport function Component() {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const selectedTabName = searchParams.get('tab') || 'html';\n  let selectedTabIndex = tabs.findIndex(tab => tab.name === selectedTabName);\n  selectedTabIndex = selectedTabIndex === -1 ? 0 : selectedTabIndex;\n\n  const mode = selectedTabName === 'html' ? 'html' : 'css';\n\n  const tabList = (\n    <Tabs\n      selectedTab={selectedTabIndex}\n      onTabChange={index => setSearchParams({tab: tabs[index].name})}\n    >\n      <TabList className=\"px-8\">\n        {tabs.map(tab => (\n          <Tab key={tab.name}>\n            <Trans {...tab.label} />\n          </Tab>\n        ))}\n      </TabList>\n    </Tabs>\n  );\n\n  return <EditorLayout key={mode} mode={mode} tabList={tabList} />;\n}\n\ninterface EditorLayoutProps {\n  mode: 'css' | 'html';\n  tabList: ReactElement;\n}\nfunction EditorLayout({mode, tabList}: EditorLayoutProps) {\n  const {data} = useAdminSettings();\n  const defaultValues =\n    mode === 'css'\n      ? {custom_code: {css: data.custom_code.css}}\n      : {custom_code: {html: data.custom_code.html}};\n\n  const form = useForm<AdminSettings>({\n    defaultValues,\n  });\n\n  return (\n    <AdminSettingsLayout\n      form={form}\n      title={<Trans message=\"Custom code\" />}\n      tabs={tabList}\n      docsLink={AdminDocsUrls.settings.customCode}\n    >\n      <div className=\"relative h-580 overflow-hidden rounded-panel border\">\n        <CodeEditor mode={mode} />\n      </div>\n    </AdminSettingsLayout>\n  );\n}\n\ninterface CodeEditorProps {\n  mode: 'css' | 'html';\n}\nfunction CodeEditor({mode}: CodeEditorProps) {\n  const {setValue, getValues, setError, clearErrors} =\n    useFormContext<AdminSettings>();\n\n  // There's a bug in AceEditor, onChange is called on mount,\n  // so we need to ignore it, otherwise form will be marked as dirty\n  const ignoreChange = useRef(true);\n\n  const formPath =\n    mode === 'html'\n      ? ('custom_code.html' as const)\n      : ('custom_code.css' as const);\n\n  return (\n    <Suspense fallback={<ProgressCircle isIndeterminate />}>\n      <AceEditor\n        mode={mode}\n        onLoad={() => {\n          setTimeout(() => (ignoreChange.current = false), 10);\n        }}\n        onChange={newValue => {\n          if (!ignoreChange.current) {\n            return setValue(formPath, newValue, {shouldDirty: true});\n          }\n        }}\n        defaultValue={getValues(formPath) || ''}\n        onIsValidChange={isValid => {\n          if (isValid) {\n            clearErrors(formPath);\n          } else {\n            setError(formPath, {type: 'manual'});\n          }\n        }}\n      />\n    </Suspense>\n  );\n}\n"],"file":"assets/custom-code-settings-BOzBt6Y9.js"}