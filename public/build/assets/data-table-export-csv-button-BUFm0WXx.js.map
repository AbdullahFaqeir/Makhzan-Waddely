{"version":3,"file":"data-table-export-csv-button-BUFm0WXx.js","sources":["../../../common/foundation/resources/client/datatable/requests/use-export-csv.ts","../../../common/foundation/resources/client/datatable/csv-export/csv-export-info-dialog.tsx","../../../common/foundation/resources/client/datatable/csv-export/data-table-export-csv-button.tsx"],"sourcesContent":["import {apiClient} from '../../http/query-client';\nimport {BackendResponse} from '../../http/backend-response/backend-response';\nimport {useMutation} from '@tanstack/react-query';\nimport {showHttpErrorToast} from '../../http/show-http-error-toast';\n\ninterface Response extends BackendResponse {\n  downloadPath?: string;\n  result?: 'jobQueued';\n}\n\nexport type ExportCsvPayload = Record<string, string | number | undefined>;\n\nexport function useExportCsv(endpoint: string) {\n  return useMutation({\n    mutationFn: (payload?: ExportCsvPayload) => exportCsv(endpoint, payload),\n    onError: err => showHttpErrorToast(err),\n  });\n}\n\nfunction exportCsv(\n  endpoint: string,\n  payload: ExportCsvPayload | undefined,\n): Promise<Response> {\n  return apiClient.post(endpoint, payload).then(r => r.data);\n}\n","import {DialogBody} from '@ui/overlays/dialog/dialog-body';\nimport {DialogFooter} from '@ui/overlays/dialog/dialog-footer';\nimport {DialogHeader} from '@ui/overlays/dialog/dialog-header';\nimport {useDialogContext} from '@ui/overlays/dialog/dialog-context';\nimport {Dialog} from '@ui/overlays/dialog/dialog';\nimport {Button} from '@ui/buttons/button';\nimport {Trans} from '@ui/i18n/trans';\n\nexport function CsvExportInfoDialog() {\n  const {close} = useDialogContext();\n  return (\n    <Dialog>\n      <DialogHeader>\n        <Trans message=\"Csv export\" />\n      </DialogHeader>\n      <DialogBody>\n        <Trans\n          message=\"Your request is being processed. We'll email you when the report is ready to download. In\n            certain cases, it might take a little longer, depending on the number of items beings\n            exported and the volume of activity.\"\n        />\n      </DialogBody>\n      <DialogFooter>\n        <Button variant=\"flat\" color=\"primary\" onClick={close}>\n          <Trans message=\"Got it\" />\n        </Button>\n      </DialogFooter>\n    </Dialog>\n  );\n}\n","import {IconButton} from '@ui/buttons/icon-button';\nimport {FileDownloadIcon} from '@ui/icons/material/FileDownload';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {downloadFileFromUrl} from '@ui/utils/files/download-file-from-url';\nimport {Fragment, useState} from 'react';\nimport {ExportCsvPayload, useExportCsv} from '../requests/use-export-csv';\nimport {CsvExportInfoDialog} from './csv-export-info-dialog';\n\ninterface DataTableExportCsvButtonProps {\n  endpoint: string;\n  payload?: ExportCsvPayload;\n}\nexport function DataTableExportCsvButton({\n  endpoint,\n  payload,\n}: DataTableExportCsvButtonProps) {\n  const [dialogIsOpen, setDialogIsOpen] = useState(false);\n  const exportCsv = useExportCsv(endpoint);\n\n  return (\n    <Fragment>\n      <IconButton\n        variant=\"outline\"\n        color=\"primary\"\n        size=\"sm\"\n        className=\"flex-shrink-0\"\n        disabled={exportCsv.isPending}\n        onClick={() => {\n          exportCsv.mutate(payload, {\n            onSuccess: response => {\n              if (response.downloadPath) {\n                downloadFileFromUrl(response.downloadPath);\n              } else {\n                setDialogIsOpen(true);\n              }\n            },\n          });\n        }}\n      >\n        <FileDownloadIcon />\n      </IconButton>\n      <DialogTrigger\n        type=\"modal\"\n        isOpen={dialogIsOpen}\n        onOpenChange={setDialogIsOpen}\n      >\n        <CsvExportInfoDialog />\n      </DialogTrigger>\n    </Fragment>\n  );\n}\n"],"names":["useExportCsv","endpoint","useMutation","payload","exportCsv","err","showHttpErrorToast","apiClient","r","CsvExportInfoDialog","close","useDialogContext","Dialog","jsx","DialogHeader","Trans","DialogBody","DialogFooter","Button","DataTableExportCsvButton","dialogIsOpen","setDialogIsOpen","useState","Fragment","IconButton","response","downloadFileFromUrl","FileDownloadIcon","DialogTrigger"],"mappings":"sRAYO,SAASA,EAAaC,EAAkB,CAC7C,OAAOC,EAAY,CACjB,WAAaC,GAA+BC,EAAUH,EAAUE,CAAO,EACvE,QAASE,GAAOC,EAAmBD,CAAG,CAAA,CACvC,CACH,CAEA,SAASD,EACPH,EACAE,EACmB,CACnB,OAAOI,EAAU,KAAKN,EAAUE,CAAO,EAAE,KAAKK,GAAKA,EAAE,IAAI,CAC3D,CChBO,SAASC,GAAsB,CACpC,KAAM,CAAC,MAAAC,CAAA,EAASC,EAAA,EAChB,cACGC,EAAA,CACC,SAAA,CAAAC,MAACC,EAAA,CACC,SAAAD,EAAAA,IAACE,EAAA,CAAM,QAAQ,aAAa,EAC9B,QACCC,EAAA,CACC,SAAAH,EAAAA,IAACE,EAAA,CACC,QAAQ;AAAA;AAAA,iDAAA,CAAA,EAIZ,EACAF,MAACI,EAAA,CACC,SAAAJ,EAAAA,IAACK,EAAA,CAAO,QAAQ,OAAO,MAAM,UAAU,QAASR,EAC9C,SAAAG,MAACE,EAAA,CAAM,QAAQ,SAAS,EAC1B,CAAA,CACF,CAAA,EACF,CAEJ,CCjBO,SAASI,EAAyB,CACvC,SAAAlB,EACA,QAAAE,CACF,EAAkC,CAChC,KAAM,CAACiB,EAAcC,CAAe,EAAIC,EAAAA,SAAS,EAAK,EAChDlB,EAAYJ,EAAaC,CAAQ,EAEvC,cACGsB,WAAA,CACC,SAAA,CAAAV,EAAAA,IAACW,EAAA,CACC,QAAQ,UACR,MAAM,UACN,KAAK,KACL,UAAU,gBACV,SAAUpB,EAAU,UACpB,QAAS,IAAM,CACbA,EAAU,OAAOD,EAAS,CACxB,UAAWsB,GAAY,CACjBA,EAAS,aACXC,EAAoBD,EAAS,YAAY,EAEzCJ,EAAgB,EAAI,CAExB,CAAA,CACD,CACH,EAEA,eAACM,EAAA,CAAA,CAAiB,CAAA,CAAA,EAEpBd,EAAAA,IAACe,EAAA,CACC,KAAK,QACL,OAAQR,EACR,aAAcC,EAEd,eAACZ,EAAA,CAAA,CAAoB,CAAA,CAAA,CACvB,EACF,CAEJ"}