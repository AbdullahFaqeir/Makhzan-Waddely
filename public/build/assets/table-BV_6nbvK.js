import{r as h,cw as ue,j as b,w as de,c as H,A as fe,y as be,cx as he,cy as Y,cz as xe,b as ge,G as Z,ai as T,ad as Q,ah as pe,af as me}from"./main-BdzhGpqn.js";import{C as _}from"./checkbox-B6q4SJqi.js";import{S as we}from"./skeleton-CTimao-U.js";import{A as ye}from"./ArrowDownward-DXr7353z.js";import{$ as J}from"./useEffectEvent-D8HiMrwe.js";import{u as ve}from"./use-pointer-events-Dsln3OKq.js";function ke(e){let{ref:t,onInteractOutside:r,isDisabled:o,onInteractOutsideStart:n}=e,i=h.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),a=J(s=>{r&&X(s,t)&&(n&&n(s),i.current.isPointerDown=!0)}),u=J(s=>{r&&r(s)});h.useEffect(()=>{let s=i.current;if(o)return;const l=t.current,x=ue(l);if(typeof PointerEvent<"u"){let c=y=>{s.isPointerDown&&X(y,t)&&u(y),s.isPointerDown=!1};return x.addEventListener("pointerdown",a,!0),x.addEventListener("click",c,!0),()=>{x.removeEventListener("pointerdown",a,!0),x.removeEventListener("click",c,!0)}}},[t,o,a,u])}function X(e,t){if(e.button>0)return!1;if(e.target){const r=e.target.ownerDocument;if(!r||!r.documentElement.contains(e.target)||e.target.closest("[data-react-aria-top-layer]"))return!1}return t.current?!e.composedPath().includes(t.current):!1}const D=h.createContext(null),Ce={key:"checkbox",header:()=>b.jsx($e,{}),align:"center",width:"w-24 flex-shrink-0",body:(e,t)=>t.isPlaceholder?b.jsx(we,{size:"w-24 h-24",variant:"rect"}):b.jsx(Pe,{item:e})};function Pe({item:e}){const{selectedRows:t,toggleRow:r}=h.useContext(D);return b.jsx(_,{checked:t.includes(e.id),onChange:()=>r(e)})}function $e(){const{trans:e}=de(),{data:t,selectedRows:r,onSelectionChange:o}=h.useContext(D),n=!!t.length&&t.length===r.length,i=!n&&!!r.length;return b.jsx(_,{"aria-label":e({message:"Select all"}),isIndeterminate:i,checked:n,onChange:()=>{o(n?[]:t.map(a=>a.id))}})}function ee({index:e,isHeader:t}){const{columns:r,cellHeight:o="h-50",headerCellHeight:n="h-46",tableStyle:i}=h.useContext(D),a=e===0,u=r.length-1===e,s=r[e],l=t?n:o;return i==="flex"?Ee(s,l):De(s,a,u,l)}function De(e,t,r,o){let n=e==null?void 0:e.padding;return n||(t?n="pl-16 pr-12":r?n="pr-16 pl-12":n="px-12"),H("overflow-hidden whitespace-nowrap outline-none focus-visible:outline focus-visible:outline-offset-2 text-left",o,e==null?void 0:e.maxWidth,e==null?void 0:e.width,n,e==null?void 0:e.className)}function Ee(e,t){let r="justify-start";(e==null?void 0:e.align)==="center"?r="justify-center":(e==null?void 0:e.align)==="end"&&(r="justify-end");const o=e==null?void 0:e.padding;return H("flex items-center overflow-hidden whitespace-nowrap overflow-ellipsis outline-none focus-visible:outline focus-visible:outline-offset-2",t,(e==null?void 0:e.width)??"flex-1",e==null?void 0:e.maxWidth,e==null?void 0:e.minWidth,r,o,e==null?void 0:e.className)}function je({index:e}){const{columns:t,sortDescriptor:r,onSortChange:o,enableSorting:n,tableStyle:i}=h.useContext(D),a=t[e],u=ee({index:e,isHeader:!0}),[s,l]=h.useState(!1),x=a.sortingKey||a.key,c=a.allowsSorting&&n,{orderBy:y,orderDir:v}=r||{},k=c&&y===x;let p;k&&v==="asc"?p="ascending":k&&v==="desc"?p="descending":c&&(p="none");const m=()=>{if(!c)return;let w;k&&v==="desc"?w={orderDir:"asc",orderBy:x}:k&&v==="asc"?w={orderBy:void 0,orderDir:void 0}:w={orderDir:"desc",orderBy:x},o==null||o(w)},P=k||s,E={visible:{opacity:1,y:0},hidden:{opacity:0,y:"-25%"}},j=i==="html"?"th":"div";return b.jsxs(j,{role:"columnheader",tabIndex:-1,"aria-colindex":e+1,"aria-sort":p,className:H(u,"text-xs font-medium text-muted",c&&"cursor-pointer"),onMouseEnter:()=>{l(!0)},onMouseLeave:()=>{l(!1)},onKeyDown:w=>{(w.key===" "||w.key==="Enter")&&(w.preventDefault(),m())},onClick:m,children:[a.hideHeader?b.jsx("div",{className:"opacity-0",children:a.header()}):a.header(),b.jsx(fe,{children:c&&b.jsx(be.span,{variants:E,animate:P?"visible":"hidden",initial:!1,transition:{type:"tween"},className:"-mt-2 ml-6 inline-block","data-testid":"table-sort-button","aria-hidden":!P,children:b.jsx(ye,{size:"xs",className:H("text-muted",v==="asc"&&y===x&&"rotate-180 transition-transform")})},"sort-icon")})]})}function Se(){const{columns:e,tableStyle:t,headerRowBg:r}=h.useContext(D),o=t==="html"?"thead":h.Fragment,n=t==="html"?"tr":"div";return b.jsx(o,{children:b.jsx(n,{role:"row","aria-rowindex":1,tabIndex:-1,className:H(t==="flex"&&"flex gap-x-16 px-16",r),children:e.map((i,a)=>b.jsx(je,{index:a},i.key))})})}function B(e){return he()?e.metaKey:e.ctrlKey}function Ie(e){const{cellCount:t,rowCount:r}=e;return{onKeyDown:n=>{switch(n.key){case"ArrowLeft":$(n,{cell:{op:"decrement"}},e);break;case"ArrowRight":$(n,{cell:{op:"increment"}},e);break;case"ArrowUp":$(n,{row:{op:"decrement"}},e);break;case"ArrowDown":$(n,{row:{op:"increment"}},e);break;case"PageUp":$(n,{row:{op:"decrement",count:5}},e);break;case"PageDown":$(n,{row:{op:"increment",count:5}},e);break;case"Tab":He(n);break;case"Home":B(n)?$(n,{row:{op:"decrement",count:r},cell:{op:"decrement",count:t}},e):$(n,{cell:{op:"decrement",count:t}},e);break;case"End":B(n)?$(n,{row:{op:"increment",count:r},cell:{op:"increment",count:t}},e):$(n,{cell:{op:"increment",count:t}},e);break}}}}function $(e,t,{cellCount:r,rowCount:o}){var k,p,m,P,E,j,w;if(((k=document.activeElement)==null?void 0:k.tagName)==="input")return;e.preventDefault();const n=e.currentTarget,i=e.target.closest("[aria-colindex]");if(!i||!n)return;const a=i.closest("[aria-rowindex]");if(!a)return;let u=parseInt(a.getAttribute("aria-rowindex")),s=parseInt(i.getAttribute("aria-colindex"));if(Number.isNaN(u)||Number.isNaN(s))return;const l=((p=t.row)==null?void 0:p.count)??1;((m=t.row)==null?void 0:m.op)==="increment"?u=Math.min(o,u+l):((P=t.row)==null?void 0:P.op)==="decrement"&&(u=Math.max(1,u-l));const x=((E=t.cell)==null?void 0:E.count)??1;((j=t.cell)==null?void 0:j.op)==="increment"?s=Math.min(r,s+x):((w=t.cell)==null?void 0:w.op)==="decrement"&&(s=Math.max(1,s-x));const c=n.querySelector(`[aria-rowindex="${u}"] [aria-colindex="${s}"]`);if(!c)return;const v=Y(c).nextNode()||c;i.setAttribute("tabindex","-1"),v.setAttribute("tabindex","0"),v.focus()}function He(e){const t=e.currentTarget;if(e.shiftKey)t.focus();else{const r=Y(t,{tabbable:!0});let o,n;do n=r.lastChild(),n&&(o=n);while(n);o&&!o.contains(document.activeElement)&&xe(o)}}function Me({index:e,isSelected:t,isHeader:r}){const o=ge(),n=Z(),{hideBorder:i,hideHeaderBorder:a,enableSelection:u,collapseOnMobile:s,onAction:l,isCollapsedMode:x,tableStyle:c}=h.useContext(D);return H(c==="flex"&&"flex gap-x-16","break-inside-avoid outline-none border border-transparent",x&&"rounded-panel",l&&"cursor-pointer",n&&s&&i?"mb-8 pl-8 pr-0 rounded":"px-16",!i&&"border-b-divider",!(a??i)&&e===0&&"border-t-divider",t&&!o&&"bg-primary/selected hover:bg-primary/focus focus-visible:bg-primary/focus",t&&o&&"bg-selected hover:bg-focus focus-visible:bg-focus",!t&&!r&&(u||l)&&"focus-visible:bg-focus hover:bg-hover")}function Ne({rowIndex:e,rowIsHovered:t,index:r,item:o,id:n}){const{columns:i,tableStyle:a}=h.useContext(D),u=i[r],s=h.useMemo(()=>({index:e,isHovered:t,isPlaceholder:o.isPlaceholder}),[e,t,o.isPlaceholder]),l=ee({index:r,isHeader:!1}),x=a==="html"?"td":"div";let c=u.body(o,s);return s.isPlaceholder||(c=b.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis",children:c})),b.jsx(x,{tabIndex:-1,role:"gridcell","aria-colindex":r+1,id:n,className:l,children:c})}function Re(e){return e.shiftKey||B(e)}const Te=["button","a","input","select","textarea"];function Ae({item:e,index:t,renderAs:r,className:o,style:n}){const{selectedRows:i,columns:a,toggleRow:u,selectRow:s,onAction:l,selectRowOnContextMenu:x,enableSelection:c,selectionStyle:y,hideHeaderRow:v,tableStyle:k}=h.useContext(D),p=h.useRef(!1),m=i.includes(e.id),[P,E]=h.useState(!1),j=d=>d.target.closest(Te.join(",")),w=d=>{y==="highlight"&&l&&!p.current&&!j(d)&&(d.preventDefault(),d.stopPropagation(),l(e,t))},A=!!i.length,M=d=>{j(d)||(y==="checkbox"?c&&(A||!l)?u(e):l&&l(e,t):y==="highlight"&&(p.current?c&&A?u(e):l==null||l(e,t):c&&s(e,Re(d))))},{domProps:L}=ve({onPointerDown:d=>{p.current=d.pointerType==="touch"},onPress:M,onLongPress:c?()=>{p.current&&u(e)}:void 0}),F=d=>{c&&d.key===" "?(d.preventDefault(),d.stopPropagation(),y==="checkbox"?u(e):s(e)):d.key==="Enter"&&!i.length&&l&&(d.preventDefault(),d.stopPropagation(),l(e,t))},V=d=>{x&&c&&(i.includes(e.id)||s(e)),p.current&&(d.preventDefault(),d.stopPropagation())},W=Me({index:t,isSelected:m}),O=r||(k==="html"?"tr":"div");return b.jsx(O,{role:"row","aria-rowindex":t+1+(v?0:1),"aria-selected":m,tabIndex:-1,className:H(o,W),item:typeof O=="string"?void 0:e,onDoubleClick:T(w),onKeyDown:T(F),onContextMenu:T(V),onPointerEnter:T(()=>E(!0)),onPointerLeave:T(()=>E(!1)),style:n,...L,children:a.map((d,z)=>b.jsx(Ne,{rowIndex:t,rowIsHovered:P,index:z,item:e},`${e.id}-${d.key}`))})}function ze({className:e,columns:t,activeColumns:r,collapseOnMobile:o=!0,hideHeaderRow:n=!1,hideHeaderBorder:i=null,headerRowBg:a,hideBorder:u=!1,data:s,selectedRows:l,defaultSelectedRows:x,onSelectionChange:c,sortDescriptor:y,onSortChange:v,enableSorting:k=!0,onDelete:p,enableSelection:m=!0,selectionStyle:P="checkbox",ariaLabelledBy:E,selectRowOnContextMenu:j,onAction:w,renderRowAs:A,tableBody:M,meta:L,tableRef:F,closeOnInteractOutside:V=!1,cellHeight:W,headerCellHeight:O,tableStyle:d="flex",...z}){const G=Z(),R=!!G&&o;R&&(n=!0,u=!0);const[g,I]=Q(l,x||[],c),[te,ne]=Q(y,void 0,v),re=h.useCallback(f=>{const C=[...g];if(!C.includes(f.id))C.push(f.id);else{const S=C.indexOf(f.id);C.splice(S,1)}I(C)},[g,I]),oe=h.useCallback((f,C)=>{let S=[];f&&(S=C?[...g==null?void 0:g.filter(N=>N!==f.id),f.id]:[f.id]),I(S)},[g,I]),K=h.useMemo(()=>{const f=t.filter(S=>{if(r&&!r.includes(S.key))return!1;const N=S.visibleInMode||"regular";if(N==="all"||N==="compact"&&R||N==="regular"&&!R)return!0});return r&&f.sort((S,N)=>{const le=r.indexOf(S.key),ce=r.indexOf(N.key);return le-ce}),m&&P!=="highlight"&&!G&&f.unshift(Ce),f},[G,t,m,P,R,r]),se={isCollapsedMode:R,cellHeight:W,headerCellHeight:O,hideHeaderBorder:i,headerRowBg:a,hideBorder:u,hideHeaderRow:n,selectedRows:g,onSelectionChange:I,enableSorting:k,enableSelection:m,selectionStyle:P,data:s,columns:K,sortDescriptor:te,onSortChange:ne,toggleRow:re,selectRow:oe,onAction:w,selectRowOnContextMenu:j,meta:L,collapseOnMobile:o,tableStyle:d},ie=Ie({cellCount:m?K.length+1:K.length,rowCount:s.length+1}),U={renderRowAs:A};M?M=h.cloneElement(M,U):M=b.jsx(Oe,{...U});const q=pe(F);ke({ref:q,onInteractOutside:f=>{V&&m&&(g!=null&&g.length)&&!f.target.closest('[role="dialog"]')&&I([])}});const ae=d==="html"?"table":"div";return b.jsx(D.Provider,{value:se,children:b.jsxs(ae,{...me(z,ie,{onKeyDown:f=>{f.key==="Escape"?(f.preventDefault(),f.stopPropagation(),g!=null&&g.length&&I([])):f.key==="Delete"?(f.preventDefault(),f.stopPropagation(),g!=null&&g.length&&(p==null||p(s.filter(C=>g==null?void 0:g.includes(C.id))))):B(f)&&f.key==="a"&&(f.preventDefault(),f.stopPropagation(),m&&I(s.map(C=>C.id)))}}),tabIndex:0,role:"grid","aria-rowcount":s.length+1,"aria-colcount":K.length+1,ref:q,"aria-multiselectable":m?!0:void 0,"aria-labelledby":E,className:H(e,"isolate w-full select-none text-sm outline-none focus-visible:ring-2"),children:[!n&&b.jsx(Se,{}),M]})})}function Oe({renderRowAs:e}){const{data:t,tableStyle:r}=h.useContext(D),o=r==="html"?"tbody":h.Fragment;return b.jsx(o,{children:t.map((n,i)=>b.jsx(Ae,{item:n,index:i,renderAs:e},n.id))})}export{ze as T,D as a,B as b,Re as i};
