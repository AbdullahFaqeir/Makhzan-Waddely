import{ap as b,ar as q,aJ as f,x as o,ax as k,cX as H,k as y,a3 as Q,aF as z,a8 as P,j as e,M as R,Q as $,T as a,R as K,ao as M,aa as O,a4 as j,B as h,aq as T,aA as W,L as D,c as V,az as w,am as G,aD as p,J as x,D as c,g as J,r as S,ce as E,a2 as X,cH as Y}from"./main-BdzhGpqn.js";import{t as Z}from"./team-DYmDDGxN.js";import{F as ee}from"./image-selector-D4wNsD_9.js";import{D as se}from"./dialog-footer-DL2JkwrZ.js";import{F as ae}from"./file-upload-provider-Cq9bpz4o.js";import{B as te,u as re}from"./use-unban-users-6DVKVEBn.js";import{C as v}from"./confirmation-dialog-DtIJ4lxn.js";import{N as oe}from"./name-with-avatar-oLONXEoV.js";import{a as ie}from"./form-chip-field-Bj0OQHU9.js";import{F as C}from"./formatted-date-hsbUwQxj.js";import{E as ne}from"./Edit-AfuLMjS-.js";import{L as le}from"./Login-DhVXLpJA.js";import{P as N}from"./PersonOff-Bn-NXlZw.js";import{a as l,F}from"./select-filter-panel-BD_PypVS.js";import{c as me,u as de}from"./timestamp-filters-Bn_q9MOg.js";import{u as ce,a as ue,G as pe,D as xe,b as ge,c as je}from"./use-datatable-query-CL53W5gM.js";import{D as he}from"./data-table-export-csv-button-DiZ_bwz3.js";import{D as be}from"./data-table-add-item-button-DnF2ZiVm.js";import{D as fe}from"./datatable-filters-Cd3MyVOw.js";import{a as ye,D as ve,b as De,c as we}from"./datatable-page-with-header-layout-T5QYry_g.js";import{T as Se}from"./table-BV_6nbvK.js";import"./use-active-upload-DEBAs0lx.js";import"./open-upload-window-DBvxFCUj.js";import"./uploaded-file-BYIHeonQ.js";import"./shallow-DE7pCYeO.js";import"./AddAPhoto-DuYWQYIn.js";import"./progress-bar-base-LbuncwuG.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./date-picker-BiDllGjz.js";import"./use-current-date-time-CnLDai64.js";import"./use-date-formatter-BlrPWK68.js";import"./DateRange-DT2RCJ3g.js";import"./use-base-date-picker-state-DYteqbZD.js";import"./input-CDTJ1VfY.js";import"./KeyboardArrowRight-DFizyHtY.js";import"./switch-DFT-JawA.js";import"./use-normalized-models-yOhv1j4Y.js";import"./ArrowRightAlt-DSM1kJ5L.js";import"./use-date-range-picker-state-CEbm743A.js";import"./list-DRfBegha.js";import"./select-l28gQBMg.js";import"./skeleton-CTimao-U.js";import"./formatted-number-pJC-IR-x.js";import"./FilterAlt-BkhHIgY7.js";import"./accordion-DxYXjiZR.js";import"./checkbox-B6q4SJqi.js";import"./CheckBoxOutlineBlank-DvnJQjlB.js";import"./FileDownload-CzvSUcXm.js";import"./download-file-from-url-BVaKcxRP.js";import"./Add-iOynMxF0.js";import"./dashboard-layout-context-DDiFtkN0.js";import"./use-toggle-dashboard-left-sidebar-Dzdho4R0.js";import"./ArrowDownward-DXr7353z.js";import"./useEffectEvent-D8HiMrwe.js";import"./use-pointer-events-Dsln3OKq.js";import"./useGlobalListeners-C14jVC5X.js";function Ce(s){return b({mutationFn:t=>Fe(t),onSuccess:()=>{f(o("User created")),k.invalidateQueries({queryKey:H.users.invalidateKey})},onError:t=>q(t,s)})}function Fe(s){return s.roles&&(s.roles=s.roles.map(t=>t.id)),y.post("users",s).then(t=>t.data)}function Ie(){const s=Q(),t=Ce(s),r=z(),{close:i,formId:n}=P();return e.jsxs(R,{children:[e.jsx($,{children:e.jsx(a,{message:"Create user"})}),e.jsx(K,{children:e.jsxs(M,{id:n,form:s,onSubmit:m=>{t.mutate(m,{onSuccess:g=>{i(),r(`${g.user.id}`,{replace:!0})}})},children:[e.jsx(ae,{children:e.jsx(ee,{className:"mb-24",name:"image",uploadType:O.avatars,label:e.jsx(a,{message:"Avatar"}),showRemoveButton:!0})}),e.jsx(j,{required:!0,className:"mb-24",name:"email",type:"email",label:e.jsx(a,{message:"Email"})}),e.jsx(j,{className:"mb-24",name:"name",label:e.jsx(a,{message:"Name"})}),e.jsx(j,{required:!0,name:"password",type:"password",label:e.jsx(a,{message:"Password"})})]})}),e.jsxs(se,{children:[e.jsx(h,{variant:"outline",onClick:()=>i(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(h,{variant:"flat",color:"primary",type:"submit",form:n,disabled:t.isPending,children:e.jsx(a,{message:"Create"})})]})]})}function Ue(){return b({mutationFn:s=>ke(s),onSuccess:async s=>{f(o(`Impersonating user "${s.user.name}"`)),window.location.href="/"},onError:s=>T(s)})}function ke(s){return y.post(`admin/users/impersonate/${s.userId}`,s).then(t=>t.data)}function Pe({user:s}){const t=Ue();return e.jsx(v,{title:e.jsx(a,{message:"Impersonate user"}),isLoading:t.isPending,body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(a,{message:"Are you sure you want to login as this user?"})}),e.jsx("p",{className:"mt-8",children:e.jsx(a,{message:"This will log you out of your current account and log you in as the user."})})]}),confirm:e.jsx(a,{message:"Login"}),onConfirm:()=>{t.mutate({userId:s.id})}})}const I=[{key:"name",allowsSorting:!0,sortingKey:"email",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(a,{message:"User"}),body:s=>e.jsx(oe,{image:s.image,label:s.name,description:s.email,alwaysShowAvatar:!0,avatarCircle:!0})},{key:"roles",header:()=>e.jsx(a,{message:"Roles"}),body:s=>{var t;return e.jsx(ie,{radius:"rounded",size:"xs",children:(t=s==null?void 0:s.roles)==null?void 0:t.map(r=>e.jsx(W,{selectable:!0,children:e.jsx(D,{className:V("capitalize"),target:"_blank",to:`/admin/roles/${r.id}/edit`,children:e.jsx(a,{message:r.name})})},r.id))})}},{key:"subscribed",header:()=>e.jsx(a,{message:"Subscribed"}),width:"w-96",body:s=>{var t;return(t=s.subscriptions)!=null&&t.filter(r=>r.valid).length?e.jsx(w,{className:"text-positive icon-md"}):e.jsx(G,{className:"text-danger icon-md"})}},{key:"banned_at",allowsSorting:!0,header:()=>e.jsx(a,{message:"Suspended"}),width:"w-96",body:s=>s.banned_at?e.jsx(w,{className:"text-danger icon-md"}):null},{key:"latest_active_session",width:"w-110",header:()=>e.jsx(a,{message:"Last active"}),body:s=>s.latest_active_session?e.jsx("time",{children:e.jsx(C,{date:s.latest_active_session.updated_at})}):"-"},{key:"created_at",allowsSorting:!0,width:"w-110",header:()=>e.jsx(a,{message:"Created at"}),body:s=>e.jsx("time",{children:e.jsx(C,{date:s.created_at})})},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),width:"w-128 flex-shrink-0",hideHeader:!0,align:"end",visibleInMode:"all",body:s=>e.jsxs("div",{className:"text-muted",children:[e.jsx(D,{to:`${s.id}/details`,children:e.jsx(p,{label:e.jsx(a,{message:"Edit user"}),children:e.jsx(x,{size:"md",children:e.jsx(ne,{})})})}),s.banned_at?e.jsx(Te,{user:s}):e.jsxs(c,{type:"modal",children:[e.jsx(p,{label:e.jsx(a,{message:"Suspend user"}),children:e.jsx(x,{size:"md",children:e.jsx(N,{})})}),e.jsx(te,{userIds:[s.id]})]}),e.jsx(Ee,{user:s})]})}];function Te({user:s}){const t=re([s.id]);return e.jsxs(c,{type:"modal",onClose:r=>{r&&t.mutate()},children:[e.jsx(p,{label:e.jsx(a,{message:"Remove suspension"}),children:e.jsx(x,{size:"md",color:"danger",children:e.jsx(N,{})})}),e.jsx(v,{isDanger:!0,title:e.jsx(a,{message:"Suspend “:name“",values:{name:s.name}}),body:e.jsx(a,{message:"Are you sure you want to remove suspension from this user?"}),confirm:e.jsx(a,{message:"Unsuspend"})})]})}function Ee({user:s}){return e.jsxs(c,{type:"modal",children:[e.jsx(p,{label:e.jsx(a,{message:"Login as user"}),children:e.jsx(x,{size:"md",children:e.jsx(le,{})})}),e.jsx(Pe,{user:s})]})}const U=[{key:"email_verified_at",label:o("Email"),description:o("Email verification status"),defaultOperator:l.ne,control:{type:F.Select,defaultValue:"01",options:[{key:"01",label:o("is confirmed"),value:{value:null,operator:l.ne}},{key:"02",label:o("is not confirmed"),value:{value:null,operator:l.eq}}]}},me({description:o("Date user registered or was created")}),de({description:o("Date user was last updated")}),{key:"subscriptions",label:o("Subscription"),description:o("Whether user is subscribed or not"),defaultOperator:l.eq,control:{type:F.Select,defaultValue:"01",options:[{key:"01",label:o("is subscribed"),value:{value:"*",operator:l.has}},{key:"02",label:o("is not subscribed"),value:{value:"*",operator:l.doesntHave}}]}}];function Ls(){const{billing:s}=J(),[t,r]=S.useState([]),{searchParams:i,sortDescriptor:n,mergeIntoSearchParams:m,setSearchQuery:g,isFiltering:_}=ce(Y),A=s.enable?I:I.filter(d=>d.key!=="subscribed"),u=ue(E.users.index(i)),B=e.jsxs(c,{type:"modal",children:[e.jsx(h,{variant:"flat",color:"danger",children:e.jsx(a,{message:"Delete"})}),e.jsx(Ne,{selectedIds:t,onDelete:()=>r([])})]}),L=e.jsxs(S.Fragment,{children:[e.jsx(he,{endpoint:"users/csv/export"}),e.jsxs(c,{type:"modal",children:[e.jsx(be,{children:e.jsx(a,{message:"Add new user"})}),e.jsx(Ie,{})]})]});return e.jsxs(ye,{children:[e.jsx(pe,{query:u}),e.jsx(X,{children:e.jsx(a,{message:"Users"})}),e.jsx(ve,{title:e.jsx(a,{message:"Users"}),showSidebarToggleButton:!0}),e.jsxs(De,{children:[e.jsx(xe,{searchValue:i.query,onSearchChange:g,actions:L,selectedItems:t,selectedActions:B,filters:U}),e.jsx(fe,{filters:U}),e.jsxs(we,{children:[e.jsx(Se,{columns:A,data:u.items,sortDescriptor:n,onSortChange:m,enableSelection:!0,selectedRows:t,onSelectionChange:r}),u.isEmpty&&e.jsx(ge,{isFiltering:_,image:Z,title:e.jsx(a,{message:"No users have been created yet"}),filteringTitle:e.jsx(a,{message:"No matching users"})}),e.jsx(je,{query:u,onPageChange:d=>m({page:d}),onPerPageChange:d=>m({perPage:d})})]})]})]})}function Ne({selectedIds:s,onDelete:t}){const{close:r}=P(),i=b({mutationFn:()=>y.delete(`users/${s.join(",")}`),onSuccess:async()=>{await k.invalidateQueries({queryKey:E.users.invalidateKey}),f(o("Users deleted")),t(),r()},onError:n=>T(n)});return e.jsx(v,{isDanger:!0,isLoading:i.isPending,title:e.jsx(a,{message:"Delete users"}),body:e.jsx(a,{message:"Are you sure you want to delete selected users?",values:{count:s.length}}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>i.mutate()})}export{Ls as Component,Ne as DeleteUsersDialog};
