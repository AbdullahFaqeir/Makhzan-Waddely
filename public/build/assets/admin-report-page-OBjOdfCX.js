const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./lazy-chart-CaAuEhMY.js","./main-BdzhGpqn.js","./main-BPqvtJUK.css"])))=>i.map(i=>d[i]);
import{r as c,w as K,$,j as t,x as v,T as g,a as Z,c as y,A as J,y as V,z as B,G as O,D as q,B as W,P as X,H as k,I as Y,J as ee,M as te,Q as se,R as ae,g as re,V as ne,W as E,X as L,_ as oe,Y as ie,Z as le,a0 as ce,e as me,a1 as ue,k as de,a2 as fe}from"./main-BdzhGpqn.js";import{T as xe,a as ge,b as pe}from"./TrendingFlat-fpHUNt5V.js";import{F as A}from"./formatted-number-pJC-IR-x.js";import{F as he}from"./formatted-bytes-n7lOD0MA.js";import{S as je}from"./skeleton-CTimao-U.js";import{g as H}from"./use-current-date-time-CnLDai64.js";import{F as be,u as S,D as ve,a as ye,b as we}from"./use-date-range-picker-state-CEbm743A.js";import{D as De}from"./formatted-date-hsbUwQxj.js";import{D as Ce}from"./DateRange-DT2RCJ3g.js";import{A as Ne}from"./ArrowBack-V0Wwapyg.js";import{$ as Te}from"./use-date-formatter-BlrPWK68.js";import{D as $e}from"./datatable-page-with-header-layout-T5QYry_g.js";import"./pretty-bytes-bO14ePu9.js";import"./list-DRfBegha.js";import"./switch-DFT-JawA.js";import"./ArrowRightAlt-DSM1kJ5L.js";import"./dialog-footer-DL2JkwrZ.js";import"./use-base-date-picker-state-DYteqbZD.js";import"./input-CDTJ1VfY.js";import"./KeyboardArrowRight-DFizyHtY.js";import"./dashboard-layout-context-DDiFtkN0.js";import"./use-toggle-dashboard-left-sidebar-Dzdho4R0.js";const ke=c.memo(({minutes:e,seconds:a,ms:s,startDate:r,endDate:n,verbose:o=!1,addZeroToFirstUnit:m=!0,isLive:i,maxIsLiveMs:u,minDuration:l=0,liveInterval:f=5e3})=>{const{trans:p}=K(),d=c.useMemo(()=>{if(r||n){const z=r?$(r):H(),T=(n?$(n):H()).toDate().getTime()-z.toDate().getTime();return T>l?T:l}return e?e*6e4:a?a*1e3:s||l},[e,a,s,r,n,l]),[j,R]=c.useState(d);c.useEffect(()=>{R(d)},[d]);const N=c.useRef(j);N.current=j,c.useEffect(()=>{const z=u&&N.current>u;if(i&&!z){const P=setInterval(()=>{R(T=>T+f)},f);return()=>clearInterval(P)}},[i,f,u,d]);const b=j<0?-j:j,C={days:Math.trunc(b/864e5),hours:Math.trunc(b/36e5)%24,minutes:Math.trunc(b/6e4)%60,seconds:Math.trunc(b/1e3)%60};let w;return o?w=Re(C,p):w=ze(C,m),t.jsx(c.Fragment,{children:w})});function Re(e,a){const s=[];return e.days&&s.push(`${e.days}${a(v("d"))}`),e.hours&&s.push(`${e.hours}${a(v("hr"))}`),e.minutes&&s.push(`${e.minutes}${a(v("min"))}`),e.seconds&&!e.hours&&s.push(`${e.seconds}${a(v("sec"))}`),s.join(" ")}function ze(e,a=!0){const s=D(e.seconds);let r="";return e.days&&!r&&(r=`${e.days}:${D(e.hours)}:${D(e.minutes)}:${s}`),e.hours&&!r&&(r=`${D(e.hours,a)}:${D(e.minutes)}:${s}`),r||(r=`${D(e.minutes,a)}:${s}`),r}function D(e,a=!0){if(!a)return e;let s=`${e}`;return s.length===1&&(s="0"+s),s}function Ae({report:e,isLoading:a}){return e?t.jsx(c.Fragment,{children:e==null?void 0:e.map(s=>t.jsx(Ie,{icon:s.icon,type:s.type,currentValue:s.currentValue,previousValue:s.previousValue,percentageChange:s.percentageChange,isLoading:a,children:t.jsx(g,{message:s.name})},s.name))}):t.jsx("div",{className:"col-span-12 row-span-3"})}function Ie({icon:e,children:a,type:s,currentValue:r,previousValue:n,percentageChange:o,isLoading:m=!1,colSpan:i="col-span-3",rowSpan:u="row-span-3"}){let l;if(e)if(c.isValidElement(e))l=c.cloneElement(e,{size:"sm"});else{const f=Z(e);l=f?t.jsx(f,{size:"sm"}):null}return t.jsxs("div",{className:y("compact-scrollbar flex flex-col justify-between overflow-x-auto overflow-y-hidden whitespace-nowrap rounded-panel border px-20 py-14",i,u),children:[t.jsxs("div",{className:"flex items-center gap-6",children:[l,t.jsx("h2",{className:"text-sm font-semibold",children:a})]}),t.jsxs("div",{className:"flex gap-10",children:[t.jsx("div",{className:"text-4xl font-medium text-main",children:t.jsx(J,{initial:!1,mode:"wait",children:m?t.jsx(V.div,{...B,children:t.jsx(je,{className:"min-w-40"})},"skeleton"):t.jsx(V.div,{...B,children:t.jsx(Fe,{type:s,value:r})},"value")})}),r!=null&&(o!=null||n!=null)&&t.jsx("div",{className:"flex items-center gap-10",children:t.jsx(Me,{currentValue:r,previousValue:n,percentageChange:o})})]})]})}function Fe({type:e,value:a}){if(a==null)return"â€”";switch(e){case"fileSize":return t.jsx(he,{bytes:a});case"percentage":return t.jsx(A,{value:a,style:"percent",maximumFractionDigits:1});case"durationInSeconds":return t.jsx(ke,{seconds:a,verbose:!0});default:return t.jsx(A,{value:a})}}function Me(e){const a=Pe(e);let s;return a>0?s=t.jsx(xe,{size:"md",className:"text-positive"}):a===0?s=t.jsx(ge,{className:"text-muted"}):s=t.jsx(pe,{className:"text-danger"}),t.jsxs(c.Fragment,{children:[s,t.jsxs("div",{className:"text-sm font-semibold text-muted",children:[a,"%"]})]})}function Pe({percentageChange:e,previousValue:a,currentValue:s}){return e!=null||a==null||s==null?e??0:a===0?100:Math.round((s-a)/a*100)}const Ve={month:"short",day:"2-digit"};function Be({value:e,onChange:a,disabled:s,compactOnMobile:r=!0,enableCompare:n=!1,granularity:o="minute"}){const m=O();return t.jsxs(q,{type:"popover",onClose:i=>{i&&a(i)},children:[t.jsx(W,{variant:"outline",color:"chip",endIcon:t.jsx(Ce,{}),disabled:s,children:t.jsx(be,{start:e.start,end:e.end,options:m&&r?Ve:De.short})}),t.jsx(Ee,{value:e,enableCompare:n,granularity:o})]})}function Ee({value:e,enableCompare:a,granularity:s}){const r=O(),n=S({granularity:s,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),o=!!e.compareStart&&!!e.compareEnd,m=S({granularity:s,defaultValue:o?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:ve[0].getRangeValue(n.selectedValue)});return t.jsx(ye,{state:n,compareState:a?m:void 0,compareVisibleDefault:o,showInlineDatePickerField:!r})}function Q(e){const{title:a,description:s,children:r,className:n,contentIsFlex:o=!0,contentClassName:m,contentRef:i}=e;return t.jsxs("div",{className:y("flex flex-auto flex-col rounded-panel border bg-elevated p-20",n),children:[t.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between pb-10 text-xs",children:[t.jsx("div",{className:"text-sm font-semibold",children:a}),s&&t.jsx("div",{className:"text-muted",children:s})]}),t.jsx("div",{ref:i,className:y("relative",o&&"flex flex-auto items-center justify-center",m),children:r})]})}function I(){return t.jsxs("div",{className:"absolute mx-auto flex items-center gap-10 text-sm",children:[t.jsx(X,{isIndeterminate:!0,size:"sm"}),t.jsx(g,{message:"Chart loading"})]})}const Le=c.memo(({code:e})=>{const{localeCode:a}=k(),s=new Intl.DisplayNames([a],{type:"region"});let r;try{r=s.of(e.toUpperCase())}catch{}return t.jsx(c.Fragment,{children:r})}),He=Y(t.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger");function Se({title:e,body:a,dialogSize:s="sm",className:r}){return t.jsxs(q,{type:"popover",triggerOnHover:!0,children:[t.jsx(ee,{className:y("ml-4 text-muted opacity-70",r),iconSize:"xs",size:"2xs",children:t.jsx(He,{viewBox:"0 0 16 16"})}),t.jsxs(te,{size:s,children:[e&&t.jsx(se,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:e}),t.jsx(ae,{children:a})]})]})}const _="https://www.gstatic.com/charts/loader.js";function _e({placeholderRef:e,data:a,country:s,onCountrySelected:r}){const{trans:n}=K(),{analytics:o}=re(),m=o==null?void 0:o.gchart_api_key,{selectedTheme:i}=ne(),u=c.useRef(null),l=!!r&&!s,f=c.useCallback(()=>{var b,C;if(typeof google>"u")return;const d=a.map(w=>[w.label,w.value]);d.unshift([n(s?v("City"):v("Country")),n(v("Clicks"))]);const j=`${E(i.values["--be-bg-elevated"])}`,N={colorAxis:{colors:[`${E(i.values["--be-primary"])}`]},backgroundColor:j,region:s?s.toUpperCase():void 0,resolution:s?"provinces":"countries",displayMode:s?"markers":"regions",enableRegionInteractivity:l};!u.current&&e.current&&((b=google==null?void 0:google.visualization)!=null&&b.GeoChart)&&(u.current=new google.visualization.GeoChart(e.current)),(C=u.current)==null||C.draw(google.visualization.arrayToDataTable(d),N)},[i,a,e,n,s,l]),p=c.useCallback(async()=>{L.isLoadingOrLoaded(_)||(await L.loadAsset(_,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:m}),f())},[m,f]);return c.useEffect(()=>(u.current&&r&&google.visualization.events.addListener(u.current,"regionClick",d=>r==null?void 0:r(d.region)),()=>{u.current&&google.visualization.events.removeAllListeners(u.current)}),[r,u.current]),c.useEffect(()=>{p()},[p]),c.useEffect(()=>{f()},[i,f,a]),{drawGoogleChart:f}}function Ge({data:e,isLoading:a,onCountrySelected:s,country:r,className:n,colSpan:o="col-span-7",rowSpan:m="row-span-11",...i}){const u=c.useRef(null),l=!!s,f=e==null?void 0:e.datasets[0].data,p=c.useMemo(()=>f||[],[f]);return _e({placeholderRef:u,data:p,country:r,onCountrySelected:s}),t.jsxs(Q,{...i,className:y(n,o,m,"compact-scrollbar overflow-x-auto overflow-y-hidden"),title:t.jsxs("div",{className:"flex items-center",children:[t.jsx(g,{message:"Top Locations"}),r?t.jsxs("span",{className:"pl-4",children:["(",t.jsx(Le,{code:r}),")"]}):null,l&&t.jsx(Ke,{})]}),contentIsFlex:a,children:[a&&t.jsx(I,{}),t.jsxs("div",{className:"flex gap-24",children:[t.jsx("div",{ref:u,className:"min-h-[340px] w-[480px] flex-auto"}),t.jsxs("div",{className:"w-[170px]",children:[t.jsx("div",{className:"max-h-[340px] w-full flex-initial overflow-y-auto text-sm",children:p.map(d=>t.jsxs("div",{className:y("mb-4 flex items-center gap-4",l&&"cursor-pointer hover:underline"),role:l?"button":void 0,onClick:()=>{s==null||s(d.code)},children:[t.jsx("div",{className:"max-w-110 overflow-hidden overflow-ellipsis whitespace-nowrap",children:d.label}),t.jsxs("div",{children:["(",d.percentage,")%"]})]},d.label))}),r&&t.jsx(W,{variant:"outline",size:"xs",className:"mt-14",startIcon:t.jsx(Ne,{}),onClick:()=>{s==null||s(void 0)},children:t.jsx(g,{message:"Back to countries"})})]})]})]})}function Ke(){return t.jsx(Se,{title:t.jsx(g,{message:"Zooming in"}),body:t.jsx(g,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const Oe=c.lazy(()=>oe(()=>import("./lazy-chart-CaAuEhMY.js"),__vite__mapDeps([0,1,2]),import.meta.url));function F(e){const{title:a,description:s,className:r,rowSpan:n="row-span-11",colSpan:o="col-span-6",contentRef:m,isLoading:i}=e;return t.jsx(Q,{title:a,description:s,className:y(r,n,o),contentRef:m,children:t.jsxs(c.Suspense,{fallback:t.jsx(I,{}),children:[t.jsx(Oe,{...e}),i&&t.jsx(I,{})]})})}const G=ie().themes[0].values["--be-primary"],h=[[`rgb(${G.replaceAll(" ",",")})`,`rgba(${G.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]];function M(e,{localeCode:a="en",shareFirstDatasetLabels:s=!0}){if(!e)return{datasets:[]};const r=[];return{...e,datasets:e.datasets.map((n,o)=>{const m=n.data.map((i,u)=>{let l;return o===0||!s?(l=qe(i,e.granularity,a),r[u]=l):l=r[u],{...l,value:i.value}});return{...n,data:m}})}}function qe(e,a,s){return e.label?{label:e.label}:e.date?We(e,a,s):{label:""}}function We({date:e,endDate:a},s="day",r){const n=$(e).toDate(),o=a?$(a).toDate():null;switch(s){case"minute":return{label:x(r,{second:"2-digit"}).format(n),tooltipTitle:x(r,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(n)};case"hour":return{label:x(r,{hour:"numeric",minute:"numeric"}).format(n),tooltipTitle:x(r,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(n)};case"day":return{label:x(r,{day:"2-digit",weekday:"short"}).format(n),tooltipTitle:x(r,{day:"2-digit",weekday:"short",month:"short"}).format(n)};case"week":return{label:x(r,{month:"short",day:"2-digit"}).format(n),tooltipTitle:x(r,{day:"2-digit",month:"long",year:"numeric"}).formatRange(n,o)};case"month":return{label:x(r,{month:"short",year:"numeric"}).format(n),tooltipTitle:x(r,{month:"long",year:"numeric"}).format(n)};case"year":return{label:x(r,{year:"numeric"}).format(n),tooltipTitle:x(r,{year:"numeric"}).format(n)}}}const x=le((e,a)=>new Te(e,a),{equals:(e,a)=>ce(e,a)});function Qe({data:e,direction:a="vertical",individualBarColors:s=!1,className:r,...n}){const{localeCode:o}=k(),m=c.useMemo(()=>{const l=M(e,{localeCode:o});return l.datasets=l.datasets.map((f,p)=>({...f,backgroundColor:s?h.map(d=>d[1]):h[p][1],borderColor:s?h.map(d=>d[0]):h[p][0],borderWidth:2})),l},[e,o,s]),i=a==="horizontal",u=c.useMemo(()=>({indexAxis:i?"y":"x",parsing:{xAxisKey:i?"value":"label",yAxisKey:i?"label":"value"}}),[i]);return t.jsx(F,{type:"bar",className:r,data:m,options:u,...n})}const Ue={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function Ze({data:e,...a}){const{localeCode:s}=k(),r=c.useMemo(()=>{const n=M(e,{localeCode:s});return n.datasets=n.datasets.map((o,m)=>({...o,backgroundColor:h[m][1],borderColor:h[m][0],pointBackgroundColor:h[m][0]})),n},[e,s]);return t.jsx(F,{...a,data:r,type:"line",options:Ue})}const Je={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function Xe({data:e,className:a,...s}){const{localeCode:r}=k(),n=c.useMemo(()=>{var m;const o=M(e,{localeCode:r});return o.labels=(m=o.datasets[0])==null?void 0:m.data.map(i=>i.label),o.datasets=o.datasets.map((i,u)=>({...i,backgroundColor:h.map(l=>l[1]),borderColor:h.map(l=>l[0]),borderWidth:2})),o},[e,r]);return t.jsx(F,{type:"polarArea",data:n,options:Je,className:a,...s})}function Ye({report:e,isLoading:a}){const s=e==null?void 0:e.pageViews.total;return t.jsxs(t.Fragment,{children:[t.jsx(Ze,{colSpan:"col-span-8",isLoading:a,data:e==null?void 0:e.pageViews,title:t.jsx(g,{message:"Pageviews"}),description:s?t.jsx(g,{message:":count total views",values:{count:t.jsx(A,{value:s})}}):null}),t.jsx(Xe,{colSpan:"col-span-4",isLoading:a,data:e==null?void 0:e.devices,title:t.jsx(g,{message:"Top devices"})}),t.jsx(Ge,{colSpan:"col-span-7",isLoading:a,data:e==null?void 0:e.locations,title:t.jsx(g,{message:"Top locations"})}),t.jsx(Qe,{colSpan:"col-span-5",isLoading:a,data:e==null?void 0:e.browsers,direction:"horizontal",individualBarColors:!0,hideLegend:!0,title:t.jsx(g,{message:"Top browsers"})})]})}const U="admin/reports";function et(e={}){return me({queryKey:[U,e],queryFn:()=>tt(e),placeholderData:ue})}function tt({types:e,dateRange:a}){const s={};return e&&(s.types=e.join(",")),a&&(s.startDate=a.start.toAbsoluteString(),s.endDate=a.end.toAbsoluteString(),s.timezone=a.start.timeZone),de.get(U,{params:s}).then(r=>r.data)}function Ct(){const[e,a]=c.useState(()=>we[2].getRangeValue()),{isLoading:s,data:r}=et({dateRange:e}),n=t.jsx(g,{message:"Visitors report"});return t.jsxs("div",{className:"flex h-full flex-col",children:[t.jsx(fe,{children:n}),t.jsx($e,{showSidebarToggleButton:!0,title:n,rightContent:t.jsx(Be,{value:e,onChange:a})}),t.jsxs("div",{className:"chart-grid flex-auto overflow-auto p-12 md:p-24",children:[t.jsx(Ae,{report:r==null?void 0:r.headerReport}),t.jsx(Ye,{report:r==null?void 0:r.visitorsReport,isLoading:s})]})]})}export{Ct as Component};
