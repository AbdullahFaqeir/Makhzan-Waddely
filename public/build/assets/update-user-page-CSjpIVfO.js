import{w as v,an as x,ao as g,av as b,aH as D,x as m,k as j,r as d,j as e,D as T,ai as S,B as U,T as i,a_ as w,aj as I,a5 as c,ar as A,a7 as C,aD as N,ay as P,cn as y,a9 as B,aC as E,l as O,g as z,L as F,O as R,cc as _,a1 as k}from"./main-owSUWNVS.js";import{a as q}from"./crupdate-resource-layout-G1oL7yCW.js";import{u as H,B as L}from"./use-unban-users-BcVGO_qK.js";import{D as M}from"./paginated-resources-SauKRGLr.js";import{C as Q}from"./confirmation-dialog-DdZaouVf.js";import{I as K}from"./image-selector-DcLehUop.js";import{F as $}from"./file-upload-provider-B2470Xt4.js";import{u as V}from"./use-url-backed-tabs-Dvact2xK.js";import{T as G,a as J,b as W}from"./tabs-CAX8nIFM.js";import{u as X}from"./use-required-params-BWJ6Ts-l.js";import{u as Y}from"./useSuspenseQuery-BjTtEPeK.js";import{B as Z,a as p}from"./breadcrumb-Bnfa8bCQ.js";import"./datatable-page-with-header-layout-68nRfBM1.js";import"./dashboard-layout-context-Cg5RoSzJ.js";import"./use-toggle-dashboard-left-sidebar-B95u609v.js";import"./date-picker-DHqKAJpp.js";import"./use-current-date-time-lVcX-4fw.js";import"./use-date-formatter-BiXQj-wq.js";import"./DateRange-6Lw_fZZT.js";import"./dialog-footer-D_t7V-bM.js";import"./use-base-date-picker-state-Cn_aBnWX.js";import"./input-4Oo6Fyef.js";import"./KeyboardArrowRight-ChYgp5kQ.js";import"./switch-DbAW1G8x.js";import"./use-active-upload-D5c4dCmN.js";import"./open-upload-window-Ckg_K7W2.js";import"./uploaded-file-0zTC6Yq4.js";import"./shallow-2-UK8gGu.js";import"./AddAPhoto-DEBtVm9g.js";import"./progress-bar-base-BNUfzFdJ.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./useEffectEvent-BzNFWHXk.js";import"./ChevronRight-C9FzEt6s.js";import"./MoreHoriz-DuK_U7d6.js";function ee(){const{trans:s}=v();return x({mutationFn:a=>se(a.userId),onSuccess:async()=>{await b.invalidateQueries({queryKey:M("users")}),D(s(m("User deleted")))},onError:a=>g(a)})}function se(s){return j.delete(`users/${s}`).then(a=>a.data)}function ae({user:s,children:a}){const t=H([s.id]),n=s.banned_at!==null,[o,r]=d.useState(!1);return e.jsxs(d.Fragment,{children:[e.jsx(T,{type:"modal",isOpen:o,onOpenChange:r,children:e.jsx(te,{userId:s.id})}),e.jsxs(S,{children:[e.jsx(U,{className:"ml-auto",variant:"outline",size:"sm",endIcon:e.jsx(w,{}),children:e.jsx(i,{message:"Actions"})}),e.jsxs(I,{children:[a,e.jsx(c,{value:"toggleSuspension",onSelected:()=>{n?t.mutate():A(L,{userIds:[s.id]})},children:n?e.jsx(i,{message:"Unsuspend user"}):e.jsx(i,{message:"Suspend user"})}),e.jsx(c,{value:"delete",onSelected:()=>{r(!0)},children:e.jsx(i,{message:"Delete user"})})]})]})]})}function te({userId:s}){const a=ee(),{close:t}=C(),n=N();return e.jsx(Q,{isDanger:!0,isLoading:a.isPending,title:e.jsx(i,{message:"Delete user"}),confirm:e.jsx(i,{message:"Delete"}),body:e.jsx(i,{message:"Are you sure you want to delete this user?"}),onConfirm:()=>{a.mutate({userId:s},{onSuccess:()=>{t(),n("..",{relative:"path"})}})}})}function re({user:s,badge:a}){var o,r,u;const t=s.banned_at!==null,n=(r=(o=s.bans)==null?void 0:o[0])==null?void 0:r.comment;return e.jsxs("div",{className:"container mx-auto mb-44 mt-38 flex-shrink-0 px-24",children:[e.jsxs("div",{className:"flex gap-32",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ie,{user:s}),e.jsx("div",{className:"absolute right-0 top-2",children:a})]}),e.jsxs("div",{children:[!!((u=s.roles)!=null&&u.length)&&e.jsx(P,{radius:"rounded-panel",size:"sm",className:"mb-6 w-max",children:s.roles[0].name}),e.jsx("h1",{className:"text-2xl font-semibold",children:s.name}),e.jsx("div",{className:"mt-4 text-sm text-muted",children:s.email})]})]}),t&&e.jsxs("div",{className:"mt-24 flex w-max items-center gap-8 rounded-panel bg-danger-lighter px-10 py-6 text-sm text-danger-darker",children:[e.jsx(y,{size:"sm"}),n?e.jsx(i,{message:"Suspended: :reason",values:{reason:n}}):e.jsx(i,{message:"Suspended"})]})]})}function ie({user:s}){const[a,t]=d.useState(s.image),n=ne(s.id);return e.jsx($,{children:e.jsx(K,{value:a,uploadType:B.avatars,variant:"avatar",stretchPreview:!0,previewSize:"w-90 h-90",placeholderIcon:e.jsx(E,{label:s.name,size:"w-full h-full text-2xl",circle:!0}),showRemoveButton:!0,onChange:(o,r)=>{t(r==null?void 0:r.url),n.mutate({image:(r==null?void 0:r.url)??null,image_entry_id:(r==null?void 0:r.id)??null})}})})}function ne(s){return x({mutationFn:a=>j.put(`users/${s}`,a).then(t=>t.data),onError:a=>g(a)})}const oe=[{uri:"details",label:m("Details")},{uri:"permissions",label:m("Roles & permissions")},{uri:"security",label:m("Security")},{uri:"date",label:m("Date & time")},{uri:"api",label:m("API")}];function le({user:s,tabs:a}){const{user:t,hasPermission:n}=O(),{api:o}=z(),r=(o==null?void 0:o.integrated)&&n("api.access"),u=d.useMemo(()=>a.filter(l=>!(l.uri==="api"&&!r||l.uri==="security"&&s.id!==(t==null?void 0:t.id))),[s.id,t==null?void 0:t.id,r,a]),[h,f]=V(u);return e.jsx("div",{className:"container mx-auto px-24",children:e.jsxs(G,{selectedTab:h,onTabChange:f,overflow:"overflow-visible",children:[e.jsx(J,{className:"mb-24",children:u.map(l=>e.jsx(W,{elementType:F,to:l.uri,children:e.jsx(i,{...l.label})},l.uri))}),e.jsx(R,{context:s})]})})}function Qe(){const{userId:s}=X(["userId"]),t=Y(_.users.get(s)).data.user;return e.jsxs(d.Fragment,{children:[e.jsx(k,{children:e.jsx(i,{message:"Edit user"})}),e.jsx(q,{endActions:e.jsx(ae,{user:t}),children:e.jsxs(Z,{size:"xl",children:[e.jsx(p,{to:"..",relative:"path",children:e.jsx(i,{message:"Users"})}),e.jsx(p,{children:t.name})]})}),e.jsx(re,{user:t}),e.jsx(le,{tabs:oe,user:t})]})}export{Qe as Component};
//# sourceMappingURL=update-user-page-CSjpIVfO.js.map
