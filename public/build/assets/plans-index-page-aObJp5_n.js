import{x as r,w as x,an as g,ao as h,aH as y,av as j,cc as d,k as b,aD as F,j as e,T as s,cE as T,r as f,aB as D,J as c,L as P,D as w}from"./main-owSUWNVS.js";import{u as C,a as E,G as k,D as A,b as I,c as H}from"./use-datatable-query-CxfVxFSv.js";import{D as N}from"./datatable-filters-xSZH8rQ_.js";import{a as B,D as W,b as q,c as L}from"./datatable-page-with-header-layout-68nRfBM1.js";import{T as Q}from"./table-Bl939KD9.js";import{F as p}from"./formatted-date-dVjFR1LG.js";import{D as K}from"./Delete-D6PatUO1.js";import{E as M}from"./Edit-D8nu-GLe.js";import{S as _}from"./Sync-D5xF8gWw.js";import{C as z}from"./confirmation-dialog-DdZaouVf.js";import{F as $}from"./formatted-price-BZx2tBTa.js";import{N as G}from"./name-with-avatar-BLPHAx2F.js";import{D as O}from"./data-table-add-item-button-C867XSQv.js";import{s as V}from"./software-engineer-BiXKysY-.js";import{a as m,F as J}from"./select-filter-panel-2MY77qxo.js";import{c as R,u as U}from"./timestamp-filters-C0zLPmIY.js";import"./FilterAlt-xRRmNiqG.js";import"./accordion-CpK0I08P.js";import"./checkbox-CiHJ6TYf.js";import"./CheckBoxOutlineBlank-6JQ3-TmB.js";import"./select-Bv69-mBO.js";import"./KeyboardArrowRight-ChYgp5kQ.js";import"./skeleton-xT-yudp1.js";import"./dashboard-layout-context-Cg5RoSzJ.js";import"./use-toggle-dashboard-left-sidebar-B95u609v.js";import"./ArrowDownward-BrhAHC5n.js";import"./useEffectEvent-BzNFWHXk.js";import"./use-pointer-events-BS6HVgE8.js";import"./useGlobalListeners-MjeT7y1B.js";import"./use-date-formatter-BiXQj-wq.js";import"./dialog-footer-D_t7V-bM.js";import"./Add-BV-9IpU7.js";import"./use-normalized-models-Cb3k3qGb.js";import"./form-chip-field-CYaGs1JT.js";import"./input-4Oo6Fyef.js";import"./ArrowRightAlt-PxVB8wV6.js";import"./DateRange-6Lw_fZZT.js";import"./use-base-date-picker-state-Cn_aBnWX.js";import"./use-date-range-picker-state-Bb0A2vO_.js";import"./list-B5Ky1WKX.js";import"./switch-DbAW1G8x.js";import"./use-current-date-time-lVcX-4fw.js";import"./formatted-number-1UpMPscB.js";const u=[{key:"subscriptions",label:r("Subscriptions"),description:r("Whether plan has any active subscriptions"),defaultOperator:m.eq,control:{type:J.Select,defaultValue:"01",options:[{key:"01",label:r("Has active subscriptions"),value:{value:"*",operator:m.has}},{key:"02",label:r("Does not have active subscriptions"),value:{value:"*",operator:m.doesntHave}}]}},R({description:r("Date plan was created")}),U({description:r("Date plan was last updated")})],X=a=>`billing/products/${a}`;function Y(){const{trans:a}=x();return g({mutationFn:t=>Z(t),onSuccess:()=>{y(a(r("Plan deleted"))),j.invalidateQueries({queryKey:d.products.invalidateKey})},onError:t=>h(t)})}function Z({productId:a}){return b.delete(X(a)).then(t=>t.data)}function ee(){const{trans:a}=x();return g({mutationFn:()=>ae(),onSuccess:()=>{y(a(r("Plans synced"))),j.invalidateQueries({queryKey:d.products.invalidateKey})},onError:t=>h(t,r("Could not sync plans"))})}function ae(){return b.post("billing/products/sync").then(a=>a.data)}const te=[{key:"name",allowsSorting:!0,visibleInMode:"all",header:()=>e.jsx(s,{message:"Name"}),body:a=>{const t=a.prices[0];return e.jsx(G,{label:a.name,description:a.free?e.jsx(s,{message:"Free"}):e.jsx($,{price:t})})}},{key:"created_at",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(s,{message:"Created"}),body:a=>e.jsx(p,{date:a.created_at})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-100",header:()=>e.jsx(s,{message:"Last updated"}),body:a=>e.jsx(p,{date:a.updated_at})},{key:"actions",header:()=>e.jsx(s,{message:"Actions"}),visibleInMode:"all",hideHeader:!0,align:"end",maxWidth:"max-w-84",body:a=>e.jsxs(f.Fragment,{children:[e.jsx(c,{size:"md",className:"text-muted",elementType:P,to:`/admin/plans/${a.id}/edit`,children:e.jsx(M,{})}),e.jsx(se,{product:a})]})}];function Je(){const a=F(),{searchParams:t,sortDescriptor:n,mergeIntoSearchParams:l,setSearchQuery:S,isFiltering:v}=C(T),i=E(d.products.index(t));return e.jsxs(B,{children:[e.jsx(k,{query:i}),e.jsx(W,{title:e.jsx(s,{message:"Subscription plans"}),showSidebarToggleButton:!0}),e.jsxs(q,{children:[e.jsx(A,{searchValue:t.query,onSearchChange:S,actions:e.jsx(re,{}),filters:u}),e.jsx(N,{filters:u}),e.jsxs(L,{children:[e.jsx(Q,{columns:te,data:i.items,sortDescriptor:n,onSortChange:l,enableSelection:!1,onAction:o=>{a(`/admin/plans/${o.id}/edit`)}}),i.isEmpty&&e.jsx(I,{className:"mt-50",isFiltering:v,image:V,title:e.jsx(s,{message:"No plans have been created yet"}),filteringTitle:e.jsx(s,{message:"No matching plans"})}),e.jsx(H,{query:i,onPageChange:o=>l({page:o}),onPerPageChange:o=>l({perPage:o})})]})]})]})}function se({product:a}){const t=Y();return e.jsxs(w,{type:"modal",onClose:n=>{n&&t.mutate({productId:a.id})},children:[e.jsx(D,{label:e.jsx(s,{message:"Delete plan"}),children:e.jsx(c,{size:"md",className:"text-muted",disabled:t.isPending,children:e.jsx(K,{})})}),e.jsx(z,{title:e.jsx(s,{message:"Delete plan"}),body:e.jsx(s,{message:"Are you sure you want to delete this plan?"}),confirm:e.jsx(s,{message:"Delete"})})]})}function re(){const a=ee();return e.jsxs(f.Fragment,{children:[e.jsx(D,{label:e.jsx(s,{message:"Sync plans with Stripe & PayPal"}),children:e.jsx(c,{color:"primary",variant:"outline",size:"sm",disabled:a.isPending,onClick:()=>{a.mutate()},children:e.jsx(_,{})})}),e.jsx(O,{elementType:P,to:"/admin/plans/new",children:e.jsx(s,{message:"Add new plan"})})]})}export{Je as Component};
//# sourceMappingURL=plans-index-page-aObJp5_n.js.map
