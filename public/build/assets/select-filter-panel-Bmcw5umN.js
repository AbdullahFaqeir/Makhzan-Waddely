import{r as f,j as s,a5 as y,w as P,T as b,aA as G,G as O,D as X,ah as W,ae as Y,$ as L,x as h,a8 as B,a4 as Z,a3 as _,e as ee,k as ne,ac as se,aa as ae,c as q,A as te,aC as N,y as K,z as V,aB as E,J as oe}from"./main-TIUJvpaR.js";import{u as H}from"./use-normalized-models-DEvVtvvO.js";import{F as U}from"./form-chip-field-ebQy8_UE.js";import{A as le}from"./ArrowRightAlt-CPRMvsTm.js";import{D as ce}from"./DateRange-LhM59-62.js";import{D as re,a as T}from"./use-base-date-picker-state-DYQU3Rut.js";import{u as ie,a as de}from"./use-date-range-picker-state-Df5vuAtM.js";import{F as J,S as ue}from"./select-T49HzTXy.js";import{E as me}from"./Edit-_sVfUVPu.js";import{S as I}from"./skeleton-uSF3jNnm.js";function he({name:e,label:t,placeholder:n,model:o,endpoint:a,className:l,allowCustomValue:d=!1,size:u,valueKey:g}){const[x,i]=f.useState(""),{data:c,isLoading:r}=H(a||`normalized-models/${o}`,{query:x});return s.jsx(U,{className:l,name:e,label:t,size:u,valueKey:g,inputValue:x,onInputValueChange:i,suggestions:c==null?void 0:c.results,placeholder:n,isLoading:r,allowCustomValue:d,children:c==null?void 0:c.results.map(m=>s.jsx(y,{value:m,startIcon:m.image?s.jsx("img",{className:"h-24 w-24 rounded-full object-cover",src:m.image,alt:""}):void 0,children:m.name},m.id))})}function Je({filter:e}){return s.jsx(ge,{filter:e,name:`${e.key}.value`})}function ge({filter:e,name:t,size:n="sm"}){var a;const{trans:o}=P();return e.control.autocompleteEndpoint?s.jsx(he,{name:t,size:n,placeholder:e.control.placeholder?o(e.control.placeholder):void 0,endpoint:e.control.autocompleteEndpoint}):s.jsx(U,{size:n,name:t,valueKey:"id",allowCustomValue:!1,showDropdownArrow:!0,isAsync:!0,placeholder:e.control.placeholder?o(e.control.placeholder):void 0,displayWith:l=>{var u;const d=(u=e.control.options)==null?void 0:u.find(g=>g.key===l.id);if(d)return typeof d.label=="string"?d.label:d.label.message},suggestions:(a=e.control.options)==null?void 0:a.map(l=>({id:l.key,name:typeof l.label=="string"?l.label:l.label.message})),children:l=>s.jsx(y,{value:l.id,children:s.jsx(b,{message:l.name})},l.id)})}var xe=(e=>(e.Select="select",e.DateRangePicker="dateRangePicker",e.SelectModel="selectModel",e.Input="input",e.BooleanToggle="booleanToggle",e.ChipField="chipField",e.Custom="custom",e))(xe||{}),pe=(e=>(e.eq="=",e.ne="!=",e.gt=">",e.gte=">=",e.lt="<",e.lte="<=",e.has="has",e.notNull="notNull",e.contains="contains",e.notContains="notContains",e.startsWith="startsWith",e.endsWith="endsWith",e.hasAll="hasAll",e.doesntHave="doesntHave",e.between="between",e))(pe||{});const S="filters";function fe(e){if(!e)return[];let t=[];try{t=JSON.parse(atob(decodeURIComponent(e))),t.map(n=>(n.valueKey!=null&&(n.value=n.valueKey),n))}catch{}return t}function je(e,t){return!e||(e=t?e.filter(n=>n.value!=="").map(n=>ve(n,t)):e,e=e.filter(n=>!n.isInactive),!e.length)?"":encodeURIComponent(btoa(JSON.stringify(e)))}function ve(e,t){var o;const n=t.find(a=>a.key===e.key);if((n==null?void 0:n.control.type)==="select"){const a=(n.control.options||[]).find(l=>l.key===e.value);if(a)return{...e,value:a.value,valueKey:a.key}}return(o=n==null?void 0:n.extraFilters)!=null&&o.length&&(e.extraFilters=n.extraFilters),e}function Qe(e,t){const[n,o]=G(),a=n.get(S),l=f.useMemo(()=>{if(!e)return[];const i=fe(a);return(t||[]).forEach(c=>{if(!i.find(r=>r.key===c)){const r=e.find(m=>m.key===c);i.push({key:c,value:r.control.defaultValue,operator:r.defaultOperator,isInactive:!0})}}),i.sort((c,r)=>e.findIndex(m=>m.key===c.key)-e.findIndex(m=>m.key===r.key)),i},[a,t,e]),d=f.useCallback(i=>{const c=[...l];return i.forEach(r=>{const m=typeof r=="object"?r.key:r,p=c.findIndex(k=>k.key===m);p>-1&&c.splice(p,1)}),c},[l]),u=f.useCallback(i=>{const c=je(i,e);c?o(r=>(r.delete("page"),r.delete("perPage"),r.set(S,c),r),{replace:!0}):(n.delete(S),o(n,{replace:!0}))},[e,n,o]),g=f.useCallback(i=>{const r=[...d(i),...i];u(r)},[d,u]),x=f.useCallback(i=>u(d([i])),[d,u]);return{add:g,remove:x,replaceAll:u,decodedFilters:l,encodedFilters:a}}function ye(e){var r,m;const{granularity:t,closeDialogOnSelection:n,...o}=e,a=ie(e),l=f.useRef(null),u=O()&&t!=="day",g=s.jsx(X,{offset:8,placement:"bottom-start",isOpen:a.calendarIsOpen,onOpenChange:a.setCalendarIsOpen,type:"popover",triggerRef:l,returnFocusToTrigger:!1,moveFocusToDialog:!1,children:s.jsx(de,{state:a})}),x={onClick:p=>{p.stopPropagation(),p.preventDefault(),be(p)?a.setCalendarIsOpen(!1):a.setCalendarIsOpen(!0)}},i=a.selectedValue,c=a.setSelectedValue;return s.jsxs(f.Fragment,{children:[s.jsxs(re,{ref:l,wrapperProps:x,endAdornment:u?void 0:s.jsx(ce,{}),...o,children:[s.jsx(T,{isPlaceholder:(r=a.isPlaceholder)==null?void 0:r.start,state:a,segmentProps:x,value:i.start,onChange:p=>{c({start:p,end:i.end})}}),s.jsx(le,{className:"block flex-shrink-0 text-muted",size:"md"}),s.jsx(T,{isPlaceholder:(m=a.isPlaceholder)==null?void 0:m.end,state:a,segmentProps:x,value:i.end,onChange:p=>{c({start:i.start,end:p})}})]}),g]})}function be(e){return["hour","minute","dayPeriod"].includes(e.currentTarget.ariaLabel||"")}function ke(e){const{field:{onChange:t,onBlur:n,value:o,ref:a},fieldState:{invalid:l,error:d}}=W({name:e.name}),u={onChange:g=>{t(g?Ce(g):null)},onBlur:n,value:Fe(o),invalid:l,errorMessage:d==null?void 0:d.message,inputRef:a};return s.jsx(ye,{...Y(u,e)})}function Fe(e){const{start:t,end:n,preset:o}=e||{},a={preset:o};try{t&&(a.start=typeof t=="string"?L(t):t),n&&(a.end=typeof n=="string"?L(n):n)}catch{}return a}function Ce({start:e,end:t,preset:n}={}){const o={preset:n};return e&&(o.start=e.toAbsoluteString()),t&&(o.end=t.toAbsoluteString()),o}function Ie({filter:e,name:t,size:n="sm"}){return s.jsx(ke,{min:e.control.min,max:e.control.max,size:n,name:t,granularity:"day",closeDialogOnSelection:!0})}function Ge({filter:e}){return s.jsx(Ie,{filter:e,name:`${e.key}.value`})}const Se={"=":h("is"),"!=":h("is not"),">":h("is greater than"),">=":h("is greater than or equal to"),"<":h("is less than"),"<=":h("is less than or equal to"),notNull:h("is not empty"),contains:h("contains"),notContains:h("does not contain"),startsWith:h("starts with"),endsWith:h("ends with"),has:h("Include"),doesntHave:h("Do not include"),between:h("Is between"),hasAll:h("Include all")};function Oe({filter:e}){var o,a;const t=B(),n=Z({control:t.control,name:`${e.key}.operator`});return s.jsxs(f.Fragment,{children:[(o=e.operators)!=null&&o.length?s.jsx(J,{selectionMode:"single",name:`${e.key}.operator`,className:"mb-14",size:"sm",children:(a=e.operators)==null?void 0:a.map(l=>s.jsx(y,{value:l,children:s.jsx(b,{...Se[l]})},l))}):null,n==="notNull"?null:s.jsx(Pe,{filter:e,name:`${e.key}.value`})]})}function Pe({filter:e,name:t,size:n="sm"}){const o=e.control;return s.jsx(_,{size:n,name:t,type:e.control.inputType,min:"minValue"in o?o.minValue:void 0,max:"maxValue"in o?o.maxValue:void 0,minLength:"minLength"in o?o.minLength:void 0,maxLength:"maxLength"in o?o.maxLength:void 0})}function Ne(e,t,n){return ee({queryKey:[e,t],queryFn:()=>we(e,t),...n})}async function we(e,t){return ne.get(e,{params:t}).then(n=>n.data)}function Re({label:e,className:t,background:n,value:o,defaultValue:a="",placeholder:l=h("Select item..."),searchPlaceholder:d=h("Find an item..."),onChange:u,description:g,errorMessage:x,invalid:i,autoFocus:c,queryParams:r,endpoint:m,disabled:p,required:k,size:Q}){var M;const F=f.useRef(null),[w,R]=f.useState(""),[C,D]=se(o,a,u),A=H(m,{query:w,...r}),{trans:$}=P(),v=ae({size:Q,background:n});return C?s.jsxs("div",{className:t,children:[e&&s.jsx("div",{className:v.label,children:e}),s.jsx("div",{className:q(v.input,i&&"border-danger"),children:s.jsx(te,{initial:!1,mode:"wait",children:s.jsx(De,{disabled:p,endpoint:m,className:v.input,modelId:C,queryParams:r,onEditClick:()=>{D(""),R(""),requestAnimationFrame(()=>{var j,z;(j=F.current)==null||j.focus(),(z=F.current)==null||z.click()})}})})}),g&&!x&&s.jsx("div",{className:v.description,children:g}),x&&s.jsx("div",{className:v.error,children:x})]}):s.jsx(ue,{className:t,showSearchField:!0,invalid:i,errorMessage:x,description:g,color:"white",isAsync:!0,background:n,placeholder:$(l),searchPlaceholder:$(d),label:e,isLoading:A.isFetching,items:(M=A.data)==null?void 0:M.results,inputValue:w,onInputValueChange:R,selectionMode:"single",selectedValue:C,onSelectionChange:D,ref:F,autoFocus:c,disabled:p,required:k,children:j=>s.jsx(y,{value:j.id,description:j.description,startIcon:s.jsx(N,{src:j.image,size:"sm",label:j.name}),children:j.name},j.id)})}function De({modelId:e,onEditClick:t,endpoint:n,disabled:o,queryParams:a}){const{data:l,isLoading:d}=Ne(`${n}/${e}`,a);return d||!(l!=null&&l.model)?s.jsx(Ae,{},"skeleton"):s.jsxs(K.div,{className:q("flex h-full items-center gap-8",o&&"pointer-events-none cursor-not-allowed text-disabled"),...V,children:[s.jsx(N,{src:l.model.image,label:l.model.name,size:"sm"}),s.jsx("div",{children:s.jsx(E,{label:l.model.description??l.model.name??"",children:s.jsx("div",{className:"text-sm leading-4",children:l.model.name})})}),s.jsx(E,{label:s.jsx(b,{message:"Change item"}),children:s.jsx(oe,{className:"ml-auto text-muted",size:"sm",onClick:t,disabled:o,children:s.jsx(me,{})})})]},"preview")}function Ae(){return s.jsxs(K.div,{className:"flex h-full items-center gap-8",...V,children:[s.jsx(I,{variant:"rect",size:"w-24 h-24 flex-shrink-0"}),s.jsx(I,{className:"max-w-100 text-xs"}),s.jsx(I,{variant:"icon",size:"w-24 h-24",className:"ml-auto"})]})}function $e({name:e,size:t,...n}){const{clearErrors:o}=B(),{field:{onChange:a,value:l=""},fieldState:{invalid:d,error:u}}=W({name:e});return s.jsx(Re,{size:t,value:l,onChange:g=>{a(g),o(e)},invalid:d,errorMessage:u==null?void 0:u.message,...n})}function Xe({filter:e}){return s.jsx(Me,{filter:e,name:`${e.key}.value`})}function Me({filter:e,name:t,size:n="sm"}){return s.jsx($e,{name:t,size:n,endpoint:e.control.endpoint?e.control.endpoint:`normalized-models/${e.control.model}`})}function Ye({filter:e}){return s.jsx(ze,{filter:e,name:`${e.key}.value`})}function ze({filter:e,name:t,size:n="sm"}){const{trans:o}=P();return s.jsx(J,{size:n,name:t,selectionMode:"single",showSearchField:e.control.showSearchField,placeholder:e.control.placeholder?o(e.control.placeholder):void 0,searchPlaceholder:e.control.searchPlaceholder?o(e.control.searchPlaceholder):void 0,children:e.control.options.map(a=>s.jsx(y,{value:a.key,startIcon:e.control.showAvatar?s.jsx(N,{size:"sm",src:a.image,label:typeof a.label=="object"?a.label.message:a.label}):null,children:typeof a.label=="string"?a.label:s.jsx(b,{...a.label})},a.key))})}export{Je as C,Ge as D,xe as F,Oe as I,Xe as N,Ye as S,pe as a,Se as b,Qe as c,Ce as d,je as e,$e as f,Ne as u};
