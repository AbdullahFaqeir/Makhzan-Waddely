{"version":3,"file":"custom-page-layout-DxS0O_oy.js","sources":["../../../common/foundation/resources/client/custom-page/custom-page-body.tsx","../../../common/foundation/resources/client/ui/library/utils/hooks/use-spin-delay.ts","../../../common/foundation/resources/client/http/page-status.tsx","../../../common/foundation/resources/client/custom-page/use-custom-page.ts","../../../common/foundation/resources/client/custom-page/custom-page-layout.tsx"],"sourcesContent":["import {CustomPage} from '@common/admin/custom-pages/custom-page';\nimport {useEffect, useRef} from 'react';\nimport {highlightAllCode} from '@common/text-editor/highlight/highlight-code';\n\ninterface CustomPageBodyProps {\n  page: CustomPage;\n}\nexport function CustomPageBody({page}: CustomPageBodyProps) {\n  const bodyRef = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    if (bodyRef.current) {\n      highlightAllCode(bodyRef.current);\n    }\n  }, []);\n\n  return (\n    <div className=\"px-16 md:px-24\">\n      <div className=\"custom-page-body prose mx-auto my-50 dark:prose-invert\">\n        <h1>{page.title}</h1>\n        <div\n          ref={bodyRef}\n          className=\"whitespace-pre-wrap break-words\"\n          dangerouslySetInnerHTML={{__html: page.body}}\n        />\n      </div>\n    </div>\n  );\n}\n","import {useEffect, useRef, useState} from 'react';\n\ninterface SpinDelayOptions {\n  delay?: number;\n  minDuration?: number;\n}\n\ntype State = 'IDLE' | 'DELAY' | 'DISPLAY' | 'EXPIRE';\n\nexport const defaultOptions = {\n  delay: 500,\n  minDuration: 200,\n};\n\nexport function useSpinDelay(\n  loading: boolean,\n  options?: SpinDelayOptions,\n): boolean {\n  options = Object.assign({}, defaultOptions, options);\n\n  const [state, setState] = useState<State>('IDLE');\n  const timeout = useRef<any>(null);\n\n  useEffect(() => {\n    if (loading && state === 'IDLE') {\n      clearTimeout(timeout.current);\n\n      timeout.current = setTimeout(\n        () => {\n          if (!loading) {\n            return setState('IDLE');\n          }\n\n          timeout.current = setTimeout(\n            () => {\n              setState('EXPIRE');\n            },\n            options?.minDuration,\n          );\n\n          setState('DISPLAY');\n        },\n        options?.delay,\n      );\n\n      setState('DELAY');\n    }\n\n    if (!loading && state !== 'DISPLAY') {\n      clearTimeout(timeout.current);\n      setState('IDLE');\n    }\n  }, [loading, state, options.delay, options.minDuration]);\n\n  useEffect(() => {\n    return () => clearTimeout(timeout.current);\n  }, []);\n\n  return state === 'DISPLAY' || state === 'EXPIRE';\n}\n\nexport default useSpinDelay;\n","import {FullPageLoader} from '@ui/progress/full-page-loader';\nimport {errorStatusIs} from '@common/http/error-status-is';\nimport {NotFoundPage} from '@common/ui/not-found-page/not-found-page';\nimport {PageErrorMessage} from '@common/errors/page-error-message';\nimport React, {ReactNode} from 'react';\nimport {UseQueryResult} from '@tanstack/react-query';\nimport {Navigate} from 'react-router';\nimport {useAuth} from '@common/auth/use-auth';\nimport useSpinDelay from '@ui/utils/hooks/use-spin-delay';\n\ninterface Props {\n  query: UseQueryResult;\n  show404?: boolean;\n  redirectOn404?: string;\n  loaderClassName?: string;\n  loaderIsScreen?: boolean;\n  loader?: ReactNode;\n  delayedSpinner?: boolean;\n  isLoading?: boolean;\n}\nexport function PageStatus({\n  query,\n  show404 = true,\n  loader,\n  loaderClassName,\n  loaderIsScreen = true,\n  delayedSpinner = true,\n  redirectOn404,\n  isLoading,\n}: Props) {\n  const {isLoggedIn} = useAuth();\n  isLoading = isLoading ?? query.isLoading;\n\n  const showSpinner = useSpinDelay(isLoading, {\n    delay: 500,\n    minDuration: 200,\n  });\n\n  if (isLoading) {\n    if (!showSpinner && delayedSpinner) {\n      return null;\n    }\n    return (\n      loader || (\n        <FullPageLoader className={loaderClassName} screen={loaderIsScreen} />\n      )\n    );\n  }\n\n  if (\n    query.isError &&\n    (errorStatusIs(query.error, 401) || errorStatusIs(query.error, 403)) &&\n    !isLoggedIn\n  ) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  if (show404 && query.isError && errorStatusIs(query.error, 404)) {\n    if (redirectOn404) {\n      return <Navigate to={redirectOn404} replace />;\n    }\n    return <NotFoundPage />;\n  }\n\n  return <PageErrorMessage />;\n}\n","import {useQuery} from '@tanstack/react-query';\nimport {apiClient} from '../http/query-client';\nimport {BackendResponse} from '../http/backend-response/backend-response';\nimport {CustomPage} from '../admin/custom-pages/custom-page';\nimport {useParams} from 'react-router';\nimport {getBootstrapData} from '@ui/bootstrap-data/bootstrap-data-store';\n\nconst endpoint = (slugOrId: number | string) => `custom-pages/${slugOrId}`;\n\nexport interface FetchCustomPageResponse extends BackendResponse {\n  page: CustomPage;\n}\n\nexport function useCustomPage(pageId?: number | string) {\n  const params = useParams();\n  if (!pageId) {\n    pageId = params.pageId;\n  }\n  return useQuery({\n    queryKey: [endpoint(pageId!)],\n    queryFn: () => fetchCustomPage(pageId!),\n    initialData: () => {\n      const data = getBootstrapData().loaders?.customPage;\n      if (data?.page && (data.page.id == pageId || data.page.slug == pageId)) {\n        return data;\n      }\n    },\n  });\n}\n\nfunction fetchCustomPage(\n  slugOrId: number | string,\n): Promise<FetchCustomPageResponse> {\n  return apiClient.get(endpoint(slugOrId)).then(response => response.data);\n}\n","import {CustomPageBody} from '@common/custom-page/custom-page-body';\nimport {PageMetaTags} from '@common/http/page-meta-tags';\nimport {PageStatus} from '@common/http/page-status';\nimport {useEffect} from 'react';\nimport {useMatches, useParams} from 'react-router';\nimport {Footer} from '../ui/footer/footer';\nimport {Navbar} from '../ui/navigation/navbar/navbar';\nimport {useCustomPage} from './use-custom-page';\n\ninterface Props {\n  slug?: string | number;\n}\nexport function Component({slug}: Props) {\n  const {pageSlug} = useParams();\n  let matchesSlug: string;\n  useMatches().forEach(match => {\n    const slug = (match.handle as {slug: string})?.slug;\n    if (slug) {\n      matchesSlug = slug;\n    }\n  });\n\n  const query = useCustomPage(slug || pageSlug || matchesSlug!);\n\n  useEffect(() => {\n    if (query.data?.page) {\n      window.scrollTo(0, 0);\n    }\n  }, [query]);\n\n  return (\n    <div className=\"flex min-h-screen flex-col bg\">\n      <PageMetaTags query={query} />\n      <Navbar\n        color=\"bg\"\n        menuPosition=\"custom-page-navbar\"\n        className=\"sticky top-0 flex-shrink-0\"\n      />\n      <div className=\"flex-auto\">\n        {query.data ? (\n          <CustomPageBody page={query.data.page} />\n        ) : (\n          <PageStatus query={query} loaderClassName=\"mt-80\" />\n        )}\n      </div>\n      <Footer className=\"mx-14 md:mx-40\" />\n    </div>\n  );\n}\n"],"names":["CustomPageBody","page","bodyRef","useRef","useEffect","highlightAllCode","jsxs","jsx","defaultOptions","useSpinDelay","loading","options","state","setState","useState","timeout","PageStatus","query","show404","loader","loaderClassName","loaderIsScreen","delayedSpinner","redirectOn404","isLoading","isLoggedIn","useAuth","showSpinner","FullPageLoader","errorStatusIs","Navigate","NotFoundPage","PageErrorMessage","endpoint","slugOrId","useCustomPage","pageId","params","useParams","useQuery","fetchCustomPage","data","_a","getBootstrapData","apiClient","response","Component","slug","pageSlug","matchesSlug","useMatches","match","PageMetaTags","Navbar","Footer"],"mappings":"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"}