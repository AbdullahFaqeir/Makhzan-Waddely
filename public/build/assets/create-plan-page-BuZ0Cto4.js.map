{"version":3,"file":"create-plan-page-BuZ0Cto4.js","sources":["../../../common/foundation/resources/client/admin/plans/requests/use-create-product.ts","../../../common/foundation/resources/client/admin/plans/crupdate-plan-page/create-plan-page.tsx"],"sourcesContent":["import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {Price} from '@common/billing/price';\nimport {Product} from '@common/billing/product';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {useNavigate} from '@common/ui/navigation/use-navigate';\nimport {useMutation} from '@tanstack/react-query';\nimport {message} from '@ui/i18n/message';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {toast} from '@ui/toast/toast';\nimport {UseFormReturn} from 'react-hook-form';\n\nexport interface CreateProductPayload\n  extends Omit<Partial<Product>, 'feature_list' | 'prices'> {\n  feature_list: {value: string}[];\n  prices: Omit<Price, 'id'>[];\n}\n\nexport function useCreateProduct(form: UseFormReturn<CreateProductPayload>) {\n  const {trans} = useTrans();\n  const navigate = useNavigate();\n  return useMutation({\n    mutationFn: (payload: CreateProductPayload) => createProduct(payload),\n    onSuccess: () => {\n      toast(trans(message('Plan created')));\n      queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.products.invalidateKey,\n      });\n      navigate('/admin/plans');\n    },\n    onError: err => onFormQueryError(err, form),\n  });\n}\n\nfunction createProduct(payload: CreateProductPayload): Promise<Response> {\n  const backendPayload = {\n    ...payload,\n    feature_list: payload.feature_list.map(feature => feature.value),\n  };\n  return apiClient.post('billing/products', backendPayload).then(r => r.data);\n}\n","import {Breadcrumb} from '@ui/breadcrumbs/breadcrumb';\nimport {BreadcrumbItem} from '@ui/breadcrumbs/breadcrumb-item';\nimport {Trans} from '@ui/i18n/trans';\nimport {useForm} from 'react-hook-form';\nimport {CrupdateResourceLayout} from '../../crupdate-resource-layout';\nimport {\n  CreateProductPayload,\n  useCreateProduct,\n} from '../requests/use-create-product';\nimport {CrupdatePlanForm} from './crupdate-plan-form';\n\nexport function Component() {\n  const form = useForm<CreateProductPayload>({\n    defaultValues: {\n      free: false,\n      recommended: false,\n    },\n  });\n  const createProduct = useCreateProduct(form);\n\n  return (\n    <CrupdateResourceLayout\n      form={form}\n      onSubmit={values => {\n        createProduct.mutate(values);\n      }}\n      title={\n        <Breadcrumb size=\"xl\">\n          <BreadcrumbItem to=\"/admin/plans\">\n            <Trans message=\"Plans\" />\n          </BreadcrumbItem>\n          <BreadcrumbItem>\n            <Trans message=\"New plan\" />\n          </BreadcrumbItem>\n        </Breadcrumb>\n      }\n      isLoading={createProduct.isPending}\n    >\n      <CrupdatePlanForm />\n    </CrupdateResourceLayout>\n  );\n}\n"],"names":["useCreateProduct","form","trans","useTrans","navigate","useNavigate","useMutation","payload","createProduct","toast","message","queryClient","commonAdminQueries","err","onFormQueryError","backendPayload","feature","apiClient","r","Component","useForm","jsx","CrupdateResourceLayout","values","jsxs","Breadcrumb","BreadcrumbItem","Trans","CrupdatePlanForm"],"mappings":"+xBAkBO,SAASA,EAAiBC,EAA2C,CAC1E,KAAM,CAAC,MAAAC,CAAA,EAASC,EAAA,EACVC,EAAWC,EAAA,EACjB,OAAOC,EAAY,CACjB,WAAaC,GAAkCC,EAAcD,CAAO,EACpE,UAAW,IAAM,CACfE,EAAMP,EAAMQ,EAAQ,cAAc,CAAC,CAAC,EACpCC,EAAY,kBAAkB,CAC5B,SAAUC,EAAmB,SAAS,aAAA,CACvC,EACDR,EAAS,cAAc,CACzB,EACA,QAASS,GAAOC,EAAiBD,EAAKZ,CAAI,CAAA,CAC3C,CACH,CAEA,SAASO,EAAcD,EAAkD,CACvE,MAAMQ,EAAiB,CACrB,GAAGR,EACH,aAAcA,EAAQ,aAAa,IAAIS,GAAWA,EAAQ,KAAK,CAAA,EAEjE,OAAOC,EAAU,KAAK,mBAAoBF,CAAc,EAAE,KAAKG,GAAKA,EAAE,IAAI,CAC5E,CC7BO,SAASC,GAAY,CAC1B,MAAMlB,EAAOmB,EAA8B,CACzC,cAAe,CACb,KAAM,GACN,YAAa,EAAA,CACf,CACD,EACKZ,EAAgBR,EAAiBC,CAAI,EAE3C,OACEoB,EAAAA,IAACC,EAAA,CACC,KAAArB,EACA,SAAUsB,GAAU,CAClBf,EAAc,OAAOe,CAAM,CAC7B,EACA,MACEC,EAAAA,KAACC,EAAA,CAAW,KAAK,KACf,SAAA,CAAAJ,EAAAA,IAACK,GAAe,GAAG,eACjB,eAACC,EAAA,CAAM,QAAQ,QAAQ,CAAA,CACzB,QACCD,EAAA,CACC,SAAAL,EAAAA,IAACM,EAAA,CAAM,QAAQ,WAAW,CAAA,CAC5B,CAAA,EACF,EAEF,UAAWnB,EAAc,UAEzB,eAACoB,EAAA,CAAA,CAAiB,CAAA,CAAA,CAGxB"}