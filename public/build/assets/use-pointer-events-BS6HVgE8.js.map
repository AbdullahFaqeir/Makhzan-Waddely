{"version":3,"file":"use-pointer-events-BS6HVgE8.js","sources":["../../../common/foundation/resources/client/ui/library/interactions/use-pointer-events.ts"],"sourcesContent":["import React, {HTMLAttributes, useRef} from 'react';\nimport {useGlobalListeners} from '@react-aria/utils';\nimport {createEventHandler} from '@ui/utils/dom/create-event-handler';\n\ninterface PointerState {\n  lastPosition: {x: number; y: number};\n  id?: number;\n  started: boolean;\n  el?: HTMLElement;\n  originalTouchAction?: string;\n  originalUserSelect?: string;\n  longPressTimer?: any;\n  longPressTriggered?: boolean;\n}\n\ninterface UsePointerEventsReturn {\n  domProps: HTMLAttributes<HTMLElement>;\n}\n\nexport interface UsePointerEventsProps {\n  onMoveStart?: (e: PointerEvent, el: HTMLElement) => false | void;\n  onMove?: (e: PointerEvent, deltaX: number, deltaY: number) => void;\n  onMoveEnd?: (e: PointerEvent) => void;\n  onPointerDown?: (e: React.PointerEvent) => void | false;\n  onPointerUp?: (e: PointerEvent, el: HTMLElement) => void;\n  onPress?: (e: PointerEvent, el: HTMLElement) => void;\n  onLongPress?: (e: PointerEvent | React.PointerEvent, el: HTMLElement) => void;\n  preventDefault?: boolean;\n  stopPropagation?: boolean;\n  minimumMovement?: number;\n}\nexport function usePointerEvents({\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  minimumMovement = 0,\n  preventDefault,\n  stopPropagation = true,\n  onPress,\n  onLongPress,\n  ...props\n}: UsePointerEventsProps): UsePointerEventsReturn {\n  const stateRef = useRef<PointerState>({\n    lastPosition: {x: 0, y: 0},\n    started: false,\n    longPressTriggered: false,\n  });\n  const state = stateRef.current;\n\n  const {addGlobalListener, removeGlobalListener} = useGlobalListeners();\n\n  const start = (e: PointerEvent) => {\n    if (!state.el) return;\n    const result = onMoveStart?.(e, state.el);\n\n    // allow user to cancel interaction\n    if (result === false) return;\n\n    state.originalTouchAction = state.el.style.touchAction;\n    state.el.style.touchAction = 'none';\n    state.originalUserSelect = document.documentElement.style.userSelect;\n    document.documentElement.style.userSelect = 'none';\n    state.started = true;\n  };\n\n  const onPointerDown = (e: React.PointerEvent) => {\n    if (e.button === 0 && state.id == null) {\n      state.started = false;\n\n      const result = props.onPointerDown?.(e);\n      if (result === false) return;\n\n      if (stopPropagation) {\n        e.stopPropagation();\n      }\n      if (preventDefault) {\n        e.preventDefault();\n      }\n      state.id = e.pointerId;\n      state.el = e.currentTarget as HTMLElement;\n      state.lastPosition = {x: e.clientX, y: e.clientY};\n\n      // use global listeners, so we don't have to capture pointer,\n      // which would prevent click events on child nodes\n\n      if (onLongPress) {\n        state.longPressTimer = setTimeout(() => {\n          onLongPress(e, state.el!);\n          state.longPressTriggered = true;\n        }, 400);\n      }\n\n      if (onMoveStart || onMove) {\n        addGlobalListener(window, 'pointermove', onPointerMove, false);\n      }\n      addGlobalListener(window, 'pointerup', onPointerUp, false);\n      addGlobalListener(window, 'pointercancel', onPointerUp, false);\n    }\n  };\n\n  const onPointerMove = (e: PointerEvent) => {\n    if (e.pointerId === state.id) {\n      const deltaX = e.clientX - state.lastPosition.x;\n      const deltaY = e.clientY - state.lastPosition.y;\n\n      if (\n        (Math.abs(deltaX) >= minimumMovement ||\n          Math.abs(deltaY) >= minimumMovement) &&\n        !state.started\n      ) {\n        start(e);\n      }\n\n      if (state.started) {\n        onMove?.(e, deltaX, deltaY);\n        state.lastPosition = {x: e.clientX, y: e.clientY};\n      }\n    }\n  };\n\n  const onPointerUp = (e: PointerEvent) => {\n    if (e.pointerId === state.id) {\n      // cancel long press timer, if exists\n      if (state.longPressTimer) {\n        clearTimeout(state.longPressTimer);\n      }\n\n      const longPressTriggered = state.longPressTriggered;\n      state.longPressTriggered = false;\n\n      // only call onMoveEnd if we actually started moving\n      if (state.started) {\n        onMoveEnd?.(e);\n      }\n\n      if (state.el) {\n        // handle press only if event was not cancelled (via touch scroll on mobile for example)\n        if (e.type !== 'pointercancel') {\n          props.onPointerUp?.(e, state.el);\n\n          // only call onPress if pointer did not leave onPointerDown element\n          if (e.target && state.el.contains(e.target as HTMLElement)) {\n            // trigger either onPress or onLongPress\n            if (longPressTriggered) {\n              onLongPress?.(e, state.el);\n            } else {\n              onPress?.(e, state.el);\n            }\n          }\n        }\n\n        document.documentElement.style.userSelect =\n          state.originalUserSelect || '';\n        state.el.style.touchAction = state.originalTouchAction || '';\n      }\n      state.id = undefined;\n      state.started = false;\n      removeGlobalListener(window, 'pointermove', onPointerMove, false);\n      removeGlobalListener(window, 'pointerup', onPointerUp, false);\n      removeGlobalListener(window, 'pointercancel', onPointerUp, false);\n    }\n  };\n\n  return {\n    domProps: {\n      onPointerDown: createEventHandler(onPointerDown),\n    },\n  };\n}\n"],"names":["usePointerEvents","onMoveStart","onMove","onMoveEnd","minimumMovement","preventDefault","stopPropagation","onPress","onLongPress","props","state","useRef","addGlobalListener","removeGlobalListener","useGlobalListeners","start","onPointerDown","_a","onPointerMove","onPointerUp","deltaX","deltaY","longPressTriggered","createEventHandler"],"mappings":"oGA+BO,SAASA,EAAiB,CAC/B,YAAAC,EACA,OAAAC,EACA,UAAAC,EACA,gBAAAC,EAAkB,EAClB,eAAAC,EACA,gBAAAC,EAAkB,GAClB,QAAAC,EACA,YAAAC,EACA,GAAGC,CACL,EAAkD,CAMhD,MAAMC,EALWC,EAAAA,OAAqB,CACpC,aAAc,CAAC,EAAG,EAAG,EAAG,CAAA,EACxB,QAAS,GACT,mBAAoB,EAAA,CACrB,EACsB,QAEjB,CAAC,kBAAAC,EAAmB,qBAAAC,CAAA,EAAwBC,EAAA,EAE5CC,EAAS,GAAoB,CAC7B,CAACL,EAAM,KACIT,GAAA,YAAAA,EAAc,EAAGS,EAAM,OAGvB,KAEfA,EAAM,oBAAsBA,EAAM,GAAG,MAAM,YAC3CA,EAAM,GAAG,MAAM,YAAc,OAC7BA,EAAM,mBAAqB,SAAS,gBAAgB,MAAM,WAC1D,SAAS,gBAAgB,MAAM,WAAa,OAC5CA,EAAM,QAAU,GAClB,EAEMM,EAAiB,GAA0B,OAC/C,GAAI,EAAE,SAAW,GAAKN,EAAM,IAAM,KAAM,CAItC,GAHAA,EAAM,QAAU,KAEDO,EAAAR,EAAM,gBAAN,YAAAQ,EAAA,KAAAR,EAAsB,MACtB,GAAO,OAElBH,GACF,EAAE,gBAAA,EAEAD,GACF,EAAE,eAAA,EAEJK,EAAM,GAAK,EAAE,UACbA,EAAM,GAAK,EAAE,cACbA,EAAM,aAAe,CAAC,EAAG,EAAE,QAAS,EAAG,EAAE,OAAA,EAKrCF,IACFE,EAAM,eAAiB,WAAW,IAAM,CACtCF,EAAY,EAAGE,EAAM,EAAG,EACxBA,EAAM,mBAAqB,EAC7B,EAAG,GAAG,IAGJT,GAAeC,IACjBU,EAAkB,OAAQ,cAAeM,EAAe,EAAK,EAE/DN,EAAkB,OAAQ,YAAaO,EAAa,EAAK,EACzDP,EAAkB,OAAQ,gBAAiBO,EAAa,EAAK,CAC/D,CACF,EAEMD,EAAiB,GAAoB,CACzC,GAAI,EAAE,YAAcR,EAAM,GAAI,CAC5B,MAAMU,EAAS,EAAE,QAAUV,EAAM,aAAa,EACxCW,EAAS,EAAE,QAAUX,EAAM,aAAa,GAG3C,KAAK,IAAIU,CAAM,GAAKhB,GACnB,KAAK,IAAIiB,CAAM,GAAKjB,IACtB,CAACM,EAAM,SAEPK,EAAM,CAAC,EAGLL,EAAM,UACRR,GAAA,MAAAA,EAAS,EAAGkB,EAAQC,GACpBX,EAAM,aAAe,CAAC,EAAG,EAAE,QAAS,EAAG,EAAE,OAAA,EAE7C,CACF,EAEMS,EAAe,GAAoB,OACvC,GAAI,EAAE,YAAcT,EAAM,GAAI,CAExBA,EAAM,gBACR,aAAaA,EAAM,cAAc,EAGnC,MAAMY,EAAqBZ,EAAM,mBACjCA,EAAM,mBAAqB,GAGvBA,EAAM,UACRP,GAAA,MAAAA,EAAY,IAGVO,EAAM,KAEJ,EAAE,OAAS,mBACbO,EAAAR,EAAM,cAAN,MAAAQ,EAAA,KAAAR,EAAoB,EAAGC,EAAM,IAGzB,EAAE,QAAUA,EAAM,GAAG,SAAS,EAAE,MAAqB,IAEnDY,EACFd,GAAA,MAAAA,EAAc,EAAGE,EAAM,IAEvBH,GAAA,MAAAA,EAAU,EAAGG,EAAM,MAKzB,SAAS,gBAAgB,MAAM,WAC7BA,EAAM,oBAAsB,GAC9BA,EAAM,GAAG,MAAM,YAAcA,EAAM,qBAAuB,IAE5DA,EAAM,GAAK,OACXA,EAAM,QAAU,GAChBG,EAAqB,OAAQ,cAAeK,EAAe,EAAK,EAChEL,EAAqB,OAAQ,YAAaM,EAAa,EAAK,EAC5DN,EAAqB,OAAQ,gBAAiBM,EAAa,EAAK,CAClE,CACF,EAEA,MAAO,CACL,SAAU,CACR,cAAeI,EAAmBP,CAAa,CAAA,CACjD,CAEJ"}