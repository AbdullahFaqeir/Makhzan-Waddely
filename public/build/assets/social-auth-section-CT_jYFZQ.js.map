{"version":3,"file":"social-auth-section-CT_jYFZQ.js","sources":["../../../common/foundation/resources/client/auth/requests/connect-social-with-password.ts","../../../common/foundation/resources/client/auth/ui/social-auth-section.tsx"],"sourcesContent":["import {useMutation} from '@tanstack/react-query';\nimport {UseFormReturn} from 'react-hook-form';\nimport {BackendResponse} from '../../http/backend-response/backend-response';\nimport {onFormQueryError} from '../../errors/on-form-query-error';\nimport {useNavigate} from '../../ui/navigation/use-navigate';\nimport {apiClient} from '../../http/query-client';\nimport {useAuth} from '../use-auth';\nimport {setBootstrapData} from '@ui/bootstrap-data/bootstrap-data-store';\n\ninterface Response extends BackendResponse {\n  bootstrapData: string;\n}\n\nexport interface ConnectSocialPayload {\n  password: string;\n}\n\nexport function useConnectSocialWithPassword(\n  form: UseFormReturn<ConnectSocialPayload>,\n) {\n  const navigate = useNavigate();\n  const {getRedirectUri} = useAuth();\n  return useMutation({\n    mutationFn: connect,\n    onSuccess: response => {\n      setBootstrapData(response.bootstrapData);\n      navigate(getRedirectUri(), {replace: true});\n    },\n    onError: r => onFormQueryError(r, form),\n  });\n}\n\nfunction connect(payload: ConnectSocialPayload): Promise<Response> {\n  return apiClient\n    .post('secure/auth/social/connect', payload)\n    .then(response => response.data);\n}\n","import {\n  SocialService,\n  useSocialLogin,\n} from '@common/auth/requests/use-social-login';\nimport {useAllSocialLoginsDisabled} from '@common/auth/ui/use-all-social-logins-disabled';\nimport {useAuth} from '@common/auth/use-auth';\nimport {useNavigate} from '@common/ui/navigation/use-navigate';\nimport {Button} from '@ui/buttons/button';\nimport {IconButton} from '@ui/buttons/icon-button';\nimport {Form} from '@ui/forms/form';\nimport {FormTextField} from '@ui/forms/input-field/text-field/text-field';\nimport {message} from '@ui/i18n/message';\nimport {MessageDescriptor} from '@ui/i18n/message-descriptor';\nimport {Trans} from '@ui/i18n/trans';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {EnvatoIcon} from '@ui/icons/social/envato';\nimport {FacebookIcon} from '@ui/icons/social/facebook';\nimport {GoogleIcon} from '@ui/icons/social/google';\nimport {TwitterIcon} from '@ui/icons/social/twitter';\nimport {Dialog} from '@ui/overlays/dialog/dialog';\nimport {DialogBody} from '@ui/overlays/dialog/dialog-body';\nimport {useDialogContext} from '@ui/overlays/dialog/dialog-context';\nimport {DialogFooter} from '@ui/overlays/dialog/dialog-footer';\nimport {DialogHeader} from '@ui/overlays/dialog/dialog-header';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {useSettings} from '@ui/settings/use-settings';\nimport clsx from 'clsx';\nimport {Fragment, ReactElement, ReactNode} from 'react';\nimport {useForm} from 'react-hook-form';\nimport {\n  ConnectSocialPayload,\n  useConnectSocialWithPassword,\n} from '../requests/connect-social-with-password';\n\nconst googleLabel = message('Continue with google');\nconst facebookLabel = message('Continue with facebook');\nconst twitterLabel = message('Continue with twitter');\nconst envatoLabel = message('Continue with envato');\n\ninterface SocialAuthSectionProps {\n  dividerMessage: ReactNode;\n  isUsingInvite?: boolean;\n}\nexport function SocialAuthSection({\n  dividerMessage,\n  isUsingInvite,\n}: SocialAuthSectionProps) {\n  const {social} = useSettings();\n  const navigate = useNavigate();\n  const {getRedirectUri} = useAuth();\n  const {loginWithSocial, requestingPassword, setIsRequestingPassword} =\n    useSocialLogin();\n\n  if (useAllSocialLoginsDisabled({isUsingInvite})) {\n    return null;\n  }\n\n  const handleSocialLogin = async (service: SocialService) => {\n    const e = await loginWithSocial(service);\n    if (e?.status === 'SUCCESS' || e?.status === 'ALREADY_LOGGED_IN') {\n      navigate(getRedirectUri(), {replace: true});\n    }\n  };\n\n  return (\n    <Fragment>\n      <div className=\"relative my-20 text-center before:absolute before:left-0 before:top-1/2 before:h-1 before:w-full before:-translate-y-1/2 before:bg-divider\">\n        <span className=\"relative z-10 bg-elevated px-10 text-sm text-muted\">\n          {dividerMessage}\n        </span>\n      </div>\n      <div\n        className={clsx(\n          'flex items-center justify-center gap-14',\n          !social?.compact_buttons && 'flex-col',\n        )}\n      >\n        {social?.google?.enable ? (\n          <SocialLoginButton\n            label={googleLabel}\n            icon={<GoogleIcon viewBox=\"0 0 48 48\" />}\n            onClick={() => handleSocialLogin('google')}\n          />\n        ) : null}\n        {social?.facebook?.enable ? (\n          <SocialLoginButton\n            label={facebookLabel}\n            icon={<FacebookIcon className=\"text-facebook\" />}\n            onClick={() => handleSocialLogin('facebook')}\n          />\n        ) : null}\n        {social?.twitter?.enable ? (\n          <SocialLoginButton\n            label={twitterLabel}\n            icon={<TwitterIcon className=\"text-twitter\" />}\n            onClick={() => handleSocialLogin('twitter')}\n          />\n        ) : null}\n        {social?.envato?.enable && !isUsingInvite ? (\n          <SocialLoginButton\n            label={envatoLabel}\n            icon={<EnvatoIcon viewBox=\"0 0 50 50\" className=\"text-envato\" />}\n            onClick={() => handleSocialLogin('envato')}\n          />\n        ) : null}\n      </div>\n      <DialogTrigger\n        type=\"modal\"\n        isOpen={requestingPassword}\n        onOpenChange={setIsRequestingPassword}\n      >\n        <RequestPasswordDialog />\n      </DialogTrigger>\n    </Fragment>\n  );\n}\n\nfunction RequestPasswordDialog() {\n  const form = useForm<ConnectSocialPayload>();\n  const {formId} = useDialogContext();\n  const connect = useConnectSocialWithPassword(form);\n  return (\n    <Dialog>\n      <DialogHeader>\n        <Trans message=\"Password required\" />\n      </DialogHeader>\n      <DialogBody>\n        <div className=\"mb-30 text-sm text-muted\">\n          <Trans message=\"An account with this email address already exists. If you want to connect the two accounts, enter existing account password.\" />\n        </div>\n        <Form\n          form={form}\n          id={formId}\n          onSubmit={payload => {\n            connect.mutate(payload);\n          }}\n        >\n          <FormTextField\n            autoFocus\n            name=\"password\"\n            type=\"password\"\n            required\n            label={<Trans message=\"Password\" />}\n          />\n        </Form>\n      </DialogBody>\n      <DialogFooter>\n        <Button variant=\"text\">\n          <Trans message=\"Cancel\" />\n        </Button>\n        <Button\n          type=\"submit\"\n          form={formId}\n          variant=\"flat\"\n          color=\"primary\"\n          disabled={connect.isPending}\n        >\n          <Trans message=\"Connect\" />\n        </Button>\n      </DialogFooter>\n    </Dialog>\n  );\n}\n\ninterface SocialLoginButtonProps {\n  onClick: () => void;\n  label: MessageDescriptor;\n  icon: ReactElement;\n}\nfunction SocialLoginButton({onClick, label, icon}: SocialLoginButtonProps) {\n  const {trans} = useTrans();\n  const settings = useSettings();\n\n  if (settings.social?.compact_buttons) {\n    return (\n      <IconButton variant=\"outline\" aria-label={trans(label)} onClick={onClick}>\n        {icon}\n      </IconButton>\n    );\n  }\n\n  return (\n    <Button\n      variant=\"outline\"\n      startIcon={icon}\n      onClick={onClick}\n      className=\"min-h-42 w-full\"\n    >\n      <span className=\"min-w-160 text-start\">\n        <Trans {...label} />\n      </span>\n    </Button>\n  );\n}\n"],"names":["useConnectSocialWithPassword","form","navigate","useNavigate","getRedirectUri","useAuth","useMutation","connect","response","setBootstrapData","r","onFormQueryError","payload","apiClient","googleLabel","message","facebookLabel","twitterLabel","envatoLabel","SocialAuthSection","dividerMessage","isUsingInvite","social","useSettings","loginWithSocial","requestingPassword","setIsRequestingPassword","useSocialLogin","useAllSocialLoginsDisabled","handleSocialLogin","service","e","Fragment","jsx","jsxs","clsx","_a","SocialLoginButton","GoogleIcon","_b","FacebookIcon","_c","TwitterIcon","_d","EnvatoIcon","DialogTrigger","RequestPasswordDialog","useForm","formId","useDialogContext","Dialog","DialogHeader","Trans","DialogBody","Form","FormTextField","DialogFooter","Button","onClick","label","icon","trans","useTrans","IconButton"],"mappings":"+cAiBO,SAASA,EACdC,EACA,CACA,MAAMC,EAAWC,EAAA,EACX,CAAC,eAAAC,CAAA,EAAkBC,EAAA,EACzB,OAAOC,EAAY,CACjB,WAAYC,EACZ,UAAWC,GAAY,CACrBC,EAAiBD,EAAS,aAAa,EACvCN,EAASE,EAAA,EAAkB,CAAC,QAAS,GAAK,CAC5C,EACA,QAASM,GAAKC,EAAiBD,EAAGT,CAAI,CAAA,CACvC,CACH,CAEA,SAASM,EAAQK,EAAkD,CACjE,OAAOC,EACJ,KAAK,6BAA8BD,CAAO,EAC1C,KAAKJ,GAAYA,EAAS,IAAI,CACnC,CCFA,MAAMM,EAAcC,EAAQ,sBAAsB,EAC5CC,EAAgBD,EAAQ,wBAAwB,EAChDE,EAAeF,EAAQ,uBAAuB,EAC9CG,EAAcH,EAAQ,sBAAsB,EAM3C,SAASI,GAAkB,CAChC,eAAAC,EACA,cAAAC,CACF,EAA2B,aACzB,KAAM,CAAC,OAAAC,CAAA,EAAUC,EAAA,EACXrB,EAAWC,EAAA,EACX,CAAC,eAAAC,CAAA,EAAkBC,EAAA,EACnB,CAAC,gBAAAmB,EAAiB,mBAAAC,EAAoB,wBAAAC,CAAA,EAC1CC,EAAA,EAEF,GAAIC,EAA2B,CAAC,cAAAP,CAAA,CAAc,EAC5C,OAAO,KAGT,MAAMQ,EAAoB,MAAOC,GAA2B,CAC1D,MAAMC,EAAI,MAAMP,EAAgBM,CAAO,IACnCC,GAAA,YAAAA,EAAG,UAAW,YAAaA,GAAA,YAAAA,EAAG,UAAW,sBAC3C7B,EAASE,EAAA,EAAkB,CAAC,QAAS,GAAK,CAE9C,EAEA,cACG4B,WAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,6IACb,SAAAA,EAAAA,IAAC,QAAK,UAAU,qDACb,WACH,CAAA,CACF,EACAC,EAAAA,KAAC,MAAA,CACC,UAAWC,EACT,0CACA,EAACb,GAAA,MAAAA,EAAQ,kBAAmB,UAAA,EAG7B,SAAA,EAAAc,EAAAd,GAAA,YAAAA,EAAQ,SAAR,MAAAc,EAAgB,OACfH,EAAAA,IAACI,EAAA,CACC,MAAOvB,EACP,KAAMmB,EAAAA,IAACK,EAAA,CAAW,QAAQ,WAAA,CAAY,EACtC,QAAS,IAAMT,EAAkB,QAAQ,CAAA,CAAA,EAEzC,MACHU,EAAAjB,GAAA,YAAAA,EAAQ,WAAR,MAAAiB,EAAkB,OACjBN,EAAAA,IAACI,EAAA,CACC,MAAOrB,EACP,KAAMiB,EAAAA,IAACO,EAAA,CAAa,UAAU,eAAA,CAAgB,EAC9C,QAAS,IAAMX,EAAkB,UAAU,CAAA,CAAA,EAE3C,MACHY,EAAAnB,GAAA,YAAAA,EAAQ,UAAR,MAAAmB,EAAiB,OAChBR,EAAAA,IAACI,EAAA,CACC,MAAOpB,EACP,KAAMgB,EAAAA,IAACS,EAAA,CAAY,UAAU,cAAA,CAAe,EAC5C,QAAS,IAAMb,EAAkB,SAAS,CAAA,CAAA,EAE1C,MACHc,EAAArB,GAAA,YAAAA,EAAQ,SAAR,MAAAqB,EAAgB,QAAU,CAACtB,EAC1BY,EAAAA,IAACI,EAAA,CACC,MAAOnB,EACP,KAAMe,EAAAA,IAACW,EAAA,CAAW,QAAQ,YAAY,UAAU,cAAc,EAC9D,QAAS,IAAMf,EAAkB,QAAQ,CAAA,CAAA,EAEzC,IAAA,CAAA,CAAA,EAENI,EAAAA,IAACY,EAAA,CACC,KAAK,QACL,OAAQpB,EACR,aAAcC,EAEd,eAACoB,EAAA,CAAA,CAAsB,CAAA,CAAA,CACzB,EACF,CAEJ,CAEA,SAASA,GAAwB,CAC/B,MAAM7C,EAAO8C,EAAA,EACP,CAAC,OAAAC,CAAA,EAAUC,EAAA,EACX1C,EAAUP,EAA6BC,CAAI,EACjD,cACGiD,EAAA,CACC,SAAA,CAAAjB,MAACkB,EAAA,CACC,SAAAlB,EAAAA,IAACmB,EAAA,CAAM,QAAQ,oBAAoB,EACrC,SACCC,EAAA,CACC,SAAA,CAAApB,EAAAA,IAAC,OAAI,UAAU,2BACb,eAACmB,EAAA,CAAM,QAAQ,+HAA+H,CAAA,CAChJ,EACAnB,EAAAA,IAACqB,EAAA,CACC,KAAArD,EACA,GAAI+C,EACJ,SAAUpC,GAAW,CACnBL,EAAQ,OAAOK,CAAO,CACxB,EAEA,SAAAqB,EAAAA,IAACsB,EAAA,CACC,UAAS,GACT,KAAK,WACL,KAAK,WACL,SAAQ,GACR,MAAOtB,EAAAA,IAACmB,EAAA,CAAM,QAAQ,UAAA,CAAW,CAAA,CAAA,CACnC,CAAA,CACF,EACF,SACCI,EAAA,CACC,SAAA,CAAAvB,EAAAA,IAACwB,GAAO,QAAQ,OACd,eAACL,EAAA,CAAM,QAAQ,SAAS,CAAA,CAC1B,EACAnB,EAAAA,IAACwB,EAAA,CACC,KAAK,SACL,KAAMT,EACN,QAAQ,OACR,MAAM,UACN,SAAUzC,EAAQ,UAElB,SAAA0B,EAAAA,IAACmB,EAAA,CAAM,QAAQ,SAAA,CAAU,CAAA,CAAA,CAC3B,CAAA,CACF,CAAA,EACF,CAEJ,CAOA,SAASf,EAAkB,CAAC,QAAAqB,EAAS,MAAAC,EAAO,KAAAC,GAA+B,OACzE,KAAM,CAAC,MAAAC,CAAA,EAASC,EAAA,EAGhB,OAAI1B,EAFab,EAAA,EAEJ,SAAT,MAAAa,EAAiB,gBAEjBH,MAAC8B,GAAW,QAAQ,UAAU,aAAYF,EAAMF,CAAK,EAAG,QAAAD,EACrD,SAAAE,CAAA,CACH,EAKF3B,EAAAA,IAACwB,EAAA,CACC,QAAQ,UACR,UAAWG,EACX,QAAAF,EACA,UAAU,kBAEV,SAAAzB,EAAAA,IAAC,QAAK,UAAU,uBACd,eAACmB,EAAA,CAAO,GAAGO,EAAO,CAAA,CACpB,CAAA,CAAA,CAGN"}