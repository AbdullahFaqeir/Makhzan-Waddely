import{$ as G}from"./useGlobalListeners-MjeT7y1B.js";import{r as w}from"./main-owSUWNVS.js";import{U as k}from"./uploaded-file-0zTC6Yq4.js";const m=new Map,S=new Map,B=new Map,p={status:"inactive"};function _(t){const s=new IntersectionObserver(e=>{e.forEach(a=>{const{width:i,height:f,left:D,top:b}=a.boundingClientRect,[I,c]=[...t].find(([,h])=>h.ref.current===a.target)||[];if(I==null||c==null)return;const v={width:i,height:f,left:D,top:b};t.set(I,{...c,rect:v})}),s.disconnect()});[...t.values()].forEach(e=>{e.ref.current&&s.observe(e.ref.current)})}let X=null;function M(t){X=t}function L({e:t,rect:s,deltaX:e,deltaY:a}){return{rect:s,x:t.clientX,y:t.clientY,deltaX:e??0,deltaY:a??0,nativeEvent:t}}function $(t){return{left:t.left,top:t.top,width:t.width,height:t.height}}function Q({id:t,disabled:s,ref:e,preview:a,hidePreview:i,...f}){const D=w.useRef(null),{addGlobalListener:b,removeAllGlobalListeners:I}=G(),c=w.useRef({lastPosition:{x:0,y:0}}).current,v=w.useRef(f);v.current=f,w.useLayoutEffect(()=>(s?m.delete(t):m.set(t,{...m.get(t),id:t,ref:e,type:v.current.type,getData:v.current.getData}),()=>{m.delete(t)}),[t,s,v,e]);const h=n=>{B.forEach(l=>{var d;l.type===((d=m.get(t))==null?void 0:d.type)&&n(l)})},r=n=>{var A,y;n.stopPropagation();const l=m.get(t),d=e.current,R=!D.current||!c.clickedEl||D.current.contains(c.clickedEl);if(X||!d||!l||!R){n.preventDefault(),n.stopPropagation();return}_(S),M("drag"),i&&H(n),n.dataTransfer.effectAllowed="move",c.lastPosition={x:n.clientX,y:n.clientY},c.currentRect=$(d.getBoundingClientRect());const E=L({rect:c.currentRect,e:n});a!=null&&a.current&&a.current(l,T=>{n.dataTransfer.setDragImage(T,0,0)}),p.status="dragging",p.dragTargetId=t,e.current&&(e.current.dataset.dragging="true"),(y=(A=v.current).onDragStart)==null||y.call(A,E,l),requestAnimationFrame(()=>{h(T=>{var O;return(O=T.onDragStart)==null?void 0:O.call(T,E,l)})}),b(window,"dragover",o,!0)},o=n=>{var y,T;if(n.stopPropagation(),n.preventDefault(),!c.currentRect)return;const l=n.clientX-c.lastPosition.x,d=n.clientY-c.lastPosition.y,R={...c.currentRect,left:c.currentRect.left+l,top:c.currentRect.top+d},E=L({rect:R,e:n,deltaX:l,deltaY:d}),A=m.get(t);A&&((T=(y=v.current).onDragMove)==null||T.call(y,E,A),h(O=>{var x;return(x=O.onDragMove)==null?void 0:x.call(O,E,A)})),c.lastPosition={x:n.clientX,y:n.clientY},c.currentRect=R};return{draggableProps:{draggable:!s,onDragStart:r,onDragEnd:n=>{var R,E;if(n.stopPropagation(),I(),!c.currentRect)return;M(null),P&&P.remove();const l=L({rect:c.currentRect,e:n}),d=m.get(t);d&&((E=(R=v.current).onDragEnd)==null||E.call(R,l,d),h(A=>{var y;return(y=A.onDragEnd)==null?void 0:y.call(A,l,d,p.status)})),requestAnimationFrame(()=>{p.dragTargetId=void 0,p.status="inactive",e.current&&delete e.current.dataset.dragging})},onPointerDown:n=>{c.clickedEl=n.target}},dragHandleRef:D}}let P;function H(t){P||(P=new Image,document.body.append(P),P.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),t.dataTransfer.setDragImage(P,0,0)}async function U(t){const s=[];for await(const e of t)s.push(e);return s}async function*q(t){const s=[];for(const e of t.items)if(e.kind==="file"){const a=e.webkitGetAsEntry();a&&s.push(a)}for(const e of s)if(e.isFile){if(e.name===".DS_Store")continue;const a=await C(e);yield new k(a,e.fullPath)}else e.isDirectory&&(yield*Y(e))}async function*Y(t){const s=t.createReader();let e;do{e=await new Promise((a,i)=>{s.readEntries(a,i)});for(const a of e)if(a.isFile){if(a.name===".DS_Store")continue;const i=await C(a);yield new k(i,a.fullPath)}else a.isDirectory&&(yield*Y(a))}while(e.length>0)}function C(t){return new Promise((s,e)=>t.file(s,e))}const z=400;function V({id:t,disabled:s,ref:e,...a}){const i=w.useRef({dragOverElements:new Set,dropActivateTimer:void 0}).current,f=w.useRef(a);f.current=a,w.useLayoutEffect(()=>(S.set(t,{...S.get(t),disabled:s,id:t,ref:e}),()=>{S.delete(t)}),[t,f,s,e]);const D=r=>{var g;const o=f.current,u=o.allowDragEventsFromItself||e.current!==((g=r.ref)==null?void 0:g.current);return!!(r!=null&&r.type&&u&&o.types.includes(r.type)&&(!o.acceptsDrop||o.acceptsDrop(r)))},b=r=>{var u,g;const o=F(r);o&&((g=(u=f.current).onDragLeave)==null||g.call(u,o))};return{droppableProps:s?{}:{onDragOver:r=>{var u,g;r.preventDefault(),r.stopPropagation();const o=F(r);o&&D(o)&&((g=(u=f.current).onDragOver)==null||g.call(u,o,r))},onDragEnter:r=>{var u,g;if(r.stopPropagation(),i.dragOverElements.add(r.target),i.dragOverElements.size>1)return;const o=F(r);o&&D(o)&&((g=(u=f.current).onDragEnter)==null||g.call(u,o),clearTimeout(i.dropActivateTimer),typeof f.current.onDropActivate=="function"&&(i.dropActivateTimer=setTimeout(()=>{var n,l;o&&((l=(n=f.current).onDropActivate)==null||l.call(n,o))},z)))},onDragLeave:r=>{r.stopPropagation(),i.dragOverElements.delete(r.target);for(const u of i.dragOverElements)r.currentTarget.contains(u)||i.dragOverElements.delete(u);if(i.dragOverElements.size>0)return;const o=F(r);o&&D(o)&&(b(r),clearTimeout(i.dropActivateTimer))},onDrop:async r=>{var u,g,n,l;r.preventDefault(),r.stopPropagation(),i.dragOverElements.clear(),b(r),clearTimeout(i.dropActivateTimer);const o=F(r);if(o)if((g=(u=f.current).onDragLeave)==null||g.call(u,o),!D(o))p.status!=="inactive"&&(p.status="dropFail");else{const d=(l=(n=f.current).onDrop)==null?void 0:l.call(n,o);p.status!=="inactive"&&(p.status=d===!1?"dropFail":"dropSuccess")}}}}}function F(t){if(p.dragTargetId!=null)return m.get(p.dragTargetId);if(t.dataTransfer.types.includes("Files"))return{type:"nativeFile",el:null,ref:null,getData:()=>U(q(t.dataTransfer))}}export{S as a,V as b,X as c,B as d,_ as e,Q as u};
//# sourceMappingURL=use-droppable-C1L4PX9b.js.map
