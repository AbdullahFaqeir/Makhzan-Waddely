{"version":3,"file":"create-custom-page-Dco63y4R.js","sources":["../../../common/foundation/resources/client/admin/custom-pages/requests/use-create-custom-page.ts","../../../common/foundation/resources/client/admin/custom-pages/create-custom-page.tsx"],"sourcesContent":["import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {DatatableDataQueryKey} from '@common/datatable/requests/paginated-resources';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {useMutation} from '@tanstack/react-query';\nimport {message} from '@ui/i18n/message';\nimport {toast} from '@ui/toast/toast';\nimport {CustomPage} from '../custom-page';\n\ninterface Response extends BackendResponse {\n  page: CustomPage;\n}\n\nexport interface CreateCustomPagePayload {\n  title?: string;\n  body?: string;\n  slug?: string;\n  hide_nav?: boolean;\n}\n\nexport function useCreateCustomPage(endpoint?: string) {\n  const finalEndpoint = endpoint || 'custom-pages';\n  return useMutation({\n    mutationFn: (payload: CreateCustomPagePayload) =>\n      createPage(payload, finalEndpoint),\n    onError: err => showHttpErrorToast(err),\n    onSuccess: async () => {\n      await queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.customPages.invalidateKey,\n      });\n      await queryClient.invalidateQueries({\n        queryKey: DatatableDataQueryKey(finalEndpoint),\n      });\n      toast(message('Page created'));\n    },\n  });\n}\n\nfunction createPage(\n  payload: CreateCustomPagePayload,\n  endpoint: string,\n): Promise<Response> {\n  return apiClient.post(`${endpoint}`, payload).then(r => r.data);\n}\n","import {UploadType} from '@app/site-config';\nimport {\n  CreateCustomPagePayload,\n  useCreateCustomPage,\n} from '@common/admin/custom-pages/requests/use-create-custom-page';\nimport ArticleEditorPage from '@common/article-editor/article-editor-page';\nimport {StaticPageTitle} from '@common/seo/static-page-title';\nimport {useNavigate} from '@common/ui/navigation/use-navigate';\nimport {Breadcrumb} from '@ui/breadcrumbs/breadcrumb';\nimport {BreadcrumbItem} from '@ui/breadcrumbs/breadcrumb-item';\nimport {Button} from '@ui/buttons/button';\nimport {Trans} from '@ui/i18n/trans';\nimport {Fragment} from 'react';\nimport {FormProvider, useForm} from 'react-hook-form';\n\nexport function Component() {\n  const navigate = useNavigate();\n  const createPage = useCreateCustomPage();\n  const form = useForm<CreateCustomPagePayload>();\n\n  const handleSave = () => {\n    createPage.mutate(form.getValues(), {\n      onSuccess: () => navigate('../', {relative: 'path'}),\n    });\n  };\n\n  const saveButton = (\n    <Button\n      variant=\"flat\"\n      color=\"primary\"\n      size=\"xs\"\n      onClick={() => handleSave()}\n      disabled={createPage.isPending}\n    >\n      <Trans message=\"Create\" />\n    </Button>\n  );\n\n  const breadCrumb = (\n    <Breadcrumb size=\"xl\">\n      <BreadcrumbItem to=\"..\" relative=\"path\">\n        <Trans message=\"Custom pages\" />\n      </BreadcrumbItem>\n      <BreadcrumbItem>\n        <Trans message=\"New page\" />\n      </BreadcrumbItem>\n    </Breadcrumb>\n  );\n\n  return (\n    <Fragment>\n      <StaticPageTitle>\n        <Trans message=\"New custom page\" />\n      </StaticPageTitle>\n      <FormProvider {...form}>\n        <ArticleEditorPage\n          imageUploadType={UploadType.articleImages}\n          saveButton={saveButton}\n          title={breadCrumb}\n          onChange={value => {\n            form.setValue('body', value, {shouldDirty: true});\n          }}\n        />\n      </FormProvider>\n    </Fragment>\n  );\n}\n"],"names":["useCreateCustomPage","endpoint","finalEndpoint","useMutation","payload","createPage","err","showHttpErrorToast","queryClient","commonAdminQueries","DatatableDataQueryKey","toast","message","apiClient","r","Component","navigate","useNavigate","form","useForm","handleSave","saveButton","jsx","Button","Trans","breadCrumb","jsxs","Breadcrumb","BreadcrumbItem","Fragment","StaticPageTitle","FormProvider","ArticleEditorPage","UploadType","value"],"mappings":"urCAqBO,SAASA,EAAoBC,EAAmB,CACrD,MAAMC,EAA4B,eAClC,OAAOC,EAAY,CACjB,WAAaC,GACXC,EAAWD,EAASF,CAAa,EACnC,QAASI,GAAOC,EAAmBD,CAAG,EACtC,UAAW,SAAY,CACrB,MAAME,EAAY,kBAAkB,CAClC,SAAUC,EAAmB,YAAY,aAAA,CAC1C,EACD,MAAMD,EAAY,kBAAkB,CAClC,SAAUE,EAAsBR,CAAa,CAAA,CAC9C,EACDS,EAAMC,EAAQ,cAAc,CAAC,CAC/B,CAAA,CACD,CACH,CAEA,SAASP,EACPD,EACAH,EACmB,CACnB,OAAOY,EAAU,KAAK,GAAGZ,CAAQ,GAAIG,CAAO,EAAE,KAAKU,GAAKA,EAAE,IAAI,CAChE,CC7BO,SAASC,IAAY,CAC1B,MAAMC,EAAWC,EAAA,EACXZ,EAAaL,EAAA,EACbkB,EAAOC,EAAA,EAEPC,EAAa,IAAM,CACvBf,EAAW,OAAOa,EAAK,YAAa,CAClC,UAAW,IAAMF,EAAS,MAAO,CAAC,SAAU,OAAO,CAAA,CACpD,CACH,EAEMK,EACJC,EAAAA,IAACC,EAAA,CACC,QAAQ,OACR,MAAM,UACN,KAAK,KACL,QAAS,IAAMH,EAAA,EACf,SAAUf,EAAW,UAErB,SAAAiB,EAAAA,IAACE,EAAA,CAAM,QAAQ,QAAA,CAAS,CAAA,CAAA,EAItBC,EACJC,EAAAA,KAACC,EAAA,CAAW,KAAK,KACf,SAAA,CAAAL,EAAAA,IAACM,EAAA,CAAe,GAAG,KAAK,SAAS,OAC/B,SAAAN,EAAAA,IAACE,EAAA,CAAM,QAAQ,cAAA,CAAe,CAAA,CAChC,QACCI,EAAA,CACC,SAAAN,EAAAA,IAACE,EAAA,CAAM,QAAQ,WAAW,CAAA,CAC5B,CAAA,EACF,EAGF,cACGK,WAAA,CACC,SAAA,CAAAP,MAACQ,EAAA,CACC,SAAAR,EAAAA,IAACE,EAAA,CAAM,QAAQ,kBAAkB,EACnC,EACAF,EAAAA,IAACS,EAAA,CAAc,GAAGb,EAChB,SAAAI,EAAAA,IAACU,EAAA,CACC,gBAAiBC,EAAW,cAC5B,WAAAZ,EACA,MAAOI,EACP,SAAUS,GAAS,CACjBhB,EAAK,SAAS,OAAQgB,EAAO,CAAC,YAAa,GAAK,CAClD,CAAA,CAAA,CACF,CACF,CAAA,EACF,CAEJ"}