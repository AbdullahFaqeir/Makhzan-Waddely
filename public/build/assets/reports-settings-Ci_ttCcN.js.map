{"version":3,"file":"reports-settings-Ci_ttCcN.js","sources":["../../../common/foundation/resources/client/ui/library/forms/input-field/file-field.tsx","../../../common/foundation/resources/client/admin/settings/pages/reports-settings.tsx"],"sourcesContent":["import React, {ChangeEventHandler} from 'react';\nimport {mergeProps, useObjectRef} from '@react-aria/utils';\nimport {useController} from 'react-hook-form';\nimport clsx from 'clsx';\nimport {BaseFieldProps} from './base-field-props';\nimport {useField} from './use-field';\nimport {getInputFieldClassNames} from './get-input-field-class-names';\nimport {Field} from './field';\nimport {TextFieldProps} from './text-field/text-field';\n\nexport interface FileFieldProps\n  extends Omit<BaseFieldProps, 'type'> {\n  onChange?: ChangeEventHandler<'input'>;\n  accept?: string;\n}\nexport const FileField = React.forwardRef<HTMLInputElement, FileFieldProps>(\n  (props, ref) => {\n    const inputRef = useObjectRef(ref);\n\n    const {fieldProps, inputProps} = useField({...props, focusRef: inputRef});\n\n    const inputFieldClassNames = getInputFieldClassNames(props);\n\n    return (\n      <Field ref={ref} fieldClassNames={inputFieldClassNames} {...fieldProps}>\n        <input\n          type=\"file\"\n          ref={inputRef}\n          {...inputProps as any}\n          className={clsx(\n            inputFieldClassNames.input,\n            'py-8',\n            'file:bg-primary file:text-on-primary file:border-none file:rounded file:text-sm file:font-semibold file:px-10 file:h-24 file:mr-10'\n          )}\n        />\n      </Field>\n    );\n  }\n);\n\nexport interface FormFileFieldProps extends FileFieldProps {\n  name: string;\n}\nexport function FormFileField({name, ...props}: FormFileFieldProps) {\n  const {\n    field: {onChange, onBlur, ref},\n    fieldState: {invalid, error},\n  } = useController({\n    name,\n  });\n\n  const [value, setValue] = React.useState('');\n\n  const formProps: TextFieldProps = {\n    onChange: e => {\n      onChange(e.target.files?.[0]);\n      setValue(e.target.value);\n    },\n    onBlur,\n    value,\n    invalid,\n    errorMessage: error?.message,\n  };\n\n  return <FileField ref={ref} {...mergeProps(formProps, props)} />;\n}\n","import {AdminDocsUrls} from '@app/admin/admin-config';\nimport {AdminSettings} from '@common/admin/settings/admin-settings';\nimport {SettingsErrorGroup} from '@common/admin/settings/layout/settings-error-group';\nimport {AdminSettingsLayout} from '@common/admin/settings/layout/settings-layout';\nimport {DocsLink} from '@common/admin/settings/layout/settings-links';\nimport {SettingsPanel} from '@common/admin/settings/layout/settings-panel';\nimport {useAdminSettings} from '@common/admin/settings/requests/use-admin-settings';\nimport {FormFileField} from '@ui/forms/input-field/file-field';\nimport {FormTextField} from '@ui/forms/input-field/text-field/text-field';\nimport {Trans} from '@ui/i18n/trans';\nimport {Fragment} from 'react';\nimport {useForm, useFormContext} from 'react-hook-form';\n\nexport function Component() {\n  const {data} = useAdminSettings();\n  const form = useForm<AdminSettings>({\n    defaultValues: {\n      files: {\n        // form will be marked as dirty without this\n        certificate: '' as unknown as undefined,\n      },\n      server: {\n        analytics_property_id: data.server.analytics_property_id ?? '',\n      },\n      client: {\n        analytics: {\n          tracking_code: data.client.analytics?.tracking_code ?? '',\n          gchart_api_key: data.client.analytics?.gchart_api_key ?? '',\n        },\n      },\n    },\n  });\n\n  return (\n    <AdminSettingsLayout title={<Trans message=\"Analytics\" />} form={form}>\n      <GoogleAnalyticsPanel />\n    </AdminSettingsLayout>\n  );\n}\n\nfunction GoogleAnalyticsPanel() {\n  const {clearErrors} = useFormContext();\n  return (\n    <SettingsPanel\n      layout=\"vertical\"\n      title={<Trans message=\"Google Analytics\" />}\n      description={\n        <Trans message=\"Configure Google Analytics integration for tracking site usage and displaying statistics.\" />\n      }\n      link={\n        AdminDocsUrls.settings.googleAnalytics ? (\n          <DocsLink link={AdminDocsUrls.settings.googleAnalytics} />\n        ) : null\n      }\n    >\n      <SettingsErrorGroup\n        separatorTop={false}\n        separatorBottom={false}\n        name=\"analytics_group\"\n      >\n        {isInvalid => (\n          <Fragment>\n            <FormFileField\n              size=\"md\"\n              className=\"mb-20\"\n              onChange={() => clearErrors()}\n              invalid={isInvalid}\n              name=\"files.certificate\"\n              accept=\".json\"\n              label={\n                <Trans message=\"Google service account key file (.json)\" />\n              }\n            />\n            <FormTextField\n              size=\"sm\"\n              className=\"mb-20\"\n              onChange={() => clearErrors()}\n              invalid={isInvalid}\n              name=\"server.analytics_property_id\"\n              type=\"number\"\n              label={<Trans message=\"Google analytics property ID\" />}\n            />\n            <FormTextField\n              size=\"sm\"\n              className=\"mb-20\"\n              onChange={() => clearErrors()}\n              invalid={isInvalid}\n              name=\"client.analytics.tracking_code\"\n              placeholder=\"G-******\"\n              min=\"1\"\n              max=\"20\"\n              description={\n                <Trans message=\"Google analytics measurement ID only, not the whole javascript snippet.\" />\n              }\n              label={<Trans message=\"Google tag manager measurement ID\" />}\n            />\n            <FormTextField\n              size=\"sm\"\n              name=\"client.analytics.gchart_api_key\"\n              label={<Trans message=\"Google maps javascript API key\" />}\n              description={\n                <Trans message=\"Only required in order to show world geochart on integrated analytics pages.\" />\n              }\n            />\n          </Fragment>\n        )}\n      </SettingsErrorGroup>\n    </SettingsPanel>\n  );\n}\n"],"names":["FileField","React","props","ref","inputRef","useObjectRef","fieldProps","inputProps","useField","inputFieldClassNames","getInputFieldClassNames","Field","jsx","clsx","FormFileField","name","onChange","onBlur","invalid","error","useController","value","setValue","formProps","e","_a","mergeProps","Component","data","useAdminSettings","form","useForm","_b","AdminSettingsLayout","Trans","GoogleAnalyticsPanel","clearErrors","useFormContext","SettingsPanel","AdminDocsUrls","DocsLink","SettingsErrorGroup","isInvalid","Fragment","FormTextField"],"mappings":"85BAeO,MAAMA,EAAYC,EAAM,WAC7B,CAACC,EAAOC,IAAQ,CACd,MAAMC,EAAWC,EAAaF,CAAG,EAE3B,CAAC,WAAAG,EAAY,WAAAC,GAAcC,EAAS,CAAC,GAAGN,EAAO,SAAUE,EAAS,EAElEK,EAAuBC,EAAwBR,CAAK,EAE1D,aACGS,EAAA,CAAM,IAAAR,EAAU,gBAAiBM,EAAuB,GAAGH,EAC1D,SAAAM,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,IAAKR,EACJ,GAAGG,EACJ,UAAWM,EACTJ,EAAqB,MACrB,OACA,oIAAA,CACF,CAAA,EAEJ,CAEJ,CACF,EAKO,SAASK,EAAc,CAAC,KAAAC,EAAM,GAAGb,GAA4B,CAClE,KAAM,CACJ,MAAO,CAAC,SAAAc,EAAU,OAAAC,EAAQ,IAAAd,CAAA,EAC1B,WAAY,CAAC,QAAAe,EAAS,MAAAC,CAAA,CAAK,EACzBC,EAAc,CAChB,KAAAL,CAAA,CACD,EAEK,CAACM,EAAOC,CAAQ,EAAIrB,EAAM,SAAS,EAAE,EAErCsB,EAA4B,CAChC,SAAUC,GAAK,OACbR,GAASS,EAAAD,EAAE,OAAO,QAAT,YAAAC,EAAiB,EAAE,EAC5BH,EAASE,EAAE,OAAO,KAAK,CACzB,EACA,OAAAP,EACA,MAAAI,EACA,QAAAH,EACA,aAAcC,GAAA,YAAAA,EAAO,OAAA,EAGvB,aAAQnB,EAAA,CAAU,IAAAG,EAAW,GAAGuB,EAAWH,EAAWrB,CAAK,EAAG,CAChE,CCpDO,SAASyB,GAAY,SAC1B,KAAM,CAAC,KAAAC,CAAA,EAAQC,EAAA,EACTC,EAAOC,EAAuB,CAClC,cAAe,CACb,MAAO,CAEL,YAAa,EAAA,EAEf,OAAQ,CACN,sBAAuBH,EAAK,OAAO,uBAAyB,EAAA,EAE9D,OAAQ,CACN,UAAW,CACT,gBAAeH,EAAAG,EAAK,OAAO,YAAZ,YAAAH,EAAuB,gBAAiB,GACvD,iBAAgBO,EAAAJ,EAAK,OAAO,YAAZ,YAAAI,EAAuB,iBAAkB,EAAA,CAC3D,CACF,CACF,CACD,EAED,OACEpB,EAAAA,IAACqB,EAAA,CAAoB,MAAOrB,EAAAA,IAACsB,EAAA,CAAM,QAAQ,WAAA,CAAY,EAAI,KAAAJ,EACzD,SAAAlB,EAAAA,IAACuB,EAAA,CAAA,CAAqB,EACxB,CAEJ,CAEA,SAASA,GAAuB,CAC9B,KAAM,CAAC,YAAAC,CAAA,EAAeC,EAAA,EACtB,OACEzB,EAAAA,IAAC0B,EAAA,CACC,OAAO,WACP,MAAO1B,EAAAA,IAACsB,EAAA,CAAM,QAAQ,kBAAA,CAAmB,EACzC,YACEtB,EAAAA,IAACsB,EAAA,CAAM,QAAQ,2FAAA,CAA4F,EAE7G,KACEK,EAAc,SAAS,gBACrB3B,EAAAA,IAAC4B,GAAS,KAAMD,EAAc,SAAS,eAAA,CAAiB,EACtD,KAGN,SAAA3B,EAAAA,IAAC6B,EAAA,CACC,aAAc,GACd,gBAAiB,GACjB,KAAK,kBAEJ,SAAAC,UACEC,EAAAA,SAAA,CACC,SAAA,CAAA/B,EAAAA,IAACE,EAAA,CACC,KAAK,KACL,UAAU,QACV,SAAU,IAAMsB,EAAA,EAChB,QAASM,EACT,KAAK,oBACL,OAAO,QACP,MACE9B,EAAAA,IAACsB,EAAA,CAAM,QAAQ,yCAAA,CAA0C,CAAA,CAAA,EAG7DtB,EAAAA,IAACgC,EAAA,CACC,KAAK,KACL,UAAU,QACV,SAAU,IAAMR,EAAA,EAChB,QAASM,EACT,KAAK,+BACL,KAAK,SACL,MAAO9B,EAAAA,IAACsB,EAAA,CAAM,QAAQ,8BAAA,CAA+B,CAAA,CAAA,EAEvDtB,EAAAA,IAACgC,EAAA,CACC,KAAK,KACL,UAAU,QACV,SAAU,IAAMR,EAAA,EAChB,QAASM,EACT,KAAK,iCACL,YAAY,WACZ,IAAI,IACJ,IAAI,KACJ,YACE9B,EAAAA,IAACsB,EAAA,CAAM,QAAQ,yEAAA,CAA0E,EAE3F,MAAOtB,EAAAA,IAACsB,EAAA,CAAM,QAAQ,mCAAA,CAAoC,CAAA,CAAA,EAE5DtB,EAAAA,IAACgC,EAAA,CACC,KAAK,KACL,KAAK,kCACL,MAAOhC,EAAAA,IAACsB,EAAA,CAAM,QAAQ,gCAAA,CAAiC,EACvD,YACEtB,EAAAA,IAACsB,EAAA,CAAM,QAAQ,8EAAA,CAA+E,CAAA,CAAA,CAElG,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CAGN"}