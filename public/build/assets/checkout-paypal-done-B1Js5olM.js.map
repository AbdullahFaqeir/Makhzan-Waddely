{"version":3,"file":"checkout-paypal-done-B1Js5olM.js","sources":["../../../common/foundation/resources/client/billing/checkout/paypal/checkout-paypal-done.tsx"],"sourcesContent":["import {apiClient} from '@common/http/query-client';\nimport {message} from '@ui/i18n/message';\nimport {useEffect, useRef, useState} from 'react';\nimport {useParams, useSearchParams} from 'react-router';\nimport {\n  BillingRedirectMessage,\n  BillingRedirectMessageConfig,\n} from '../../billing-redirect-message';\nimport {CheckoutLayout} from '../checkout-layout';\nimport {CheckoutProductSummary} from '../checkout-product-summary';\n\nexport function Component() {\n  const {productId, priceId} = useParams();\n  const [params] = useSearchParams();\n  const alreadyStoredLocally = useRef(false);\n\n  const [messageConfig, setMessageConfig] =\n    useState<BillingRedirectMessageConfig>();\n\n  useEffect(() => {\n    const subscriptionId = params.get('subscriptionId');\n    const status = params.get('status');\n\n    if (alreadyStoredLocally.current) {\n      return;\n    }\n\n    if (subscriptionId && status === 'success') {\n      storeSubscriptionDetailsLocally(subscriptionId).then(() => {\n        setMessageConfig(\n          getRedirectMessageConfig('success', productId, priceId),\n        );\n        window.location.href = '/billing';\n      });\n    } else {\n      setMessageConfig(getRedirectMessageConfig(status, productId, priceId));\n    }\n    alreadyStoredLocally.current = true;\n  }, [priceId, productId, params]);\n\n  return (\n    <CheckoutLayout>\n      <BillingRedirectMessage config={messageConfig} />\n      <CheckoutProductSummary showBillingLine={false} />\n    </CheckoutLayout>\n  );\n}\n\nfunction getRedirectMessageConfig(\n  status?: 'success' | 'error' | string | null,\n  productId?: string,\n  priceId?: string,\n): BillingRedirectMessageConfig {\n  switch (status) {\n    case 'success':\n      return {\n        message: message('Subscription successful!'),\n        status: 'success',\n        buttonLabel: message('Return to site'),\n        link: '/billing',\n      };\n    default:\n      return {\n        message: message('Something went wrong. Please try again.'),\n        status: 'error',\n        buttonLabel: message('Go back'),\n        link: errorLink(productId, priceId),\n      };\n  }\n}\n\nfunction errorLink(productId?: string, priceId?: string): string {\n  return productId && priceId ? `/checkout/${productId}/${priceId}` : '/';\n}\n\nfunction storeSubscriptionDetailsLocally(subscriptionId: string) {\n  return apiClient.post('billing/paypal/store-subscription-details-locally', {\n    paypal_subscription_id: subscriptionId,\n  });\n}\n"],"names":["Component","productId","priceId","useParams","params","useSearchParams","alreadyStoredLocally","useRef","messageConfig","setMessageConfig","useState","useEffect","subscriptionId","status","storeSubscriptionDetailsLocally","getRedirectMessageConfig","CheckoutLayout","jsx","BillingRedirectMessage","CheckoutProductSummary","message","errorLink","apiClient"],"mappings":"6XAWO,SAASA,GAAY,CAC1B,KAAM,CAAC,UAAAC,EAAW,QAAAC,CAAA,EAAWC,EAAA,EACvB,CAACC,CAAM,EAAIC,EAAA,EACXC,EAAuBC,EAAAA,OAAO,EAAK,EAEnC,CAACC,EAAeC,CAAgB,EACpCC,WAAA,EAEFC,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAiBR,EAAO,IAAI,gBAAgB,EAC5CS,EAAST,EAAO,IAAI,QAAQ,EAE9BE,EAAqB,UAIrBM,GAAkBC,IAAW,UAC/BC,EAAgCF,CAAc,EAAE,KAAK,IAAM,CACzDH,EACEM,EAAyB,UAAWd,EAAWC,CAAO,CAAA,EAExD,OAAO,SAAS,KAAO,UACzB,CAAC,EAEDO,EAAiBM,EAAyBF,EAAQZ,EAAWC,CAAO,CAAC,EAEvEI,EAAqB,QAAU,GACjC,EAAG,CAACJ,EAASD,EAAWG,CAAM,CAAC,SAG5BY,EAAA,CACC,SAAA,CAAAC,EAAAA,IAACC,EAAA,CAAuB,OAAQV,CAAA,CAAe,EAC/CS,EAAAA,IAACE,EAAA,CAAuB,gBAAiB,EAAA,CAAO,CAAA,EAClD,CAEJ,CAEA,SAASJ,EACPF,EACAZ,EACAC,EAC8B,CAC9B,OAAQW,EAAA,CACN,IAAK,UACH,MAAO,CACL,QAASO,EAAQ,0BAA0B,EAC3C,OAAQ,UACR,YAAaA,EAAQ,gBAAgB,EACrC,KAAM,UAAA,EAEV,QACE,MAAO,CACL,QAASA,EAAQ,yCAAyC,EAC1D,OAAQ,QACR,YAAaA,EAAQ,SAAS,EAC9B,KAAMC,EAAUpB,EAAWC,CAAO,CAAA,CACpC,CAEN,CAEA,SAASmB,EAAUpB,EAAoBC,EAA0B,CAC/D,OAAOD,GAAaC,EAAU,aAAaD,CAAS,IAAIC,CAAO,GAAK,GACtE,CAEA,SAASY,EAAgCF,EAAwB,CAC/D,OAAOU,EAAU,KAAK,oDAAqD,CACzE,uBAAwBV,CAAA,CACzB,CACH"}