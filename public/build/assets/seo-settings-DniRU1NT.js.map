{"version":3,"mappings":";wxBAeA,MAAMA,EAAYC,EAAM,KAAK,IAAAC,EAAA,IAAM,OAAO,0BAA+B,2CAAC,EAEnE,SAASC,GAAY,CAC1B,KAAM,CACJ,KAAM,CAAC,KAAAC,CAAA,CAAI,EACTC,EAAiBC,EAAmB,SAAS,SAAS,EAEpD,CAACC,EAAcC,CAAe,EAAIC,EAAA,EAClCC,EAAeH,EAAa,IAAI,MAAM,GAAK,OAAO,KAAKH,CAAI,EAAE,CAAC,EAEpE,OACEO,MAACC,EAAA,CACC,KAAMF,EAEN,OACEC,MAACE,EAAA,CACC,MAAOF,MAACG,EAAA,CAAM,QAAQ,OAAO,EAC7B,cAAc,SACd,cAAeJ,EACf,kBAAmBK,GAASP,EAAgB,CAAC,KAAMO,EAAgB,EACnE,UAAU,QAET,gBAAO,QAAQX,CAAI,EAAE,IAAI,CAAC,CAACY,CAAG,IAC7BL,MAACM,GAAe,MAAOD,EACpB,WAAWA,CAAG,GADNA,CAEX,CACD,GACH,EAdGN,CAAA,CAkBX,CAMA,SAASE,EAAa,CAAC,KAAAM,EAAM,OAAAC,GAA4B,CACvD,KAAM,CACJ,KAAM,CAAC,KAAAf,CAAA,CAAI,EACTC,EAAiBC,EAAmB,SAAS,SAAS,EAEpDc,EAAOC,EAAuB,CAClC,cAAe,CACb,IAAK,CACH,CAACH,CAAI,EAAGd,EAAKc,CAAI,EAAE,QAAUd,EAAKc,CAAI,EAAE,SAC1C,CACF,CACD,EAED,OACEI,OAACC,EAAA,CACC,KAAAH,EACA,MAAOT,MAACG,EAAA,CAAM,QAAQ,WAAW,EACjC,SAAUU,EAAc,SAAS,IAEhC,UAAAL,EACDR,MAAC,OAAI,UAAU,eACb,eAACG,EAAA,CAAM,QAAQ,UAAU,EAC3B,EACAH,MAACc,GAAW,KAAAP,CAAA,CAAY,IAG9B,CAKA,SAASO,EAAW,CAAC,KAAAP,GAAwB,CAC3C,KAAM,CACJ,KAAM,CAAC,KAAAd,CAAA,CAAI,EACTC,EAAiBC,EAAmB,SAAS,SAAS,EACpDoB,EAAYC,SAAwB,IAAI,EACxC,CAAC,SAAAC,EAAU,UAAAC,EAAW,SAAAC,EAAU,YAAAC,CAAA,EACpCC,EAAA,EAIIC,EAAeN,SAAO,EAAI,EAEhC,cACGO,WAAA,CAAS,eAAWC,EAAA,CAAe,gBAAe,GAAC,EAClD,UAAAxB,MAAC,OAAI,UAAU,sDACb,SAAAA,MAACX,EAAA,CACC,UAAA0B,EACA,SAAU,GACV,KAAK,oBACL,OAAQ,IAAM,CACZ,WAAW,IAAOO,EAAa,QAAU,GAAQ,EAAE,CACrD,EACA,SAAUG,GAAY,CACpB,GAAI,CAACH,EAAa,QAChB,OAAOL,EAAS,OAAOV,CAAI,GAAIkB,EAAU,CAAC,YAAa,GAAK,CAEhE,EACA,aAAcP,EAAU,OAAOX,CAAI,EAAE,GAAK,GAC1C,gBAAiBmB,GAAW,CACtBA,EACFN,EAAY,OAAOb,CAAI,EAAE,EAEzBY,EAAS,OAAOZ,CAAI,GAAI,CAAC,KAAM,SAAS,CAE5C,IAEJ,EACAP,MAAC2B,EAAA,CACC,UAAU,QACV,QAAQ,UACR,MAAM,UACN,QAAS,IAAM,CACTZ,EAAU,SACZA,EAAU,QAAQ,OAAO,SAAStB,EAAKc,CAAI,EAAE,QAAQ,CAEzD,EAEA,SAAAP,MAACG,EAAA,CAAM,QAAQ,oBAAoB,GACrC,EACF,CAEJ,CAEA,SAASyB,EAAWC,EAAc,CAChC,OAAOA,EACJ,QAAQ,KAAM,GAAG,EACjB,QAAQ,QAASC,GAAKA,EAAE,aAAa,EACrC,MAAM,GAAG,EACT,OAAOC,GAAKA,EAAE,OAAS,CAAC,EACxB,KAAK,GAAG,CACb","names":["AceEditor","React","__vitePreload","Component","tags","useSuspenseQuery","commonAdminQueries","searchParams","setSearchParams","useSearchParams","selectedView","jsx","EditorLayout","Select","Trans","value","key","Item","view","select","form","useForm","jsxs","AdminSettingsLayout","AdminDocsUrls","CodeEditor","editorRef","useRef","setValue","getValues","setError","clearErrors","useFormContext","ignoreChange","Suspense","ProgressCircle","newValue","isValid","Button","prettyName","name","l","p"],"ignoreList":[],"sources":["../../../common/foundation/resources/client/admin/settings/pages/seo-settings.tsx"],"sourcesContent":["import {AdminDocsUrls} from '@app/admin/admin-config';\nimport {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {AdminSettings} from '@common/admin/settings/admin-settings';\nimport {AdminSettingsLayout} from '@common/admin/settings/layout/settings-layout';\nimport {useSuspenseQuery} from '@tanstack/react-query';\nimport {Button} from '@ui/buttons/button';\nimport {Item} from '@ui/forms/listbox/item';\nimport {Select} from '@ui/forms/select/select';\nimport {Trans} from '@ui/i18n/trans';\nimport {ProgressCircle} from '@ui/progress/progress-circle';\nimport React, {ReactElement, Suspense, useRef} from 'react';\nimport type ReactAce from 'react-ace/lib/ace';\nimport {useForm, useFormContext} from 'react-hook-form';\nimport {useSearchParams} from 'react-router';\n\nconst AceEditor = React.lazy(() => import('@common/ace-editor/ace-editor'));\n\nexport function Component() {\n  const {\n    data: {tags},\n  } = useSuspenseQuery(commonAdminQueries.settings.seoTags());\n\n  const [searchParams, setSearchParams] = useSearchParams();\n  const selectedView = searchParams.get('view') || Object.keys(tags)[0];\n\n  return (\n    <EditorLayout\n      view={selectedView}\n      key={selectedView}\n      select={\n        <Select\n          label={<Trans message=\"Page\" />}\n          selectionMode=\"single\"\n          selectedValue={selectedView}\n          onSelectionChange={value => setSearchParams({view: value as string})}\n          className=\"mb-24\"\n        >\n          {Object.entries(tags).map(([key]) => (\n            <Item key={key} value={key}>\n              {prettyName(key)}\n            </Item>\n          ))}\n        </Select>\n      }\n    />\n  );\n}\n\ninterface EditorLayoutProps {\n  view: string;\n  select: ReactElement;\n}\nfunction EditorLayout({view, select}: EditorLayoutProps) {\n  const {\n    data: {tags},\n  } = useSuspenseQuery(commonAdminQueries.settings.seoTags());\n\n  const form = useForm<AdminSettings>({\n    defaultValues: {\n      seo: {\n        [view]: tags[view].custom || tags[view].original,\n      },\n    },\n  });\n\n  return (\n    <AdminSettingsLayout\n      form={form}\n      title={<Trans message=\"SEO tags\" />}\n      docsLink={AdminDocsUrls.settings.seo}\n    >\n      {select}\n      <div className=\"mb-4 text-sm\">\n        <Trans message=\"Content\" />\n      </div>\n      <CodeEditor view={view} />\n    </AdminSettingsLayout>\n  );\n}\n\ninterface CodeEditorProps {\n  view: string;\n}\nfunction CodeEditor({view}: CodeEditorProps) {\n  const {\n    data: {tags},\n  } = useSuspenseQuery(commonAdminQueries.settings.seoTags());\n  const editorRef = useRef<ReactAce | null>(null);\n  const {setValue, getValues, setError, clearErrors} =\n    useFormContext<AdminSettings>();\n\n  // There's a bug in AceEditor, onChange is called on mount,\n  // so we need to ignore it, otherwise form will be marked as dirty\n  const ignoreChange = useRef(true);\n\n  return (\n    <Suspense fallback={<ProgressCircle isIndeterminate />}>\n      <div className=\"relative h-580 overflow-hidden rounded-panel border\">\n        <AceEditor\n          editorRef={editorRef}\n          beautify={false}\n          mode=\"php_laravel_blade\"\n          onLoad={() => {\n            setTimeout(() => (ignoreChange.current = false), 10);\n          }}\n          onChange={newValue => {\n            if (!ignoreChange.current) {\n              return setValue(`seo.${view}`, newValue, {shouldDirty: true});\n            }\n          }}\n          defaultValue={getValues(`seo.${view}`) || ''}\n          onIsValidChange={isValid => {\n            if (isValid) {\n              clearErrors(`seo.${view}`);\n            } else {\n              setError(`seo.${view}`, {type: 'manual'});\n            }\n          }}\n        />\n      </div>\n      <Button\n        className=\"mt-12\"\n        variant=\"outline\"\n        color=\"primary\"\n        onClick={() => {\n          if (editorRef.current) {\n            editorRef.current.editor.setValue(tags[view].original);\n          }\n        }}\n      >\n        <Trans message=\"Reset to original\" />\n      </Button>\n    </Suspense>\n  );\n}\n\nfunction prettyName(name: string) {\n  return name\n    .replace(/-/g, ' ')\n    .replace(/\\b\\w/g, l => l.toUpperCase())\n    .split(' ')\n    .filter(p => p.length > 2)\n    .join(' ');\n}\n"],"file":"assets/seo-settings-DniRU1NT.js"}