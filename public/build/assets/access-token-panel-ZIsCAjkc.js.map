{"version":3,"file":"access-token-panel-ZIsCAjkc.js","sources":["../../../common/foundation/resources/client/auth/ui/account-settings/access-token-panel/create-new-token.ts","../../../common/foundation/resources/client/auth/ui/account-settings/access-token-panel/create-new-token-dialog.tsx","../../../common/foundation/resources/client/auth/ui/account-settings/access-token-panel/delete-access-token.ts","../../../common/foundation/resources/client/auth/ui/account-settings/access-token-panel/access-token-panel.tsx"],"sourcesContent":["import {useMutation} from '@tanstack/react-query';\nimport {UseFormReturn} from 'react-hook-form';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {toast} from '@ui/toast/toast';\nimport {AccessToken} from '../../../access-token';\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\nimport {message} from '@ui/i18n/message';\nimport {apiClient} from '@common/http/query-client';\n\ninterface Response extends BackendResponse {\n  token: AccessToken;\n  plainTextToken: string;\n}\n\nexport interface CreateAccessTokenPayload {\n  tokenName: string;\n}\n\nfunction createAccessToken(\n  payload: CreateAccessTokenPayload,\n): Promise<Response> {\n  return apiClient.post(`access-tokens`, payload).then(r => r.data);\n}\n\nexport function useCreateAccessToken(\n  form: UseFormReturn<CreateAccessTokenPayload>,\n) {\n  return useMutation({\n    mutationFn: (props: CreateAccessTokenPayload) => createAccessToken(props),\n    onSuccess: () => {\n      toast(message('Token create'));\n    },\n    onError: r => onFormQueryError(r, form),\n  });\n}\n","import { queryClient } from '@common/http/query-client';\nimport { Button } from '@ui/buttons/button';\nimport { Form } from '@ui/forms/form';\nimport {\n  FormTextField,\n  TextField,\n} from '@ui/forms/input-field/text-field/text-field';\nimport { Trans } from '@ui/i18n/trans';\nimport { ErrorIcon } from '@ui/icons/material/Error';\nimport { Dialog } from '@ui/overlays/dialog/dialog';\nimport { DialogBody } from '@ui/overlays/dialog/dialog-body';\nimport { useDialogContext } from '@ui/overlays/dialog/dialog-context';\nimport { DialogFooter } from '@ui/overlays/dialog/dialog-footer';\nimport { DialogHeader } from '@ui/overlays/dialog/dialog-header';\nimport useClipboard from '@ui/utils/hooks/use-clipboard';\nimport { useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport {\n  CreateAccessTokenPayload,\n  useCreateAccessToken,\n} from './create-new-token';\n\nexport function CreateNewTokenDialog() {\n  const form = useForm<CreateAccessTokenPayload>();\n  const {formId, close} = useDialogContext();\n  const createToken = useCreateAccessToken(form);\n\n  const [plainTextToken, setPlainTextToken] = useState<string>();\n\n  const formNode = (\n    <Form\n      form={form}\n      id={formId}\n      onSubmit={values => {\n        createToken.mutate(values, {\n          onSuccess: response => {\n            setPlainTextToken(response.plainTextToken);\n            queryClient.invalidateQueries({queryKey: ['users']});\n          },\n        });\n      }}\n    >\n      <FormTextField\n        name=\"tokenName\"\n        label={<Trans message=\"Token name\" />}\n        required\n        autoFocus\n      />\n    </Form>\n  );\n\n  return (\n    <Dialog>\n      <DialogHeader>\n        <Trans message=\"Create new token\" />\n      </DialogHeader>\n      <DialogBody>\n        {plainTextToken ? (\n          <PlainTextPreview plainTextToken={plainTextToken} />\n        ) : (\n          formNode\n        )}\n      </DialogBody>\n      <DialogFooter>\n        <Button variant=\"text\" onClick={close}>\n          <Trans message=\"Done\" />\n        </Button>\n        {!plainTextToken && (\n          <Button\n            variant=\"flat\"\n            color=\"primary\"\n            type=\"submit\"\n            form={formId}\n            disabled={createToken.isPending}\n          >\n            <Trans message=\"Create\" />\n          </Button>\n        )}\n      </DialogFooter>\n    </Dialog>\n  );\n}\n\ninterface PlainTextPreviewProps {\n  plainTextToken: string;\n}\nfunction PlainTextPreview({plainTextToken}: PlainTextPreviewProps) {\n  const [isCopied, copyToClipboard] = useClipboard(plainTextToken || '', {\n    successDuration: 1000,\n  });\n\n  return (\n    <>\n      <TextField\n        readOnly\n        value={plainTextToken}\n        autoFocus\n        onClick={e => {\n          e.currentTarget.focus();\n          e.currentTarget.select();\n        }}\n        endAppend={\n          <Button variant=\"flat\" color=\"primary\" onClick={copyToClipboard}>\n            {isCopied ? <Trans message=\"Copied!\" /> : <Trans message=\"Copy\" />}\n          </Button>\n        }\n      />\n      <div className=\"mt-14 flex items-center gap-10 text-sm\">\n        <ErrorIcon size=\"sm\" className=\"text-danger\" />\n        <Trans message=\"Make sure to store the token in a safe place. After this dialog is closed, token will not be viewable anymore.\" />\n      </div>\n    </>\n  );\n}\n","import {useMutation} from '@tanstack/react-query';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {toast} from '@ui/toast/toast';\nimport {message} from '@ui/i18n/message';\nimport {apiClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\n\ninterface Response extends BackendResponse {}\n\ninterface Props {\n  id: number;\n}\n\nfunction deleteAccessToken({id}: Props): Promise<Response> {\n  return apiClient.delete(`access-tokens/${id}`).then(r => r.data);\n}\n\nexport function useDeleteAccessToken() {\n  return useMutation({\n    mutationFn: (props: Props) => deleteAccessToken(props),\n    onSuccess: () => {\n      toast(message('Token deleted'));\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n}\n","import {AccountSettingsId} from '@common/auth/ui/account-settings/account-settings-sidenav';\nimport {queryClient} from '@common/http/query-client';\nimport {Button} from '@ui/buttons/button';\nimport {LinkStyle} from '@ui/buttons/external-link';\nimport {FormattedDate} from '@ui/i18n/formatted-date';\nimport {Trans} from '@ui/i18n/trans';\nimport {IllustratedMessage} from '@ui/images/illustrated-message';\nimport {SvgImage} from '@ui/images/svg-image';\nimport {ConfirmationDialog} from '@ui/overlays/dialog/confirmation-dialog';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {useSettings} from '@ui/settings/use-settings';\nimport {User} from '@ui/types/user';\nimport clsx from 'clsx';\nimport {Link} from 'react-router';\nimport {AccessToken} from '../../../access-token';\nimport {useAuth} from '../../../use-auth';\nimport {AccountSettingsPanel} from '../account-settings-panel';\nimport {CreateNewTokenDialog} from './create-new-token-dialog';\nimport {useDeleteAccessToken} from './delete-access-token';\nimport secureFilesSvg from './secure-files.svg';\n\ninterface PartialUser {\n  id: number;\n  tokens?: User['tokens'];\n}\n\ninterface Props {\n  user: PartialUser;\n}\nexport function AccessTokenPanel({user}: Props) {\n  const tokens = user.tokens || [];\n  const {hasPermission, user: authUser} = useAuth();\n  const {api} = useSettings();\n  if (!api?.integrated || !hasPermission('api.access')) return null;\n  return (\n    <AccountSettingsPanel\n      id={AccountSettingsId.Developers}\n      title={<Trans message=\"API access tokens\" />}\n      titleSuffix={\n        <Link className={LinkStyle} to=\"/api-docs\" target=\"_blank\">\n          <Trans message=\"Documentation\" />\n        </Link>\n      }\n      actions={user.id === authUser?.id ? <CreateNewTokenButton /> : null}\n    >\n      {!tokens.length ? (\n        <IllustratedMessage\n          className=\"py-40\"\n          image={<SvgImage src={secureFilesSvg} />}\n          title={\n            user.id === authUser?.id ? (\n              <Trans message=\"You have no personal access tokens yet\" />\n            ) : (\n              <Trans message=\"User has not created any access tokens yet\" />\n            )\n          }\n        />\n      ) : (\n        tokens.map((token, index) => (\n          <TokenLine\n            token={token}\n            key={token.id}\n            isLast={index === tokens.length - 1}\n          />\n        ))\n      )}\n    </AccountSettingsPanel>\n  );\n}\n\ninterface TokenLineProps {\n  token: AccessToken;\n  isLast: boolean;\n}\nfunction TokenLine({token, isLast}: TokenLineProps) {\n  return (\n    <div\n      className={clsx(\n        'flex items-center gap-24',\n        !isLast && 'mb-12 border-b pb-12',\n      )}\n    >\n      <div className=\"text-sm\">\n        <div className=\"font-semibold\">\n          <Trans message=\"Name\" />\n        </div>\n        <div>{token.name}</div>\n        <div className=\"mt-10 font-semibold\">\n          <Trans message=\"Last used\" />\n        </div>\n        <div>\n          {token.last_used_at ? (\n            <FormattedDate date={token.last_used_at} />\n          ) : (\n            <Trans message=\"Never\" />\n          )}\n        </div>\n      </div>\n      <DeleteTokenButton token={token} />\n    </div>\n  );\n}\n\nfunction CreateNewTokenButton() {\n  return (\n    <DialogTrigger type=\"modal\">\n      <Button variant=\"flat\" color=\"primary\">\n        <Trans message=\"Create token\" />\n      </Button>\n      <CreateNewTokenDialog />\n    </DialogTrigger>\n  );\n}\n\ninterface DeleteTokenButtonProps {\n  token: AccessToken;\n}\nfunction DeleteTokenButton({token}: DeleteTokenButtonProps) {\n  const deleteToken = useDeleteAccessToken();\n  return (\n    <DialogTrigger\n      type=\"modal\"\n      onClose={isConfirmed => {\n        if (isConfirmed) {\n          deleteToken.mutate(\n            {id: token.id},\n            {\n              onSuccess: () =>\n                queryClient.invalidateQueries({queryKey: ['users']}),\n            },\n          );\n        }\n      }}\n    >\n      <Button\n        size=\"xs\"\n        variant=\"outline\"\n        color=\"danger\"\n        className=\"ml-auto flex-shrink-0\"\n      >\n        <Trans message=\"Delete\" />\n      </Button>\n      <ConfirmationDialog\n        isDanger\n        title={<Trans message=\"Delete token?\" />}\n        body={\n          <Trans message=\"This token will be deleted immediately and permanently. Once deleted, it can no longer be used to make API requests.\" />\n        }\n        confirm={<Trans message=\"Delete\" />}\n      />\n    </DialogTrigger>\n  );\n}\n"],"names":["createAccessToken","payload","apiClient","r","useCreateAccessToken","form","useMutation","props","toast","message","onFormQueryError","CreateNewTokenDialog","useForm","formId","close","useDialogContext","createToken","plainTextToken","setPlainTextToken","useState","formNode","jsx","Form","values","response","queryClient","FormTextField","Trans","Dialog","DialogHeader","DialogBody","PlainTextPreview","DialogFooter","Button","isCopied","copyToClipboard","useClipboard","jsxs","Fragment","TextField","e","ErrorIcon","deleteAccessToken","id","useDeleteAccessToken","err","showHttpErrorToast","AccessTokenPanel","user","tokens","hasPermission","authUser","useAuth","api","useSettings","AccountSettingsPanel","AccountSettingsId","Link","LinkStyle","CreateNewTokenButton","token","index","TokenLine","IllustratedMessage","SvgImage","secureFilesSvg","isLast","clsx","FormattedDate","DeleteTokenButton","DialogTrigger","deleteToken","isConfirmed","ConfirmationDialog"],"mappings":"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"}