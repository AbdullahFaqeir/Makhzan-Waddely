{"version":3,"file":"custom-page-datable-DB7j4bgK.js","sources":["../../../common/foundation/resources/client/admin/custom-pages/custom-page-datatable-columns.tsx","../../../common/foundation/resources/client/admin/custom-pages/articles.svg","../../../common/foundation/resources/client/admin/custom-pages/custom-page-datatable-filters.tsx","../../../common/foundation/resources/client/admin/custom-pages/custom-page-datable.tsx"],"sourcesContent":["import {CustomPage} from '@common/admin/custom-pages/custom-page';\nimport {ColumnConfig} from '@common/datatable/column-config';\nimport {NameWithAvatar} from '@common/datatable/column-templates/name-with-avatar';\nimport {LinkStyle} from '@ui/buttons/external-link';\nimport {IconButton} from '@ui/buttons/icon-button';\nimport {FormattedDate} from '@ui/i18n/formatted-date';\nimport {Trans} from '@ui/i18n/trans';\nimport {EditIcon} from '@ui/icons/material/Edit';\nimport {Link} from 'react-router';\n\nexport const CustomPageDatatableColumns: ColumnConfig<CustomPage>[] = [\n  {\n    key: 'slug',\n    allowsSorting: true,\n    width: 'flex-2 min-w-200',\n    visibleInMode: 'all',\n    header: () => <Trans message=\"Slug\" />,\n    body: page => (\n      <Link target=\"_blank\" to={`/pages/${page.slug}`} className={LinkStyle}>\n        {page.slug}\n      </Link>\n    ),\n  },\n  {\n    key: 'user_id',\n    allowsSorting: true,\n    width: 'flex-2 min-w-140',\n    header: () => <Trans message=\"Owner\" />,\n    body: page =>\n      page.user && (\n        <NameWithAvatar\n          image={page.user.image}\n          label={page.user.name}\n          description={page.user.email}\n          avatarCircle\n        />\n      ),\n  },\n  {\n    key: 'type',\n    maxWidth: 'max-w-100',\n    header: () => <Trans message=\"Type\" />,\n    body: page => <Trans message={page.type} />,\n  },\n  {\n    key: 'updated_at',\n    allowsSorting: true,\n    width: 'w-100',\n    header: () => <Trans message=\"Last updated\" />,\n    body: page => <FormattedDate date={page.updated_at} />,\n  },\n  {\n    key: 'actions',\n    header: () => <Trans message=\"Actions\" />,\n    hideHeader: true,\n    align: 'end',\n    width: 'w-84 flex-shrink-0',\n    visibleInMode: 'all',\n    body: page => (\n      <IconButton\n        size=\"md\"\n        className=\"text-muted\"\n        elementType={Link}\n        to={`${page.id}/edit`}\n      >\n        <EditIcon />\n      </IconButton>\n    ),\n  },\n];\n","export default \"__VITE_ASSET__CwKo6tv2__\"","import {\n  BackendFilter,\n  FilterControlType,\n  FilterOperator,\n} from '../../datatable/filters/backend-filter';\nimport {message} from '@ui/i18n/message';\nimport {USER_MODEL} from '@ui/types/user';\nimport {SiteConfigContextValue} from '@common/core/settings/site-config-context';\nimport {\n  createdAtFilter,\n  updatedAtFilter,\n} from '@common/datatable/filters/timestamp-filters';\n\nexport const CustomPageDatatableFilters = (\n  config: SiteConfigContextValue,\n): BackendFilter[] => {\n  const dynamicFilters: BackendFilter[] =\n    config.customPages.types.length > 1\n      ? [\n          {\n            control: {\n              type: FilterControlType.Select,\n              defaultValue: 'default',\n              options: config.customPages.types.map(type => ({\n                value: type.type,\n                label: type.label,\n                key: type.type,\n              })),\n            },\n\n            key: 'type',\n            label: message('Type'),\n            description: message('Type of the page'),\n            defaultOperator: FilterOperator.eq,\n          },\n        ]\n      : [];\n\n  return [\n    {\n      key: 'user_id',\n      label: message('User'),\n      description: message('User page was created by'),\n      defaultOperator: FilterOperator.eq,\n      control: {\n        type: FilterControlType.SelectModel,\n        model: USER_MODEL,\n      },\n    },\n    ...dynamicFilters,\n    createdAtFilter({\n      description: message('Date page was created'),\n    }),\n    updatedAtFilter({\n      description: message('Date page was last updated'),\n    }),\n  ];\n};\n","import {AdminDocsUrls} from '@app/admin/admin-config';\nimport {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {CustomPageDatatableColumns} from '@common/admin/custom-pages/custom-page-datatable-columns';\nimport {DocsLink} from '@common/admin/settings/layout/settings-links';\nimport {GlobalLoadingProgress} from '@common/core/global-loading-progress';\nimport {SiteConfigContext} from '@common/core/settings/site-config-context';\nimport {DataTableAddItemButton} from '@common/datatable/data-table-add-item-button';\nimport {DataTableHeader} from '@common/datatable/data-table-header';\nimport {DataTablePaginationFooter} from '@common/datatable/data-table-pagination-footer';\nimport {useDatatableSearchParams} from '@common/datatable/filters/utils/use-datatable-search-params';\nimport {validateDatatableSearch} from '@common/datatable/filters/utils/validate-datatable-search';\nimport {DataTableEmptyStateMessage} from '@common/datatable/page/data-table-emty-state-message';\nimport {DatatableFilters} from '@common/datatable/page/datatable-filters';\nimport {\n  DatatablePageHeaderBar,\n  DatatablePageScrollContainer,\n  DatatablePageWithHeaderBody,\n  DatatablePageWithHeaderLayout,\n} from '@common/datatable/page/datatable-page-with-header-layout';\nimport {useDatatableQuery} from '@common/datatable/requests/use-datatable-query';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {Table} from '@common/ui/tables/table';\nimport {useMutation} from '@tanstack/react-query';\nimport {Button} from '@ui/buttons/button';\nimport {message} from '@ui/i18n/message';\nimport {Trans} from '@ui/i18n/trans';\nimport {ConfirmationDialog} from '@ui/overlays/dialog/confirmation-dialog';\nimport {useDialogContext} from '@ui/overlays/dialog/dialog-context';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {toast} from '@ui/toast/toast';\nimport {Fragment, useContext, useMemo, useState} from 'react';\nimport {Link} from 'react-router';\nimport articlesSvg from './articles.svg';\nimport {CustomPageDatatableFilters} from './custom-page-datatable-filters';\n\nexport function Component() {\n  const config = useContext(SiteConfigContext);\n  const [selectedRows, setSelectedRows] = useState<(number | string)[]>([]);\n  const {\n    searchParams,\n    sortDescriptor,\n    mergeIntoSearchParams,\n    setSearchQuery,\n    isFiltering,\n  } = useDatatableSearchParams(validateDatatableSearch);\n\n  const filters = useMemo(() => {\n    return CustomPageDatatableFilters(config);\n  }, [config]);\n\n  const query = useDatatableQuery({\n    ...commonAdminQueries.customPages.index({...searchParams}),\n  });\n\n  const selectedActions = (\n    <DialogTrigger type=\"modal\">\n      <Button variant=\"flat\" color=\"danger\">\n        <Trans message=\"Delete\" />\n      </Button>\n      <DeleteCustomPagesDialog\n        selectedIds={selectedRows}\n        onDelete={() => setSelectedRows([])}\n      />\n    </DialogTrigger>\n  );\n\n  const actions = (\n    <Fragment>\n      <DataTableAddItemButton elementType={Link} to=\"new\">\n        <Trans message=\"New page\" />\n      </DataTableAddItemButton>\n    </Fragment>\n  );\n\n  return (\n    <DatatablePageWithHeaderLayout>\n      <GlobalLoadingProgress query={query} />\n      <DatatablePageHeaderBar\n        title={<Trans message=\"Custom pages\" />}\n        showSidebarToggleButton\n        rightContent={\n          <DocsLink\n            variant=\"button\"\n            link={AdminDocsUrls.pages.customPages}\n            size=\"xs\"\n          />\n        }\n      />\n      <DatatablePageWithHeaderBody>\n        <DataTableHeader\n          searchValue={searchParams.query}\n          onSearchChange={setSearchQuery}\n          actions={actions}\n          selectedItems={selectedRows}\n          selectedActions={selectedActions}\n          filters={filters}\n        />\n        <DatatableFilters filters={filters} />\n        <DatatablePageScrollContainer>\n          <Table\n            columns={CustomPageDatatableColumns}\n            data={query.items}\n            sortDescriptor={sortDescriptor}\n            onSortChange={mergeIntoSearchParams}\n            enableSelection\n            selectedRows={selectedRows}\n            onSelectionChange={setSelectedRows}\n          />\n          {query.isEmpty && (\n            <DataTableEmptyStateMessage\n              isFiltering={isFiltering}\n              image={articlesSvg}\n              title={<Trans message=\"No pages have been created yet\" />}\n              filteringTitle={<Trans message=\"No matching pages\" />}\n            />\n          )}\n          <DataTablePaginationFooter\n            query={query}\n            onPageChange={page => mergeIntoSearchParams({page})}\n            onPerPageChange={perPage => mergeIntoSearchParams({perPage})}\n          />\n        </DatatablePageScrollContainer>\n      </DatatablePageWithHeaderBody>\n    </DatatablePageWithHeaderLayout>\n  );\n}\n\ninterface DeleteCustomPagesDialogProps {\n  selectedIds: (number | string)[];\n  onDelete: () => void;\n}\nfunction DeleteCustomPagesDialog({\n  selectedIds,\n  onDelete,\n}: DeleteCustomPagesDialogProps) {\n  const {close} = useDialogContext();\n  const deletePages = useMutation({\n    mutationFn: () =>\n      apiClient\n        .delete(`custom-pages/${selectedIds.join(',')}`)\n        .then(r => r.data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.customPages.invalidateKey,\n      });\n      toast(message('Pages deleted'));\n      onDelete();\n      close();\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n\n  return (\n    <ConfirmationDialog\n      isLoading={deletePages.isPending}\n      onConfirm={() => deletePages.mutate()}\n      title={<Trans message=\"Delete pages\" />}\n      body={<Trans message=\"Are you sure you want to delete selected pages?\" />}\n      confirm={<Trans message=\"Delete\" />}\n    />\n  );\n}\n"],"names":["CustomPageDatatableColumns","jsx","Trans","page","Link","LinkStyle","NameWithAvatar","FormattedDate","IconButton","EditIcon","articlesSvg","CustomPageDatatableFilters","config","dynamicFilters","FilterControlType","type","message","FilterOperator","USER_MODEL","createdAtFilter","updatedAtFilter","Component","useContext","SiteConfigContext","selectedRows","setSelectedRows","useState","searchParams","sortDescriptor","mergeIntoSearchParams","setSearchQuery","isFiltering","useDatatableSearchParams","validateDatatableSearch","filters","useMemo","query","useDatatableQuery","commonAdminQueries","selectedActions","jsxs","DialogTrigger","Button","DeleteCustomPagesDialog","actions","Fragment","DataTableAddItemButton","DatatablePageWithHeaderLayout","GlobalLoadingProgress","DatatablePageHeaderBar","DocsLink","AdminDocsUrls","DatatablePageWithHeaderBody","DataTableHeader","DatatableFilters","DatatablePageScrollContainer","Table","DataTableEmptyStateMessage","DataTablePaginationFooter","perPage","selectedIds","onDelete","close","useDialogContext","deletePages","useMutation","apiClient","r","queryClient","toast","err","showHttpErrorToast","ConfirmationDialog"],"mappings":"m9DAUO,MAAMA,GAAyD,CACpE,CACE,IAAK,OACL,cAAe,GACf,MAAO,mBACP,cAAe,MACf,OAAQ,IAAMC,EAAAA,IAACC,EAAA,CAAM,QAAQ,MAAA,CAAO,EACpC,KAAMC,GACJF,EAAAA,IAACG,EAAA,CAAK,OAAO,SAAS,GAAI,UAAUD,EAAK,IAAI,GAAI,UAAWE,EACzD,WAAK,IAAA,CACR,CAAA,EAGJ,CACE,IAAK,UACL,cAAe,GACf,MAAO,mBACP,OAAQ,IAAMJ,EAAAA,IAACC,EAAA,CAAM,QAAQ,OAAA,CAAQ,EACrC,KAAMC,GACJA,EAAK,MACHF,EAAAA,IAACK,EAAA,CACC,MAAOH,EAAK,KAAK,MACjB,MAAOA,EAAK,KAAK,KACjB,YAAaA,EAAK,KAAK,MACvB,aAAY,EAAA,CAAA,CACd,EAGN,CACE,IAAK,OACL,SAAU,YACV,OAAQ,IAAMF,EAAAA,IAACC,EAAA,CAAM,QAAQ,MAAA,CAAO,EACpC,KAAMC,GAAQF,EAAAA,IAACC,EAAA,CAAM,QAASC,EAAK,IAAA,CAAM,CAAA,EAE3C,CACE,IAAK,aACL,cAAe,GACf,MAAO,QACP,OAAQ,IAAMF,EAAAA,IAACC,EAAA,CAAM,QAAQ,cAAA,CAAe,EAC5C,KAAMC,GAAQF,EAAAA,IAACM,EAAA,CAAc,KAAMJ,EAAK,UAAA,CAAY,CAAA,EAEtD,CACE,IAAK,UACL,OAAQ,IAAMF,EAAAA,IAACC,EAAA,CAAM,QAAQ,SAAA,CAAU,EACvC,WAAY,GACZ,MAAO,MACP,MAAO,qBACP,cAAe,MACf,KAAMC,GACJF,EAAAA,IAACO,EAAA,CACC,KAAK,KACL,UAAU,aACV,YAAaJ,EACb,GAAI,GAAGD,EAAK,EAAE,QAEd,eAACM,EAAA,CAAA,CAAS,CAAA,CAAA,CACZ,CAGN,ECrEAC,GAAe,yDCaFC,GACXC,GACoB,CACpB,MAAMC,EACJD,EAAO,YAAY,MAAM,OAAS,EAC9B,CACE,CACE,QAAS,CACP,KAAME,EAAkB,OACxB,aAAc,UACd,QAASF,EAAO,YAAY,MAAM,IAAIG,IAAS,CAC7C,MAAOA,EAAK,KACZ,MAAOA,EAAK,MACZ,IAAKA,EAAK,IAAA,EACV,CAAA,EAGJ,IAAK,OACL,MAAOC,EAAQ,MAAM,EACrB,YAAaA,EAAQ,kBAAkB,EACvC,gBAAiBC,EAAe,EAAA,CAClC,EAEF,CAAA,EAEN,MAAO,CACL,CACE,IAAK,UACL,MAAOD,EAAQ,MAAM,EACrB,YAAaA,EAAQ,0BAA0B,EAC/C,gBAAiBC,EAAe,GAChC,QAAS,CACP,KAAMH,EAAkB,YACxB,MAAOI,CAAA,CACT,EAEF,GAAGL,EACHM,EAAgB,CACd,YAAaH,EAAQ,uBAAuB,CAAA,CAC7C,EACDI,GAAgB,CACd,YAAaJ,EAAQ,4BAA4B,CAAA,CAClD,CAAA,CAEL,ECrBO,SAASK,IAAY,CAC1B,MAAMT,EAASU,EAAAA,WAAWC,CAAiB,EACrC,CAACC,EAAcC,CAAe,EAAIC,EAAAA,SAA8B,CAAA,CAAE,EAClE,CACJ,aAAAC,EACA,eAAAC,EACA,sBAAAC,EACA,eAAAC,EACA,YAAAC,CAAA,EACEC,EAAyBC,CAAuB,EAE9CC,EAAUC,EAAAA,QAAQ,IACfxB,GAA2BC,CAAM,EACvC,CAACA,CAAM,CAAC,EAELwB,EAAQC,EAAkB,CAC9B,GAAGC,EAAmB,YAAY,MAAM,CAAC,GAAGX,EAAa,CAAA,CAC1D,EAEKY,EACJC,EAAAA,KAACC,EAAA,CAAc,KAAK,QAClB,SAAA,CAAAxC,EAAAA,IAACyC,EAAA,CAAO,QAAQ,OAAO,MAAM,SAC3B,SAAAzC,EAAAA,IAACC,EAAA,CAAM,QAAQ,QAAA,CAAS,CAAA,CAC1B,EACAD,EAAAA,IAAC0C,GAAA,CACC,YAAanB,EACb,SAAU,IAAMC,EAAgB,CAAA,CAAE,CAAA,CAAA,CACpC,EACF,EAGImB,EACJ3C,EAAAA,IAAC4C,WAAA,CACC,SAAA5C,MAAC6C,GAAuB,YAAa1C,EAAM,GAAG,MAC5C,SAAAH,EAAAA,IAACC,EAAA,CAAM,QAAQ,UAAA,CAAW,EAC5B,EACF,EAGF,cACG6C,EAAA,CACC,SAAA,CAAA9C,MAAC+C,GAAsB,MAAAZ,EAAc,EACrCnC,EAAAA,IAACgD,EAAA,CACC,MAAOhD,EAAAA,IAACC,EAAA,CAAM,QAAQ,cAAA,CAAe,EACrC,wBAAuB,GACvB,aACED,EAAAA,IAACiD,EAAA,CACC,QAAQ,SACR,KAAMC,EAAc,MAAM,YAC1B,KAAK,IAAA,CAAA,CACP,CAAA,SAGHC,EAAA,CACC,SAAA,CAAAnD,EAAAA,IAACoD,EAAA,CACC,YAAa1B,EAAa,MAC1B,eAAgBG,EAChB,QAAAc,EACA,cAAepB,EACf,gBAAAe,EACA,QAAAL,CAAA,CAAA,EAEFjC,MAACqD,GAAiB,QAAApB,EAAkB,SACnCqB,EAAA,CACC,SAAA,CAAAtD,EAAAA,IAACuD,EAAA,CACC,QAASxD,GACT,KAAMoC,EAAM,MACZ,eAAAR,EACA,aAAcC,EACd,gBAAe,GACf,aAAAL,EACA,kBAAmBC,CAAA,CAAA,EAEpBW,EAAM,SACLnC,EAAAA,IAACwD,EAAA,CACC,YAAA1B,EACA,MAAOrB,GACP,MAAOT,EAAAA,IAACC,EAAA,CAAM,QAAQ,gCAAA,CAAiC,EACvD,eAAgBD,EAAAA,IAACC,EAAA,CAAM,QAAQ,mBAAA,CAAoB,CAAA,CAAA,EAGvDD,EAAAA,IAACyD,EAAA,CACC,MAAAtB,EACA,aAAcjC,GAAQ0B,EAAsB,CAAC,KAAA1B,EAAK,EAClD,gBAAiBwD,GAAW9B,EAAsB,CAAC,QAAA8B,EAAQ,CAAA,CAAA,CAC7D,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,CAEJ,CAMA,SAAShB,GAAwB,CAC/B,YAAAiB,EACA,SAAAC,CACF,EAAiC,CAC/B,KAAM,CAAC,MAAAC,CAAA,EAASC,EAAA,EACVC,EAAcC,EAAY,CAC9B,WAAY,IACVC,EACG,OAAO,gBAAgBN,EAAY,KAAK,GAAG,CAAC,EAAE,EAC9C,KAAKO,GAAKA,EAAE,IAAI,EACrB,UAAW,IAAM,CACfC,EAAY,kBAAkB,CAC5B,SAAU9B,EAAmB,YAAY,aAAA,CAC1C,EACD+B,EAAMrD,EAAQ,eAAe,CAAC,EAC9B6C,EAAA,EACAC,EAAA,CACF,EACA,QAASQ,GAAOC,EAAmBD,CAAG,CAAA,CACvC,EAED,OACErE,EAAAA,IAACuE,EAAA,CACC,UAAWR,EAAY,UACvB,UAAW,IAAMA,EAAY,OAAA,EAC7B,MAAO/D,EAAAA,IAACC,EAAA,CAAM,QAAQ,cAAA,CAAe,EACrC,KAAMD,EAAAA,IAACC,EAAA,CAAM,QAAQ,iDAAA,CAAkD,EACvE,QAASD,EAAAA,IAACC,EAAA,CAAM,QAAQ,QAAA,CAAS,CAAA,CAAA,CAGvC"}