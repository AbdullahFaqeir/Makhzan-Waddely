import{b5 as V,b6 as U,t as J,v as R,b3 as M,h as E,a0 as W,X,b7 as Y,k as N,j as e,G as L,b8 as Z,b2 as ee,r as v,c as w,P as b,A as se,y as ae,z as re,D as te,an as B,ao as T,x as y,av as oe,aH as ie,l as ne,ai as le,J as F,a_ as de,aj as ce,a5 as k,T as p,aB as me,B as A,aE as ue,aF as _,N as pe,au as he,w as K,aw as xe,b9 as fe,ba as ve}from"./main-owSUWNVS.js";import{a as ge,B as we,i as q,n as je,l as be,A as ye,D as Pe,C as Ie}from"./dashboard-content-header-COPI5xFT.js";import{T as Ne}from"./table-Bl939KD9.js";import{A as $}from"./ad-host-CmxwDBsN.js";import{a as Fe,u as Se,c as De,b as ke}from"./file-preview-dialog-B9U301gU.js";import{F as Ce}from"./file-upload-provider-B2470Xt4.js";import{F as P}from"./FileDownload-bolxAr3M.js";import{I as Me,G as Ee}from"./GridView-Evyl8cHR.js";import{d as I}from"./download-file-from-url-BVaKcxRP.js";import{B as Le,a as Be}from"./breadcrumb-Bnfa8bCQ.js";import{D as Te,a as Ae}from"./dashboard-layout-C1S9XKdL.js";import{s as _e}from"./secure-files-DjSbgaf8.js";import"./dashboard-layout-context-Cg5RoSzJ.js";import"./Sort-D9ehvC2K.js";import"./formatted-date-dVjFR1LG.js";import"./use-date-formatter-BiXQj-wq.js";import"./checkbox-CiHJ6TYf.js";import"./CheckBoxOutlineBlank-6JQ3-TmB.js";import"./Delete-D6PatUO1.js";import"./Link-DhzV3yro.js";import"./index-BwE6w5yz.js";import"./pretty-bytes-bO14ePu9.js";import"./uploaded-file-0zTC6Yq4.js";import"./FileUpload-CZccU7nn.js";import"./open-upload-window-Ckg_K7W2.js";import"./MoreVert-Btfc9NhN.js";import"./skeleton-xT-yudp1.js";import"./ArrowDownward-BrhAHC5n.js";import"./useEffectEvent-BzNFWHXk.js";import"./use-pointer-events-BS6HVgE8.js";import"./useGlobalListeners-MjeT7y1B.js";import"./getScrollParent--OCc5gFh.js";import"./ChevronLeft-B3xE5I5-.js";import"./ChevronRight-C9FzEt6s.js";import"./KeyboardArrowRight-ChYgp5kQ.js";import"./MoreHoriz-DuK_U7d6.js";import"./use-previous-CFk0zUUs.js";const m=V()(U(s=>({password:null,viewMode:J("drive.viewMode")||"grid",activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:a=>{s(r=>{r.password=a})},isPasswordProtected:!1,setIsPasswordProtected:a=>{s(r=>{r.isPasswordProtected=a})},setViewMode:a=>{s(r=>{r.viewMode=a,R("drive.viewMode",a)})},setActiveSort:a=>{s(r=>{r.activeSort=a})}})));function f(){return m.getState()}function x(){var d,l;const{hash:s}=M(),a=m(t=>t.activeSort),r=m(t=>t.isPasswordProtected),i=m(t=>t.password),o=C(s,a,i),n=ge({queryKey:o,queryFn:async({pageParam:t=1})=>{const c=await N.get(`shareable-link-page/${s}`,{params:{loader:"shareableLinkPage",page:t,password:i,...a}}).then(u=>u.data);return c.passwordInvalid&&f().setIsPasswordProtected(!0),c},initialData:()=>{var u;const t=(u=X().loaders)==null?void 0:u.shareableLinkPage;if(!(t!=null&&t.link))return;if(Y(o,C(t.link.hash,{orderBy:"updated_at",orderDir:"desc"},i)))return t.passwordInvalid&&f().setIsPasswordProtected(!0),{pageParams:[void 0,1],pages:[t]}},initialPageParam:1,getNextPageParam:t=>{if(!t.folderChildren)return;const c=t.folderChildren.current_page,u=t.folderChildren.last_page;if(!(c>=u))return c+1},enabled:!!s&&!r||i!=null,placeholderData:W});return{...n,link:(d=n.data)==null?void 0:d.pages[0].link,entries:(l=n.data)==null?void 0:l.pages.flatMap(t=>{var c;return(c=t.folderChildren)==null?void 0:c.data})}}const C=(s,a,r)=>[E.shareableLinks.invalidateKey,"page",s,`${a.orderBy}:${a.orderDir}`,r];function Ke({entries:s,onEntrySelected:a}){return e.jsx("div",{className:"file-grid",children:s.map((r,i)=>e.jsx(we,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:r,onContextMenu:o=>{o.preventDefault()},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&a(r,i)},onClick:()=>{a(r,i)}},r.id))})}const qe=q.filter(s=>s.key!=="updated_at");function $e({entries:s,onEntrySelected:a}){const r=m(o=>o.activeSort),i=L();return e.jsx(Ne,{columns:i?qe:q,data:s,sortDescriptor:r,onSortChange:o=>{f().setActiveSort(o)},onAction:(o,n)=>{a(o,n)},enableSelection:!1})}function He(s,a){var i;let r=s.hash;return a&&((i=s.entry)==null?void 0:i.hash)!==a&&(r=`${r}:${a}`),r}function H(){const{link:s}=x(),a=Z();return r=>{s&&a(`/drive/s/${He(s,r)}`)}}function Ge({className:s}){const{pathname:a}=ee(),r=H(),[i,o]=v.useState(),n=m(h=>h.viewMode),d=v.useRef(null),{link:l,entries:t,isFetchingNextPage:c,hasNextPage:u,fetchNextPage:S,isPlaceholderData:Q}=x();if(v.useEffect(()=>{o(void 0)},[a]),v.useEffect(()=>{const h=d.current;if(!h)return;const g=new IntersectionObserver(([z])=>{z.isIntersecting&&u&&S()});return g.observe(h),()=>{g.unobserve(h)}},[u,S]),!l||Q)return e.jsx("div",{className:w("flex justify-center",s),children:e.jsx(b,{isIndeterminate:!0})});const D=(h,g)=>{h.type==="folder"?r(h.hash):o(g)},j=t||[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:w("file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24",s),children:[e.jsx($,{slot:"file-preview",className:"mb-40"}),n==="grid"?e.jsx(Ke,{entries:j,onEntrySelected:D}):e.jsx($e,{entries:j,onEntrySelected:D}),e.jsx("span",{ref:d,"aria-hidden":!0}),e.jsx(se,{children:c&&e.jsx(ae.div,{className:"mt-24 flex w-full justify-center",...re,children:e.jsx(b,{isIndeterminate:!0,"aria-label":"loading"})})})]}),e.jsx(te,{type:"modal",isOpen:i!=null,onClose:()=>o(void 0),children:e.jsx(Fe,{entries:j,defaultActiveIndex:i,allowDownload:l.allow_download})})]})}function Oe({linkId:s,password:a}){return N.post(`shareable-links/${s}/import`,{password:a}).then(r=>r.data)}function Qe(){const s=m(a=>a.password);return B({mutationFn:a=>Oe({...a,password:s}),onSuccess:async()=>{await oe.invalidateQueries({queryKey:E.shareableLinks.invalidateKey}),ie(y("Item imported into your drive"))},onError:a=>T(a,y("Could not create link"))})}function G(){var d;const{link:s}=x(),{user:a,isLoggedIn:r}=ne(),{downloadUrl:i}=Se(s==null?void 0:s.entry),o=Qe(),n=(d=s==null?void 0:s.entry)==null?void 0:d.users.find(l=>l.id===(a==null?void 0:a.id));return s!=null&&s.entry?e.jsxs("div",{children:[s.allow_download&&e.jsx(ze,{downloadUrl:i}),!n&&r&&s.allow_edit&&e.jsxs(le,{onItemSelected:l=>{l==="import"?o.mutate({linkId:s.id}):l==="download"&&i&&I(i)},children:[e.jsx(F,{className:"ml-6",disabled:o.isPending,children:e.jsx(de,{})}),e.jsxs(ce,{children:[e.jsx(k,{value:"download",startIcon:e.jsx(P,{}),children:e.jsx(p,{message:"Download"})}),e.jsx(k,{value:"import",startIcon:e.jsx(Me,{}),children:e.jsx(p,{message:"Save a copy to your own drive"})})]})]})]}):null}function ze({downloadUrl:s}){return e.jsxs(v.Fragment,{children:[e.jsx(me,{label:e.jsx(p,{message:"Download"}),children:e.jsx(F,{className:"md:hidden",onClick:()=>{s&&I(s)},children:e.jsx(P,{})})}),e.jsx(A,{className:"max-md:hidden",size:"sm",variant:"flat",color:"chip",startIcon:e.jsx(P,{}),onClick:()=>{s&&I(s)},children:e.jsx(p,{message:"Download"})})]})}function Ve({className:s,folder:a,link:r}){const i=H(),o=m(l=>l.password),n=je({hash:a==null?void 0:a.hash,params:{shareable_link:r.id,password:o}});let d;if(n.isLoading)d=null;else{const l=[];n.data&&n.data.path.forEach(t=>{l.push({folder:t,label:e.jsx(e.Fragment,{children:t.name})})}),d=e.jsx(Le,{size:"lg",isNavigation:!0,children:l.map(t=>e.jsx(Be,{onSelected:()=>{i(t.folder.hash)},children:t.label},t.folder.hash))})}return e.jsx("div",{className:w("h-36 flex-shrink-0",s),children:d})}function Ue(){const s=m(o=>o.activeSort),{link:a,isFetching:r}=x(),i=a&&a.entry;return e.jsxs("div",{className:"flex flex-col justify-between gap-14 p-14 md:h-90 md:flex-row md:items-center md:p-24",children:[i&&e.jsx(Ve,{link:a,folder:a.entry,className:"flex-auto"}),i&&e.jsxs("div",{className:"flex items-center justify-between text-muted md:justify-start",children:[e.jsx(be,{isDisabled:r,descriptor:s,onChange:o=>{f().setActiveSort(o)}}),e.jsx("div",{className:"ml-10 md:border-l md:pl-10",children:e.jsx(F,{onClick:()=>{f().setViewMode(f().viewMode==="grid"?"list":"grid")},children:e.jsx(Ee,{})})})]})]})}function Je(){const{entries:s,isFetched:a}=x(),r=a&&!(s!=null&&s.length);return e.jsxs(Te,{name:"folder-preview",children:[e.jsx(ye,{hideToggleButton:!0,rightChildren:e.jsx(G,{}),color:"bg"}),e.jsx(Pe,{children:e.jsx(Ue,{})}),e.jsx(Ce,{children:e.jsx(Ae,{children:r?e.jsx(Re,{}):e.jsx(Ge,{})})})]})}function Re({className:s}){return e.jsx(ue,{className:w(s,"mt-80"),image:e.jsx(_,{src:Ie}),title:e.jsx(p,{message:"Folder is empty"}),description:e.jsx(p,{message:"No files have been uploaded to this folder yet"})})}function We(){return B({mutationFn:({password:s,linkHash:a})=>N.post(`shareable-link-page/${a}/check-password`,{password:s}).then(r=>r.data),onSuccess:(s,a)=>{s.matches&&f().setPassword(a.password)},onError:s=>T(s,y("Could not create link"))})}function O(){const{link:s}=x(),a=L();return e.jsx(pe,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(s==null?void 0:s.entry)&&e.jsx(G,{}),menuPosition:"shareable-link-page",hideLogo:a,children:(s==null?void 0:s.entry)&&s.entry.type!=="folder"&&e.jsxs("div",{className:"fex-auto flex min-w-0 items-center gap-10",children:[e.jsx(he,{className:"flex-shrink-0",type:s.entry.type}),e.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:s.entry.name})]})})}function Xe(){const{trans:s}=K(),{hash:a}=M(),r=s({message:"Password"}),[i,o]=v.useState(""),n=We(),d=a?a.split(":")[0]:null,l=n.data&&!n.data.matches;return e.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[e.jsx(O,{}),e.jsx("div",{className:"mx-auto my-80 px-10 md:px-20",children:e.jsxs("div",{className:"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14",children:[e.jsx("div",{className:"h-132 w-[165px]",children:e.jsx(_,{src:_e})}),e.jsxs("form",{onSubmit:t=>{t.preventDefault(),n.mutate({linkHash:d,password:i})},children:[e.jsx("span",{className:"text-sm",children:e.jsx(p,{message:"The link you are trying to access is password protected."})}),e.jsx(xe,{autoFocus:!0,placeholder:r,"aria-label":r,className:"mb-20 mt-10",type:"password",value:i,required:!0,errorMessage:l&&e.jsx(p,{message:"Password is not valid"}),onChange:t=>{o(t.target.value)}}),e.jsx("div",{className:"text-right",children:e.jsx(A,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:n.isPending,children:e.jsx(p,{message:"Enter"})})})]})]})})]})}function Ye(){const{link:s}=x();return s!=null&&s.entry?e.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[e.jsx(O,{}),e.jsx($,{slot:"file-preview",className:"mx-auto mt-24"}),e.jsx(De,{entries:[s.entry],showHeader:!1,allowDownload:s.allow_download})]}):null}function As(){var d;const{status:s,link:a}=x(),{trans:r}=K(),i=m(l=>l.isPasswordProtected),o=m(l=>l.password);let n;if(s==="pending")n=e.jsx("div",{className:"flex h-screen flex-auto items-center justify-center",children:e.jsx(b,{"aria-label":r({message:"Loading link"}),isIndeterminate:!0})});else{if(!a&&!i)return e.jsx(fe,{});i&&!o?n=e.jsx(Xe,{}):((d=a==null?void 0:a.entry)==null?void 0:d.type)==="folder"?n=e.jsx(Je,{}):n=e.jsx(Ye,{})}return e.jsx(ve,{children:e.jsx(ke.Provider,{value:{shareable_link:a==null?void 0:a.id,password:o},children:n})})}export{As as Component};
//# sourceMappingURL=shareable-link-page-xc4wZgbN.js.map
