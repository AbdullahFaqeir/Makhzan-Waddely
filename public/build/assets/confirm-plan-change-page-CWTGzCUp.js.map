{"version":3,"file":"confirm-plan-change-page-CWTGzCUp.js","sources":["../../../common/foundation/resources/client/billing/billing-page/requests/use-change-subscription-plan.ts","../../../common/foundation/resources/client/billing/billing-page/confirm-plan-change-page.tsx"],"sourcesContent":["import {useMutation} from '@tanstack/react-query';\nimport {apiClient} from '@common/http/query-client';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {toast} from '@ui/toast/toast';\nimport {message} from '@ui/i18n/message';\nimport {User} from '@ui/types/user';\nimport {invalidateBillingUserQuery} from '../use-billing-user';\nimport {useNavigate} from '@common/ui/navigation/use-navigate';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\n\ninterface Response extends BackendResponse {\n  user: User;\n}\n\ninterface Payload {\n  subscriptionId: number;\n  newProductId: number;\n  newPriceId: number;\n}\n\nexport function useChangeSubscriptionPlan() {\n  const {trans} = useTrans();\n  const navigate = useNavigate();\n  return useMutation({\n    mutationFn: (props: Payload) => changePlan(props),\n    onSuccess: () => {\n      toast(trans(message('Plan changed.')));\n      invalidateBillingUserQuery();\n      navigate('/billing');\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n}\n\nfunction changePlan({subscriptionId, ...other}: Payload): Promise<Response> {\n  return apiClient\n    .post(`billing/subscriptions/${subscriptionId}/change-plan`, other)\n    .then(r => r.data);\n}\n","import {billingQueries} from '@common/billing/billing-queries';\nimport {useQuery} from '@tanstack/react-query';\nimport {Breadcrumb} from '@ui/breadcrumbs/breadcrumb';\nimport {BreadcrumbItem} from '@ui/breadcrumbs/breadcrumb-item';\nimport {Button} from '@ui/buttons/button';\nimport {FormattedDate} from '@ui/i18n/formatted-date';\nimport {Trans} from '@ui/i18n/trans';\nimport {Fragment} from 'react';\nimport {Link, Navigate, useParams} from 'react-router';\nimport {useNavigate} from '../../ui/navigation/use-navigate';\nimport {FormattedPrice} from '../formatted-price';\nimport {BillingPlanPanel} from './billing-plan-panel';\nimport {useChangeSubscriptionPlan} from './requests/use-change-subscription-plan';\nimport {useBillingUser} from './use-billing-user';\n\nconst previousUrl = '/billing/change-plan';\n\nexport function Component() {\n  const {productId, priceId} = useParams();\n  const navigate = useNavigate();\n  const query = useQuery(billingQueries.products.index());\n  const {subscription} = useBillingUser();\n  const changePlan = useChangeSubscriptionPlan();\n\n  if (!query.data || subscription?.price_id == priceId) {\n    return <Navigate to=\"/billing/change-plan\" replace />;\n  }\n\n  const newProduct = query.data.products.find(p => `${p.id}` === productId);\n  const newPrice = newProduct?.prices.find(p => `${p.id}` === priceId);\n\n  if (!newProduct || !newPrice || !subscription) {\n    navigate(previousUrl);\n    return null;\n  }\n\n  const newDate = (\n    <span className=\"whitespace-nowrap\">\n      <FormattedDate date={subscription.renews_at} preset=\"long\" />;\n    </span>\n  );\n\n  return (\n    <Fragment>\n      <Breadcrumb>\n        <BreadcrumbItem isLink onSelected={() => navigate('/billing')}>\n          <Trans message=\"Billing\" />\n        </BreadcrumbItem>\n        <BreadcrumbItem onSelected={() => navigate(previousUrl)}>\n          <Trans message=\"Plans\" />\n        </BreadcrumbItem>\n        <BreadcrumbItem>\n          <Trans message=\"Confirm\" />\n        </BreadcrumbItem>\n      </Breadcrumb>\n      <h1 className=\"my-32 text-3xl font-bold md:my-64\">\n        <Trans message=\"Confirm your new plan\" />\n      </h1>\n      <BillingPlanPanel title={<Trans message=\"Changing to\" />}>\n        <div className=\"max-w-[464px]\">\n          <div className=\"text-xl font-bold\">{newProduct.name}</div>\n          <FormattedPrice price={newPrice} className=\"text-lg\" />\n          <div className=\"mb-48 mt-12 border-b pb-24 text-base\">\n            <Trans\n              message=\"You will be charged the new price starting :date\"\n              values={{date: newDate}}\n            />\n          </div>\n          <div>\n            <div>\n              <Button\n                variant=\"flat\"\n                color=\"primary\"\n                size=\"md\"\n                className=\"mb-16 w-full\"\n                onClick={() => {\n                  changePlan.mutate({\n                    subscriptionId: subscription.id,\n                    newProductId: newProduct.id,\n                    newPriceId: newPrice.id,\n                  });\n                }}\n                disabled={changePlan.isPending}\n              >\n                <Trans message=\"Confirm\" />\n              </Button>\n            </div>\n            <div>\n              <Button\n                variant=\"outline\"\n                className=\"w-full\"\n                to={previousUrl}\n                elementType={Link}\n              >\n                <Trans message=\"Go back\" />\n              </Button>\n            </div>\n            <div className=\"mt-12 text-xs text-muted\">\n              <Trans message=\"By confirming your new plan, you agree to our terms of Service and privacy policy.\" />\n            </div>\n          </div>\n        </div>\n      </BillingPlanPanel>\n    </Fragment>\n  );\n}\n"],"names":["useChangeSubscriptionPlan","trans","useTrans","navigate","useNavigate","useMutation","props","changePlan","toast","message","invalidateBillingUserQuery","err","showHttpErrorToast","subscriptionId","other","apiClient","r","previousUrl","Component","productId","priceId","useParams","query","useQuery","billingQueries","subscription","useBillingUser","jsx","Navigate","newProduct","p","newPrice","newDate","jsxs","FormattedDate","Fragment","Breadcrumb","BreadcrumbItem","Trans","BillingPlanPanel","FormattedPrice","Button","Link"],"mappings":"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"}