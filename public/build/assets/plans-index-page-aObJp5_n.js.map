{"version":3,"file":"plans-index-page-aObJp5_n.js","sources":["../../../common/foundation/resources/client/admin/plans/plans-index-page-filters.ts","../../../common/foundation/resources/client/admin/plans/requests/use-delete-product.ts","../../../common/foundation/resources/client/admin/plans/requests/use-sync-products.ts","../../../common/foundation/resources/client/admin/plans/plans-index-page.tsx"],"sourcesContent":["import {\n  BackendFilter,\n  FilterControlType,\n  FilterOperator,\n} from '../../datatable/filters/backend-filter';\nimport {message} from '@ui/i18n/message';\nimport {\n  createdAtFilter,\n  updatedAtFilter,\n} from '@common/datatable/filters/timestamp-filters';\n\nexport const PlansIndexPageFilters: BackendFilter[] = [\n  {\n    key: 'subscriptions',\n    label: message('Subscriptions'),\n    description: message('Whether plan has any active subscriptions'),\n    defaultOperator: FilterOperator.eq,\n    control: {\n      type: FilterControlType.Select,\n      defaultValue: '01',\n      options: [\n        {\n          key: '01',\n          label: message('Has active subscriptions'),\n          value: {value: '*', operator: FilterOperator.has},\n        },\n        {\n          key: '02',\n          label: message('Does not have active subscriptions'),\n          value: {value: '*', operator: FilterOperator.doesntHave},\n        },\n      ],\n    },\n  },\n  createdAtFilter({\n    description: message('Date plan was created'),\n  }),\n  updatedAtFilter({\n    description: message('Date plan was last updated'),\n  }),\n];\n","import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {useMutation} from '@tanstack/react-query';\nimport {message} from '@ui/i18n/message';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {toast} from '@ui/toast/toast';\n\nconst endpoint = (id: number) => `billing/products/${id}`;\n\ninterface Response extends BackendResponse {}\n\ninterface Payload {\n  productId: number;\n}\n\nexport function useDeleteProduct() {\n  const {trans} = useTrans();\n  return useMutation({\n    mutationFn: (payload: Payload) => updateProduct(payload),\n    onSuccess: () => {\n      toast(trans(message('Plan deleted')));\n      queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.products.invalidateKey,\n      });\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n}\n\nfunction updateProduct({productId}: Payload): Promise<Response> {\n  return apiClient.delete(endpoint(productId)).then(r => r.data);\n}\n","import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {useMutation} from '@tanstack/react-query';\nimport {message} from '@ui/i18n/message';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {toast} from '@ui/toast/toast';\n\ninterface Response extends BackendResponse {}\n\nexport function useSyncProducts() {\n  const {trans} = useTrans();\n  return useMutation({\n    mutationFn: () => syncPlans(),\n    onSuccess: () => {\n      toast(trans(message('Plans synced')));\n      queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.products.invalidateKey,\n      });\n    },\n    onError: err => showHttpErrorToast(err, message('Could not sync plans')),\n  });\n}\n\nfunction syncPlans(): Promise<Response> {\n  return apiClient.post('billing/products/sync').then(r => r.data);\n}\n","import {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {GlobalLoadingProgress} from '@common/core/global-loading-progress';\nimport {DataTableHeader} from '@common/datatable/data-table-header';\nimport {DataTablePaginationFooter} from '@common/datatable/data-table-pagination-footer';\nimport {useDatatableSearchParams} from '@common/datatable/filters/utils/use-datatable-search-params';\nimport {validateDatatableSearch} from '@common/datatable/filters/utils/validate-datatable-search';\nimport {DatatableFilters} from '@common/datatable/page/datatable-filters';\nimport {\n  DatatablePageHeaderBar,\n  DatatablePageScrollContainer,\n  DatatablePageWithHeaderBody,\n  DatatablePageWithHeaderLayout,\n} from '@common/datatable/page/datatable-page-with-header-layout';\nimport {useDatatableQuery} from '@common/datatable/requests/use-datatable-query';\nimport {Table} from '@common/ui/tables/table';\nimport {IconButton} from '@ui/buttons/icon-button';\nimport {FormattedDate} from '@ui/i18n/formatted-date';\nimport {Trans} from '@ui/i18n/trans';\nimport {DeleteIcon} from '@ui/icons/material/Delete';\nimport {EditIcon} from '@ui/icons/material/Edit';\nimport {SyncIcon} from '@ui/icons/material/Sync';\nimport {ConfirmationDialog} from '@ui/overlays/dialog/confirmation-dialog';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {Tooltip} from '@ui/tooltip/tooltip';\nimport {Fragment} from 'react';\nimport {Link} from 'react-router';\nimport {FormattedPrice} from '../../billing/formatted-price';\nimport {Product} from '../../billing/product';\nimport {ColumnConfig} from '../../datatable/column-config';\nimport {NameWithAvatar} from '../../datatable/column-templates/name-with-avatar';\nimport {DataTableAddItemButton} from '../../datatable/data-table-add-item-button';\nimport {DataTableEmptyStateMessage} from '../../datatable/page/data-table-emty-state-message';\nimport {useNavigate} from '../../ui/navigation/use-navigate';\nimport softwareEngineerSvg from './../tags/software-engineer.svg';\nimport {PlansIndexPageFilters} from './plans-index-page-filters';\nimport {useDeleteProduct} from './requests/use-delete-product';\nimport {useSyncProducts} from './requests/use-sync-products';\n\nconst columnConfig: ColumnConfig<Product>[] = [\n  {\n    key: 'name',\n    allowsSorting: true,\n    visibleInMode: 'all',\n    header: () => <Trans message=\"Name\" />,\n    body: product => {\n      const price = product.prices[0];\n      return (\n        <NameWithAvatar\n          label={product.name}\n          description={\n            product.free ? (\n              <Trans message=\"Free\" />\n            ) : (\n              <FormattedPrice price={price} />\n            )\n          }\n        />\n      );\n    },\n  },\n  {\n    key: 'created_at',\n    allowsSorting: true,\n    maxWidth: 'max-w-100',\n    header: () => <Trans message=\"Created\" />,\n    body: product => <FormattedDate date={product.created_at} />,\n  },\n  {\n    key: 'updated_at',\n    allowsSorting: true,\n    maxWidth: 'max-w-100',\n    header: () => <Trans message=\"Last updated\" />,\n    body: product => <FormattedDate date={product.updated_at} />,\n  },\n  {\n    key: 'actions',\n    header: () => <Trans message=\"Actions\" />,\n    visibleInMode: 'all',\n    hideHeader: true,\n    align: 'end',\n    maxWidth: 'max-w-84',\n    body: product => {\n      return (\n        <Fragment>\n          <IconButton\n            size=\"md\"\n            className=\"text-muted\"\n            elementType={Link}\n            to={`/admin/plans/${product.id}/edit`}\n          >\n            <EditIcon />\n          </IconButton>\n          <DeleteProductButton product={product} />\n        </Fragment>\n      );\n    },\n  },\n];\n\nexport function Component() {\n  const navigate = useNavigate();\n  const {\n    searchParams,\n    sortDescriptor,\n    mergeIntoSearchParams,\n    setSearchQuery,\n    isFiltering,\n  } = useDatatableSearchParams(validateDatatableSearch);\n\n  const query = useDatatableQuery(\n    commonAdminQueries.products.index(searchParams),\n  );\n\n  return (\n    <DatatablePageWithHeaderLayout>\n      <GlobalLoadingProgress query={query} />\n      <DatatablePageHeaderBar\n        title={<Trans message=\"Subscription plans\" />}\n        showSidebarToggleButton\n      />\n      <DatatablePageWithHeaderBody>\n        <DataTableHeader\n          searchValue={searchParams.query}\n          onSearchChange={setSearchQuery}\n          actions={<Actions />}\n          filters={PlansIndexPageFilters}\n        />\n        <DatatableFilters filters={PlansIndexPageFilters} />\n        <DatatablePageScrollContainer>\n          <Table\n            columns={columnConfig}\n            data={query.items}\n            sortDescriptor={sortDescriptor}\n            onSortChange={mergeIntoSearchParams}\n            enableSelection={false}\n            onAction={item => {\n              navigate(`/admin/plans/${item.id}/edit`);\n            }}\n          />\n          {query.isEmpty && (\n            <DataTableEmptyStateMessage\n              className=\"mt-50\"\n              isFiltering={isFiltering}\n              image={softwareEngineerSvg}\n              title={<Trans message=\"No plans have been created yet\" />}\n              filteringTitle={<Trans message=\"No matching plans\" />}\n            />\n          )}\n          <DataTablePaginationFooter\n            query={query}\n            onPageChange={page => mergeIntoSearchParams({page})}\n            onPerPageChange={perPage => mergeIntoSearchParams({perPage})}\n          />\n        </DatatablePageScrollContainer>\n      </DatatablePageWithHeaderBody>\n    </DatatablePageWithHeaderLayout>\n  );\n}\n\ninterface DeleteProductButtonProps {\n  product: Product;\n}\nfunction DeleteProductButton({product}: DeleteProductButtonProps) {\n  const deleteProduct = useDeleteProduct();\n  return (\n    <DialogTrigger\n      type=\"modal\"\n      onClose={confirmed => {\n        if (confirmed) {\n          deleteProduct.mutate({productId: product.id});\n        }\n      }}\n    >\n      <Tooltip label={<Trans message=\"Delete plan\" />}>\n        <IconButton\n          size=\"md\"\n          className=\"text-muted\"\n          disabled={deleteProduct.isPending}\n        >\n          <DeleteIcon />\n        </IconButton>\n      </Tooltip>\n      <ConfirmationDialog\n        title={<Trans message=\"Delete plan\" />}\n        body={<Trans message=\"Are you sure you want to delete this plan?\" />}\n        confirm={<Trans message=\"Delete\" />}\n      />\n    </DialogTrigger>\n  );\n}\n\nfunction Actions() {\n  const syncPlans = useSyncProducts();\n  return (\n    <Fragment>\n      <Tooltip label={<Trans message=\"Sync plans with Stripe & PayPal\" />}>\n        <IconButton\n          color=\"primary\"\n          variant=\"outline\"\n          size=\"sm\"\n          disabled={syncPlans.isPending}\n          onClick={() => {\n            syncPlans.mutate();\n          }}\n        >\n          <SyncIcon />\n        </IconButton>\n      </Tooltip>\n      <DataTableAddItemButton elementType={Link} to=\"/admin/plans/new\">\n        <Trans message=\"Add new plan\" />\n      </DataTableAddItemButton>\n    </Fragment>\n  );\n}\n"],"names":["PlansIndexPageFilters","message","FilterOperator","FilterControlType","createdAtFilter","updatedAtFilter","endpoint","id","useDeleteProduct","trans","useTrans","useMutation","payload","updateProduct","toast","queryClient","commonAdminQueries","err","showHttpErrorToast","productId","apiClient","r","useSyncProducts","syncPlans","columnConfig","jsx","Trans","product","price","NameWithAvatar","FormattedPrice","FormattedDate","Fragment","IconButton","Link","EditIcon","DeleteProductButton","Component","navigate","useNavigate","searchParams","sortDescriptor","mergeIntoSearchParams","setSearchQuery","isFiltering","useDatatableSearchParams","validateDatatableSearch","query","useDatatableQuery","DatatablePageWithHeaderLayout","GlobalLoadingProgress","DatatablePageHeaderBar","DatatablePageWithHeaderBody","DataTableHeader","Actions","DatatableFilters","DatatablePageScrollContainer","Table","item","DataTableEmptyStateMessage","softwareEngineerSvg","DataTablePaginationFooter","page","perPage","deleteProduct","jsxs","DialogTrigger","confirmed","Tooltip","DeleteIcon","ConfirmationDialog","SyncIcon","DataTableAddItemButton"],"mappings":"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"}