{"version":3,"file":"translation-management-page-uWO9OgiT.js","sources":["../../../common/foundation/resources/client/admin/translations/new-translation-dialog.tsx","../../../common/foundation/resources/client/admin/translations/translation-management-page.tsx"],"sourcesContent":["import {useForm} from 'react-hook-form';\nimport {Dialog} from '@ui/overlays/dialog/dialog';\nimport {DialogHeader} from '@ui/overlays/dialog/dialog-header';\nimport {Trans} from '@ui/i18n/trans';\nimport {DialogBody} from '@ui/overlays/dialog/dialog-body';\nimport {useDialogContext} from '@ui/overlays/dialog/dialog-context';\nimport {Form} from '@ui/forms/form';\nimport {FormTextField} from '@ui/forms/input-field/text-field/text-field';\nimport {DialogFooter} from '@ui/overlays/dialog/dialog-footer';\nimport {Button} from '@ui/buttons/button';\nimport {SectionHelper} from '../../ui/other/section-helper';\n\ninterface FormValue {\n  key: string;\n  value: string;\n}\n\nexport function NewTranslationDialog() {\n  const {formId, close} = useDialogContext();\n  const form = useForm<FormValue>();\n\n  return (\n    <Dialog>\n      <DialogHeader>\n        <Trans message=\"Add translation\" />\n      </DialogHeader>\n      <DialogBody>\n        <Form\n          form={form}\n          id={formId}\n          onSubmit={values => {\n            close(values);\n          }}\n        >\n          <SectionHelper\n            className=\"mb-30\"\n            title={\n              <Trans message=\"Add a new translation, if it does not exist already.\" />\n            }\n            description={\n              <Trans message=\"This should only need to be done for things like custom menu items.\" />\n            }\n          />\n          <FormTextField\n            inputElementType=\"textarea\"\n            rows={2}\n            autoFocus\n            name=\"key\"\n            label={<Trans message=\"Translation key\" />}\n            className=\"mb-30\"\n            required\n          />\n          <FormTextField\n            inputElementType=\"textarea\"\n            rows={2}\n            name=\"value\"\n            label={<Trans message=\"Translation value\" />}\n            required\n          />\n        </Form>\n      </DialogBody>\n      <DialogFooter>\n        <Button onClick={close}>\n          <Trans message=\"Cancel\" />\n        </Button>\n        <Button variant=\"flat\" color=\"primary\" type=\"submit\" form={formId}>\n          <Trans message=\"Add\" />\n        </Button>\n      </DialogFooter>\n    </Dialog>\n  );\n}\n","import {useUploadTranslationFile} from '@common/admin/translations/use-upload-translation-file';\nimport {useVirtualizer} from '@tanstack/react-virtual';\nimport {Button} from '@ui/buttons/button';\nimport {IconButton} from '@ui/buttons/icon-button';\nimport {TextField} from '@ui/forms/input-field/text-field/text-field';\nimport {Localization} from '@ui/i18n/localization';\nimport {Trans} from '@ui/i18n/trans';\nimport {useTrans} from '@ui/i18n/use-trans';\nimport {AddIcon} from '@ui/icons/material/Add';\nimport {CloseIcon} from '@ui/icons/material/Close';\nimport {MoreVertIcon} from '@ui/icons/material/MoreVert';\nimport {SearchIcon} from '@ui/icons/material/Search';\nimport {Menu, MenuItem, MenuTrigger} from '@ui/menu/menu-trigger';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {downloadFileFromUrl} from '@ui/utils/files/download-file-from-url';\nimport {openUploadWindow} from '@ui/utils/files/open-upload-window';\nimport {useIsMobileMediaQuery} from '@ui/utils/hooks/is-mobile-media-query';\nimport {useMemo, useRef, useState} from 'react';\nimport {useNavigate} from '../../ui/navigation/use-navigate';\nimport {NewTranslationDialog} from './new-translation-dialog';\nimport {useUpdateLocalization} from './update-localization';\n\nimport {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {DatatablePageHeaderBar} from '@common/datatable/page/datatable-page-with-header-layout';\nimport {useRequiredParams} from '@common/ui/navigation/use-required-params';\nimport {useSuspenseQuery} from '@tanstack/react-query';\nimport {Breadcrumb} from '@ui/breadcrumbs/breadcrumb';\nimport {BreadcrumbItem} from '@ui/breadcrumbs/breadcrumb-item';\nimport {FileInputType} from '@ui/utils/files/file-input-config';\n\ntype Lines = Record<string, string>;\n\nexport function Component() {\n  const {localeId} = useRequiredParams(['localeId']);\n  const query = useSuspenseQuery(\n    commonAdminQueries.localizations.get(localeId),\n  );\n\n  const [lines, setLines] = useState<Lines>(\n    query.data.localization.lines || {},\n  );\n\n  const navigate = useNavigate();\n  const updateLocalization = useUpdateLocalization();\n  const [searchQuery, setSearchQuery] = useState<string>('');\n\n  return (\n    <form\n      className=\"flex h-full flex-col\"\n      onSubmit={e => {\n        e.preventDefault();\n        updateLocalization.mutate(\n          {id: query.data.localization.id, lines},\n          {\n            onSuccess: () => {\n              navigate('/admin/localizations');\n            },\n          },\n        );\n      }}\n    >\n      <DatatablePageHeaderBar\n        showSidebarToggleButton\n        title={\n          <Breadcrumb size=\"xl\">\n            <BreadcrumbItem\n              onSelected={() => {\n                navigate('/admin/localizations');\n              }}\n            >\n              <Trans message=\"Localizations\" />\n            </BreadcrumbItem>\n            <BreadcrumbItem>\n              <Trans\n                message=\":locale translations\"\n                values={{locale: query.data.localization.name}}\n              />\n            </BreadcrumbItem>\n          </Breadcrumb>\n        }\n      />\n      <Header\n        localization={query.data.localization}\n        setLines={setLines}\n        lines={lines}\n        searchQuery={searchQuery}\n        setSearchQuery={setSearchQuery}\n        isLoading={updateLocalization.isPending}\n      />\n      <LinesList lines={lines} setLines={setLines} searchQuery={searchQuery} />\n    </form>\n  );\n}\n\ninterface HeaderProps {\n  localization: Localization;\n  lines: Lines;\n  setLines: (lines: Lines) => void;\n  searchQuery: string;\n  setSearchQuery: (value: string) => void;\n  isLoading: boolean;\n}\nfunction Header({\n  localization,\n  searchQuery,\n  setSearchQuery,\n  isLoading,\n  lines,\n  setLines,\n}: HeaderProps) {\n  const isMobile = useIsMobileMediaQuery();\n  const {trans} = useTrans();\n\n  return (\n    <div className=\"flex-shrink-0 p-14 md:p-24\">\n      <div className=\"flex items-center gap-32 md:gap-12\">\n        <div className=\"max-w-440 flex-auto\">\n          <TextField\n            value={searchQuery}\n            onChange={e => setSearchQuery(e.target.value)}\n            startAdornment={<SearchIcon />}\n            placeholder={trans({message: 'Type to search...'})}\n          />\n        </div>\n        <DialogTrigger\n          type=\"modal\"\n          onClose={newTranslation => {\n            if (newTranslation) {\n              const newLines = {...lines};\n              newLines[newTranslation.key] = newTranslation.value;\n              setLines(newLines);\n            }\n          }}\n        >\n          {!isMobile && (\n            <Button\n              className=\"ml-auto\"\n              variant=\"outline\"\n              color=\"primary\"\n              startIcon={<AddIcon />}\n            >\n              <Trans message=\"Add new\" />\n            </Button>\n          )}\n          <NewTranslationDialog />\n        </DialogTrigger>\n        <ActionsMenuTrigger locale={localization} />\n        <Button\n          variant=\"flat\"\n          color=\"primary\"\n          type=\"submit\"\n          disabled={isLoading}\n        >\n          {isMobile ? (\n            <Trans message=\"Save\" />\n          ) : (\n            <Trans message=\"Save translations\" />\n          )}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\ninterface LinesListProps {\n  searchQuery?: string;\n  lines: Lines;\n  setLines: (lines: Lines) => void;\n}\nfunction LinesList({searchQuery, lines, setLines}: LinesListProps) {\n  const filteredLines = useMemo(() => {\n    return Object.entries(lines).filter(([id, translation]) => {\n      const lowerCaseQuery = searchQuery?.toLowerCase();\n      return (\n        !lowerCaseQuery ||\n        id?.toLowerCase().includes(lowerCaseQuery) ||\n        translation?.toLowerCase().includes(lowerCaseQuery)\n      );\n    });\n  }, [lines, searchQuery]);\n\n  const ref = useRef<HTMLDivElement>(null);\n  const rowVirtualizer = useVirtualizer({\n    count: filteredLines.length,\n    getScrollElement: () => ref.current,\n    estimateSize: () => 123,\n  });\n\n  return (\n    <div className=\"flex-auto overflow-y-auto px-14 md:px-24\" ref={ref}>\n      <div\n        className=\"relative w-full\"\n        style={{\n          height: `${rowVirtualizer.getTotalSize()}px`,\n        }}\n      >\n        {rowVirtualizer.getVirtualItems().map(virtualItem => {\n          const [id, translation] = filteredLines[virtualItem.index];\n          return (\n            <div\n              key={id}\n              className=\"absolute left-0 top-0 w-full\"\n              style={{\n                height: `${virtualItem.size}px`,\n                transform: `translateY(${virtualItem.start}px)`,\n              }}\n            >\n              <div className=\"mb-10 rounded border md:mr-10\">\n                <div className=\"flex items-center justify-between gap-24 border-b px-10 py-2\">\n                  <label\n                    className=\"flex-auto text-xs font-semibold\"\n                    htmlFor={id}\n                  >\n                    {id}\n                  </label>\n                  <IconButton\n                    size=\"xs\"\n                    className=\"text-muted\"\n                    onClick={() => {\n                      const newLines = {...lines};\n                      delete newLines[id];\n                      setLines(newLines);\n                    }}\n                  >\n                    <CloseIcon />\n                  </IconButton>\n                </div>\n                <div>\n                  <textarea\n                    id={id}\n                    name={id}\n                    defaultValue={translation}\n                    className=\"block w-full resize-none rounded bg-inherit p-10 text-sm outline-none focus-visible:ring-2\"\n                    rows={2}\n                    onChange={e => {\n                      const newLines = {...lines};\n                      newLines[id] = e.target.value;\n                      setLines(newLines);\n                    }}\n                  />\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\ninterface ActionsMenuTriggerProps {\n  locale: Localization;\n}\nfunction ActionsMenuTrigger({locale}: ActionsMenuTriggerProps) {\n  const uploadFile = useUploadTranslationFile();\n  return (\n    <MenuTrigger>\n      <IconButton\n        variant=\"outline\"\n        size=\"sm\"\n        color=\"primary\"\n        disabled={uploadFile.isPending}\n      >\n        <MoreVertIcon />\n      </IconButton>\n      <Menu>\n        <MenuItem\n          value=\"download\"\n          onSelected={() =>\n            downloadFileFromUrl(`api/v1/localizations/${locale.id}/download`)\n          }\n        >\n          <Trans message=\"Download\" />\n        </MenuItem>\n        <MenuItem\n          value=\"upload\"\n          onSelected={async () => {\n            const files = await openUploadWindow({\n              types: [FileInputType.json],\n            });\n            if (files.length == 1) {\n              uploadFile.mutate({localeId: locale.id, file: files[0]});\n            }\n          }}\n        >\n          <Trans message=\"Upload\" />\n        </MenuItem>\n      </Menu>\n    </MenuTrigger>\n  );\n}\n"],"names":["NewTranslationDialog","formId","close","useDialogContext","form","useForm","Dialog","jsx","DialogHeader","Trans","DialogBody","jsxs","Form","values","SectionHelper","FormTextField","DialogFooter","Button","Component","localeId","useRequiredParams","query","useSuspenseQuery","commonAdminQueries","lines","setLines","useState","navigate","useNavigate","updateLocalization","useUpdateLocalization","searchQuery","setSearchQuery","e","DatatablePageHeaderBar","Breadcrumb","BreadcrumbItem","Header","LinesList","localization","isLoading","isMobile","useIsMobileMediaQuery","trans","useTrans","TextField","SearchIcon","DialogTrigger","newTranslation","newLines","AddIcon","ActionsMenuTrigger","filteredLines","useMemo","id","translation","lowerCaseQuery","ref","useRef","rowVirtualizer","useVirtualizer","virtualItem","IconButton","CloseIcon","locale","uploadFile","useUploadTranslationFile","MenuTrigger","MoreVertIcon","Menu","MenuItem","downloadFileFromUrl","files","openUploadWindow","FileInputType"],"mappings":"ylCAiBO,SAASA,GAAuB,CACrC,KAAM,CAAC,OAAAC,EAAQ,MAAAC,CAAA,EAASC,EAAA,EAClBC,EAAOC,EAAA,EAEb,cACGC,EAAA,CACC,SAAA,CAAAC,MAACC,EAAA,CACC,SAAAD,EAAAA,IAACE,EAAA,CAAM,QAAQ,kBAAkB,EACnC,QACCC,EAAA,CACC,SAAAC,EAAAA,KAACC,EAAA,CACC,KAAAR,EACA,GAAIH,EACJ,SAAUY,GAAU,CAClBX,EAAMW,CAAM,CACd,EAEA,SAAA,CAAAN,EAAAA,IAACO,EAAA,CACC,UAAU,QACV,MACEP,EAAAA,IAACE,EAAA,CAAM,QAAQ,sDAAA,CAAuD,EAExE,YACEF,EAAAA,IAACE,EAAA,CAAM,QAAQ,qEAAA,CAAsE,CAAA,CAAA,EAGzFF,EAAAA,IAACQ,EAAA,CACC,iBAAiB,WACjB,KAAM,EACN,UAAS,GACT,KAAK,MACL,MAAOR,EAAAA,IAACE,EAAA,CAAM,QAAQ,iBAAA,CAAkB,EACxC,UAAU,QACV,SAAQ,EAAA,CAAA,EAEVF,EAAAA,IAACQ,EAAA,CACC,iBAAiB,WACjB,KAAM,EACN,KAAK,QACL,MAAOR,EAAAA,IAACE,EAAA,CAAM,QAAQ,mBAAA,CAAoB,EAC1C,SAAQ,EAAA,CAAA,CACV,CAAA,CAAA,EAEJ,SACCO,EAAA,CACC,SAAA,CAAAT,EAAAA,IAACU,GAAO,QAASf,EACf,eAACO,EAAA,CAAM,QAAQ,SAAS,CAAA,CAC1B,EACAF,EAAAA,IAACU,EAAA,CAAO,QAAQ,OAAO,MAAM,UAAU,KAAK,SAAS,KAAMhB,EACzD,SAAAM,EAAAA,IAACE,EAAA,CAAM,QAAQ,MAAM,CAAA,CACvB,CAAA,CAAA,CACF,CAAA,EACF,CAEJ,CCvCO,SAASS,IAAY,CAC1B,KAAM,CAAC,SAAAC,CAAA,EAAYC,EAAkB,CAAC,UAAU,CAAC,EAC3CC,EAAQC,EACZC,EAAmB,cAAc,IAAIJ,CAAQ,CAAA,EAGzC,CAACK,EAAOC,CAAQ,EAAIC,EAAAA,SACxBL,EAAM,KAAK,aAAa,OAAS,CAAA,CAAC,EAG9BM,EAAWC,EAAA,EACXC,EAAqBC,EAAA,EACrB,CAACC,EAAaC,CAAc,EAAIN,EAAAA,SAAiB,EAAE,EAEzD,OACEf,EAAAA,KAAC,OAAA,CACC,UAAU,uBACV,SAAUsB,GAAK,CACbA,EAAE,eAAA,EACFJ,EAAmB,OACjB,CAAC,GAAIR,EAAM,KAAK,aAAa,GAAI,MAAAG,CAAA,EACjC,CACE,UAAW,IAAM,CACfG,EAAS,sBAAsB,CACjC,CAAA,CACF,CAEJ,EAEA,SAAA,CAAApB,EAAAA,IAAC2B,EAAA,CACC,wBAAuB,GACvB,MACEvB,EAAAA,KAACwB,EAAA,CAAW,KAAK,KACf,SAAA,CAAA5B,EAAAA,IAAC6B,EAAA,CACC,WAAY,IAAM,CAChBT,EAAS,sBAAsB,CACjC,EAEA,SAAApB,EAAAA,IAACE,EAAA,CAAM,QAAQ,eAAA,CAAgB,CAAA,CAAA,QAEhC2B,EAAA,CACC,SAAA7B,EAAAA,IAACE,EAAA,CACC,QAAQ,uBACR,OAAQ,CAAC,OAAQY,EAAM,KAAK,aAAa,IAAA,CAAI,CAAA,CAC/C,CACF,CAAA,CAAA,CACF,CAAA,CAAA,EAGJd,EAAAA,IAAC8B,EAAA,CACC,aAAchB,EAAM,KAAK,aACzB,SAAAI,EACA,MAAAD,EACA,YAAAO,EACA,eAAAC,EACA,UAAWH,EAAmB,SAAA,CAAA,EAEhCtB,EAAAA,IAAC+B,EAAA,CAAU,MAAAd,EAAc,SAAAC,EAAoB,YAAAM,CAAA,CAA0B,CAAA,CAAA,CAAA,CAG7E,CAUA,SAASM,EAAO,CACd,aAAAE,EACA,YAAAR,EACA,eAAAC,EACA,UAAAQ,EACA,MAAAhB,EACA,SAAAC,CACF,EAAgB,CACd,MAAMgB,EAAWC,EAAA,EACX,CAAC,MAAAC,CAAA,EAASC,EAAA,EAEhB,aACG,MAAA,CAAI,UAAU,6BACb,SAAAjC,EAAAA,KAAC,MAAA,CAAI,UAAU,qCACb,SAAA,CAAAJ,EAAAA,IAAC,MAAA,CAAI,UAAU,sBACb,SAAAA,EAAAA,IAACsC,EAAA,CACC,MAAOd,EACP,SAAUE,GAAKD,EAAeC,EAAE,OAAO,KAAK,EAC5C,qBAAiBa,EAAA,EAAW,EAC5B,YAAaH,EAAM,CAAC,QAAS,oBAAoB,CAAA,CAAA,EAErD,EACAhC,EAAAA,KAACoC,EAAA,CACC,KAAK,QACL,QAASC,GAAkB,CACzB,GAAIA,EAAgB,CAClB,MAAMC,EAAW,CAAC,GAAGzB,CAAA,EACrByB,EAASD,EAAe,GAAG,EAAIA,EAAe,MAC9CvB,EAASwB,CAAQ,CACnB,CACF,EAEC,SAAA,CAAA,CAACR,GACAlC,EAAAA,IAACU,EAAA,CACC,UAAU,UACV,QAAQ,UACR,MAAM,UACN,gBAAYiC,EAAA,EAAQ,EAEpB,SAAA3C,EAAAA,IAACE,EAAA,CAAM,QAAQ,SAAA,CAAU,CAAA,CAAA,QAG5BT,EAAA,CAAA,CAAqB,CAAA,CAAA,CAAA,EAExBO,EAAAA,IAAC4C,EAAA,CAAmB,OAAQZ,CAAA,CAAc,EAC1ChC,EAAAA,IAACU,EAAA,CACC,QAAQ,OACR,MAAM,UACN,KAAK,SACL,SAAUuB,EAET,SAAAC,QACEhC,EAAA,CAAM,QAAQ,OAAO,EAEtBF,EAAAA,IAACE,EAAA,CAAM,QAAQ,mBAAA,CAAoB,CAAA,CAAA,CAEvC,CAAA,CACF,CAAA,CACF,CAEJ,CAOA,SAAS6B,EAAU,CAAC,YAAAP,EAAa,MAAAP,EAAO,SAAAC,GAA2B,CACjE,MAAM2B,EAAgBC,EAAAA,QAAQ,IACrB,OAAO,QAAQ7B,CAAK,EAAE,OAAO,CAAC,CAAC8B,EAAIC,CAAW,IAAM,CACzD,MAAMC,EAAiBzB,GAAA,YAAAA,EAAa,cACpC,MACE,CAACyB,IACDF,GAAA,YAAAA,EAAI,cAAc,SAASE,MAC3BD,GAAA,YAAAA,EAAa,cAAc,SAASC,GAExC,CAAC,EACA,CAAChC,EAAOO,CAAW,CAAC,EAEjB0B,EAAMC,EAAAA,OAAuB,IAAI,EACjCC,EAAiBC,EAAe,CACpC,MAAOR,EAAc,OACrB,iBAAkB,IAAMK,EAAI,QAC5B,aAAc,IAAM,GAAA,CACrB,EAED,OACElD,EAAAA,IAAC,MAAA,CAAI,UAAU,2CAA2C,IAAAkD,EACxD,SAAAlD,EAAAA,IAAC,MAAA,CACC,UAAU,kBACV,MAAO,CACL,OAAQ,GAAGoD,EAAe,aAAA,CAAc,IAAA,EAGzC,SAAAA,EAAe,gBAAA,EAAkB,IAAIE,GAAe,CACnD,KAAM,CAACP,EAAIC,CAAW,EAAIH,EAAcS,EAAY,KAAK,EACzD,OACEtD,EAAAA,IAAC,MAAA,CAEC,UAAU,+BACV,MAAO,CACL,OAAQ,GAAGsD,EAAY,IAAI,KAC3B,UAAW,cAAcA,EAAY,KAAK,KAAA,EAG5C,SAAAlD,EAAAA,KAAC,MAAA,CAAI,UAAU,gCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,+DACb,SAAA,CAAAJ,EAAAA,IAAC,QAAA,CACC,UAAU,kCACV,QAAS+C,EAER,SAAAA,CAAA,CAAA,EAEH/C,EAAAA,IAACuD,EAAA,CACC,KAAK,KACL,UAAU,aACV,QAAS,IAAM,CACb,MAAMb,EAAW,CAAC,GAAGzB,CAAA,EACrB,OAAOyB,EAASK,CAAE,EAClB7B,EAASwB,CAAQ,CACnB,EAEA,eAACc,EAAA,CAAA,CAAU,CAAA,CAAA,CACb,EACF,QACC,MAAA,CACC,SAAAxD,EAAAA,IAAC,WAAA,CACC,GAAA+C,EACA,KAAMA,EACN,aAAcC,EACd,UAAU,6FACV,KAAM,EACN,SAAUtB,GAAK,CACb,MAAMgB,EAAW,CAAC,GAAGzB,CAAA,EACrByB,EAASK,CAAE,EAAIrB,EAAE,OAAO,MACxBR,EAASwB,CAAQ,CACnB,CAAA,CAAA,CACF,CACF,CAAA,CAAA,CACF,CAAA,EAzCKK,CAAA,CA4CX,CAAC,CAAA,CAAA,EAEL,CAEJ,CAKA,SAASH,EAAmB,CAAC,OAAAa,GAAkC,CAC7D,MAAMC,EAAaC,EAAA,EACnB,cACGC,EAAA,CACC,SAAA,CAAA5D,EAAAA,IAACuD,EAAA,CACC,QAAQ,UACR,KAAK,KACL,MAAM,UACN,SAAUG,EAAW,UAErB,eAACG,EAAA,CAAA,CAAa,CAAA,CAAA,SAEfC,EAAA,CACC,SAAA,CAAA9D,EAAAA,IAAC+D,EAAA,CACC,MAAM,WACN,WAAY,IACVC,EAAoB,wBAAwBP,EAAO,EAAE,WAAW,EAGlE,SAAAzD,EAAAA,IAACE,EAAA,CAAM,QAAQ,UAAA,CAAW,CAAA,CAAA,EAE5BF,EAAAA,IAAC+D,EAAA,CACC,MAAM,SACN,WAAY,SAAY,CACtB,MAAME,EAAQ,MAAMC,EAAiB,CACnC,MAAO,CAACC,EAAc,IAAI,CAAA,CAC3B,EACGF,EAAM,QAAU,GAClBP,EAAW,OAAO,CAAC,SAAUD,EAAO,GAAI,KAAMQ,EAAM,CAAC,EAAE,CAE3D,EAEA,SAAAjE,EAAAA,IAACE,EAAA,CAAM,QAAQ,QAAA,CAAS,CAAA,CAAA,CAC1B,CAAA,CACF,CAAA,EACF,CAEJ"}