import{b5 as p,aF as h,g as k,aC as C,r as n,j as u,x as t,k as S}from"./main-BdzhGpqn.js";import{l as _}from"./index-U9JJOqTM.js";import{B as w}from"./billing-redirect-message-6yuC9Q9u.js";import{C as x,a as L}from"./checkout-product-summary-CSKglORp.js";import"./TaskAlt-Dt65A2PZ.js";import"./skeleton-CTimao-U.js";import"./billing-queries-7PHfszbY.js";import"./formatted-price-DRpdBayZ.js";import"./product-feature-list-Pn5BcLN8.js";function q(){const{productId:e,priceId:s}=p(),r=h(),{billing:{stripe_public_key:l}}=k(),[b]=C(),a=b.get("payment_intent_client_secret"),[d,o]=n.useState(),g=n.useRef(!1);return n.useEffect(()=>{g.current||(_(l).then(async m=>{if(!m||!a){o(c());return}m.retrievePaymentIntent(a).then(async({paymentIntent:i})=>{(i==null?void 0:i.status)==="succeeded"?(await y(i.id),o(c("succeeded",e,s)),window.location.href="/billing"):o(c(i==null?void 0:i.status,e,s))})}),g.current=!0)},[l,a,s,e]),a?u.jsxs(x,{children:[u.jsx(w,{config:d}),u.jsx(L,{showBillingLine:!1})]}):(r("/"),null)}function c(e,s,r){switch(e){case"succeeded":return{message:t("Subscription successful!"),status:"success",buttonLabel:t("Return to site"),link:"/billing"};case"processing":return{message:t("Payment processing. We'll update you when payment is received."),status:"success",buttonLabel:t("Return to site"),link:"/billing"};case"requires_payment_method":return{message:t("Payment failed. Please try another payment method."),status:"error",buttonLabel:t("Go back"),link:f(s,r)};default:return{message:t("Something went wrong"),status:"error",buttonLabel:t("Go back"),link:f(s,r)}}}function f(e,s){return e&&s?`/checkout/${e}/${s}`:"/"}function y(e){return S.post("billing/stripe/store-subscription-details-locally",{payment_intent_id:e})}export{q as Component};
