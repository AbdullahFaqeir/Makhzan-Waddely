import{an as b,ap as q,aH as y,x as o,av as k,cU as H,k as f,a2 as Q,aD as z,a7 as P,j as e,M as R,Q as $,T as a,R as K,am as M,a9 as O,a3 as j,B as h,ao as T,ay as W,L as D,c as V,ax as w,ak as G,aB as p,J as x,D as c,g as J,r as S,cc as E,a1 as X,cE as Y}from"./main-TIUJvpaR.js";import{t as Z}from"./team-DYmDDGxN.js";import{F as ee}from"./image-selector-BFIa6Lk9.js";import{D as se}from"./dialog-footer-yCpPZGPO.js";import{F as ae}from"./file-upload-provider-B_bRCnuD.js";import{B as te,u as re}from"./use-unban-users-Z2XcbS_e.js";import{C as v}from"./confirmation-dialog-Ds1Wl8FN.js";import{N as oe}from"./name-with-avatar-B4cJ-k97.js";import{a as ie}from"./form-chip-field-ebQy8_UE.js";import{F as C}from"./formatted-date-CsxGDhkC.js";import{E as ne}from"./Edit-_sVfUVPu.js";import{L as le}from"./Login-8NOP77J2.js";import{P as B}from"./PersonOff-ClYErEVJ.js";import{a as l,F}from"./select-filter-panel-Bmcw5umN.js";import{c as me,u as de}from"./timestamp-filters-WRgK6N5J.js";import{u as ce,a as ue,G as pe,D as xe,b as ge,c as je}from"./use-datatable-query-GunfT5m0.js";import{D as he}from"./data-table-export-csv-button-wlpVM_TY.js";import{D as be}from"./data-table-add-item-button-rLvL8LGv.js";import{D as ye}from"./datatable-filters-BjM39JGH.js";import{a as fe,D as ve,b as De,c as we}from"./datatable-page-with-header-layout-Bbr3vl7W.js";import{T as Se}from"./table-Bwvbdqc8.js";import"./use-active-upload-DYNfvvrt.js";import"./open-upload-window-DllX9uve.js";import"./uploaded-file-CLeM2EFo.js";import"./shallow-CASQY68G.js";import"./AddAPhoto-aH5lhBgl.js";import"./progress-bar-base-DGA8yIQk.js";import"./file-input-config-DrcTpI3-.js";import"./pretty-bytes-bO14ePu9.js";import"./date-picker-ChxLcE9J.js";import"./use-current-date-time-BdzpdEnL.js";import"./use-date-formatter-hhGEq_P-.js";import"./DateRange-LhM59-62.js";import"./use-base-date-picker-state-DYQU3Rut.js";import"./input-C85ULg8F.js";import"./KeyboardArrowRight-C0U0wgwT.js";import"./switch-Bj7wwiPq.js";import"./use-normalized-models-DEvVtvvO.js";import"./ArrowRightAlt-CPRMvsTm.js";import"./use-date-range-picker-state-Df5vuAtM.js";import"./list-DlNGU0yW.js";import"./select-T49HzTXy.js";import"./skeleton-uSF3jNnm.js";import"./formatted-number-rmEdx96M.js";import"./FilterAlt-TOiEFGZR.js";import"./accordion-CabB8onw.js";import"./checkbox-kZVscZNC.js";import"./CheckBoxOutlineBlank-p6gxL9Ym.js";import"./FileDownload-pojohXY8.js";import"./download-file-from-url-BVaKcxRP.js";import"./Add-CRE_6SK0.js";import"./dashboard-layout-context-DA6Q35rI.js";import"./use-toggle-dashboard-left-sidebar-BuzWlDo2.js";import"./ArrowDownward-B1kd_Dtq.js";import"./useEffectEvent-Bgk8rSJ3.js";import"./use-pointer-events-B6G-2ez3.js";import"./useGlobalListeners-_BzTaAbJ.js";function Ce(s){return b({mutationFn:t=>Fe(t),onSuccess:()=>{y(o("User created")),k.invalidateQueries({queryKey:H.users.invalidateKey})},onError:t=>q(t,s)})}function Fe(s){return s.roles&&(s.roles=s.roles.map(t=>t.id)),f.post("users",s).then(t=>t.data)}function Ue(){const s=Q(),t=Ce(s),r=z(),{close:i,formId:n}=P();return e.jsxs(R,{children:[e.jsx($,{children:e.jsx(a,{message:"Create user"})}),e.jsx(K,{children:e.jsxs(M,{id:n,form:s,onSubmit:m=>{t.mutate(m,{onSuccess:g=>{i(),r(`${g.user.id}`,{replace:!0})}})},children:[e.jsx(ae,{children:e.jsx(ee,{className:"mb-24",name:"image",uploadType:O.avatars,label:e.jsx(a,{message:"Avatar"}),showRemoveButton:!0})}),e.jsx(j,{required:!0,className:"mb-24",name:"email",type:"email",label:e.jsx(a,{message:"Email"})}),e.jsx(j,{className:"mb-24",name:"name",label:e.jsx(a,{message:"Name"})}),e.jsx(j,{required:!0,name:"password",type:"password",label:e.jsx(a,{message:"Password"})})]})}),e.jsxs(se,{children:[e.jsx(h,{variant:"outline",onClick:()=>i(),children:e.jsx(a,{message:"Cancel"})}),e.jsx(h,{variant:"flat",color:"primary",type:"submit",form:n,disabled:t.isPending,children:e.jsx(a,{message:"Create"})})]})]})}function Ie(){return b({mutationFn:s=>ke(s),onSuccess:async s=>{y(o(`Impersonating user "${s.user.name}"`)),window.location.href="/"},onError:s=>T(s)})}function ke(s){return f.post(`admin/users/impersonate/${s.userId}`,s).then(t=>t.data)}function Pe({user:s}){const t=Ie();return e.jsx(v,{title:e.jsx(a,{message:"Impersonate user"}),isLoading:t.isPending,body:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(a,{message:"Are you sure you want to login as this user?"})}),e.jsx("p",{className:"mt-8",children:e.jsx(a,{message:"This will log you out of your current account and log you in as the user."})})]}),confirm:e.jsx(a,{message:"Login"}),onConfirm:()=>{t.mutate({userId:s.id})}})}const U=[{key:"name",allowsSorting:!0,sortingKey:"email",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(a,{message:"User"}),body:s=>e.jsx(oe,{image:s.image,label:s.name,description:s.email,alwaysShowAvatar:!0,avatarCircle:!0})},{key:"roles",header:()=>e.jsx(a,{message:"Roles"}),body:s=>{var t;return e.jsx(ie,{radius:"rounded",size:"xs",children:(t=s==null?void 0:s.roles)==null?void 0:t.map(r=>e.jsx(W,{selectable:!0,children:e.jsx(D,{className:V("capitalize"),target:"_blank",to:`/admin/roles/${r.id}/edit`,children:e.jsx(a,{message:r.name})})},r.id))})}},{key:"subscribed",header:()=>e.jsx(a,{message:"Subscribed"}),width:"w-96",body:s=>{var t;return(t=s.subscriptions)!=null&&t.filter(r=>r.valid).length?e.jsx(w,{className:"text-positive icon-md"}):e.jsx(G,{className:"text-danger icon-md"})}},{key:"banned_at",allowsSorting:!0,header:()=>e.jsx(a,{message:"Suspended"}),width:"w-96",body:s=>s.banned_at?e.jsx(w,{className:"text-danger icon-md"}):null},{key:"latest_active_session",width:"w-110",header:()=>e.jsx(a,{message:"Last active"}),body:s=>s.latest_active_session?e.jsx("time",{children:e.jsx(C,{date:s.latest_active_session.updated_at})}):"-"},{key:"created_at",allowsSorting:!0,width:"w-110",header:()=>e.jsx(a,{message:"Created at"}),body:s=>e.jsx("time",{children:e.jsx(C,{date:s.created_at})})},{key:"actions",header:()=>e.jsx(a,{message:"Actions"}),width:"w-128 flex-shrink-0",hideHeader:!0,align:"end",visibleInMode:"all",body:s=>e.jsxs("div",{className:"text-muted",children:[e.jsx(D,{to:`${s.id}/details`,children:e.jsx(p,{label:e.jsx(a,{message:"Edit user"}),children:e.jsx(x,{size:"md",children:e.jsx(ne,{})})})}),s.banned_at?e.jsx(Te,{user:s}):e.jsxs(c,{type:"modal",children:[e.jsx(p,{label:e.jsx(a,{message:"Suspend user"}),children:e.jsx(x,{size:"md",children:e.jsx(B,{})})}),e.jsx(te,{userIds:[s.id]})]}),e.jsx(Ee,{user:s})]})}];function Te({user:s}){const t=re([s.id]);return e.jsxs(c,{type:"modal",onClose:r=>{r&&t.mutate()},children:[e.jsx(p,{label:e.jsx(a,{message:"Remove suspension"}),children:e.jsx(x,{size:"md",color:"danger",children:e.jsx(B,{})})}),e.jsx(v,{isDanger:!0,title:e.jsx(a,{message:"Suspend “:name“",values:{name:s.name}}),body:e.jsx(a,{message:"Are you sure you want to remove suspension from this user?"}),confirm:e.jsx(a,{message:"Unsuspend"})})]})}function Ee({user:s}){return e.jsxs(c,{type:"modal",children:[e.jsx(p,{label:e.jsx(a,{message:"Login as user"}),children:e.jsx(x,{size:"md",children:e.jsx(le,{})})}),e.jsx(Pe,{user:s})]})}const I=[{key:"email_verified_at",label:o("Email"),description:o("Email verification status"),defaultOperator:l.ne,control:{type:F.Select,defaultValue:"01",options:[{key:"01",label:o("is confirmed"),value:{value:null,operator:l.ne}},{key:"02",label:o("is not confirmed"),value:{value:null,operator:l.eq}}]}},me({description:o("Date user registered or was created")}),de({description:o("Date user was last updated")}),{key:"subscriptions",label:o("Subscription"),description:o("Whether user is subscribed or not"),defaultOperator:l.eq,control:{type:F.Select,defaultValue:"01",options:[{key:"01",label:o("is subscribed"),value:{value:"*",operator:l.has}},{key:"02",label:o("is not subscribed"),value:{value:"*",operator:l.doesntHave}}]}}];function Ls(){const{billing:s}=J(),[t,r]=S.useState([]),{searchParams:i,sortDescriptor:n,mergeIntoSearchParams:m,setSearchQuery:g,isFiltering:N}=ce(Y),_=s.enable?U:U.filter(d=>d.key!=="subscribed"),u=ue(E.users.index(i)),A=e.jsxs(c,{type:"modal",children:[e.jsx(h,{variant:"flat",color:"danger",children:e.jsx(a,{message:"Delete"})}),e.jsx(Be,{selectedIds:t,onDelete:()=>r([])})]}),L=e.jsxs(S.Fragment,{children:[e.jsx(he,{endpoint:"users/csv/export"}),e.jsxs(c,{type:"modal",children:[e.jsx(be,{children:e.jsx(a,{message:"Add new user"})}),e.jsx(Ue,{})]})]});return e.jsxs(fe,{children:[e.jsx(pe,{query:u}),e.jsx(X,{children:e.jsx(a,{message:"Users"})}),e.jsx(ve,{title:e.jsx(a,{message:"Users"}),showSidebarToggleButton:!0}),e.jsxs(De,{children:[e.jsx(xe,{searchValue:i.query,onSearchChange:g,actions:L,selectedItems:t,selectedActions:A,filters:I}),e.jsx(ye,{filters:I}),e.jsxs(we,{children:[e.jsx(Se,{columns:_,data:u.items,sortDescriptor:n,onSortChange:m,enableSelection:!0,selectedRows:t,onSelectionChange:r}),u.isEmpty&&e.jsx(ge,{isFiltering:N,image:Z,title:e.jsx(a,{message:"No users have been created yet"}),filteringTitle:e.jsx(a,{message:"No matching users"})}),e.jsx(je,{query:u,onPageChange:d=>m({page:d}),onPerPageChange:d=>m({perPage:d})})]})]})]})}function Be({selectedIds:s,onDelete:t}){const{close:r}=P(),i=b({mutationFn:()=>f.delete(`users/${s.join(",")}`),onSuccess:async()=>{await k.invalidateQueries({queryKey:E.users.invalidateKey}),y(o("Users deleted")),t(),r()},onError:n=>T(n)});return e.jsx(v,{isDanger:!0,isLoading:i.isPending,title:e.jsx(a,{message:"Delete users"}),body:e.jsx(a,{message:"Are you sure you want to delete selected users?",values:{count:s.length}}),confirm:e.jsx(a,{message:"Delete"}),onConfirm:()=>i.mutate()})}export{Ls as Component,Be as DeleteUsersDialog};
