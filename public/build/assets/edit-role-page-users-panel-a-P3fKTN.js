import{a8 as N,r as h,w as P,j as e,M as R,Q as A,T as t,R as F,ay as k,x as j,S as q,B as g,aG as Q,aH as E,c as M,aE as K,ap as b,aq as S,aJ as D,k as I,ce as f,D as C,ax as T,cQ as z,a1 as V}from"./main-BdzhGpqn.js";import{b as U,u as H,a as L,G as $,D as B,c as G}from"./use-datatable-query-CL53W5gM.js";import{N as _}from"./name-with-avatar-oLONXEoV.js";import{c as J}from"./datatable-page-with-header-layout-T5QYry_g.js";import{D as W}from"./paginated-resources-CKb8WiSB.js";import{u as O}from"./use-required-params-B4etqSDS.js";import{T as X}from"./table-BV_6nbvK.js";import{D as Y}from"./dialog-footer-DL2JkwrZ.js";import{t as v}from"./team-DYmDDGxN.js";import{u as Z}from"./use-normalized-models-yOhv1j4Y.js";import{u as ee}from"./useSuspenseQuery-DRZs9XPp.js";import{F as se}from"./formatted-date-hsbUwQxj.js";import{C as ae}from"./confirmation-dialog-DtIJ4lxn.js";import"./FilterAlt-BkhHIgY7.js";import"./select-filter-panel-BD_PypVS.js";import"./form-chip-field-Bj0OQHU9.js";import"./input-CDTJ1VfY.js";import"./ArrowRightAlt-DSM1kJ5L.js";import"./DateRange-DT2RCJ3g.js";import"./use-base-date-picker-state-DYteqbZD.js";import"./use-date-formatter-BlrPWK68.js";import"./KeyboardArrowRight-DFizyHtY.js";import"./use-date-range-picker-state-CEbm743A.js";import"./list-DRfBegha.js";import"./switch-DFT-JawA.js";import"./use-current-date-time-CnLDai64.js";import"./select-l28gQBMg.js";import"./Edit-AfuLMjS-.js";import"./skeleton-CTimao-U.js";import"./accordion-DxYXjiZR.js";import"./checkbox-B6q4SJqi.js";import"./CheckBoxOutlineBlank-DvnJQjlB.js";import"./dashboard-layout-context-DDiFtkN0.js";import"./use-toggle-dashboard-left-sidebar-Dzdho4R0.js";import"./ArrowDownward-DXr7353z.js";import"./useEffectEvent-D8HiMrwe.js";import"./use-pointer-events-Dsln3OKq.js";import"./useGlobalListeners-C14jVC5X.js";function re({multiple:s=!1,endpoint:a="normalized-models/user"}){var y;const{close:r}=N(),[o,p]=h.useState(""),{trans:m}=P(),c=Z(a,{query:o,perPage:14}),u=((y=c.data)==null?void 0:y.results)||[],[i,n]=h.useState([]),w=e.jsx(Q,{className:"pt-20",size:"sm",title:e.jsx(t,{message:"No matching users"}),description:e.jsx(t,{message:"Try another search query"}),image:e.jsx(E,{src:v})});return e.jsxs(R,{size:"lg",children:[e.jsx(A,{children:s?e.jsx(t,{message:"Select users"}):e.jsx(t,{message:"Select a user"})}),e.jsxs(F,{children:[e.jsx(k,{autoFocus:!0,size:"sm",className:"mb-20",startAdornment:e.jsx(q,{}),placeholder:m(j("Search for user by name or email")),value:o,onChange:d=>{p(d.target.value)}}),!c.isLoading&&!u.length&&w,e.jsx("div",{className:"grid grid-cols-2 gap-x-10",children:u.map(d=>e.jsx(te,{isSelected:!!i.find(l=>l.id===d.id),user:d,onSelected:l=>{s?i.find(x=>x.id===l.id)?n(i.filter(x=>x.id!==l.id)):n([...i,l]):r(l)}},d.id))})]}),s&&e.jsxs(Y,{children:[e.jsx(g,{onClick:()=>r(),children:e.jsx(t,{message:"Cancel"})}),e.jsx(g,{variant:"flat",color:"primary",onClick:()=>r(i),disabled:!i.length,children:e.jsx(t,{message:"Select"})})]})]})}function te({user:s,onSelected:a,isSelected:r}){return e.jsxs("div",{className:M("flex items-center gap-10 rounded-panel border-1 p-10 outline-none ring-offset-4 focus-visible:ring",r?"border-primary bg-primary/5 hover:bg-primary/10":"border-transparent hover:bg-hover"),role:"button",tabIndex:0,onClick:()=>{a(s)},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),a(s))},children:[e.jsx(K,{src:s.image,label:s.name??"Visitor",circle:!0}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:s.name??e.jsx(t,{message:"Visitor"})}),e.jsx("div",{className:"overflow-hidden text-ellipsis text-muted",children:s.description})]})]},s.id)}function oe(s){return b({mutationFn:({userIds:a})=>ie({userIds:a,roleId:s.id}),onSuccess:(a,r)=>{D(j("Assigned [one 1 user|other :count users] to :role",{values:{count:r.userIds.length,role:s.name}}))},onError:a=>S(a)})}function ie({roleId:s,userIds:a}){return I.post(`roles/${s}/add-users`,{userIds:a}).then(r=>r.data)}function ne(s){return b({mutationFn:({userIds:a})=>le({userIds:a,roleId:s.id}),onSuccess:(a,r)=>{D(j("Removed [one 1 user|other :count users] from “{role}“",{values:{count:r.userIds.length,role:s.name}}))},onError:a=>S(a)})}function le({roleId:s,userIds:a}){return I.post(`roles/${s}/remove-users`,{userIds:a}).then(r=>r.data)}const me=[{key:"email",allowsSorting:!0,sortingKey:"email",visibleInMode:"all",header:()=>e.jsx(t,{message:"User"}),body:s=>e.jsx(_,{image:s.image,label:s.name??e.jsx(t,{message:"Visitor"}),description:s.email,alwaysShowAvatar:!0,avatarLabel:"Visitor"})},{key:"created_at",allowsSorting:!0,header:()=>e.jsx(t,{message:"Assigned at"}),body:s=>e.jsx(se,{date:s.created_at})}];function Xe(){const{roleId:s}=O(["roleId"]),a=ee(f.roles.get(s));return a.data.role.guests||a.data.role.type==="workspace"?e.jsx("div",{className:"pb-10 pt-30",children:e.jsx(U,{image:v,title:e.jsx(t,{message:"Users can't be assigned to this role"})})}):e.jsx(de,{role:a.data.role})}function de({role:s}){const[a,r]=h.useState([]),{searchParams:o,sortDescriptor:p,mergeIntoSearchParams:m,setSearchQuery:c,isFiltering:u}=H(z),i=L({...f.users.index({...o,roleId:`${s.id}`}),placeholderData:V});return e.jsxs("div",{children:[e.jsx($,{query:i}),e.jsx(B,{searchValue:o.query,onSearchChange:c,actions:e.jsx(ce,{role:s}),selectedItems:a,selectedActions:e.jsx(ue,{role:s,selectedIds:a})}),e.jsxs(J,{children:[e.jsx(X,{columns:me,data:i.items,sortDescriptor:p,onSortChange:m,enableSelection:!0,selectedRows:a,onSelectionChange:n=>r(n)}),i.isEmpty?e.jsx(U,{image:v,isFiltering:u,title:e.jsx(t,{message:"No users have been assigned to this role yet"}),filteringTitle:e.jsx(t,{message:"No matching users"})}):null,e.jsx(G,{query:i,onPageChange:n=>m({page:n}),onPerPageChange:n=>m({perPage:n})})]})]})}function ce({role:s}){const a=oe(s);return e.jsxs(C,{type:"modal",onClose:r=>{r&&a.mutate({userIds:[r.id]},{onSuccess:()=>{T.invalidateQueries({queryKey:W("users",{roleId:`${s.id}`})})}})},children:[e.jsx(g,{variant:"flat",color:"primary",disabled:a.isPending,children:e.jsx(t,{message:"Assign user"})}),e.jsx(re,{})]})}function ue({role:s,selectedIds:a}){const r=ne(s);return e.jsxs(C,{type:"modal",onClose:o=>{o&&r.mutate({userIds:a},{onSuccess:()=>{T.invalidateQueries({queryKey:f.users.invalidateKey})}})},children:[e.jsx(g,{variant:"flat",color:"danger",disabled:r.isPending,children:e.jsx(t,{message:"Remove users"})}),e.jsx(ae,{title:e.jsx(t,{message:"Remove users from role?"}),body:e.jsx(t,{message:"This will permanently remove the users from this role."}),confirm:e.jsx(t,{message:"Remove"}),isDanger:!0})]})}export{Xe as Component,ue as RemoveUsersAction};
