{"version":3,"file":"file-entry-index-page-BCvBsn5l.js","sources":["../../../common/foundation/resources/client/admin/file-entry/upload.svg","../../../common/foundation/resources/client/admin/file-entry/file-entry-index-page.tsx"],"sourcesContent":["export default \"__VITE_ASSET__B4M9R_gT__\"","import {AdminDocsUrls} from '@app/admin/admin-config';\nimport {commonAdminQueries} from '@common/admin/common-admin-queries';\nimport {DocsLink} from '@common/admin/settings/layout/settings-links';\nimport {GlobalLoadingProgress} from '@common/core/global-loading-progress';\nimport {DataTableHeader} from '@common/datatable/data-table-header';\nimport {DataTablePaginationFooter} from '@common/datatable/data-table-pagination-footer';\nimport {useDatatableSearchParams} from '@common/datatable/filters/utils/use-datatable-search-params';\nimport {validateDatatableSearch} from '@common/datatable/filters/utils/validate-datatable-search';\nimport {DatatableFilters} from '@common/datatable/page/datatable-filters';\nimport {\n  DatatablePageHeaderBar,\n  DatatablePageScrollContainer,\n  DatatablePageWithHeaderBody,\n  DatatablePageWithHeaderLayout,\n} from '@common/datatable/page/datatable-page-with-header-layout';\nimport {useDatatableQuery} from '@common/datatable/requests/use-datatable-query';\nimport {apiClient, queryClient} from '@common/http/query-client';\nimport {showHttpErrorToast} from '@common/http/show-http-error-toast';\nimport {Table} from '@common/ui/tables/table';\nimport {FilePreviewDialog} from '@common/uploads/components/file-preview/file-preview-dialog';\nimport {FileTypeIcon} from '@common/uploads/components/file-type-icon/file-type-icon';\nimport {useMutation} from '@tanstack/react-query';\nimport {Button} from '@ui/buttons/button';\nimport {IconButton} from '@ui/buttons/icon-button';\nimport {FormattedBytes} from '@ui/i18n/formatted-bytes';\nimport {FormattedDate} from '@ui/i18n/formatted-date';\nimport {message} from '@ui/i18n/message';\nimport {Trans} from '@ui/i18n/trans';\nimport {CheckIcon} from '@ui/icons/material/Check';\nimport {CloseIcon} from '@ui/icons/material/Close';\nimport {VisibilityIcon} from '@ui/icons/material/Visibility';\nimport {ConfirmationDialog} from '@ui/overlays/dialog/confirmation-dialog';\nimport {useDialogContext} from '@ui/overlays/dialog/dialog-context';\nimport {DialogTrigger} from '@ui/overlays/dialog/dialog-trigger';\nimport {toast} from '@ui/toast/toast';\nimport {User} from '@ui/types/user';\nimport {Fragment, useState} from 'react';\nimport {ColumnConfig} from '../../datatable/column-config';\nimport {NameWithAvatar} from '../../datatable/column-templates/name-with-avatar';\nimport {DataTableEmptyStateMessage} from '../../datatable/page/data-table-emty-state-message';\nimport {FileEntry} from '../../uploads/file-entry';\nimport {FILE_ENTRY_INDEX_FILTERS} from './file-entry-index-filters';\nimport uploadSvg from './upload.svg';\n\nconst columnConfig: ColumnConfig<FileEntry>[] = [\n  {\n    key: 'name',\n    allowsSorting: true,\n    visibleInMode: 'all',\n    width: 'flex-3 min-w-200',\n    header: () => <Trans message=\"Name\" />,\n    body: entry => (\n      <Fragment>\n        <div className=\"overflow-x-hidden overflow-ellipsis\">{entry.name}</div>\n        <div className=\"overflow-x-hidden overflow-ellipsis text-xs text-muted\">\n          {entry.file_name}\n        </div>\n      </Fragment>\n    ),\n  },\n  {\n    key: 'owner_id',\n    allowsSorting: true,\n    width: 'flex-3 min-w-200',\n    header: () => <Trans message=\"Uploader\" />,\n    body: entry => {\n      const owner =\n        entry.users?.find(user => user.owns_entry) ?? entry.users?.[0];\n      if (!owner) return null;\n      return (\n        <NameWithAvatar\n          image={(owner as User).image}\n          label={(owner as User).name}\n          description={owner.email}\n        />\n      );\n    },\n  },\n  {\n    key: 'type',\n    width: 'w-100 flex-shrink-0',\n    allowsSorting: true,\n    header: () => <Trans message=\"Type\" />,\n    body: entry => (\n      <div className=\"flex items-center gap-12\">\n        <FileTypeIcon type={entry.type} className=\"h-24 w-24 overflow-hidden\" />\n        <div className=\"capitalize\">{entry.type}</div>\n      </div>\n    ),\n  },\n  {\n    key: 'public',\n    allowsSorting: true,\n    width: 'w-60 flex-shrink-0',\n    header: () => <Trans message=\"Public\" />,\n    body: entry =>\n      entry.public ? (\n        <CheckIcon className=\"text-positive icon-md\" />\n      ) : (\n        <CloseIcon className=\"text-danger icon-md\" />\n      ),\n  },\n  {\n    key: 'file_size',\n    allowsSorting: true,\n    maxWidth: 'max-w-100',\n    header: () => <Trans message=\"File size\" />,\n    body: entry => <FormattedBytes bytes={entry.file_size} />,\n  },\n  {\n    key: 'updated_at',\n    allowsSorting: true,\n    width: 'w-100',\n    header: () => <Trans message=\"Last updated\" />,\n    body: entry => <FormattedDate date={entry.updated_at} />,\n  },\n  {\n    key: 'actions',\n    header: () => <Trans message=\"Actions\" />,\n    hideHeader: true,\n    align: 'end',\n    width: 'w-42 flex-shrink-0',\n    visibleInMode: 'all',\n    body: entry => {\n      return (\n        <DialogTrigger type=\"modal\">\n          <IconButton size=\"md\" className=\"text-muted\">\n            <VisibilityIcon />\n          </IconButton>\n          <FilePreviewDialog entries={[entry]} />\n        </DialogTrigger>\n      );\n    },\n  },\n];\n\nexport function Component() {\n  const [selectedIds, setSelectedIds] = useState<(number | string)[]>([]);\n  const {\n    searchParams,\n    sortDescriptor,\n    mergeIntoSearchParams,\n    setSearchQuery,\n    isFiltering,\n  } = useDatatableSearchParams(validateDatatableSearch);\n\n  const query = useDatatableQuery(\n    commonAdminQueries.fileEntries.index(searchParams),\n  );\n\n  const selectedActions = (\n    <DialogTrigger type=\"modal\">\n      <Button variant=\"flat\" color=\"danger\">\n        <Trans message=\"Delete\" />\n      </Button>\n      <DeleteEntriesDialog\n        selectedIds={selectedIds}\n        onDelete={() => setSelectedIds([])}\n      />\n    </DialogTrigger>\n  );\n\n  return (\n    <DatatablePageWithHeaderLayout>\n      <GlobalLoadingProgress query={query} />\n      <DatatablePageHeaderBar\n        title={<Trans message=\"Uploaded files and folders\" />}\n        showSidebarToggleButton\n        rightContent={\n          <DocsLink\n            variant=\"button\"\n            link={AdminDocsUrls.pages.files}\n            size=\"xs\"\n          />\n        }\n      />\n      <DatatablePageWithHeaderBody>\n        <DataTableHeader\n          searchValue={searchParams.query}\n          onSearchChange={setSearchQuery}\n          selectedItems={selectedIds}\n          selectedActions={selectedActions}\n          filters={FILE_ENTRY_INDEX_FILTERS}\n        />\n        <DatatableFilters filters={FILE_ENTRY_INDEX_FILTERS} />\n        <DatatablePageScrollContainer>\n          <Table\n            columns={columnConfig}\n            data={query.items}\n            sortDescriptor={sortDescriptor}\n            onSortChange={mergeIntoSearchParams}\n            enableSelection\n            selectedRows={selectedIds}\n            onSelectionChange={setSelectedIds}\n          />\n          {query.isEmpty && (\n            <DataTableEmptyStateMessage\n              isFiltering={isFiltering}\n              image={uploadSvg}\n              title={<Trans message=\"Nothing has been uploaded yet\" />}\n              filteringTitle={<Trans message=\"No matching files or folders\" />}\n            />\n          )}\n          <DataTablePaginationFooter\n            query={query}\n            onPageChange={page => mergeIntoSearchParams({page})}\n            onPerPageChange={perPage => mergeIntoSearchParams({perPage})}\n          />\n        </DatatablePageScrollContainer>\n      </DatatablePageWithHeaderBody>\n    </DatatablePageWithHeaderLayout>\n  );\n}\n\ninterface DeleteEntriesDialogProps {\n  selectedIds: (number | string)[];\n  onDelete: () => void;\n}\nfunction DeleteEntriesDialog({\n  selectedIds,\n  onDelete,\n}: DeleteEntriesDialogProps) {\n  const {close} = useDialogContext();\n  const deleteSelectedEntries = useMutation({\n    mutationFn: () => apiClient.delete(`file-entries/${selectedIds.join(',')}`),\n    onSuccess: async () => {\n      await queryClient.invalidateQueries({\n        queryKey: commonAdminQueries.fileEntries.invalidateKey,\n      });\n      toast(message('File entries deleted'));\n      onDelete();\n      close();\n    },\n    onError: err => showHttpErrorToast(err),\n  });\n  return (\n    <ConfirmationDialog\n      isDanger\n      isLoading={deleteSelectedEntries.isPending}\n      title={<Trans message=\"Delete file entries\" />}\n      body={\n        <Trans\n          message=\"Are you sure you want to delete selected file entries?\"\n          values={{count: selectedIds.length}}\n        />\n      }\n      confirm={<Trans message=\"Delete\" />}\n      onConfirm={() => deleteSelectedEntries.mutate()}\n    />\n  );\n}\n"],"names":["uploadSvg","columnConfig","jsx","Trans","entry","jsxs","Fragment","owner","_a","user","_b","NameWithAvatar","FileTypeIcon","CheckIcon","CloseIcon","FormattedBytes","FormattedDate","DialogTrigger","IconButton","VisibilityIcon","FilePreviewDialog","Component","selectedIds","setSelectedIds","useState","searchParams","sortDescriptor","mergeIntoSearchParams","setSearchQuery","isFiltering","useDatatableSearchParams","validateDatatableSearch","query","useDatatableQuery","commonAdminQueries","selectedActions","Button","DeleteEntriesDialog","DatatablePageWithHeaderLayout","GlobalLoadingProgress","DatatablePageHeaderBar","DocsLink","AdminDocsUrls","DatatablePageWithHeaderBody","DataTableHeader","FILE_ENTRY_INDEX_FILTERS","DatatableFilters","DatatablePageScrollContainer","Table","DataTableEmptyStateMessage","DataTablePaginationFooter","page","perPage","onDelete","close","useDialogContext","deleteSelectedEntries","useMutation","apiClient","queryClient","toast","message","err","showHttpErrorToast","ConfirmationDialog"],"mappings":"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"}