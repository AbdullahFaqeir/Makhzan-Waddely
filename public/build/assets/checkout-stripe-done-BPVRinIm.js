import{b3 as p,aD as h,g as k,aA as S,r as n,j as u,x as t,k as _}from"./main-TIUJvpaR.js";import{l as w}from"./index-U9JJOqTM.js";import{B as x}from"./billing-redirect-message-yudZRzMw.js";import{C,a as L}from"./checkout-product-summary-CrBTjCGM.js";import"./TaskAlt-S5LLkcsW.js";import"./skeleton-uSF3jNnm.js";import"./billing-queries-D1QXfRse.js";import"./formatted-price-BnJL0Dzb.js";import"./product-feature-list-jOnIJ0MT.js";function $(){const{productId:e,priceId:s}=p(),r=h(),{billing:{stripe_public_key:l}}=k(),[b]=S(),a=b.get("payment_intent_client_secret"),[d,o]=n.useState(),g=n.useRef(!1);return n.useEffect(()=>{g.current||(w(l).then(async m=>{if(!m||!a){o(c());return}m.retrievePaymentIntent(a).then(async({paymentIntent:i})=>{(i==null?void 0:i.status)==="succeeded"?(await y(i.id),o(c("succeeded",e,s)),window.location.href="/billing"):o(c(i==null?void 0:i.status,e,s))})}),g.current=!0)},[l,a,s,e]),a?u.jsxs(C,{children:[u.jsx(x,{config:d}),u.jsx(L,{showBillingLine:!1})]}):(r("/"),null)}function c(e,s,r){switch(e){case"succeeded":return{message:t("Subscription successful!"),status:"success",buttonLabel:t("Return to site"),link:"/billing"};case"processing":return{message:t("Payment processing. We'll update you when payment is received."),status:"success",buttonLabel:t("Return to site"),link:"/billing"};case"requires_payment_method":return{message:t("Payment failed. Please try another payment method."),status:"error",buttonLabel:t("Go back"),link:f(s,r)};default:return{message:t("Something went wrong"),status:"error",buttonLabel:t("Go back"),link:f(s,r)}}}function f(e,s){return e&&s?`/checkout/${e}/${s}`:"/"}function y(e){return _.post("billing/stripe/store-subscription-details-locally",{payment_intent_id:e})}export{$ as Component};
